###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                31/Aug/2010  17:07:29 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\Source\zcl_samp #
#                          lesw.c                                             #
#    Command line       =  -f D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-C #
#                          C2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projec #
#                          ts\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\ #
#                          ..\..\Tools\CC2530DB\f8wEndev.cfg (-DCPU32MHZ      #
#                          -DROOT=__near_func -DBLINK_LEDS) -f                #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\Tools\CC2530DB\f8wConfig.cfg (-DSECURE=0        #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          -f D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-C #
#                          C2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projec #
#                          ts\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\ #
#                          ..\..\Tools\CC2530DB\f8wZCL.cfg (-DZCL_READ        #
#                          -DZCL_WRITE -DZCL_BASIC -DZCL_IDENTIFY             #
#                          -DZCL_ON_OFF -DZCL_KEY_ESTABLISH                   #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING) -DZCL_MESSAGE                       #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\Source\zcl_samp #
#                          lesw.c -D NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D  #
#                          MT_APP_FUNC -D MT_SYS_FUNC -D MT_ZDO_FUNC -D       #
#                          LCD_SUPPORTED=DEBUG -D xPOWER_SAVING -lC           #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\EndDev #
#                          iceKB\List\ -lA D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stac #
#                          k_Ex\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\EndDeviceKB\List\ --diag_suppress        #
#                          Pe001,Pa010 -o D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack #
#                          _Ex\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0- #
#                          1.4.0\Projects\zstack\HomeAutomation\SampleSwitch\ #
#                          CC2530DB\EndDeviceKB\Obj\ -e --require_prototypes  #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-C #
#                          C2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projec #
#                          ts\zstack\HomeAutomation\SampleSwitch\CC2530DB\    #
#                          -I D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-C #
#                          C2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projec #
#                          ts\zstack\HomeAutomation\SampleSwitch\CC2530DB\..\ #
#                          SOURCE\ -I D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ #
#                          ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4. #
#                          0\Projects\zstack\HomeAutomation\SampleSwitch\CC25 #
#                          30DB\..\..\SOURCE\ -I D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_ #
#                          Z-Stack_Ex\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530 #
#                          -2.3.0-1.4.0\Projects\zstack\HomeAutomation\Sample #
#                          Switch\CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I        #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MT\ -I                         #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\HAL\INCLUDE\ -I                #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\ -I        #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\OSAL\MCU\CCSOC\ -I             #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\OSAL\INCLUDE\ -I               #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\AF\ -I                   #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\NWK\ -I                  #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\SEC\ -I                  #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\SAPI\ -I                 #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\SYS\ -I                  #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\ZCL\ -I                  #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\ZDO\ -I                  #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\ZMAC\F8W\ -I                   #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\ZMAC\ -I                       #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\SERVICES\SADDR\ -I             #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\SERVICES\SDATA\ -I             #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MAC\INCLUDE\ -I                #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MAC\HIGH_LEVEL\ -I             #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ -I        #
#                          D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHI #
#                          P\ -I "C:\IAR Systems\Embedded Workbench MCS       #
#                          51\8051\INC\" -I "C:\IAR Systems\Embedded          #
#                          Workbench MCS 51\8051\INC\CLIB\" -Ohz              #
#    List file          =  D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\EndDev #
#                          iceKB\List\zcl_samplesw.lst                        #
#    Object file        =  D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC25 #
#                          30-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\EndDev #
#                          iceKB\Obj\zcl_samplesw.r51                         #
#                                                                             #
#                                                                             #
###############################################################################

D:\Z-Stack¾ã²zCode\±Ð¾Ç¼Ò²Õ_Z-Stack_Ex\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\HomeAutomation\SampleSwitch\Source\zcl_samplesw.c
      1          /**************************************************************************************************
      2            Filename:       zcl_samplesw.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Zigbee Cluster Library - sample device application.
      7          
      8          
      9            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This device will be like an On/Off Switch device. This application
     42            is not intended to be a On/Off Switch device, but will use the device
     43            description to implement this sample code.
     44          *********************************************************************/
     45          
     46          /*********************************************************************
     47           * INCLUDES
     48           */
     49          #include "ZComDef.h"
     50          #include "OSAL.h"
     51          #include "AF.h"
     52          #include "ZDApp.h"
     53          #include "ZDObject.h"
     54          #include "ZDProfile.h"
     55          
     56          #include "zcl.h"
     57          #include "zcl_general.h"
     58          #include "zcl_ha.h"
     59          #include "zcl_samplesw.h"
     60          
     61          #include "onboard.h"
     62          
     63          /* HAL */
     64          #include "hal_lcd.h"
     65          #include "hal_led.h"
     66          #include "hal_key.h"
     67          
     68          /*********************************************************************
     69           * MACROS
     70           */
     71          
     72          /*********************************************************************
     73           * CONSTANTS
     74           */
     75          /*********************************************************************
     76           * TYPEDEFS
     77           */
     78          
     79          /*********************************************************************
     80           * GLOBAL VARIABLES
     81           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     82          byte zclSampleSw_TaskID;
   \                     zclSampleSw_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     83          
     84          /*********************************************************************
     85           * GLOBAL FUNCTIONS
     86           */
     87          
     88          /*********************************************************************
     89           * LOCAL VARIABLES
     90           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     91          static afAddrType_t zclSampleSw_DstAddr;
   \                     zclSampleSw_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
     92          
     93          #define ZCLSAMPLESW_BINDINGLIST       1

   \                                 In  segment XDATA_I, align 1, keep-with-next
     94          static cId_t bindingOutClusters[ZCLSAMPLESW_BINDINGLIST] =
   \                     bindingOutClusters:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for bindingOutClusters>`
   \   000002                REQUIRE __INIT_XDATA_I
     95          {
     96            ZCL_CLUSTER_ID_GEN_ON_OFF
     97          };
     98          
     99          // Test Endpoint to allow SYS_APP_MSGs

   \                                 In  segment XDATA_I, align 1, keep-with-next
    100          static endPointDesc_t sampleSw_TestEp =
   \                     sampleSw_TestEp:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for sampleSw_TestEp>`
   \   000006                REQUIRE __INIT_XDATA_I
    101          {
    102            20,                                 // Test endpoint
    103            &zclSampleSw_TaskID,
    104            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for this test endpoint
    105            (afNetworkLatencyReq_t)0            // No Network Latency req
    106          };
    107          
    108          
    109          /*********************************************************************
    110           * LOCAL FUNCTIONS
    111           */
    112          static void zclSampleSw_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    113          static void zclSampleSw_HandleKeys( byte shift, byte keys );
    114          static void zclSampleSw_BasicResetCB( void );
    115          static void zclSampleSw_IdentifyCB( zclIdentify_t *pCmd );
    116          static void zclSampleSw_IdentifyQueryRspCB(  zclIdentifyQueryRsp_t *pRsp );
    117          static void zclSampleSw_ProcessIdentifyTimeChange( void );
    118          
    119          // Functions to process ZCL Foundation incoming Command/Response messages
    120          static void zclSampleSw_ProcessIncomingMsg( zclIncomingMsg_t *msg );
    121          #ifdef ZCL_READ
    122          static uint8 zclSampleSw_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg );
    123          #endif
    124          #ifdef ZCL_WRITE
    125          static uint8 zclSampleSw_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg );
    126          #endif
    127          static uint8 zclSampleSw_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg );
    128          #ifdef ZCL_DISCOVER
    129          static uint8 zclSampleSw_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg );
    130          #endif
    131          
    132          void GenericApp_SendTheMessage( void );
    133          
    134          /*********************************************************************
    135           * ZCL General Profile Callback table
    136           */

   \                                 In  segment XDATA_I, align 1, keep-with-next
    137          static zclGeneral_AppCallbacks_t zclSampleSw_CmdCallbacks =
   \                     zclSampleSw_CmdCallbacks:
   \   000000                DS 30
   \   00001E                REQUIRE `?<Initializer for zclSampleSw_CmdCallbacks>`
   \   00001E                REQUIRE __INIT_XDATA_I
    138          {
    139            zclSampleSw_BasicResetCB,     // Basic Cluster Reset command
    140            zclSampleSw_IdentifyCB,       // Identify command
    141            zclSampleSw_IdentifyQueryRspCB, // Identify Query Response command
    142            NULL,                         // On / Off cluster command - not needed.
    143            NULL,                         // Level Control Move to Level command
    144            NULL,                         // Level Control Move command
    145            NULL,                         // Level Control Step command
    146            NULL,                         // Group Response commands
    147            NULL,                         // Scene Store Request command
    148            NULL,                         // Scene Recall Request command
    149            NULL,                         // Scene Response commands
    150            NULL,                         // Alarm (Response) commands
    151            NULL,                         // RSSI Location commands
    152            NULL,                         // RSSI Location Response commands
    153          };
    154          
    155          
    156          /*********************************************************************
    157           * @fn          zclSampleSw_Init
    158           *
    159           * @brief       Initialization function for the zclGeneral layer.
    160           *
    161           * @param       none
    162           *
    163           * @return      none
    164           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    165          void zclSampleSw_Init( byte task_id )
   \                     zclSampleSw_Init:
    166          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    167            zclSampleSw_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000008   F0           MOVX    @DPTR,A
    168          
    169            // Set destination address to indirect
    170            zclSampleSw_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent; //¶Ç°e¼Ò¦¡-AddrNotPresent=0; AddrBroadcast=15(¼s¼½)
   \   000009   E4           CLR     A
   \   00000A   90....       MOV     DPTR,#(zclSampleSw_DstAddr + 8)
   \   00000D   F0           MOVX    @DPTR,A
    171            zclSampleSw_DstAddr.endPoint = 0;                            //¹ï¶HÀ³¥Îµ{¦¡ID
   \   00000E   90....       MOV     DPTR,#(zclSampleSw_DstAddr + 9)
   \   000011   F0           MOVX    @DPTR,A
    172            zclSampleSw_DstAddr.addr.shortAddr = 0;                      //¼s¼½¤º©w¦a§}
   \   000012   90....       MOV     DPTR,#zclSampleSw_DstAddr
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   F0           MOVX    @DPTR,A
    173            
    174            // This app is part of the Home Automation Profile
    175            zclHA_Init( &zclSampleSw_SimpleDesc );                       
   \   000018                ; Setup parameters for call to function zclHA_Init
   \   000018   7A..         MOV     R2,#(zclSampleSw_SimpleDesc & 0xff)
   \   00001A   7B..         MOV     R3,#((zclSampleSw_SimpleDesc >> 8) & 0xff)
   \   00001C   12....       LCALL   ??zclHA_Init?relay
    176          
    177            // Register the ZCL General Cluster Library callback functions
    178            zclGeneral_RegisterCmdCallbacks( SAMPLESW_ENDPOINT, &zclSampleSw_CmdCallbacks );
   \   00001F                ; Setup parameters for call to function zclGeneral_RegisterCmdCallbacks
   \   00001F   7A..         MOV     R2,#(zclSampleSw_CmdCallbacks & 0xff)
   \   000021   7B..         MOV     R3,#((zclSampleSw_CmdCallbacks >> 8) & 0xff)
   \   000023   790C         MOV     R1,#0xc
   \   000025   12....       LCALL   ??zclGeneral_RegisterCmdCallbacks?relay
    179          
    180            // Register the application's attribute list
    181            zcl_registerAttrList( SAMPLESW_ENDPOINT, SAMPLESW_MAX_ATTRIBUTES, zclSampleSw_Attrs );
   \   000028                ; Setup parameters for call to function zcl_registerAttrList
   \   000028   7C..         MOV     R4,#(zclSampleSw_Attrs & 0xff)
   \   00002A   7D..         MOV     R5,#((zclSampleSw_Attrs >> 8) & 0xff)
   \   00002C   7A0B         MOV     R2,#0xb
   \   00002E   790C         MOV     R1,#0xc
   \   000030   12....       LCALL   ??zcl_registerAttrList?relay
    182          
    183            // Register the Application to receive the unprocessed Foundation command/response messages
    184            zcl_registerForMsg( zclSampleSw_TaskID );
   \   000033                ; Setup parameters for call to function zcl_registerForMsg
   \   000033   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F9           MOV     R1,A
   \   000038   12....       LCALL   ??zcl_registerForMsg?relay
    185          
    186            // Register for all key events - This app will handle all key events
    187            RegisterForKeys( zclSampleSw_TaskID );
   \   00003B                ; Setup parameters for call to function RegisterForKeys
   \   00003B   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F9           MOV     R1,A
   \   000040   12....       LCALL   ??RegisterForKeys?relay
    188          
    189            // Register for a test endpoint
    190            afRegister( &sampleSw_TestEp );
   \   000043                ; Setup parameters for call to function afRegister
   \   000043   7A..         MOV     R2,#(sampleSw_TestEp & 0xff)
   \   000045   7B..         MOV     R3,#((sampleSw_TestEp >> 8) & 0xff)
   \   000047   12....       LCALL   ??afRegister?relay
    191          
    192            ZDO_RegisterForZDOMsg( zclSampleSw_TaskID, End_Device_Bind_rsp );
   \   00004A                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00004A   7A20         MOV     R2,#0x20
   \   00004C   7B80         MOV     R3,#-0x80
   \   00004E   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F9           MOV     R1,A
   \   000053   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    193            ZDO_RegisterForZDOMsg( zclSampleSw_TaskID, Match_Desc_rsp );
   \   000056                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000056   7A06         MOV     R2,#0x6
   \   000058   7B80         MOV     R3,#-0x80
   \   00005A   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F9           MOV     R1,A
   \   00005F   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    194          }
   \   000062                REQUIRE ?Subroutine2
   \   000062                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    195          
    196          /*********************************************************************
    197           * @fn          zclSample_event_loop
    198           *
    199           * @brief       Event Loop Processor for zclGeneral.
    200           *
    201           * @param       none
    202           *
    203           * @return      none
    204           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    205          uint16 zclSampleSw_event_loop( uint8 task_id, uint16 events )
   \                     zclSampleSw_event_loop:
    206          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    207            afIncomingMSGPacket_t *MSGpkt;
    208            (void)task_id;  // Intentionally unreferenced parameter
    209            
    210            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   55..         ANL     A,?V0 + 1
   \   00000D   F9           MOV     R1,A
   \   00000E   E4           CLR     A
   \   00000F   7001         JNZ     ??zclSampleSw_event_loop_0
   \   000011   E9           MOV     A,R1
   \                     ??zclSampleSw_event_loop_0:
   \   000012   7039         JNZ     ??zclSampleSw_event_loop_1
    211            {
    212              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclSampleSw_TaskID )) )
    213              { 
    214                switch ( MSGpkt->hdr.event )
    215                {
    216                  case ZCL_INCOMING_MSG:
    217                    // Incoming ZCL Foundation command/response messages
    218                    zclSampleSw_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );          
    219                    break;
    220          
    221                  case ZDO_CB_MSG:
    222                    zclSampleSw_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    223                    break;
    224          
    225                  case KEY_CHANGE:
    226                    zclSampleSw_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    227                    break;
    228          
    229                  default:
    230                    break;
    231                }
    232          
    233                // Release the memory
    234                osal_msg_deallocate( (uint8 *)MSGpkt );
    235              }
    236              
    237              // return unprocessed events
    238              return (events ^ SYS_EVENT_MSG);
    239            }
    240          
    241            if ( events & SAMPLESW_IDENTIFY_TIMEOUT_EVT )
   \   000014   EA           MOV     A,R2
   \   000015   A2E0         MOV     C,0xE0 /* A   */.0
   \   000017   4003         JC      $+5
   \   000019   02....       LJMP    ??zclSampleSw_event_loop_2 & 0xFFFF
    242            {
    243              zclSampleSw_IdentifyTime = 10;
   \   00001C   90....       MOV     DPTR,#zclSampleSw_IdentifyTime
   \   00001F   740A         MOV     A,#0xa
   \   000021   F0           MOVX    @DPTR,A
   \   000022   A3           INC     DPTR
   \   000023   E4           CLR     A
   \   000024   F0           MOVX    @DPTR,A
    244              zclSampleSw_ProcessIdentifyTimeChange();
   \   000025                ; Setup parameters for call to function zclSampleSw_ProcessIdentifyTimeChange
   \   000025   12....       LCALL   ??zclSampleSw_ProcessIdentifyTimeChange?relay
    245              
    246              return ( events ^ SAMPLESW_IDENTIFY_TIMEOUT_EVT );
   \   000028   7401         MOV     A,#0x1
   \   00002A   65..         XRL     A,?V0 + 0
   \   00002C   FA           MOV     R2,A
   \   00002D   AB..         MOV     R3,?V0 + 1
   \   00002F   02....       LJMP    ??zclSampleSw_event_loop_3 & 0xFFFF
    247            }
   \                     ??zclSampleSw_event_loop_4:
   \   000032                ; Setup parameters for call to function zclSampleSw_HandleKeys
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FA           MOV     R2,A
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??zclSampleSw_HandleKeys?relay
   \                     ??zclSampleSw_event_loop_5:
   \   000046                ; Setup parameters for call to function osal_msg_deallocate
   \   000046   EE           MOV     A,R6
   \   000047   FA           MOV     R2,A
   \   000048   EF           MOV     A,R7
   \   000049   FB           MOV     R3,A
   \   00004A   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??zclSampleSw_event_loop_1:
   \   00004D                ; Setup parameters for call to function osal_msg_receive
   \   00004D   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   12....       LCALL   ??osal_msg_receive?relay
   \   000055   8A..         MOV     ?V0 + 2,R2
   \   000057   8B..         MOV     ?V0 + 3,R3
   \   000059   AE..         MOV     R6,?V0 + 2
   \   00005B   AF..         MOV     R7,?V0 + 3
   \   00005D   EE           MOV     A,R6
   \   00005E   7001         JNZ     ??zclSampleSw_event_loop_6
   \   000060   EF           MOV     A,R7
   \                     ??zclSampleSw_event_loop_6:
   \   000061   7003         JNZ     $+5
   \   000063   02....       LJMP    ??zclSampleSw_event_loop_7 & 0xFFFF
   \   000066   8E82         MOV     DPL,R6
   \   000068   8F83         MOV     DPH,R7
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for zclSampleSw_event_loop>_0`:
   \   00006E   00           DB        0
   \   00006F   03           DB        3
   \   000070   34           DB        52
   \   000071   ....         DW        ??zclSampleSw_event_loop_8
   \   000073   C0           DB        192
   \   000074   ....         DW        ??zclSampleSw_event_loop_4
   \   000076   D3           DB        211
   \   000077   ....         DW        ??zclSampleSw_event_loop_9
   \   000079   ....         DW        ??zclSampleSw_event_loop_5
   \                     ??zclSampleSw_event_loop_8:
   \   00007B   8E82         MOV     DPL,R6
   \   00007D   8F83         MOV     DPH,R7
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   A3           INC     DPTR
   \   000086   E0           MOVX    A,@DPTR
   \   000087   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for zclSampleSw_event_loop>_1`:
   \   00008A   00           DB        0
   \   00008B   02           DB        2
   \   00008C   01           DB        1
   \   00008D   ....         DW        ??zclSampleSw_event_loop_10
   \   00008F   04           DB        4
   \   000090   ....         DW        ??zclSampleSw_event_loop_11
   \   000092   ....         DW        ??zclSampleSw_event_loop_12
   \                     ??zclSampleSw_event_loop_10:
   \   000094   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000097   E0           MOVX    A,@DPTR
   \   000098   FA           MOV     R2,A
   \   000099   EB           MOV     A,R3
   \   00009A   C3           CLR     C
   \   00009B   9A           SUBB    A,R2
   \   00009C   5010         JNC     ??zclSampleSw_event_loop_12
   \   00009E   0B           INC     R3
   \   00009F   80F6         SJMP    ??CrossCallReturnLabel_0
   \                     ??zclSampleSw_event_loop_11:
   \   0000A1   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000A4   8001         SJMP    ??zclSampleSw_event_loop_13
   \                     ??zclSampleSw_event_loop_14:
   \   0000A6   0B           INC     R3
   \                     ??zclSampleSw_event_loop_13:
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   FA           MOV     R2,A
   \   0000A9   EB           MOV     A,R3
   \   0000AA   C3           CLR     C
   \   0000AB   9A           SUBB    A,R2
   \   0000AC   40F8         JC      ??zclSampleSw_event_loop_14
   \                     ??zclSampleSw_event_loop_12:
   \   0000AE   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   0000B1   FA           MOV     R2,A
   \   0000B2   A3           INC     DPTR
   \   0000B3   E0           MOVX    A,@DPTR
   \   0000B4   FB           MOV     R3,A
   \   0000B5   EA           MOV     A,R2
   \   0000B6   7001         JNZ     ??zclSampleSw_event_loop_15
   \   0000B8   EB           MOV     A,R3
   \                     ??zclSampleSw_event_loop_15:
   \   0000B9   608B         JZ      ??zclSampleSw_event_loop_5
   \   0000BB                ; Setup parameters for call to function osal_mem_free
   \                     ??zclSampleSw_event_loop_16:
   \   0000BB   12....       LCALL   ??osal_mem_free?relay
   \   0000BE   8086         SJMP    ??zclSampleSw_event_loop_5
   \                     ??zclSampleSw_event_loop_9:
   \   0000C0   EE           MOV     A,R6
   \   0000C1   240C         ADD     A,#0xc
   \   0000C3   F582         MOV     DPL,A
   \   0000C5   EF           MOV     A,R7
   \   0000C6   3400         ADDC    A,#0x0
   \   0000C8   F583         MOV     DPH,A
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   F5..         MOV     ?V0 + 2,A
   \   0000CD   A3           INC     DPTR
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   F5..         MOV     ?V0 + 3,A
   \   0000D1   78..         MOV     R0,#?V0 + 2
   \   0000D3   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for zclSampleSw_event_loop>_2`:
   \   0000D6   0000         DW        0
   \   0000D8   0200         DW        2
   \   0000DA   0680         DW        32774
   \   0000DC   ....         DW        ??zclSampleSw_event_loop_17
   \   0000DE   2080         DW        32800
   \   0000E0   ....         DW        ??zclSampleSw_event_loop_18
   \   0000E2   ....         DW        ??zclSampleSw_event_loop_5
   \                     ??zclSampleSw_event_loop_18:
   \   0000E4   EE           MOV     A,R6
   \   0000E5   2413         ADD     A,#0x13
   \   0000E7   F582         MOV     DPL,A
   \   0000E9   EF           MOV     A,R7
   \   0000EA   3400         ADDC    A,#0x0
   \   0000EC   F583         MOV     DPH,A
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F8           MOV     R0,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   F583         MOV     DPH,A
   \   0000F4   8882         MOV     DPL,R0
   \   0000F6   E0           MOVX    A,@DPTR
   \   0000F7   700A         JNZ     ??zclSampleSw_event_loop_19
   \   0000F9                ; Setup parameters for call to function HalLedSet
   \   0000F9   7A01         MOV     R2,#0x1
   \                     ??zclSampleSw_event_loop_20:
   \   0000FB   7901         MOV     R1,#0x1
   \   0000FD   12....       LCALL   ??HalLedSet?relay
   \   000100   02....       LJMP    ??zclSampleSw_event_loop_5 & 0xFFFF
   \                     ??zclSampleSw_event_loop_19:
   \   000103                ; Setup parameters for call to function HalLedSet
   \   000103   7A04         MOV     R2,#0x4
   \   000105   80F4         SJMP    ??zclSampleSw_event_loop_20
   \                     ??zclSampleSw_event_loop_17:
   \   000107                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000107   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   00010A   8A..         MOV     ?V0 + 2,R2
   \   00010C   8B..         MOV     ?V0 + 3,R3
   \   00010E   EA           MOV     A,R2
   \   00010F   7001         JNZ     ??zclSampleSw_event_loop_21
   \   000111   EB           MOV     A,R3
   \                     ??zclSampleSw_event_loop_21:
   \   000112   7003         JNZ     $+5
   \   000114   02....       LJMP    ??zclSampleSw_event_loop_5 & 0xFFFF
   \   000117   8A82         MOV     DPL,R2
   \   000119   8B83         MOV     DPH,R3
   \   00011B   E0           MOVX    A,@DPTR
   \   00011C   7032         JNZ     ??zclSampleSw_event_loop_22
   \   00011E   A3           INC     DPTR
   \   00011F   A3           INC     DPTR
   \   000120   A3           INC     DPTR
   \   000121   E0           MOVX    A,@DPTR
   \   000122   602C         JZ      ??zclSampleSw_event_loop_22
   \   000124   7402         MOV     A,#0x2
   \   000126   90....       MOV     DPTR,#(zclSampleSw_DstAddr + 8)
   \   000129   F0           MOVX    @DPTR,A
   \   00012A   8A82         MOV     DPL,R2
   \   00012C   8B83         MOV     DPH,R3
   \   00012E   A3           INC     DPTR
   \   00012F   E0           MOVX    A,@DPTR
   \   000130   F8           MOV     R0,A
   \   000131   A3           INC     DPTR
   \   000132   E0           MOVX    A,@DPTR
   \   000133   F9           MOV     R1,A
   \   000134   90....       MOV     DPTR,#zclSampleSw_DstAddr
   \   000137   E8           MOV     A,R0
   \   000138   F0           MOVX    @DPTR,A
   \   000139   A3           INC     DPTR
   \   00013A   E9           MOV     A,R1
   \   00013B   F0           MOVX    @DPTR,A
   \   00013C   8A82         MOV     DPL,R2
   \   00013E   8B83         MOV     DPH,R3
   \   000140   A3           INC     DPTR
   \   000141   A3           INC     DPTR
   \   000142   A3           INC     DPTR
   \   000143   A3           INC     DPTR
   \   000144   E0           MOVX    A,@DPTR
   \   000145   90....       MOV     DPTR,#(zclSampleSw_DstAddr + 9)
   \   000148   F0           MOVX    @DPTR,A
   \   000149                ; Setup parameters for call to function HalLedSet
   \   000149   7A01         MOV     R2,#0x1
   \   00014B   7901         MOV     R1,#0x1
   \   00014D   12....       LCALL   ??HalLedSet?relay
   \                     ??zclSampleSw_event_loop_22:
   \   000150                ; Setup parameters for call to function osal_mem_free
   \   000150   AA..         MOV     R2,?V0 + 2
   \   000152   AB..         MOV     R3,?V0 + 3
   \   000154   02....       LJMP    ??zclSampleSw_event_loop_16 & 0xFFFF
   \                     ??zclSampleSw_event_loop_7:
   \   000157   AA..         MOV     R2,?V0 + 0
   \   000159   7480         MOV     A,#-0x80
   \   00015B   65..         XRL     A,?V0 + 1
   \   00015D   FB           MOV     R3,A
   \   00015E   8004         SJMP    ??zclSampleSw_event_loop_3
    248          
    249            // Discard unknown events
    250            return 0;
   \                     ??zclSampleSw_event_loop_2:
   \   000160   7A00         MOV     R2,#0x0
   \   000162   7B00         MOV     R3,#0x0
   \                     ??zclSampleSw_event_loop_3:
   \   000164   7F06         MOV     R7,#0x6
   \   000166   02....       LJMP    ?BANKED_LEAVE_XDATA
    251          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000003   F8           MOV     R0,A
   \   000004   A3           INC     DPTR
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   8882         MOV     DPL,R0
   \   000009   8983         MOV     DPH,R1
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   EE           MOV     A,R6
   \   000001   2416         ADD     A,#0x16
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET
    252          
    253          /*********************************************************************
    254           * @fn      zclSampleSw_ProcessZDOMsgs()
    255           *
    256           * @brief   Process response messages
    257           *
    258           * @param   none
    259           *
    260           * @return  none
    261           */
    262          void zclSampleSw_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    263          {
    264            switch ( inMsg->clusterID )
    265            {
    266              case End_Device_Bind_rsp:
    267                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    268                {
    269                  // Light LED
    270                  HalLedSet( HAL_LED_1, HAL_LED_MODE_ON );
    271                }
    272          #if defined(BLINK_LEDS)
    273                else
    274                {
    275                  // Flash LED to show failure
    276                  HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );
    277                }
    278          #endif
    279                break;
    280          
    281              case Match_Desc_rsp:
    282                {
    283                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    284                  if ( pRsp )
    285                  {
    286                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    287                    {
    288                      zclSampleSw_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    289                      zclSampleSw_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    290                      // Take the first endpoint, Can be changed to search through endpoints
    291                      zclSampleSw_DstAddr.endPoint = pRsp->epList[0];
    292          
    293                      // Light LED
    294                      HalLedSet( HAL_LED_1, HAL_LED_MODE_ON );
    295                    }
    296                    osal_mem_free( pRsp );
    297                  }
    298                }
    299                break;
    300            }
    301          }
    302          
    303          /*********************************************************************
    304           * @fn      zclSampleSw_HandleKeys
    305           *
    306           * @brief   Handles all key events for this device.
    307           *
    308           * @param   shift - true if in shift/alt.
    309           * @param   keys - bit field for key events. Valid entries:
    310           *                 HAL_KEY_SW_4
    311           *                 HAL_KEY_SW_3
    312           *                 HAL_KEY_SW_2
    313           *                 HAL_KEY_SW_1
    314           *
    315           * @return  none
    316           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    317          static void zclSampleSw_HandleKeys( byte shift, byte keys )
   \                     zclSampleSw_HandleKeys:
    318          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FF           MOV     R7,A
    319            zAddrType_t dstAddr;
    320            (void)shift;  // Intentionally unreferenced parameter
    321          
    322            if ( keys & HAL_KEY_SW_1 )
   \   00000C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000E   5046         JNC     ??zclSampleSw_HandleKeys_0
    323            {
    324              // Using this as the "Light Switch"
    325          #ifdef ZCL_ON_OFF
    326              zclGeneral_SendOnOff_CmdToggle( SAMPLESW_ENDPOINT, &zclSampleSw_DstAddr, false, 0 );
   \   000010                ; Setup parameters for call to function zcl_SendCommand
   \   000010   75..00       MOV     ?V0 + 0,#0x0
   \   000013   75..00       MOV     ?V0 + 1,#0x0
   \   000016   78..         MOV     R0,#?V0 + 0
   \   000018   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001B   78..         MOV     R0,#?V0 + 0
   \   00001D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000020   78..         MOV     R0,#?V0 + 0
   \   000022   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   78..         MOV     R0,#?V0 + 0
   \   00002C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000034   75..01       MOV     ?V0 + 0,#0x1
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00003C   75..02       MOV     ?V0 + 0,#0x2
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000044   7C06         MOV     R4,#0x6
   \   000046   7D00         MOV     R5,#0x0
   \   000048   7A..         MOV     R2,#(zclSampleSw_DstAddr & 0xff)
   \   00004A   7B..         MOV     R3,#((zclSampleSw_DstAddr >> 8) & 0xff)
   \   00004C   790C         MOV     R1,#0xc
   \   00004E   12....       LCALL   ??zcl_SendCommand?relay
   \   000051   740B         MOV     A,#0xb
   \   000053   12....       LCALL   ?DEALLOC_XSTACK8
    327          #endif
    328            }
    329          
    330            if ( keys & HAL_KEY_SW_2 ) //binding request(¸j©wªº½Ð¨D)
   \                     ??zclSampleSw_HandleKeys_0:
   \   000056   EF           MOV     A,R7
   \   000057   A2E1         MOV     C,0xE0 /* A   */.1
   \   000059   5069         JNC     ??zclSampleSw_HandleKeys_1
    331            {
    332              HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF );
   \   00005B                ; Setup parameters for call to function HalLedSet
   \   00005B   7A00         MOV     R2,#0x0
   \   00005D   7902         MOV     R1,#0x2
   \   00005F   12....       LCALL   ??HalLedSet?relay
    333          
    334              // Initiate an End Device Bind Request, this bind request will
    335              // only use a cluster list that is important to binding.
    336              dstAddr.addrMode = afAddr16Bit;
   \   000062   7408         MOV     A,#0x8
   \   000064   12....       LCALL   ?XSTACK_DISP0_8
   \   000067   7402         MOV     A,#0x2
   \   000069   F0           MOVX    @DPTR,A
    337              dstAddr.addr.shortAddr = 0;   // Coordinator makes the match
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   E4           CLR     A
   \   000071   F0           MOVX    @DPTR,A
   \   000072   A3           INC     DPTR
   \   000073   F0           MOVX    @DPTR,A
    338              ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    339                                     SAMPLESW_ENDPOINT,
    340                                     ZCL_HA_PROFILE_ID,
    341                                     0, NULL,   // No incoming clusters to bind
    342                                     ZCLSAMPLESW_BINDINGLIST, bindingOutClusters,
    343                                     TRUE );
   \   000074                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000074   75..01       MOV     ?V0 + 0,#0x1
   \   000077   78..         MOV     R0,#?V0 + 0
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00007C   75....       MOV     ?V0 + 0,#(bindingOutClusters & 0xff)
   \   00007F   75....       MOV     ?V0 + 1,#((bindingOutClusters >> 8) & 0xff)
   \   000082   78..         MOV     R0,#?V0 + 0
   \   000084   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000087   75..01       MOV     ?V0 + 0,#0x1
   \   00008A   78..         MOV     R0,#?V0 + 0
   \   00008C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00008F   75..00       MOV     ?V0 + 0,#0x0
   \   000092   75..00       MOV     ?V0 + 1,#0x0
   \   000095   78..         MOV     R0,#?V0 + 0
   \   000097   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009A   78..         MOV     R0,#?V0 + 0
   \   00009C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00009F   75..04       MOV     ?V0 + 0,#0x4
   \   0000A2   75..01       MOV     ?V0 + 1,#0x1
   \   0000A5   78..         MOV     R0,#?V0 + 0
   \   0000A7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AA                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000AA   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000AD   EA           MOV     A,R2
   \   0000AE   FC           MOV     R4,A
   \   0000AF   EB           MOV     A,R3
   \   0000B0   FD           MOV     R5,A
   \   0000B1   790C         MOV     R1,#0xc
   \   0000B3   7409         MOV     A,#0x9
   \   0000B5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B8   AA82         MOV     R2,DPL
   \   0000BA   AB83         MOV     R3,DPH
   \   0000BC   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   0000BF   7409         MOV     A,#0x9
   \   0000C1   12....       LCALL   ?DEALLOC_XSTACK8
    344            }
    345          
    346            if ( keys & HAL_KEY_SW_3 )
    347            {
    348            }
    349          
    350            if ( keys & HAL_KEY_SW_4 ) //atuo binding(¦Û°Ê¸j©w¸Ë¸m)
   \                     ??zclSampleSw_HandleKeys_1:
   \   0000C4   EF           MOV     A,R7
   \   0000C5   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000C7   505C         JNC     ??zclSampleSw_HandleKeys_2
    351            {
    352              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON ); //«ö¤UHAL_KEY_SW_4®É,LED_4 off
   \   0000C9                ; Setup parameters for call to function HalLedSet
   \   0000C9   7A01         MOV     R2,#0x1
   \   0000CB   7901         MOV     R1,#0x1
   \   0000CD   12....       LCALL   ??HalLedSet?relay
    353          
    354              // Initiate a Match Description Request (Service Discovery)
    355              dstAddr.addrMode = AddrBroadcast;
   \   0000D0   7408         MOV     A,#0x8
   \   0000D2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D5   740F         MOV     A,#0xf
   \   0000D7   F0           MOVX    @DPTR,A
    356              dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   0000D8   85..82       MOV     DPL,?XSP + 0
   \   0000DB   85..83       MOV     DPH,?XSP + 1
   \   0000DE   74FF         MOV     A,#-0x1
   \   0000E0   F0           MOVX    @DPTR,A
   \   0000E1   A3           INC     DPTR
   \   0000E2   F0           MOVX    @DPTR,A
    357              ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    358                                 ZCL_HA_PROFILE_ID,
    359                                 ZCLSAMPLESW_BINDINGLIST, bindingOutClusters,
    360                                 0, NULL,   // No incoming clusters to bind
    361                                 FALSE );
   \   0000E3                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000E3   75..00       MOV     ?V0 + 0,#0x0
   \   0000E6   78..         MOV     R0,#?V0 + 0
   \   0000E8   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000EB   75..00       MOV     ?V0 + 1,#0x0
   \   0000EE   78..         MOV     R0,#?V0 + 0
   \   0000F0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F3   78..         MOV     R0,#?V0 + 0
   \   0000F5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000F8   75....       MOV     ?V0 + 0,#(bindingOutClusters & 0xff)
   \   0000FB   75....       MOV     ?V0 + 1,#((bindingOutClusters >> 8) & 0xff)
   \   0000FE   78..         MOV     R0,#?V0 + 0
   \   000100   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000103   75..04       MOV     ?V0 + 0,#0x4
   \   000106   75..01       MOV     ?V0 + 1,#0x1
   \   000109   78..         MOV     R0,#?V0 + 0
   \   00010B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00010E   7901         MOV     R1,#0x1
   \   000110   7CFF         MOV     R4,#-0x1
   \   000112   7DFF         MOV     R5,#-0x1
   \   000114   7408         MOV     A,#0x8
   \   000116   12....       LCALL   ?XSTACK_DISP0_8
   \   000119   AA82         MOV     R2,DPL
   \   00011B   AB83         MOV     R3,DPH
   \   00011D   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   000120   7408         MOV     A,#0x8
   \   000122   12....       LCALL   ?DEALLOC_XSTACK8
    362            }
    363          }
   \                     ??zclSampleSw_HandleKeys_2:
   \   000125   7409         MOV     A,#0x9
   \   000127   12....       LCALL   ?DEALLOC_XSTACK8
   \   00012A   7F02         MOV     R7,#0x2
   \   00012C   02....       LJMP    ?BANKED_LEAVE_XDATA
    364          
    365          /*********************************************************************
    366           * @fn      zclSampleSw_ProcessIdentifyTimeChange
    367           *
    368           * @brief   Called to process any change to the IdentifyTime attribute.
    369           *
    370           * @param   none
    371           *
    372           * @return  none
    373           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    374          static void zclSampleSw_ProcessIdentifyTimeChange( void )
   \                     zclSampleSw_ProcessIdentifyTimeChange:
    375          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    376            if ( zclSampleSw_IdentifyTime > 0 )
   \   000004   90....       MOV     DPTR,#zclSampleSw_IdentifyTime
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7002         JNZ     ??zclSampleSw_ProcessIdentifyTimeChange_0
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \                     ??zclSampleSw_ProcessIdentifyTimeChange_0:
   \   00000C   601F         JZ      ??zclSampleSw_ProcessIdentifyTimeChange_1
    377            {
    378              osal_start_timerEx( zclSampleSw_TaskID, SAMPLESW_IDENTIFY_TIMEOUT_EVT, 1000 );
   \   00000E                ; Setup parameters for call to function osal_start_timerEx
   \   00000E   7CE8         MOV     R4,#-0x18
   \   000010   7D03         MOV     R5,#0x3
   \   000012   7A01         MOV     R2,#0x1
   \   000014   7B00         MOV     R3,#0x0
   \   000016   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F9           MOV     R1,A
   \   00001B   12....       LCALL   ??osal_start_timerEx?relay
    379              HalLedBlink ( HAL_LED_1, 0xFF, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME );
   \   00001E                ; Setup parameters for call to function HalLedBlink
   \   00001E   7CE8         MOV     R4,#-0x18
   \   000020   7D03         MOV     R5,#0x3
   \   000022   7B05         MOV     R3,#0x5
   \   000024   7AFF         MOV     R2,#-0x1
   \   000026   7901         MOV     R1,#0x1
   \   000028   12....       LCALL   ??HalLedBlink?relay
   \   00002B   801D         SJMP    ??zclSampleSw_ProcessIdentifyTimeChange_2
    380            }
    381            else
    382            {
    383              if ( zclSampleSw_OnOff )
   \                     ??zclSampleSw_ProcessIdentifyTimeChange_1:
   \   00002D   90....       MOV     DPTR,#zclSampleSw_OnOff
   \   000030   E0           MOVX    A,@DPTR
   \   000031   6004         JZ      ??zclSampleSw_ProcessIdentifyTimeChange_3
    384                HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   000033                ; Setup parameters for call to function HalLedSet
   \   000033   7A01         MOV     R2,#0x1
   \   000035   8002         SJMP    ??zclSampleSw_ProcessIdentifyTimeChange_4
    385              else
    386                HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );
   \                     ??zclSampleSw_ProcessIdentifyTimeChange_3:
   \   000037                ; Setup parameters for call to function HalLedSet
   \   000037   7A00         MOV     R2,#0x0
   \                     ??zclSampleSw_ProcessIdentifyTimeChange_4:
   \   000039   7901         MOV     R1,#0x1
   \   00003B   12....       LCALL   ??HalLedSet?relay
    387              osal_stop_timerEx( zclSampleSw_TaskID, SAMPLESW_IDENTIFY_TIMEOUT_EVT );
   \   00003E                ; Setup parameters for call to function osal_stop_timerEx
   \   00003E   7A01         MOV     R2,#0x1
   \   000040   7B00         MOV     R3,#0x0
   \   000042   90....       MOV     DPTR,#zclSampleSw_TaskID
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F9           MOV     R1,A
   \   000047   12....       LCALL   ??osal_stop_timerEx?relay
    388            }
    389          }
   \                     ??zclSampleSw_ProcessIdentifyTimeChange_2:
   \   00004A   02....       LJMP    ?Subroutine2 & 0xFFFF
    390          
    391          /*********************************************************************
    392           * @fn      zclSampleSw_BasicResetCB
    393           *
    394           * @brief   Callback from the ZCL General Cluster Library
    395           *          to set all the Basic Cluster attributes to  default values.
    396           *
    397           * @param   none
    398           *
    399           * @return  none
    400           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    401          static void zclSampleSw_BasicResetCB( void )
   \                     zclSampleSw_BasicResetCB:
    402          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    403          }
   \   000000   02....       LJMP    ?BRET
    404          
    405          /*********************************************************************
    406           * @fn      zclSampleSw_IdentifyCB
    407           *
    408           * @brief   Callback from the ZCL General Cluster Library when
    409           *          it received an Identity Command for this application.
    410           *
    411           * @param   srcAddr - source address and endpoint of the response message
    412           * @param   identifyTime - the number of seconds to identify yourself
    413           *
    414           * @return  none
    415           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    416          static void zclSampleSw_IdentifyCB( zclIdentify_t *pCmd )
   \                     zclSampleSw_IdentifyCB:
    417          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    418            zclSampleSw_IdentifyTime = pCmd->identifyTime;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F8           MOV     R0,A
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   90....       MOV     DPTR,#zclSampleSw_IdentifyTime
   \   000012   E8           MOV     A,R0
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
    419            zclSampleSw_ProcessIdentifyTimeChange();
   \   000017                ; Setup parameters for call to function zclSampleSw_ProcessIdentifyTimeChange
   \   000017   12....       LCALL   ??zclSampleSw_ProcessIdentifyTimeChange?relay
    420          }
   \   00001A   02....       LJMP    ?Subroutine2 & 0xFFFF
    421          
    422          /*********************************************************************
    423           * @fn      zclSampleSw_IdentifyQueryRspCB
    424           *
    425           * @brief   Callback from the ZCL General Cluster Library when
    426           *          it received an Identity Query Response Command for this application.
    427           *
    428           * @param   srcAddr - source address
    429           * @param   timeout - number of seconds to identify yourself (valid for query response)
    430           *
    431           * @return  none
    432           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    433          static void zclSampleSw_IdentifyQueryRspCB(  zclIdentifyQueryRsp_t *pRsp )
   \                     zclSampleSw_IdentifyQueryRspCB:
    434          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    435            // Query Response (with timeout value)
    436            (void)pRsp;
    437          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for bindingOutClusters>`:
   \   000000   0600         DW 6

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for sampleSw_TestEp>`:
   \   000000   14           DB 20
   \   000001   ....0000     DW zclSampleSw_TaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zclSampleSw_CmdCallbacks>`:
   \   000000   ........     DW ??zclSampleSw_BasicResetCB?relay, ??zclSampleSw_IdentifyCB?relay
   \   000004   ....0000     DW ??zclSampleSw_IdentifyQueryRspCB?relay, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \            00000000
   \            00000000
   \            00000000
   \   000014   00000000     DW 0H, 0H, 0H, 0H
   \            00000000
   \   00001C   0000         DB 0, 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_ProcessIdentifyTimeChange?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_ProcessIdentifyTimeChange

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_BasicResetCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_BasicResetCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_IdentifyCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_IdentifyCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclSampleSw_IdentifyQueryRspCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclSampleSw_IdentifyQueryRspCB
    438          
    439          /******************************************************************************
    440           *
    441           *  Functions for processing ZCL Foundation incoming Command/Response messages
    442           *
    443           *****************************************************************************/
    444          
    445          /*********************************************************************
    446           * @fn      zclSampleSw_ProcessIncomingMsg
    447           *
    448           * @brief   Process ZCL Foundation incoming message
    449           *
    450           * @param   pInMsg - pointer to the received message
    451           *
    452           * @return  none
    453           */
    454          static void zclSampleSw_ProcessIncomingMsg( zclIncomingMsg_t *pInMsg )
    455          {
    456            switch ( pInMsg->zclHdr.commandID )
    457            {
    458          #ifdef ZCL_READ
    459              case ZCL_CMD_READ_RSP:
    460                zclSampleSw_ProcessInReadRspCmd( pInMsg );
    461                break;
    462          #endif
    463          #ifdef ZCL_WRITE
    464              case ZCL_CMD_WRITE_RSP:
    465                zclSampleSw_ProcessInWriteRspCmd( pInMsg );
    466                break;
    467          #endif
    468          #ifdef ZCL_REPORT
    469              // See ZCL Test Applicaiton (zcl_testapp.c) for sample code on Attribute Reporting
    470              case ZCL_CMD_CONFIG_REPORT:
    471                //zclSampleSw_ProcessInConfigReportCmd( pInMsg );
    472                break;
    473          
    474              case ZCL_CMD_CONFIG_REPORT_RSP:
    475                //zclSampleSw_ProcessInConfigReportRspCmd( pInMsg );
    476                break;
    477          
    478              case ZCL_CMD_READ_REPORT_CFG:
    479                //zclSampleSw_ProcessInReadReportCfgCmd( pInMsg );
    480                break;
    481          
    482              case ZCL_CMD_READ_REPORT_CFG_RSP:
    483                //zclSampleSw_ProcessInReadReportCfgRspCmd( pInMsg );
    484                break;
    485          
    486              case ZCL_CMD_REPORT:
    487                //zclSampleSw_ProcessInReportCmd( pInMsg );
    488                break;
    489          #endif
    490              case ZCL_CMD_DEFAULT_RSP:
    491                zclSampleSw_ProcessInDefaultRspCmd( pInMsg );
    492                break;
    493          #ifdef ZCL_DISCOVER
    494              case ZCL_CMD_DISCOVER_RSP:
    495                zclSampleSw_ProcessInDiscRspCmd( pInMsg );
    496                break;
    497          #endif
    498              default:
    499                break;
    500            }
    501          
    502            if ( pInMsg->attrCmd )
    503              osal_mem_free( pInMsg->attrCmd );
    504          }
    505          
    506          #ifdef ZCL_READ
    507          /*********************************************************************
    508           * @fn      zclSampleSw_ProcessInReadRspCmd
    509           *
    510           * @brief   Process the "Profile" Read Response Command
    511           *
    512           * @param   pInMsg - incoming message to process
    513           *
    514           * @return  none
    515           */
    516          static uint8 zclSampleSw_ProcessInReadRspCmd( zclIncomingMsg_t *pInMsg )
    517          {
    518            zclReadRspCmd_t *readRspCmd;
    519            uint8 i;
    520          
    521            readRspCmd = (zclReadRspCmd_t *)pInMsg->attrCmd;
    522            for (i = 0; i < readRspCmd->numAttr; i++)
    523            {
    524              // Notify the originator of the results of the original read attributes
    525              // attempt and, for each successfull request, the value of the requested
    526              // attribute
    527            }
    528          
    529            return TRUE;
    530          }
    531          #endif // ZCL_READ
    532          
    533          #ifdef ZCL_WRITE
    534          /*********************************************************************
    535           * @fn      zclSampleSw_ProcessInWriteRspCmd
    536           *
    537           * @brief   Process the "Profile" Write Response Command
    538           *
    539           * @param   pInMsg - incoming message to process
    540           *
    541           * @return  none
    542           */
    543          static uint8 zclSampleSw_ProcessInWriteRspCmd( zclIncomingMsg_t *pInMsg )
    544          {
    545            zclWriteRspCmd_t *writeRspCmd;
    546            uint8 i;
    547          
    548            writeRspCmd = (zclWriteRspCmd_t *)pInMsg->attrCmd;
    549            for (i = 0; i < writeRspCmd->numAttr; i++)
    550            {
    551              // Notify the device of the results of the its original write attributes
    552              // command.
    553            }
    554          
    555            return TRUE;
    556          }
    557          #endif // ZCL_WRITE
    558          
    559          /*********************************************************************
    560           * @fn      zclSampleSw_ProcessInDefaultRspCmd
    561           *
    562           * @brief   Process the "Profile" Default Response Command
    563           *
    564           * @param   pInMsg - incoming message to process
    565           *
    566           * @return  none
    567           */
    568          static uint8 zclSampleSw_ProcessInDefaultRspCmd( zclIncomingMsg_t *pInMsg )
    569          {
    570            // zclDefaultRspCmd_t *defaultRspCmd = (zclDefaultRspCmd_t *)pInMsg->attrCmd;
    571            // Device is notified of the Default Response command.
    572            (void)pInMsg;
    573            return TRUE;
    574          }
    575          
    576          #ifdef ZCL_DISCOVER
    577          /*********************************************************************
    578           * @fn      zclSampleSw_ProcessInDiscRspCmd
    579           *
    580           * @brief   Process the "Profile" Discover Response Command
    581           *
    582           * @param   pInMsg - incoming message to process
    583           *
    584           * @return  none
    585           */
    586          static uint8 zclSampleSw_ProcessInDiscRspCmd( zclIncomingMsg_t *pInMsg )
    587          {
    588            zclDiscoverRspCmd_t *discoverRspCmd;
    589            uint8 i;
    590          
    591            discoverRspCmd = (zclDiscoverRspCmd_t *)pInMsg->attrCmd;
    592            for ( i = 0; i < discoverRspCmd->numAttr; i++ )
    593            {
    594              // Device is notified of the result of its attribute discovery command.
    595            }
    596          
    597            return TRUE;
    598          }
    599          #endif // ZCL_DISCOVER
    600          
    601          
    602          /****************************************************************************
    603          ****************************************************************************/
    604          
    605          

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     zclSampleSw_BasicResetCB           0      0      0
     zclSampleSw_HandleKeys             1      0     44
       -> zcl_SendCommand               0      0     60
       -> HalLedSet                     0      0     38
       -> NLME_GetShortAddr             0      0     56
       -> ZDP_EndDeviceBindReq          0      0     56
       -> HalLedSet                     0      0     38
       -> ZDP_MatchDescReq              0      0     54
     zclSampleSw_IdentifyCB             2      0      0
       -> zclSampleSw_ProcessIdentifyTimeChange
                                        4      0      0
     zclSampleSw_IdentifyQueryRspCB     0      0      0
     zclSampleSw_Init                   2      0      0
       -> zclHA_Init                    4      0      0
       -> zclGeneral_RegisterCmdCallbacks
                                        4      0      0
       -> zcl_registerAttrList          4      0      0
       -> zcl_registerForMsg            4      0      0
       -> RegisterForKeys               4      0      0
       -> afRegister                    4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     zclSampleSw_ProcessIdentifyTimeChange
                                        2      0     14
       -> osal_start_timerEx            4      0      0
       -> HalLedBlink                   4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_stop_timerEx             4      0      0
     zclSampleSw_event_loop             1      0     14
       -> zclSampleSw_ProcessIdentifyTimeChange
                                        0      0     28
       -> zclSampleSw_HandleKeys        0      0     28
       -> osal_msg_deallocate           0      0     28
       -> osal_msg_receive              0      0     28
       -> osal_mem_free                 0      0     28
       -> HalLedSet                     0      0     28
       -> HalLedSet                     0      0     28
       -> ZDO_ParseEPListRsp            0      0     28
       -> HalLedSet                     0      0     28
       -> osal_mem_free                 0      0     28


   Segment part sizes:

     Function/Label                                Bytes
     --------------                                -----
     zclSampleSw_TaskID                               1
     zclSampleSw_DstAddr                             12
     bindingOutClusters                               2
     sampleSw_TestEp                                  6
     zclSampleSw_CmdCallbacks                        30
     zclSampleSw_Init                                98
     ?Subroutine2                                     7
     zclSampleSw_event_loop                         361
     ?Subroutine0                                    14
     ?Subroutine1                                    12
     zclSampleSw_HandleKeys                         303
     zclSampleSw_ProcessIdentifyTimeChange
                                                     77
     zclSampleSw_BasicResetCB                         3
     zclSampleSw_IdentifyCB                          29
     zclSampleSw_IdentifyQueryRspCB                   3
     ?<Initializer for bindingOutClusters>            2
     ?<Initializer for sampleSw_TestEp>               6
     ?<Initializer for zclSampleSw_CmdCallbacks>     30
     ??zclSampleSw_Init?relay                         6
     ??zclSampleSw_event_loop?relay                   6
     ??zclSampleSw_HandleKeys?relay                   6
     ??zclSampleSw_ProcessIdentifyTimeChange?relay    6
     ??zclSampleSw_BasicResetCB?relay                 6
     ??zclSampleSw_IdentifyCB?relay                   6
     ??zclSampleSw_IdentifyQueryRspCB?relay           6

 
 907 bytes in segment BANKED_CODE
  42 bytes in segment BANK_RELAYS
  38 bytes in segment XDATA_I
  38 bytes in segment XDATA_ID
  13 bytes in segment XDATA_Z
 
 987 bytes of CODE  memory
  51 bytes of XDATA memory

Errors: none
Warnings: none
