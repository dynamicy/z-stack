###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                12/Mar/2010  11:24:00 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\Projects\zstack\ZMain\TI2530DB\ZMain.c       #
#    Command line       =  -f "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\Tool #
#                          s\CC2530DB\f8wCoord.cfg" (-DCPU32MHZ               #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"   #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          -f "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\Tool #
#                          s\CC2530DB\f8wZCL.cfg" (-DZCL_READ -DZCL_WRITE     #
#                          -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF            #
#                          -DZCL_KEY_ESTABLISH -DZCL_LOAD_CONTROL             #
#                          -DZCL_SIMPLE_METERING -DZCL_PRICING)               #
#                          -DZCL_MESSAGE "D:\µ{¦¡¶}µo\TI Zigbee               #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          ZMain\TI2530DB\ZMain.c" -D ZTOOL_P1 -D MT_TASK -D  #
#                          MT_APP_FUNC -D MT_SYS_FUNC -D MT_ZDO_FUNC -D       #
#                          LCD_SUPPORTED=DEBUG -lC "D:\µ{¦¡¶}µo\TI Zigbee     #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\CoordinatorKB #
#                          \List\" -lA "D:\µ{¦¡¶}µo\TI Zigbee                 #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\CoordinatorKB #
#                          \List\" --diag_suppress Pe001,Pa010 -o             #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\CoordinatorKB\Obj\" -e                   #
#                          --require_prototypes --debug --core=plain          #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\µ{¦¡¶}µo\TI Zigbee     #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\" -I          #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\SOURCE\" -I "D:\µ{¦¡¶}µo\TI Zigbee    #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\SOURCE\ #
#                          " -I "D:\µ{¦¡¶}µo\TI Zigbee                        #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\ZMAI #
#                          N\TI2530DB\" -I "D:\µ{¦¡¶}µo\TI Zigbee             #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MT\" -I "D:\µ{¦¡¶}µo\TI Zigbee        #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\HAL\INCLUDE\" -I "D:\µ{¦¡¶}µo\TI      #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\" -I       #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC #
#                          \" -I "D:\µ{¦¡¶}µo\TI Zigbee                       #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\OSAL\INCLUDE\" -I "D:\µ{¦¡¶}µo\TI     #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\AF\" -I "D:\µ{¦¡¶}µo\TI  #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\NWK\" -I                 #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\"    #
#                          -I "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SAPI\" -I "D:\µ{¦¡¶}µo\TI       #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\STACK\SYS\" -I                 #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZCL\"    #
#                          -I "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\ZDO\" -I "D:\µ{¦¡¶}µo\TI        #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\ZMAC\F8W\" -I "D:\µ{¦¡¶}µo\TI  #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\ZMAC\" -I "D:\µ{¦¡¶}µo\TI      #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\SERVICES\SADDR\" -I            #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA #
#                          \" -I "D:\µ{¦¡¶}µo\TI Zigbee                       #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\INCLUDE\" -I "D:\µ{¦¡¶}µo\TI      #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\ #
#                          zstack\HomeAutomation\SampleSwitch\CC2530DB\..\..\ #
#                          ..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" -I            #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\Projects\zstack\HomeAutomation\SampleSwitch #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\ #
#                          srf04\" -I "D:\µ{¦¡¶}µo\TI Zigbee                  #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          HomeAutomation\SampleSwitch\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I  #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\Projects\zstack\HomeAutomation\SampleSwitch\ #
#                          CC2530DB\CoordinatorKB\List\ZMain.lst              #
#    Object file        =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\Projects\zstack\HomeAutomation\SampleSwitch\ #
#                          CC2530DB\CoordinatorKB\Obj\ZMain.r51               #
#                                                                             #
#                                                                             #
###############################################################################

D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ZMain\TI2530DB\ZMain.c
      1          /**************************************************************************************************
      2            Filename:       ZMain.c
      3            Revised:        $Date: 2009-09-17 20:35:33 -0700 (Thu, 17 Sep 2009) $
      4            Revision:       $Revision: 20782 $
      5          
      6            Description:    Startup and shutdown code for ZStack
      7            Notes:          This version targets the Chipcon CC2530
      8          
      9          
     10            Copyright 2005-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Nv.h"
     48          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x9d
   \   unsigned char volatile __sfr SLEEPSTA
   \                     SLEEPSTA:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x9e
   \   unsigned char volatile __sfr CLKCONSTA
   \                     CLKCONSTA:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xbe
   \   unsigned char volatile __sfr SLEEPCMD
   \                     SLEEPCMD:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr CLKCONCMD
   \                     CLKCONCMD:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     49          #include "ZMAC.h"
     50          
     51          #ifndef NONWK
     52            #include "AF.h"
     53          #endif
     54          
     55          /* Hal */
     56          //#include "hal_lcd.h"
     57          #include "hal_keypad.h"
     58          #include "hal_lcd.h"
     59          #include "hal_led.h"
     60          #include "hal_adc.h"
     61          #include "hal_drivers.h"
     62          #include "hal_assert.h"
     63          #include "hal_flash.h"
     64          #include "hal_keypad.h"
     65          
     66          /*********************************************************************
     67           * MACROS
     68           */
     69          
     70          /*********************************************************************
     71           * CONSTANTS
     72           */
     73          
     74          // Maximun number of Vdd samples checked before go on
     75          #define MAX_VDD_SAMPLES  3
     76          #define ZMAIN_VDD_LIMIT  HAL_ADC_VDD_LIMIT_4
     77          
     78          /*********************************************************************
     79           * TYPEDEFS
     80           */
     81          
     82          /*********************************************************************
     83           * GLOBAL VARIABLES
     84           */
     85          
     86          /*********************************************************************
     87           * EXTERNAL VARIABLES
     88           */
     89          
     90          /*********************************************************************
     91           * EXTERNAL FUNCTIONS
     92           */
     93          
     94          extern bool HalAdcCheckVdd (uint8 limit);
     95          
     96          /*********************************************************************
     97           * LOCAL VARIABLES
     98           */
     99          
    100          /*********************************************************************
    101           * LOCAL FUNCTIONS
    102           */
    103          
    104          static void zmain_dev_info( void );
    105          static void zmain_ext_addr( void );
    106          static void zmain_vdd_check( void );
    107          
    108          #ifdef LCD_SUPPORTED
    109            static void zmain_lcd_init( void );
    110          #endif
    111          
    112          /*********************************************************************
    113           * @fn      main
    114           * @brief   First function called after startup.
    115           * @return  don't care
    116           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    117          int main( void )
   \                     main:
    118          {
   \   000000                ; Auto size: 0
    119            // Turn off interrupts
    120            osal_int_disable( INTS_ALL );
   \   000000                ; Setup parameters for call to function osal_int_disable
   \   000000   79FF         MOV     R1,#-0x1
   \   000002   12....       LCALL   ??osal_int_disable?relay
    121          
    122            // Initialization for board related stuff such as LEDs
    123            HAL_BOARD_INIT();
   \   000005   53BEFB       ANL     0xbe,#0xfb
   \                     ??main_0:
   \   000008   E59D         MOV     A,0x9d
   \   00000A   A2E6         MOV     C,0xE0 /* A   */.6
   \   00000C   50FA         JNC     ??main_0
   \   00000E   00           NOP
   \   00000F   78F8         MOV     R0,#-0x8
   \   000011   7901         MOV     R1,#0x1
   \                     ??main_1:
   \   000013   00           NOP
   \   000014   E8           MOV     A,R0
   \   000015   24FF         ADD     A,#-0x1
   \   000017   18           DEC     R0
   \   000018   E9           MOV     A,R1
   \   000019   34FF         ADDC    A,#-0x1
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   7001         JNZ     ??main_2
   \   00001F   E9           MOV     A,R1
   \                     ??main_2:
   \   000020   70F1         JNZ     ??main_1
   \   000022   75C680       MOV     0xc6,#-0x80
   \                     ??main_3:
   \   000025   7480         MOV     A,#-0x80
   \   000027   659E         XRL     A,0x9e
   \   000029   70FA         JNZ     ??main_3
   \   00002B   43BE04       ORL     0xbe,#0x4
   \   00002E   7408         MOV     A,#0x8
   \   000030   906270       MOV     DPTR,#0x6270
   \   000033   F0           MOVX    @DPTR,A
   \   000034   43FE01       ORL     0xfe,#0x1
   \   000037   43FE04       ORL     0xfe,#0x4
    124          
    125            // Make sure supply voltage is high enough to run
    126            zmain_vdd_check();
   \   00003A                ; Setup parameters for call to function zmain_vdd_check
   \   00003A   12....       LCALL   ??zmain_vdd_check?relay
    127          
    128            // Initialize board I/O
    129            InitBoard( OB_COLD );
   \   00003D                ; Setup parameters for call to function InitBoard
   \   00003D   7900         MOV     R1,#0x0
   \   00003F   12....       LCALL   ??InitBoard?relay
    130          
    131            // Initialze HAL drivers
    132            HalDriverInit();
   \   000042                ; Setup parameters for call to function HalDriverInit
   \   000042   12....       LCALL   ??HalDriverInit?relay
    133          
    134            // Initialize NV System
    135            osal_nv_init( NULL );
   \   000045                ; Setup parameters for call to function osal_nv_init
   \   000045   7A00         MOV     R2,#0x0
   \   000047   7B00         MOV     R3,#0x0
   \   000049   12....       LCALL   ??osal_nv_init?relay
    136          
    137            // Initialize the MAC
    138            ZMacInit();
   \   00004C                ; Setup parameters for call to function ZMacInit
   \   00004C   12....       LCALL   ??ZMacInit?relay
    139          
    140            // Determine the extended address
    141            zmain_ext_addr();
   \   00004F                ; Setup parameters for call to function zmain_ext_addr
   \   00004F   12....       LCALL   ??zmain_ext_addr?relay
    142          
    143            // Initialize basic NV items
    144            zgInit();
   \   000052                ; Setup parameters for call to function zgInit
   \   000052   12....       LCALL   ??zgInit?relay
    145          
    146          #ifndef NONWK
    147            // Since the AF isn't a task, call it's initialization routine
    148            afInit();
   \   000055                ; Setup parameters for call to function afInit
   \   000055   12....       LCALL   ??afInit?relay
    149          #endif
    150          
    151            // Initialize the operating system
    152            osal_init_system();
   \   000058                ; Setup parameters for call to function osal_init_system
   \   000058   12....       LCALL   ??osal_init_system?relay
    153          
    154            // Allow interrupts
    155            osal_int_enable( INTS_ALL );
   \   00005B                ; Setup parameters for call to function osal_int_enable
   \   00005B   79FF         MOV     R1,#-0x1
   \   00005D   12....       LCALL   ??osal_int_enable?relay
    156          
    157            // Final board initialization
    158            InitBoard( OB_READY );
   \   000060                ; Setup parameters for call to function InitBoard
   \   000060   7902         MOV     R1,#0x2
   \   000062   12....       LCALL   ??InitBoard?relay
    159          
    160            // Initization keypad
    161            halKeypadInit();
   \   000065                ; Setup parameters for call to function halKeypadInit
   \   000065   12....       LCALL   ??halKeypadInit?relay
    162            
    163            // Display information about this device
    164            zmain_dev_info();
   \   000068                ; Setup parameters for call to function zmain_dev_info
   \   000068   12....       LCALL   ??zmain_dev_info?relay
    165          
    166            /* Display the device info on the LCD */
    167          #ifdef LCD_SUPPORTED
    168            zmain_lcd_init();
   \   00006B                ; Setup parameters for call to function HalLcdWriteString
   \   00006B   7901         MOV     R1,#0x1
   \   00006D   7A..         MOV     R2,#(`?<Constant "TexasInstruments">` & 0xff)
   \   00006F   7B..         MOV     R3,#((`?<Constant "TexasInstruments">` >> 8) & 0xff)
   \   000071   12....       LCALL   ??HalLcdWriteString?relay
    169          #endif
    170          
    171          #ifdef WDT_IN_PM1
    172            /* If WDT is used, this is a good place to enable it. */
    173            WatchDogEnable( WDTIMX );
    174          #endif
    175          
    176            osal_start_system(); // No Return from here
   \   000074                ; Setup parameters for call to function osal_start_system
   \   000074   12....       LCALL   ??osal_start_system?relay
    177          
    178            return 0;  // Shouldn't get here.
   \   000077   7A00         MOV     R2,#0x0
   \   000079   7B00         MOV     R3,#0x0
   \   00007B   02....       LJMP    ?BRET
   \   00007E                REQUIRE SLEEPSTA
   \   00007E                REQUIRE CLKCONSTA
   \   00007E                REQUIRE SLEEPCMD
   \   00007E                REQUIRE CLKCONCMD
   \   00007E                REQUIRE P1DIR
    179          } // main()
    180          
    181          /*********************************************************************
    182           * @fn      zmain_vdd_check
    183           * @brief   Check if the Vdd is OK to run the processor.
    184           * @return  Return if Vdd is ok; otherwise, flash LED, then reset
    185           *********************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    186          static void zmain_vdd_check( void )
   \                     zmain_vdd_check:
    187          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    188            uint8 vdd_passed_count = 0;
   \   000005   7E00         MOV     R6,#0x0
    189            bool toggle = 0;
   \   000007   7F00         MOV     R7,#0x0
    190          
    191            // Repeat getting the sample until number of failures or successes hits MAX
    192            // then based on the count value, determine if the device is ready or not
    193            while ( vdd_passed_count < MAX_VDD_SAMPLES )
    194            {
    195              if ( HalAdcCheckVdd (ZMAIN_VDD_LIMIT) )
   \                     ??zmain_vdd_check_0:
   \   000009                ; Setup parameters for call to function HalAdcCheckVdd
   \   000009   7904         MOV     R1,#0x4
   \   00000B   12....       LCALL   ??HalAdcCheckVdd?relay
   \   00000E   E9           MOV     A,R1
   \   00000F   6019         JZ      ??zmain_vdd_check_1
    196              {
    197                vdd_passed_count++;    // Keep track # times Vdd passes in a row
   \   000011   0E           INC     R6
    198                MicroWait (10000);     // Wait 10ms to try again
   \   000012                ; Setup parameters for call to function Onboard_wait
   \   000012   7A10         MOV     R2,#0x10
   \   000014   7B27         MOV     R3,#0x27
   \   000016   12....       LCALL   ??Onboard_wait?relay
    199              }
    200              else
    201              {
    202                vdd_passed_count = 0;  // Reset passed counter
    203                MicroWait (50000);     // Wait 50ms
    204                MicroWait (50000);     // Wait another 50ms to try again
    205              }
    206          
    207              /* toggle LED1 and LED2 */
    208              if (vdd_passed_count == 0)
   \   000019   EE           MOV     A,R6
   \   00001A   601E         JZ      ??zmain_vdd_check_2
   \   00001C   C3           CLR     C
   \   00001D   9403         SUBB    A,#0x3
   \   00001F   40E8         JC      ??zmain_vdd_check_0
    209              {
    210                if ((toggle = !(toggle)))
    211                  HAL_TOGGLE_LED1();
    212                else
    213                  HAL_TOGGLE_LED2();
    214              }
    215            }
    216          
    217            /* turn off LED1 */
    218            HAL_TURN_OFF_LED1();
   \   000021   D290         SETB    0x90.0
    219            HAL_TURN_OFF_LED2();
   \   000023   D292         SETB    0x90.2
    220          }
   \   000025   7F01         MOV     R7,#0x1
   \   000027   02....       LJMP    ?BANKED_LEAVE_XDATA
   \                     ??zmain_vdd_check_1:
   \   00002A   7E00         MOV     R6,#0x0
   \   00002C                ; Setup parameters for call to function Onboard_wait
   \   00002C   7A50         MOV     R2,#0x50
   \   00002E   7BC3         MOV     R3,#-0x3d
   \   000030   12....       LCALL   ??Onboard_wait?relay
   \   000033                ; Setup parameters for call to function Onboard_wait
   \   000033   7A50         MOV     R2,#0x50
   \   000035   7BC3         MOV     R3,#-0x3d
   \   000037   12....       LCALL   ??Onboard_wait?relay
   \                     ??zmain_vdd_check_2:
   \   00003A   EF           MOV     A,R7
   \   00003B   700A         JNZ     ??zmain_vdd_check_3
   \   00003D   7F01         MOV     R7,#0x1
   \   00003F   A290         MOV     C,0x90.0
   \   000041   400E         JC      ??zmain_vdd_check_4
   \   000043   D290         SETB    0x90.0
   \   000045   80C2         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_3:
   \   000047   7F00         MOV     R7,#0x0
   \   000049   A292         MOV     C,0x90.2
   \   00004B   4008         JC      ??zmain_vdd_check_5
   \   00004D   D292         SETB    0x90.2
   \   00004F   80B8         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_4:
   \   000051   C290         CLR     0x90.0
   \   000053   80B4         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_5:
   \   000055   C292         CLR     0x90.2
   \   000057   80B0         SJMP    ??zmain_vdd_check_0
   \   000059                REQUIRE _A_P1
    221          
    222          /**************************************************************************************************
    223           * @fn          zmain_ext_addr
    224           *
    225           * @brief       Execute a prioritized search for a valid extended address and write the results
    226           *              into the OSAL NV system for use by the system. Temporary address not saved to NV.
    227           *
    228           * input parameters
    229           *
    230           * None.
    231           *
    232           * output parameters
    233           *
    234           * None.
    235           *
    236           * @return      None.
    237           **************************************************************************************************
    238           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    239          static void zmain_ext_addr(void)
   \                     zmain_ext_addr:
    240          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    241            uint8 nullAddr[Z_EXTADDR_LEN] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#((`?<Constant {255, 255, 255, 255, 255, 255, 255,` >> 8) & 0xff)
   \   000017   7582..       MOV     DPL,#(`?<Constant {255, 255, 255, 255, 255, 255, 255,` & 0xff)
   \   00001A   7408         MOV     A,#0x8
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    242            uint8 writeNV = TRUE;
    243          
    244            // First check whether a non-erased extended address exists in the OSAL NV.
    245            if ((SUCCESS != osal_nv_item_init(ZCD_NV_EXTADDR, Z_EXTADDR_LEN, NULL))  ||
    246                (SUCCESS != osal_nv_read(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress)) ||
    247                (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN)))
   \   00001F   85..82       MOV     DPL,?XSP + 0
   \   000022   85..83       MOV     DPH,?XSP + 1
   \   000025   A982         MOV     R1,DPL
   \   000027   AA83         MOV     R2,DPH
   \   000029   89..         MOV     ?V0 + 4,R1
   \   00002B   8A..         MOV     ?V0 + 5,R2
   \   00002D   F5..         MOV     ?V0 + 6,A
   \   00002F                ; Setup parameters for call to function osal_nv_item_init
   \   00002F   F5..         MOV     ?V0 + 8,A
   \   000031   F5..         MOV     ?V0 + 9,A
   \   000033   78..         MOV     R0,#?V0 + 8
   \   000035   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000038   7C08         MOV     R4,#0x8
   \   00003A   7D00         MOV     R5,#0x0
   \   00003C   7A01         MOV     R2,#0x1
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??osal_nv_item_init?relay
   \   000043   7402         MOV     A,#0x2
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   \   000048   E9           MOV     A,R1
   \   000049   7046         JNZ     ??zmain_ext_addr_0
   \   00004B                ; Setup parameters for call to function osal_nv_read
   \   00004B   75....       MOV     ?V0 + 8,#(aExtendedAddress & 0xff)
   \   00004E   75....       MOV     ?V0 + 9,#((aExtendedAddress >> 8) & 0xff)
   \   000051   78..         MOV     R0,#?V0 + 8
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000056   75..08       MOV     ?V0 + 8,#0x8
   \   000059   75..00       MOV     ?V0 + 9,#0x0
   \   00005C   78..         MOV     R0,#?V0 + 8
   \   00005E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000061   7C00         MOV     R4,#0x0
   \   000063   7D00         MOV     R5,#0x0
   \   000065   7A01         MOV     R2,#0x1
   \   000067   7B00         MOV     R3,#0x0
   \   000069   12....       LCALL   ??osal_nv_read?relay
   \   00006C   7404         MOV     A,#0x4
   \   00006E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000071   E9           MOV     A,R1
   \   000072   701D         JNZ     ??zmain_ext_addr_0
   \   000074                ; Setup parameters for call to function osal_memcmp
   \   000074   78..         MOV     R0,#?V0 + 4
   \   000076   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000079   7C08         MOV     R4,#0x8
   \   00007B   7D00         MOV     R5,#0x0
   \   00007D   79..         MOV     R1,#(aExtendedAddress & 0xff)
   \   00007F   7A..         MOV     R2,#((aExtendedAddress >> 8) & 0xff)
   \   000081   7B00         MOV     R3,#0x0
   \   000083   12....       LCALL   ??osal_memcmp?relay
   \   000086   7403         MOV     A,#0x3
   \   000088   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008B   E9           MOV     A,R1
   \   00008C   7003         JNZ     $+5
   \   00008E   02....       LJMP    ??zmain_ext_addr_1 & 0xFFFF
    248            {
    249              // Attempt to read the extended address from the location on the lock bits page
    250              // where the programming tools know to reserve it.
    251              HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_IEEE_OSET, aExtendedAddress, Z_EXTADDR_LEN);
   \                     ??zmain_ext_addr_0:
   \   000091                ; Setup parameters for call to function HalFlashRead
   \   000091   75..08       MOV     ?V0 + 8,#0x8
   \   000094   78..         MOV     R0,#?V0 + 8
   \   000096   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000099   7C..         MOV     R4,#(aExtendedAddress & 0xff)
   \   00009B   7D..         MOV     R5,#((aExtendedAddress >> 8) & 0xff)
   \   00009D   7AE8         MOV     R2,#-0x18
   \   00009F   7B07         MOV     R3,#0x7
   \   0000A1   797F         MOV     R1,#0x7f
   \   0000A3   12....       LCALL   ??HalFlashRead?relay
   \   0000A6   7402         MOV     A,#0x2
   \   0000A8   12....       LCALL   ?DEALLOC_XSTACK8
    252          
    253              if (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN))
   \   0000AB                ; Setup parameters for call to function osal_memcmp
   \   0000AB   78..         MOV     R0,#?V0 + 4
   \   0000AD   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000B0   7C08         MOV     R4,#0x8
   \   0000B2   7D00         MOV     R5,#0x0
   \   0000B4   79..         MOV     R1,#(aExtendedAddress & 0xff)
   \   0000B6   7A..         MOV     R2,#((aExtendedAddress >> 8) & 0xff)
   \   0000B8   7B00         MOV     R3,#0x0
   \   0000BA   12....       LCALL   ??osal_memcmp?relay
   \   0000BD   7403         MOV     A,#0x3
   \   0000BF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C2   E9           MOV     A,R1
   \   0000C3   6038         JZ      ??zmain_ext_addr_2
    254              {
    255                // Attempt to read the extended address from the designated location in the Info Page.
    256                if (!osal_memcmp((uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), nullAddr, Z_EXTADDR_LEN))
   \   0000C5                ; Setup parameters for call to function osal_memcmp
   \   0000C5   78..         MOV     R0,#?V0 + 4
   \   0000C7   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000CA   7C08         MOV     R4,#0x8
   \   0000CC   7D00         MOV     R5,#0x0
   \   0000CE   790C         MOV     R1,#0xc
   \   0000D0   7A78         MOV     R2,#0x78
   \   0000D2   7B00         MOV     R3,#0x0
   \   0000D4   12....       LCALL   ??osal_memcmp?relay
   \   0000D7   7403         MOV     A,#0x3
   \   0000D9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000DC   E9           MOV     A,R1
   \   0000DD   7057         JNZ     ??zmain_ext_addr_3
    257                {
    258                  osal_memcpy(aExtendedAddress, (uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), Z_EXTADDR_LEN);
   \   0000DF                ; Setup parameters for call to function osal_memcpy
   \   0000DF   75..0C       MOV     ?V0 + 0,#0xc
   \   0000E2   75..78       MOV     ?V0 + 1,#0x78
   \   0000E5   75..00       MOV     ?V0 + 2,#0x0
   \   0000E8   78..         MOV     R0,#?V0 + 0
   \   0000EA   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000ED   7C08         MOV     R4,#0x8
   \   0000EF   7D00         MOV     R5,#0x0
   \   0000F1   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   0000F3   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   0000F5   12....       LCALL   ??osal_memcpy?relay
   \   0000F8   7403         MOV     A,#0x3
   \   0000FA   12....       LCALL   ?DEALLOC_XSTACK8
    259                }
    260                else  // No valid extended address was found.
    261                {
    262                  uint8 idx;
    263                  
    264          #if !defined ( NV_RESTORE )
    265                  writeNV = FALSE;  // Make this a temporary IEEE address
    266          #endif
    267          
    268                  /* Attempt to create a sufficiently random extended address for expediency.
    269                   * Note: this is only valid/legal in a test environment and
    270                   *       must never be used for a commercial product.
    271                   */
    272                  for (idx = 0; idx < (Z_EXTADDR_LEN - 2);)
    273                  {
    274                    uint16 randy = osal_rand();
    275                    aExtendedAddress[idx++] = LO_UINT16(randy);
    276                    aExtendedAddress[idx++] = HI_UINT16(randy);
    277                  }
    278                  // Next-to-MSB identifies ZigBee devicetype.
    279          #if ZG_BUILD_COORDINATOR_TYPE && !ZG_BUILD_JOINING_TYPE
    280                  aExtendedAddress[idx++] = 0x10;
    281          #elif ZG_BUILD_RTRONLY_TYPE
    282                  aExtendedAddress[idx++] = 0x20;
    283          #else
    284                  aExtendedAddress[idx++] = 0x30;
    285          #endif
    286                  // MSB has historical signficance.
    287                  aExtendedAddress[idx] = 0xF8;
    288                }
    289              }
    290          
    291              if (writeNV)
    292              {
    293                (void)osal_nv_write(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress);
   \                     ??zmain_ext_addr_2:
   \   0000FD                ; Setup parameters for call to function osal_nv_write
   \   0000FD   75....       MOV     ?V0 + 0,#(aExtendedAddress & 0xff)
   \   000100   75....       MOV     ?V0 + 1,#((aExtendedAddress >> 8) & 0xff)
   \   000103   78..         MOV     R0,#?V0 + 0
   \   000105   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000108   75..08       MOV     ?V0 + 0,#0x8
   \   00010B   75..00       MOV     ?V0 + 1,#0x0
   \   00010E   78..         MOV     R0,#?V0 + 0
   \   000110   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000113   7C00         MOV     R4,#0x0
   \   000115   7D00         MOV     R5,#0x0
   \   000117   7A01         MOV     R2,#0x1
   \   000119   7B00         MOV     R3,#0x0
   \   00011B   12....       LCALL   ??osal_nv_write?relay
   \   00011E   7404         MOV     A,#0x4
   \   000120   12....       LCALL   ?DEALLOC_XSTACK8
    294              }
    295            }
    296          
    297            // Set the MAC PIB extended address according to results from above.
    298            (void)ZMacSetReq(MAC_EXTENDED_ADDRESS, aExtendedAddress);
   \                     ??zmain_ext_addr_1:
   \   000123                ; Setup parameters for call to function ZMacSetReq
   \   000123   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000125   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000127   79E2         MOV     R1,#-0x1e
   \   000129   12....       LCALL   ??ZMacSetReq?relay
    299          }
   \   00012C   7408         MOV     A,#0x8
   \   00012E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000131   7F0A         MOV     R7,#0xa
   \   000133   02....       LJMP    ?BANKED_LEAVE_XDATA
   \                     ??zmain_ext_addr_3:
   \   000136   7E00         MOV     R6,#0x0
   \                     ??zmain_ext_addr_4:
   \   000138                ; Setup parameters for call to function osal_rand
   \   000138   12....       LCALL   ??osal_rand?relay
   \   00013B   8A..         MOV     ?V0 + 0,R2
   \   00013D   A8..         MOV     R0,?V0 + 0
   \   00013F   8E..         MOV     ?V0 + 0,R6
   \   000141   E5..         MOV     A,?V0 + 0
   \   000143   12....       LCALL   ??Subroutine3_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000146   E8           MOV     A,R0
   \   000147   F0           MOVX    @DPTR,A
   \   000148   0E           INC     R6
   \   000149   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00014C   EB           MOV     A,R3
   \   00014D   F0           MOVX    @DPTR,A
   \   00014E   0E           INC     R6
   \   00014F   EE           MOV     A,R6
   \   000150   C3           CLR     C
   \   000151   9406         SUBB    A,#0x6
   \   000153   40E3         JC      ??zmain_ext_addr_4
   \   000155   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000158   7410         MOV     A,#0x10
   \   00015A   F0           MOVX    @DPTR,A
   \   00015B   7401         MOV     A,#0x1
   \   00015D   2E           ADD     A,R6
   \   00015E   12....       LCALL   ??Subroutine3_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000161   74F8         MOV     A,#-0x8
   \   000163   F0           MOVX    @DPTR,A
   \   000164   80BD         SJMP    ??zmain_ext_addr_1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   EE           MOV     A,R6
   \   000001                REQUIRE ??Subroutine3_0
   \   000001                ; // Fall through to label ??Subroutine3_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine3_0:
   \   000000   24..         ADD     A,#(aExtendedAddress & 0xff)
   \   000002   F582         MOV     DPL,A
   \   000004   E4           CLR     A
   \   000005   34..         ADDC    A,#((aExtendedAddress >> 8) & 0xff)
   \   000007   F583         MOV     DPH,A
   \   000009   22           RET
    300          
    301          /**************************************************************************************************
    302           * @fn          zmain_dev_info
    303           *
    304           * @brief       This displays the IEEE (MSB to LSB) on the LCD.
    305           *
    306           * input parameters
    307           *
    308           * None.
    309           *
    310           * output parameters
    311           *
    312           * None.
    313           *
    314           * @return      None.
    315           **************************************************************************************************
    316           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    317          static void zmain_dev_info(void)
   \                     zmain_dev_info:
    318          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    319          #ifdef LCD_SUPPORTED
    320            uint8 i;
    321            uint8 *xad;
    322            uint8 lcd_buf[Z_EXTADDR_LEN*2+1];
    323          
    324            // Display the extended address.
    325            xad = aExtendedAddress + Z_EXTADDR_LEN - 1;
   \   00000A   78..         MOV     R0,#((aExtendedAddress + 7) & 0xff)
   \   00000C   79..         MOV     R1,#(((aExtendedAddress + 7) >> 8) & 0xff)
    326          
    327            for (i = 0; i < Z_EXTADDR_LEN*2; xad--)
   \   00000E   7C00         MOV     R4,#0x0
    328            {
    329              uint8 ch;
    330              ch = (*xad >> 4) & 0x0F;
   \                     ??zmain_dev_info_0:
   \   000010   8882         MOV     DPL,R0
   \   000012   8983         MOV     DPH,R1
   \   000014   E0           MOVX    A,@DPTR
   \   000015   C4           SWAP    A
   \   000016   12....       LCALL   ?Subroutine2 & 0xFFFF
    331              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
   \                     ??CrossCallReturnLabel_2:
   \   000019   5004         JNC     ??zmain_dev_info_1
   \   00001B   7A30         MOV     R2,#0x30
   \   00001D   8002         SJMP    ??zmain_dev_info_2
   \                     ??zmain_dev_info_1:
   \   00001F   7A37         MOV     R2,#0x37
   \                     ??zmain_dev_info_2:
   \   000021   EA           MOV     A,R2
   \   000022   2D           ADD     A,R5
   \   000023   C0E0         PUSH    A
   \   000025   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000028   D0E0         POP     A
   \   00002A   F0           MOVX    @DPTR,A
    332              ch = *xad & 0x0F;
   \   00002B   8882         MOV     DPL,R0
   \   00002D   8983         MOV     DPH,R1
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   12....       LCALL   ?Subroutine2 & 0xFFFF
    333              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
    334            }
   \                     ??CrossCallReturnLabel_3:
   \   000033   5004         JNC     ??zmain_dev_info_3
   \   000035   7A30         MOV     R2,#0x30
   \   000037   8002         SJMP    ??zmain_dev_info_4
   \                     ??zmain_dev_info_3:
   \   000039   7A37         MOV     R2,#0x37
   \                     ??zmain_dev_info_4:
   \   00003B   EA           MOV     A,R2
   \   00003C   2D           ADD     A,R5
   \   00003D   C0E0         PUSH    A
   \   00003F   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000042   D0E0         POP     A
   \   000044   F0           MOVX    @DPTR,A
   \   000045   E8           MOV     A,R0
   \   000046   24FF         ADD     A,#-0x1
   \   000048   18           DEC     R0
   \   000049   E9           MOV     A,R1
   \   00004A   34FF         ADDC    A,#-0x1
   \   00004C   F9           MOV     R1,A
   \   00004D   EC           MOV     A,R4
   \   00004E   C3           CLR     C
   \   00004F   9410         SUBB    A,#0x10
   \   000051   40BD         JC      ??zmain_dev_info_0
    335            lcd_buf[Z_EXTADDR_LEN*2] = '\0';
   \   000053   7410         MOV     A,#0x10
   \   000055   12....       LCALL   ?XSTACK_DISP0_8
   \   000058   E4           CLR     A
   \   000059   F0           MOVX    @DPTR,A
    336            HalLcdWriteString( "IEEE: ", HAL_LCD_LINE_1 );
   \   00005A                ; Setup parameters for call to function HalLcdWriteString
   \   00005A   7901         MOV     R1,#0x1
   \   00005C   7A..         MOV     R2,#(`?<Constant "IEEE: ">` & 0xff)
   \   00005E   7B..         MOV     R3,#((`?<Constant "IEEE: ">` >> 8) & 0xff)
   \   000060   12....       LCALL   ??HalLcdWriteString?relay
    337            HalLcdWriteString( (char*)lcd_buf, HAL_LCD_LINE_2 );
   \   000063                ; Setup parameters for call to function HalLcdWriteString
   \   000063   7902         MOV     R1,#0x2
   \   000065   85..82       MOV     DPL,?XSP + 0
   \   000068   85..83       MOV     DPH,?XSP + 1
   \   00006B   AA82         MOV     R2,DPL
   \   00006D   AB83         MOV     R3,DPH
   \   00006F   12....       LCALL   ??HalLcdWriteString?relay
    338          #endif
    339          }
   \   000072   7411         MOV     A,#0x11
   \   000074   12....       LCALL   ?DEALLOC_XSTACK8
   \   000077   7F02         MOV     R7,#0x2
   \   000079   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   540F         ANL     A,#0xf
   \   000002   FD           MOV     R5,A
   \   000003   8C..         MOV     ?V0 + 0,R4
   \   000005   0C           INC     R4
   \   000006   C3           CLR     C
   \   000007   940A         SUBB    A,#0xa
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E582         MOV     A,DPL
   \   000008   25..         ADD     A,?V0 + 0
   \   00000A   F582         MOV     DPL,A
   \   00000C   E583         MOV     A,DPH
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F583         MOV     DPH,A
   \   000012   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??main?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    main

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zmain_vdd_check?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zmain_vdd_check

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zmain_ext_addr?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zmain_ext_addr

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zmain_dev_info?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zmain_dev_info

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {255, 255, 255, 255, 255, 255, 255,`:
   \   000000   FFFFFFFF     DB 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFFFFFF

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "IEEE: ">`:
   \   000000   49454545     DB "IEEE: "
   \            3A2000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "TexasInstruments">`:
   \   000000   54657861     DB "TexasInstruments"
   \            73496E73
   \            7472756D
   \            656E7473
   \            00      
    340          
    341          #ifdef LCD_SUPPORTED
    342          /*********************************************************************
    343           * @fn      zmain_lcd_init
    344           * @brief   Initialize LCD at start up.
    345           * @return  none
    346           *********************************************************************/
    347          static void zmain_lcd_init ( void )
    348          {
    349          #ifdef SERIAL_DEBUG_SUPPORTED
    350            {
    351              HalLcdWriteString( "TexasInstruments", HAL_LCD_LINE_1 );
    352          
    353          #if defined( MT_MAC_FUNC )
    354          #if defined( ZDO_COORDINATOR )
    355                HalLcdWriteString( "MAC-MT Coord", HAL_LCD_LINE_2 );
    356          #else
    357                HalLcdWriteString( "MAC-MT Device", HAL_LCD_LINE_2 );
    358          #endif // ZDO
    359          #elif defined( MT_NWK_FUNC )
    360          #if defined( ZDO_COORDINATOR )
    361                HalLcdWriteString( "NWK Coordinator", HAL_LCD_LINE_2 );
    362          #else
    363                HalLcdWriteString( "NWK Device", HAL_LCD_LINE_2 );
    364          #endif // ZDO
    365          #endif // MT_FUNC
    366            }
    367          #endif // SERIAL_DEBUG_SUPPORTED
    368          }
    369          #endif
    370          
    371          /*********************************************************************
    372          *********************************************************************/

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     main                       0      0      0
       -> osal_int_disable      0      0      0
       -> zmain_vdd_check       0      0      0
       -> InitBoard             0      0      0
       -> HalDriverInit         0      0      0
       -> osal_nv_init          0      0      0
       -> ZMacInit              0      0      0
       -> zmain_ext_addr        0      0      0
       -> zgInit                0      0      0
       -> afInit                0      0      0
       -> osal_init_system      0      0      0
       -> osal_int_enable       0      0      0
       -> InitBoard             0      0      0
       -> halKeypadInit         0      0      0
       -> zmain_dev_info        0      0      0
       -> HalLcdWriteString     0      0      0
       -> osal_start_system     0      0      0
     zmain_dev_info             1      0     27
       -> HalLcdWriteString     0      0     54
       -> HalLcdWriteString     0      0     54
     zmain_ext_addr             2      0     30
       -> osal_nv_item_init     0      0     56
       -> osal_nv_read          0      0     60
       -> osal_memcmp           0      0     58
       -> HalFlashRead          0      0     56
       -> osal_memcmp           0      0     58
       -> osal_memcmp           0      0     58
       -> osal_memcpy           0      0     58
       -> osal_nv_write         0      0     60
       -> ZMacSetReq            0      0     52
       -> osal_rand             0      0     52
     zmain_vdd_check            0      0      9
       -> HalAdcCheckVdd        0      0     18
       -> Onboard_wait          0      0     18
       -> Onboard_wait          0      0     18
       -> Onboard_wait          0      0     18


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     _A_P1                                             1
     SLEEPSTA                                          1
     CLKCONSTA                                         1
     SLEEPCMD                                          1
     CLKCONCMD                                         1
     P1DIR                                             1
     main                                            126
     zmain_vdd_check                                  89
     zmain_ext_addr                                  358
     ?Subroutine0                                      1
     ??Subroutine3_0                                  10
     zmain_dev_info                                  124
     ?Subroutine2                                     10
     ?Subroutine1                                     19
     ??main?relay                                      6
     ??zmain_vdd_check?relay                           6
     ??zmain_ext_addr?relay                            6
     ??zmain_dev_info?relay                            6
     ?<Constant {255, 255, 255, 255, 255, 255, 255,    8
     ?<Constant "IEEE: ">                              7
     ?<Constant "TexasInstruments">                   17

 
 737 bytes in segment BANKED_CODE
  24 bytes in segment BANK_RELAYS
   6 bytes in segment SFR_AN
  32 bytes in segment XDATA_ROM_C
 
 761 bytes of CODE  memory
  32 bytes of CONST memory
   0 bytes of DATA  memory (+ 6 bytes shared)

Errors: none
Warnings: none
