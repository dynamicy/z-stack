###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                22/Jul/2010  09:34:29 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE            #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Components\stack #
#                          \zdo\ZDApp.c                                       #
#    Command line       =  -f "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE        #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.c #
#                          fg" (-DCPU32MHZ -DROOT=__near_func -DBLINK_LEDS)   #
#                          -f "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE        #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig. #
#                          cfg" (-DSECURE=0 -DZG_SECURE_DYNAMIC=0             #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          -f "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE        #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg #
#                          " (-DZCL_READ -DZCL_WRITE -DZCL_BASIC              #
#                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH    #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING) -DZCL_MESSAGE                       #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Components\stack #
#                          \zdo\ZDApp.c" -D NWK_AUTO_POLL -D ZTOOL_P1 -D      #
#                          MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC -D           #
#                          MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -D              #
#                          xPOWER_SAVING -D M310 -lC                          #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\EndDeviceKB_M310\List\" -lA        #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\EndDeviceKB_M310\List\"            #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\EndDeviceKB_M310\Obj\" -e          #
#                          --require_prototypes --debug --core=plain          #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\¤½¥q²£«~\XT-200\ZIGBEE #
#                           CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\P #
#                          rojects\zstack\Sensor Network Application\ZIGBEE   #
#                          Endpoint & Device\CC2530DB\" -I                    #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\SOURCE\" -I                     #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\SOURCE\" -I                  #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I       #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I  #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCL #
#                          UDE\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE  #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\MODU #
#                          LE\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE   #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARG #
#                          ET\CC2530EB\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE        #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\OSAL\MCU\CCSOC\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE  #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\OSAL\INCLUDE\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE    #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\AF\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE        #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\NWK\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE       #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\SEC\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE       #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\SAPI\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE      #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\SYS\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE       #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\ZCL\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE       #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\STACK\ZDO\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE       #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\ZMAC\F8W\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE        #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\ZMAC\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE            #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\SERVICES\SADDR\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE  #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\SERVICES\SDATA\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE  #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\MAC\INCLUDE\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE     #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\MAC\HIGH_LEVEL\" -I "D:\¤½¥q²£«~\XT-200\ZIGBEE  #
#                          CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Pr #
#                          ojects\zstack\Sensor Network Application\ZIGBEE    #
#                          Endpoint & Device\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\MAC\LOW_LEVEL\srf04\" -I                        #
#                          "D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE           #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_ #
#                          LEVEL\srf04\SINGLE_CHIP\" -I "C:\IAR               #
#                          Systems\Embedded Workbench 5.3\8051\INC\" -I       #
#                          "C:\IAR Systems\Embedded Workbench                 #
#                          5.3\8051\INC\CLIB\" -Ohz                           #
#    List file          =  D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE            #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\EndDeviceKB_M310\List\ZDApp.lst    #
#    Object file        =  D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE            #
#                          Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ #
#                          Sensor Network Application\ZIGBEE Endpoint &       #
#                          Device\CC2530DB\EndDeviceKB_M310\Obj\ZDApp.r51     #
#                                                                             #
#                                                                             #
###############################################################################

D:\¤½¥q²£«~\XT-200\ZIGBEE CC2530\ZIGBEE Z-STACK\ZStack-CC2530-2.3.0-1.4.0\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-01-04 12:16:55 -0800 (Mon, 04 Jan 2010) $
      4            Revision:       $Revision: 21428 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          /* HAL */
     69          #include "hal_led.h"
     70          #include "hal_lcd.h"
     71          #include "hal_key.h"
     72          
     73          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     74            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     75          #endif
     76          /*********************************************************************
     77           * MACROS
     78           */
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          #if !defined( NWK_START_DELAY )
     84            #define NWK_START_DELAY             100   // in milliseconds
     85          #endif
     86          
     87          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     88            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     89          #endif
     90          
     91          #if !defined( BEACON_REQUEST_DELAY )
     92            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     93          #endif
     94          
     95          #if !defined( BEACON_REQ_DELAY_MASK )
     96            #define BEACON_REQ_DELAY_MASK       0x007F
     97          #endif
     98          
     99          #define MAX_RESUME_RETRY            3
    100          
    101          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    102          
    103          // Beacon Order Settings (see NLMEDE.h)
    104          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    105          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    106          
    107          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    108            // The number of times the frame counter can change before
    109            // saving to NV
    110            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    111          #endif
    112          
    113          // Leave control bits
    114          #define ZDAPP_LEAVE_CTRL_INIT 0
    115          #define ZDAPP_LEAVE_CTRL_SET  1
    116          #define ZDAPP_LEAVE_CTRL_RA   2
    117          
    118          // Standard time to update NWK NV data
    119          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    120          
    121          // Address Manager Stub Implementation
    122          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    123          
    124          // Size of the ZDO callback function table zdoCBFunc[]
    125          #define MAX_ZDO_CB_FUNC 1
    126          
    127          
    128          /*********************************************************************
    129           * GLOBAL VARIABLES
    130           */
    131          
    132          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    134          #endif
    135          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    136          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    137          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    138          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    139          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    147          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    150          
    151          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    155          
    156          /*********************************************************************
    157           * EXTERNAL VARIABLES
    158           */
    159          
    160          /*********************************************************************
    161           * EXTERNAL FUNCTIONS
    162           */
    163          
    164          /*********************************************************************
    165           * LOCAL FUNCTIONS
    166           */
    167          
    168          void ZDApp_NetworkStartEvt( void );
    169          void ZDApp_DeviceAuthEvt( void );
    170          void ZDApp_SaveNetworkStateEvt( void );
    171          
    172          uint8 ZDApp_ReadNetworkRestoreState( void );
    173          uint8 ZDApp_RestoreNetworkState( void );
    174          void ZDAppDetermineDeviceType( void );
    175          void ZDApp_InitUserDesc( void );
    176          void ZDAppCheckForHoldKey( void );
    177          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    178          void ZDApp_ProcessNetworkJoin( void );
    179          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    180          void ZDApp_SaveNwkKey( void );
    181          uint8 ZDApp_RestoreNwkKey( void );
    182            
    183          void ZDApp_SecInit( uint8 state );
    184          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    185          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    186          
    187          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    188          
    189          void ZDApp_ResetTimerStart( uint16 delay );
    190          void ZDApp_ResetTimerCancel( void );
    191          void ZDApp_LeaveCtrlInit( void );
    192          void ZDApp_LeaveCtrlSet( uint8 ra );
    193          uint8 ZDApp_LeaveCtrlBypass( void );
    194          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    195          void ZDApp_LeaveReset( uint8 ra );
    196          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    197                                  uint8 removeChildren );
    198          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    199          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    200          void ZDApp_RegisterCBs( void );
    201          
    202          /*********************************************************************
    203           * LOCAL VARIABLES
    204           */
    205          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    206          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    207          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    210          
    211          #if defined( HOLD_AUTO_START )
    212            devStates_t devState = DEV_HOLD;
    213          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    214            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    215          #endif
    216          
    217          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    218            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    219            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    220                                  // to parent. Set to make the device do an Orphan scan.
    221          #else
    222            // Set the default to coodinator
    223            devStartModes_t devStartMode = MODE_HARD;
    224          #endif
    225          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    226          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    227          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    228          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    229          {
    230            ZDO_EP,
    231            &ZDAppTaskID,
    232            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    233            (afNetworkLatencyReq_t)0            // No Network Latency req
    234          };
    235          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    236          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    237          
    238          /*********************************************************************
    239           * @fn      ZDApp_Init
    240           *
    241           * @brief   ZDApp Initialization function.
    242           *
    243           * @param   task_id - ZDApp Task ID
    244           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    245          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    246          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    247            // Save the task ID
    248            ZDAppTaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   F0           MOVX    @DPTR,A
    249          
    250            // Initialize the ZDO global device short address storage
    251            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   000009   7402         MOV     A,#0x2
   \   00000B   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000E   F0           MOVX    @DPTR,A
    252            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   00000F   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000012   74FE         MOV     A,#-0x2
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   74FF         MOV     A,#-0x1
   \   000018   F0           MOVX    @DPTR,A
    253            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    254          
    255            // Check for manual "Hold Auto Start"
    256            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    257          
    258            // Initialize ZDO items and setup the device - type of device to create.
    259            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    260          
    261            // Register the endpoint description with the AF
    262            // This task doesn't have a Simple description, but we still need
    263            // to register the endpoint.
    264            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000024   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000026   12....       LCALL   ??afRegister?relay
    265          
    266          #if defined( ZDO_USERDESC_RESPONSE )
    267            ZDApp_InitUserDesc();
   \   000029                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000029   12....       LCALL   ??ZDApp_InitUserDesc?relay
    268          #endif // ZDO_USERDESC_RESPONSE
    269          
    270            // Start the device?
    271            if ( devState != DEV_HOLD )
   \   00002C   90....       MOV     DPTR,#devState
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6009         JZ      ??ZDApp_Init_0
    272            {
    273              ZDOInitDevice( 0 );
   \   000032                ; Setup parameters for call to function ZDOInitDevice
   \   000032   7A00         MOV     R2,#0x0
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??ZDOInitDevice?relay
   \   000039   800D         SJMP    ??ZDApp_Init_1
    274            }
    275            else
    276            {
    277              // Blink LED to indicate HOLD_START
    278              HalLedBlink ( HAL_LED_2, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00003B                ; Setup parameters for call to function HalLedBlink
   \   00003B   7CF4         MOV     R4,#-0xc
   \   00003D   7D01         MOV     R5,#0x1
   \   00003F   7B32         MOV     R3,#0x32
   \   000041   7A00         MOV     R2,#0x0
   \   000043   7902         MOV     R1,#0x2
   \   000045   12....       LCALL   ??HalLedBlink?relay
    279            }
    280            
    281            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000048                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000048   12....       LCALL   ??ZDApp_RegisterCBs?relay
    282          } /* ZDApp_Init() */
   \   00004B   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    283          
    284          /*********************************************************************
    285           * @fn          ZDApp_SecInit
    286           *
    287           * @brief       ZDApp initialize security.
    288           *
    289           * @param       state - device initialization state
    290           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    291          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    292          {  
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    293            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    294            {
    295              // Set the Trust Center bit
    296              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    297            }
    298          
    299            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    300            {
    301              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    302            }
    303              
    304            // Initialize ZigBee Device Security Manager
    305            ZDSecMgrInit(state);
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    306          
    307            if ( ZG_SECURE_ENABLED )
    308            {
    309              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    310              {
    311                nwkFrameCounter = 0;
    312            
    313                if( _NIB.nwkKeyLoaded == FALSE )
    314                {
    315                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    316                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    317                  {
    318                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    319                      SSP_SwitchNwkKey( 0 );
    320                  }
    321                }
    322              }
    323            }    
    324          }
   \   000007   02....       LJMP    ??Subroutine27_0 & 0xFFFF
    325          
    326          /*********************************************************************
    327           * @fn      ZDApp_event_loop()
    328           *
    329           * @brief   Main event loop for Zigbee device objects task. This function
    330           *          should be called at periodic intervals.
    331           *
    332           * @param   task_id - Task ID
    333           * @param   events  - Bitmap of events
    334           *
    335           * @return  none
    336           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    337          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    338          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    339            uint8 *msg_ptr;
    340          
    341            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7030         JNZ     ??ZDApp_event_loop_1
    342            {
    343              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    344              {
    345                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    346          
    347                // Release the memory
    348                osal_msg_deallocate( msg_ptr );
    349              }
    350          
    351              // Return unprocessed events
    352              return (events ^ SYS_EVENT_MSG);
    353            }
    354          
    355            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   5044         JNC     ??ZDApp_event_loop_2
    356            {
    357              // Initialize apps and start the network
    358              devState = DEV_INIT;
   \   000018   7401         MOV     A,#0x1
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   F0           MOVX    @DPTR,A
    359              
    360              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    361                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00001E                ; Setup parameters for call to function ZDO_StartDevice
   \   00001E   7C0F         MOV     R4,#0xf
   \   000020   7B0F         MOV     R3,#0xf
   \   000022   90....       MOV     DPTR,#devStartMode
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FA           MOV     R2,A
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5407         ANL     A,#0x7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??ZDO_StartDevice?relay
    362          
    363              // Return unprocessed events
    364              return (events ^ ZDO_NETWORK_INIT);
   \   000031   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000033   6E           XRL     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000036   FB           MOV     R3,A
   \   000037   8075         SJMP    ??ZDApp_event_loop_5
    365            }
   \                     ??ZDApp_event_loop_6:
   \   000039                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000039   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003C                ; Setup parameters for call to function osal_msg_deallocate
   \   00003C   AA..         MOV     R2,?V0 + 0
   \   00003E   AB..         MOV     R3,?V0 + 1
   \   000040   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000043                ; Setup parameters for call to function osal_msg_receive
   \   000043   90....       MOV     DPTR,#ZDAppTaskID
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F9           MOV     R1,A
   \   000048   12....       LCALL   ??osal_msg_receive?relay
   \   00004B   8A..         MOV     ?V0 + 0,R2
   \   00004D   8B..         MOV     ?V0 + 1,R3
   \   00004F   EA           MOV     A,R2
   \   000050   7001         JNZ     ??ZDApp_event_loop_7
   \   000052   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000053   70E4         JNZ     ??ZDApp_event_loop_6
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   000059   6F           XRL     A,R7
   \   00005A   80DA         SJMP    ??ZDApp_event_loop_4
    366          
    367            if ( ZSTACK_ROUTER_BUILD )
    368            {
    369              if ( events & ZDO_NETWORK_START )
    370              {
    371                ZDApp_NetworkStartEvt();  //The network start event
    372            
    373                // Return unprocessed events
    374                return (events ^ ZDO_NETWORK_START);
    375              }
    376          
    377              if ( events & ZDO_ROUTER_START )
    378              {
    379                if ( nwkStatus == ZSuccess )
    380                {
    381                  if ( devState == DEV_END_DEVICE )
    382                    devState = DEV_ROUTER;
    383            
    384                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    385                }
    386                else
    387                {
    388                  // remain as end device!!
    389                }
    390                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    391            
    392                // Return unprocessed events
    393                return (events ^ ZDO_ROUTER_START);
    394              }
    395            }
    396            
    397            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_2:
   \   00005C   5410         ANL     A,#0x10
   \   00005E   6022         JZ      ??ZDApp_event_loop_9
    398            {
    399              ZDO_UpdateNwkStatus( devState );  // The device state
   \   000060                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000060   90....       MOV     DPTR,#devState
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F9           MOV     R1,A
   \   000065   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    400              
    401              // At start up, do one MTO route discovery if the device is a concentrator(¶°¤¤¾¹)
    402              if ( zgConcentratorEnable == TRUE ) 
   \   000068   90....       MOV     DPTR,#zgConcentratorEnable
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   6401         XRL     A,#0x1
   \   00006E   700E         JNZ     ??CrossCallReturnLabel_34
    403              {
    404                // Start next event
    405                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   000070                ; Setup parameters for call to function osal_start_timerEx
   \   000070   7C64         MOV     R4,#0x64
   \   000072   7D00         MOV     R5,#0x0
   \   000074   7A00         MOV     R2,#0x0
   \   000076   7B08         MOV     R3,#0x8
   \   000078   90....       MOV     DPTR,#NWK_TaskID
   \   00007B   12....       LCALL   ??Subroutine26_0 & 0xFFFF
    406              }
    407              
    408              // Return unprocessed events
    409              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_34:
   \   00007E   7410         MOV     A,#0x10
   \   000080   80B1         SJMP    ??ZDApp_event_loop_3
    410            }
    411          
    412            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_9:
   \   000082   EE           MOV     A,R6
   \   000083   5408         ANL     A,#0x8
   \   000085   6006         JZ      ??ZDApp_event_loop_10
    413            {
    414              // User defined logic
    415          
    416              // Return unprocessed events
    417              return (events ^ ZDO_COMMAND_CNF);
   \   000087   7408         MOV     A,#0x8
   \   000089   6E           XRL     A,R6
   \   00008A   FA           MOV     R2,A
   \   00008B   8021         SJMP    ??ZDApp_event_loop_5
    418            }
    419            
    420            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_10:
   \   00008D   7402         MOV     A,#0x2
   \   00008F   5F           ANL     A,R7
   \   000090   F9           MOV     R1,A
   \   000091   E4           CLR     A
   \   000092   7001         JNZ     ??ZDApp_event_loop_11
   \   000094   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_11:
   \   000095   6004         JZ      ??ZDApp_event_loop_12
    421            {
    422              ZDApp_SaveNetworkStateEvt();
    423          
    424              // Return unprocessed events
    425              return (events ^ ZDO_NWK_UPDATE_NV);
   \   000097   7402         MOV     A,#0x2
   \   000099   80BE         SJMP    ??ZDApp_event_loop_8
    426            }
    427          
    428            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_12:
   \   00009B   EE           MOV     A,R6
   \   00009C   5404         ANL     A,#0x4
   \   00009E   600A         JZ      ??ZDApp_event_loop_13
    429            {
    430              // The device has been in the UNAUTH state, so reset
    431              // Note: there will be no return from this call
    432              SystemReset();
   \   0000A0   C2AF         CLR     0xa8.7
   \   0000A2   75C9AB       MOV     0xc9,#-0x55
   \   0000A5   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_14:
   \   0000A8   80FE         SJMP    ??ZDApp_event_loop_14
    433            }
    434          
    435            if ( ZG_SECURE_ENABLED )
    436            {
    437              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    438            }
    439            else
    440            {
    441              // Discard or make more handlers
    442              return 0;
   \                     ??ZDApp_event_loop_13:
   \   0000AA   7A00         MOV     R2,#0x0
   \   0000AC   7B00         MOV     R3,#0x0
    443            }
   \                     ??ZDApp_event_loop_5:
   \   0000AE   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   \   0000B1                REQUIRE _A_IEN0
   \   0000B1                REQUIRE WDCTL
    444          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine31_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    445          
    446          /*********************************************************************
    447           * @fn      ZDApp_ProcessSecEvent()
    448           *
    449           * @brief   Process incoming security events.
    450           *
    451           * @param   task_id - Task ID
    452           * @param   events  - Bitmap of events
    453           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    454          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    455          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    456            (void)task_id;  // Intentionally unreferenced parameter
    457            
    458            if ( ZSTACK_ROUTER_BUILD )
    459            {
    460              if ( events & ZDO_NEW_DEVICE )
    461              {
    462                // process the new device event
    463                if ( ZDSecMgrNewDeviceEvent() == TRUE )
    464                {
    465                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    466                }
    467          
    468                // Return unprocessed events
    469                return (events ^ ZDO_NEW_DEVICE);
    470              }
    471            }
    472          
    473            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    474                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    475            {
    476              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    477              { 
    478                if ( events & ZDO_SECMGR_EVENT )
    479                {
    480                  ZDSecMgrEvent();
    481          
    482                  // Return unprocessed events
    483                  return (events ^ ZDO_SECMGR_EVENT);
    484                }
    485              }
    486            }
    487            
    488            if ( events & ZDO_DEVICE_AUTH )
   \   000009   EE           MOV     A,R6
   \   00000A   5480         ANL     A,#0x80
   \   00000C   600B         JZ      ??ZDApp_ProcessSecEvent_0
    489            {
    490              ZDApp_DeviceAuthEvt();
   \   00000E                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00000E   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    491          
    492              // Return unprocessed events
    493              return (events ^ ZDO_DEVICE_AUTH);
   \   000011   7480         MOV     A,#-0x80
   \   000013   6E           XRL     A,R6
   \   000014   FA           MOV     R2,A
   \   000015   EF           MOV     A,R7
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000016   FB           MOV     R3,A
   \   000017   8036         SJMP    ??ZDApp_ProcessSecEvent_2
    494            }
    495          
    496            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000019   7404         MOV     A,#0x4
   \   00001B   5F           ANL     A,R7
   \   00001C   F9           MOV     R1,A
   \   00001D   E4           CLR     A
   \   00001E   7001         JNZ     ??ZDApp_ProcessSecEvent_3
   \   000020   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000021   6028         JZ      ??ZDApp_ProcessSecEvent_4
    497            {
    498              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000023   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F8           MOV     R0,A
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   7401         MOV     A,#0x1
   \   00002D   28           ADD     A,R0
   \   00002E   FA           MOV     R2,A
   \   00002F   E4           CLR     A
   \   000030   39           ADDC    A,R1
   \   000031   FB           MOV     R3,A
   \   000032   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000035   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000038   C3           CLR     C
   \   000039   E8           MOV     A,R0
   \   00003A   94E9         SUBB    A,#-0x17
   \   00003C   E9           MOV     A,R1
   \   00003D   9403         SUBB    A,#0x3
   \   00003F   4003         JC      ??ZDApp_ProcessSecEvent_5
    499                ZDApp_SaveNwkKey();
   \   000041                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000041   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    500          
    501              // Return unprocessed events
    502              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000044   EE           MOV     A,R6
   \   000045   FA           MOV     R2,A
   \   000046   7404         MOV     A,#0x4
   \   000048   6F           XRL     A,R7
   \   000049   80CB         SJMP    ??ZDApp_ProcessSecEvent_1
    503            }
    504            
    505            // Discard or make more handlers
    506            return 0;
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00004B   7A00         MOV     R2,#0x0
   \   00004D   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   00004F   02....       LJMP    ?Subroutine19 & 0xFFFF
    507          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine32_0:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET
    508          
    509          /*********************************************************************
    510           * Application Functions
    511           */
    512          
    513          /*********************************************************************
    514           * @fn      ZDOInitDevice
    515           *
    516           * @brief   Start the device in the network.  This function will read
    517           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    518           *   restore the network state of the device.
    519           *
    520           * @param   startDelay - timeDelay to start device (in milliseconds).
    521           *      There is a jitter added to this delay:
    522           *              ((NWK_START_DELAY + startDelay)
    523           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    524           *
    525           * NOTE:    If the application would like to force a "new" join, the
    526           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    527           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    528           *          this function. "new" join means to not restore the network
    529           *          state of the device. Use zgWriteStartupOptions() to set these
    530           *          options.
    531           *
    532           * @return   ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    533           *           restored.
    534           *           ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized. This could 
    535           *           mean that ZCD_NV_STARTUP_OPTION said to not restore, or it could mean that 
    536           *           there was no network state to restore.
    537           *           ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    538           *           with the rejoin option set to TRUE.  So, the device was notstarted in the 
    539           *           network (one time only).  The next time this function is called it will start.
    540           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    541          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    542          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine3 & 0xFFFF
    543            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    544            uint16 extendedDelay = 0;
    545          
    546            if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_49:
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   E0           MOVX    A,@DPTR
   \   000011   7005         JNZ     ??ZDOInitDevice_0
    547            {    
    548              // Initialize the RAM items table, in case an NV item has been updated.
    549              zgInitItems( FALSE );
   \   000013                ; Setup parameters for call to function zgInitItems
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??zgInitItems?relay
    550            }
    551          
    552            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000018                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000018   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    553            //devtag.071807.todo - fix this temporary solution
    554            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001B   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   90....       MOV     DPTR,#(_NIB + 14)
   \   000022   F0           MOVX    @DPTR,A
    555            
    556            devState = DEV_INIT;    // Remove the Hold state
   \   000023   7401         MOV     A,#0x1
   \   000025   90....       MOV     DPTR,#devState
   \   000028   F0           MOVX    @DPTR,A
    557          
    558            // Initialize leave control logic
    559            ZDApp_LeaveCtrlInit();
   \   000029                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000029   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    560          
    561            // Check leave control reset settings
    562            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00002C                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00002C   85..82       MOV     DPL,?XSP + 0
   \   00002F   85..83       MOV     DPH,?XSP + 1
   \   000032   AC82         MOV     R4,DPL
   \   000034   AD83         MOV     R5,DPH
   \   000036   7A..         MOV     R2,#(devState & 0xff)
   \   000038   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   00003A   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    563          
    564            // Leave may make the hold state come back
    565            if ( devState == DEV_HOLD )
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   700E         JNZ     ??ZDOInitDevice_1
    566            {
    567              // Set the NV startup option to force a "new" join.
    568              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000043                ; Setup parameters for call to function zgWriteStartupOptions
   \   000043   7A02         MOV     R2,#0x2
   \   000045   79FF         MOV     R1,#-0x1
   \   000047   12....       LCALL   ??zgWriteStartupOptions?relay
    569          
    570              // Notify the applications 
    571              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00004A                ; Setup parameters for call to function osal_set_event
   \   00004A   12....       LCALL   ?Subroutine4 & 0xFFFF
    572              
    573              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_14:
   \   00004D   7902         MOV     R1,#0x2
   \   00004F   8039         SJMP    ??ZDOInitDevice_2
    574            }
    575          
    576          #if defined ( NV_RESTORE )
    577            // Get Keypad directly to see if a reset nv is needed.
    578            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    579            // while booting to skip past NV Restore.
    580            if ( HalKeyRead() == SW_BYPASS_NV )
    581              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    582            else
    583            {
    584              // Determine if NV should be restored
    585              networkStateNV = ZDApp_ReadNetworkRestoreState();
    586            }
    587          
    588            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    589            {
    590              networkStateNV = ZDApp_RestoreNetworkState();
    591            }
    592            else
    593            {
    594              // Wipe out the network state in NV
    595              NLME_InitNV();
    596              NLME_SetDefaultNV();
    597            }
    598          #endif
    599          
    600            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    601            {
    602              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000051                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000051   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    603          
    604              // Only delay if joining network - not restoring network state
    605              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    606                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000054                ; Setup parameters for call to function osal_rand
   \   000054   12....       LCALL   ??osal_rand?relay
   \   000057   8A..         MOV     ?V0 + 0,R2
   \   000059   A8..         MOV     R0,?V0 + 0
   \   00005B   85..82       MOV     DPL,?XSP + 0
   \   00005E   85..83       MOV     DPH,?XSP + 1
   \   000061   747F         MOV     A,#0x7f
   \   000063   58           ANL     A,R0
   \   000064   F8           MOV     R0,A
   \   000065   E0           MOVX    A,@DPTR
   \   000066   28           ADD     A,R0
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   3400         ADDC    A,#0x0
   \   00006C   F9           MOV     R1,A
   \   00006D   7464         MOV     A,#0x64
   \   00006F   28           ADD     A,R0
   \   000070   FE           MOV     R6,A
   \   000071   E4           CLR     A
   \   000072   39           ADDC    A,R1
   \   000073   FF           MOV     R7,A
    607            }
    608          
    609            // Initialize the security for type of device
    610            ZDApp_SecInit( networkStateNV );
   \   000074                ; Setup parameters for call to function ZDSecMgrInit
   \   000074   7901         MOV     R1,#0x1
   \   000076   12....       LCALL   ??ZDSecMgrInit?relay
    611            
    612            // Trigger the network start
    613            ZDApp_NetworkInit( extendedDelay );
   \   000079                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000079   EE           MOV     A,R6
   \   00007A   FA           MOV     R2,A
   \   00007B   EF           MOV     A,R7
   \   00007C   FB           MOV     R3,A
   \   00007D   12....       LCALL   ??ZDApp_NetworkInit?relay
    614          
    615            // set broadcast address mask to support broadcast filtering
    616            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000080                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000080   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000083   E0           MOVX    A,@DPTR
   \   000084   F9           MOV     R1,A
   \   000085   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    617            
    618            return ( networkStateNV );
   \   000088   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   00008A   02....       LJMP    ?Subroutine18 & 0xFFFF
    619          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7A10         MOV     R2,#0x10
   \   000002   02....       LJMP    ?Subroutine20 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine30_0
   \   000002                ; // Fall through to label ??Subroutine30_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine30_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine31_0
   \   000003                ; // Fall through to label ??Subroutine31_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine32_0
   \   000006                ; // Fall through to label ??Subroutine32_0
    620          
    621          /*********************************************************************
    622           * @fn      ZDApp_ReadNetworkRestoreState
    623           *
    624           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    625           *          or not to restore the network state.
    626           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    627           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    628           *
    629           *
    630           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    631           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    632           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    633           *          ZCD_NV_STARTUP_OPTION
    634           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    635          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    636          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    637            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    638          
    639            // Look for the New Network State option.
    640            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    641            {
    642              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    643            }
    644          
    645            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ?Subroutine19 & 0xFFFF
    646          }
    647          
    648          /*********************************************************************
    649           * @fn      ZDAppDetermineDeviceType()
    650           *
    651           * @brief   Determines the type of device to start. 
    652           *
    653           *          Looks at zgDeviceLogicalType and determines what type of
    654           *          device to start.  The types are:
    655           *            ZG_DEVICETYPE_COORDINATOR
    656           *            ZG_DEVICETYPE_ROUTER
    657           *            ZG_DEVICETYPE_ENDDEVICE
    658           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    659          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    660          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    661            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    662            {
    663              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    664              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    665            }
    666            else
    667            {
    668              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    669                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    670              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    671                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    672              
    673              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    674              // The device shall do rejoin the network. Otherwise, do normal join
    675              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000036   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   7003         JNZ     ??ZDAppDetermineDeviceType_5
    676              {
    677                devStartMode = MODE_JOIN;     // Assume joining
   \   00003E   E4           CLR     A
   \   00003F   8002         SJMP    ??ZDAppDetermineDeviceType_6
    678              }
    679              else
    680              {
    681                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000041   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000043   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    682              }
    683            }
    684          }
   \   000047   02....       LJMP    ??Subroutine27_0 & 0xFFFF
    685          
    686          /*********************************************************************
    687           * @fn      ZDApp_NetworkStartEvt()
    688           *
    689           * @brief   Process the Network Start Event
    690           *
    691           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    692          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    693          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    694            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    695            {
    696              // Successfully started a ZigBee network
    697              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    698              {
    699                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    700              }
    701          
    702              osal_pwrmgr_device( PWRMGR_ALWAYS_ON ); // osal device power setting -> ALWAYS ON
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    703              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT ); // TaskID -> ZDO_STATE_CHANGE_EVT
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    704            }
    705            else
    706            {
    707              // Try again with a higher energy threshold !!
    708              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    709              {
    710                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    711                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    712              }
    713              else
    714              {
    715                // Failed to start network. Enter a dormant state (until user intervenes)
    716                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    717                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
    718              }
    719            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   02....       LJMP    ?Subroutine16 & 0xFFFF
    720          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000003                REQUIRE ??Subroutine27_0
   \   000003                ; // Fall through to label ??Subroutine27_0
    721          
    722          /*********************************************************************
    723           * @fn      ZDApp_DeviceAuthEvt()
    724           *
    725           * @brief   Process the Device Authentic Event
    726           *
    727           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    728          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    729          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    730            // received authentication from trust center
    731            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   701F         JNZ     ??ZDApp_DeviceAuthEvt_0
    732            {
    733              // Stop the reset timer so it doesn't reset
    734              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    735          
    736              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine0 & 0xFFFF
    737              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    738          
    739              // Set the Power Manager Device
    740          #if defined ( POWER_SAVING )
    741              osal_pwrmgr_device( PWRMGR_BATTERY );
    742          #endif
    743          
    744              if ( ZSTACK_ROUTER_BUILD )
    745              {
    746                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    747                {
    748                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    749                  NLME_StartRouterRequest( 0, 0, false );
    750                }
    751              }
    752          
    753              // Notify to save info into NV
    754              ZDApp_NVUpdate();
    755          
    756              // Save off the security
    757              ZDApp_SaveNwkKey();
   \                     ??CrossCallReturnLabel_19:
   \   000012                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000012   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    758          
    759              ZDApp_AnnounceNewAddress();
   \   000015                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000015   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    760              
    761              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000018   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   A2E3         MOV     C,0xE0 /* A   */.3
   \   00001E   400B         JC      ??ZDApp_DeviceAuthEvt_0
    762              {
    763                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000020                ; Setup parameters for call to function NLME_SetPollRate
   \   000020   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FB           MOV     R3,A
   \   000028   12....       LCALL   ??NLME_SetPollRate?relay
    764              }
    765            }
    766            else
    767            {
    768              ZDApp_NVUpdate();
    769            }
    770          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   00002B   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7406         MOV     A,#0x6
   \   000002   90....       MOV     DPTR,#devState
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008                REQUIRE ?Subroutine20
   \   000008                ; // Fall through to label ?Subroutine20
    771          
    772          /*********************************************************************
    773           * @fn      ZDApp_SaveNetworkStateEvt()
    774           *
    775           * @brief   Process the Save the Network State Event
    776           *
    777           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    778          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    779          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    780          #if defined ( NV_RESTORE )
    781           #if defined ( NV_TURN_OFF_RADIO )
    782            // Turn off the radio's receiver during an NV update
    783            uint8 RxOnIdle;
    784            uint8 x = false;
    785            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    786            ZMacSetReq( ZMacRxOnIdle, &x );
    787           #endif
    788          
    789            // Update the Network State in NV
    790            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    791                           NWK_NV_DEVICELIST_ENABLE |
    792                           NWK_NV_BINDING_ENABLE    |
    793                           NWK_NV_ADDRMGR_ENABLE );
    794          
    795            // Reset the NV startup option to resume from NV by
    796            // clearing the "New" join option.
    797            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    798          
    799           #if defined ( NV_TURN_OFF_RADIO )
    800            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    801           #endif
    802          #endif  // NV_RESTORE
    803          }
   \   000000   02....       LJMP    ?BRET
    804          
    805          /*********************************************************************
    806           * @fn      ZDApp_RestoreNetworkState()
    807           *
    808           * @brief   This function will restore the network state of the
    809           *          device if the network state is stored in NV.
    810           *
    811           * @return
    812           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    813           *          restored.
    814           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    815           *          This could mean that zgStartupOption said to not restore, or
    816           *          it could mean that there was no network state to restore.
    817           *
    818           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    819          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    820          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    821            uint8 nvStat;
    822            nwkActiveKeyItems keyItems;
    823          
    824            // Initialize NWK NV items
    825            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    826          
    827            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   602F         JZ      ??ZDApp_RestoreNetworkState_0
    828            {
    829              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6029         JZ      ??ZDApp_RestoreNetworkState_0
    830              {
    831                // Are we a coordinator
    832                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   12....       LCALL   ??Subroutine32_0 & 0xFFFF
    833                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \                     ??CrossCallReturnLabel_46:
   \   00001E   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000021   E0           MOVX    A,@DPTR
   \   000022   7002         JNZ     ??ZDApp_RestoreNetworkState_1
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000026   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    834                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   54F8         ANL     A,#0xf8
   \   00002E   F0           MOVX    @DPTR,A
    835                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00002F   7401         MOV     A,#0x1
   \   000031   90....       MOV     DPTR,#devStartMode
   \   000034   12....       LCALL   ?Subroutine1 & 0xFFFF
    836                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
    837              }
    838              else
    839                nvStat = NV_ITEM_UNINIT;
    840          
    841              if ( ZG_SECURE_ENABLED )
    842              {
    843                nwkFrameCounterChanges = 0;
    844                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    845                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    846          
    847                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    848                {
    849                  ZDApp_RestoreNwkKey();
    850                }
    851              }
    852          
    853              // The default for RxOnWhenIdle is true for Routers and false for end devices
    854              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    855              // other than default.
    856            }
    857          
    858            if ( nvStat == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000037   EE           MOV     A,R6
   \   000038   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    859              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   00003A   7900         MOV     R1,#0x0
   \   00003C   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    860            else
    861              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   00003E   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000040                REQUIRE ?Subroutine19
   \   000040                ; // Fall through to label ?Subroutine19
    862          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000003   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   000005   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000007   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000009   12....       LCALL   ??sAddrExtCpy?relay
   \   00000C   22           RET
    863          
    864          /*********************************************************************
    865           * @fn      ZDApp_InitUserDesc()
    866           *
    867           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    868           *          when needed.  If you want to initialize the User descriptor to
    869           *          something other than all zero, do it here.
    870           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    871          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    872          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    873            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    874          
    875            // Initialize the User Descriptor, the descriptor is read from NV
    876            // when needed.  If you want to initialize the User descriptor to something
    877            // other than all zero, do it here.
    878            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine13 & 0xFFFF
    879            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    880                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_12:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    881            {
    882              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    883                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    884              {
    885                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    886                {
    887                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    888                }
    889              }
    890            }
    891          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine30_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    892          
    893          /*********************************************************************
    894           * @fn      ZDAppCheckForHoldKey()
    895           *
    896           * @brief   Check for key to set the device into Hold Auto Start
    897           *
    898           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    899          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    900          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    901          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    902            // Get Keypad directly to see if a HOLD_START is needed.
    903            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    904            // while booting to avoid starting up the device.
    905            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    906            {
    907              // Change the device state to HOLD on start up
    908              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    909            }
    910          #endif // HAL_KEY
    911          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine27_0 & 0xFFFF
    912          
    913          /*********************************************************************
    914           * @fn      ZDApp_ProcessOSALMsg()
    915           *
    916           * @brief   Process the incoming task message.
    917           *
    918           * @param   msgPtr - message to process
    919           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    920          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    921          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    922            // Data Confirmation message fields
    923            uint8 sentEP;       // This should always be 0
    924            uint8 sentStatus;
    925            afDataConfirm_t *afDataConfirm;
    926            uint8 tmp;
    927          
    928            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000016   00           DB        0
   \   000017   05           DB        5
   \   000018   01           DB        1
   \   000019   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   00001B   02           DB        2
   \   00001C   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   00001E   03           DB        3
   \   00001F   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   000021   1A           DB        26
   \   000022   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   000024   D3           DB        211
   \   000025   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000027   ....         DW        ??ZDApp_ProcessOSALMsg_5
    929            {
    930              // Incoming ZDO Message
    931              case AF_INCOMING_MSG_CMD:
    932                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000029                ; Setup parameters for call to function ZDP_IncomingData
   \   000029   12....       LCALL   ??ZDP_IncomingData?relay
   \   00002C   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    933                break;
    934                
    935              case ZDO_CB_MSG:
    936                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00002F                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00002F   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000032   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    937                break;
    938          
    939              case AF_DATA_CONFIRM_CMD:
    940                // This message is received as a confirmation of a data packet sent.
    941                // The status is of ZStatus_t type [defined in NLMEDE.h]
    942                // The message fields are defined in AF.h
    943                afDataConfirm = (afDataConfirm_t *)msgPtr;
    944                sentEP = afDataConfirm->endpoint;
    945                sentStatus = afDataConfirm->hdr.status;
    946          
    947                // Action taken when confirmation is received.
    948          #if defined ( ZIGBEE_FREQ_AGILITY )
    949                if ( pZDNwkMgr_ProcessDataConfirm )
    950                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
    951          #endif
    952                (void)sentEP;
    953                (void)sentStatus;
    954                break;
    955          
    956              case ZDO_NWK_DISC_CNF:
    957                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000035   90....       MOV     DPTR,#devState
   \   000038   E0           MOVX    A,@DPTR
   \   000039   6402         XRL     A,#0x2
   \   00003B   6003         JZ      $+5
   \   00003D   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    958                  break;
    959                
    960                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   000040   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000043   E0           MOVX    A,@DPTR
   \   000044   6401         XRL     A,#0x1
   \   000046   6008         JZ      ??ZDApp_ProcessOSALMsg_6
   \   000048   E0           MOVX    A,@DPTR
   \   000049   6402         XRL     A,#0x2
   \   00004B   6003         JZ      $+5
   \   00004D   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    961                {
    962                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   000050   8E82         MOV     DPL,R6
   \   000052   8F83         MOV     DPH,R7
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   6003         JZ      $+5
   \   000058   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   \   00005B   90....       MOV     DPTR,#zdoDiscCounter
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   C3           CLR     C
   \   000060   9403         SUBB    A,#0x3
   \   000062   5003         JNC     $+5
   \   000064   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
    963                  {
    964                    if ( devStartMode == MODE_JOIN )
   \   000067   EE           MOV     A,R6
   \   000068   2404         ADD     A,#0x4
   \   00006A   F8           MOV     R0,A
   \   00006B   EF           MOV     A,R7
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F9           MOV     R1,A
   \   00006F   88..         MOV     ?V0 + 0,R0
   \   000071   89..         MOV     ?V0 + 1,R1
   \   000073   EE           MOV     A,R6
   \   000074   2403         ADD     A,#0x3
   \   000076   18           DEC     R0
   \   000077   EF           MOV     A,R7
   \   000078   3400         ADDC    A,#0x0
   \   00007A   F9           MOV     R1,A
   \   00007B   88..         MOV     ?V0 + 2,R0
   \   00007D   89..         MOV     ?V0 + 3,R1
   \   00007F   EE           MOV     A,R6
   \   000080   2402         ADD     A,#0x2
   \   000082   18           DEC     R0
   \   000083   EF           MOV     A,R7
   \   000084   3400         ADDC    A,#0x0
   \   000086   F9           MOV     R1,A
   \   000087   88..         MOV     ?V0 + 4,R0
   \   000089   89..         MOV     ?V0 + 5,R1
   \   00008B   90....       MOV     DPTR,#devStartMode
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   703E         JNZ     ??ZDApp_ProcessOSALMsg_8
    965                    {
    966                      devState = DEV_NWK_JOINING;
   \   000091   7403         MOV     A,#0x3
   \   000093   90....       MOV     DPTR,#devState
   \   000096   F0           MOVX    @DPTR,A
    967            
    968                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   000097                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   000097   12....       LCALL   ??ZDApp_NodeProfileSync?relay
    969            
    970                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    971                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
    972                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
    973                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   00009A                ; Setup parameters for call to function NLME_JoinRequest
   \   00009A   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   F5..         MOV     ?V0 + 6,A
   \   0000A0   78..         MOV     R0,#?V0 + 6
   \   0000A2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000A5   85..82       MOV     DPL,?V0 + 0
   \   0000A8   85..83       MOV     DPH,?V0 + 1
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   F9           MOV     R1,A
   \   0000AD   85..82       MOV     DPL,?V0 + 4
   \   0000B0   85..83       MOV     DPH,?V0 + 5
   \   0000B3   E0           MOVX    A,@DPTR
   \   0000B4   FC           MOV     R4,A
   \   0000B5   85..82       MOV     DPL,?V0 + 2
   \   0000B8   85..83       MOV     DPH,?V0 + 3
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   FD           MOV     R5,A
   \   0000BD   EE           MOV     A,R6
   \   0000BE   2406         ADD     A,#0x6
   \   0000C0   FA           MOV     R2,A
   \   0000C1   EF           MOV     A,R7
   \   0000C2   3400         ADDC    A,#0x0
   \   0000C4   FB           MOV     R3,A
   \   0000C5   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000C8   7401         MOV     A,#0x1
   \   0000CA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CD   807A         SJMP    ??ZDApp_ProcessOSALMsg_9
    974                      {
    975                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    976                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
    977                      }
    978                    }
    979                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   0000CF   6403         XRL     A,#0x3
   \   0000D1   707C         JNZ     ??CrossCallReturnLabel_6
    980                    {
    981                      devState = DEV_NWK_REJOIN;
   \   0000D3   7404         MOV     A,#0x4
   \   0000D5   90....       MOV     DPTR,#devState
   \   0000D8   F0           MOVX    @DPTR,A
    982          
    983                      // Before trying to do rejoin, check if the device has a valid short address
    984                      // If not, generate a random short address for itself
    985                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   0000D9   90....       MOV     DPTR,#(_NIB + 20)
   \   0000DC   E0           MOVX    A,@DPTR
   \   0000DD   64FE         XRL     A,#0xfe
   \   0000DF   7004         JNZ     ??ZDApp_ProcessOSALMsg_10
   \   0000E1   A3           INC     DPTR
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0000E5   7012         JNZ     ??ZDApp_ProcessOSALMsg_11
    986                      {
    987                        _NIB.nwkDevAddress = osal_rand();
   \   0000E7                ; Setup parameters for call to function osal_rand
   \   0000E7   12....       LCALL   ??osal_rand?relay
   \   0000EA   90....       MOV     DPTR,#(_NIB + 20)
   \   0000ED   12....       LCALL   ??Subroutine32_0 & 0xFFFF
    988                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \                     ??CrossCallReturnLabel_47:
   \   0000F0                ; Setup parameters for call to function ZMacSetReq
   \   0000F0   7A..         MOV     R2,#((_NIB + 20) & 0xff)
   \   0000F2   7B..         MOV     R3,#(((_NIB + 20) >> 8) & 0xff)
   \   0000F4   7953         MOV     R1,#0x53
   \   0000F6   12....       LCALL   ??ZMacSetReq?relay
    989                      }
    990          
    991                      if ( ZG_SECURE_ENABLED )
    992                      {
    993                        ZDApp_RestoreNwkKey();
    994                      }
    995                      
    996                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
    997                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   0000F9   90....       MOV     DPTR,#(_NIB + 33)
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   64FE         XRL     A,#0xfe
   \   0000FF   7004         JNZ     ??ZDApp_ProcessOSALMsg_12
   \   000101   A3           INC     DPTR
   \   000102   E0           MOVX    A,@DPTR
   \   000103   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   000105   7021         JNZ     ??ZDApp_ProcessOSALMsg_13
    998                      {
    999                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   \   000107   85..82       MOV     DPL,?V0 + 4
   \   00010A   85..83       MOV     DPH,?V0 + 5
   \   00010D   E0           MOVX    A,@DPTR
   \   00010E   FA           MOV     R2,A
   \   00010F   85..82       MOV     DPL,?V0 + 2
   \   000112   85..83       MOV     DPH,?V0 + 3
   \   000115   E0           MOVX    A,@DPTR
   \   000116   F9           MOV     R1,A
   \   000117   EA           MOV     A,R2
   \   000118   90....       MOV     DPTR,#(_NIB + 33)
   \   00011B   F0           MOVX    @DPTR,A
   \   00011C   A3           INC     DPTR
   \   00011D   E9           MOV     A,R1
   \   00011E   F0           MOVX    @DPTR,A
   1000                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   00011F                ; Setup parameters for call to function ZMacSetReq
   \   00011F   7A..         MOV     R2,#((_NIB + 33) & 0xff)
   \   000121   7B..         MOV     R3,#(((_NIB + 33) >> 8) & 0xff)
   \   000123   7950         MOV     R1,#0x50
   \   000125   12....       LCALL   ??ZMacSetReq?relay
   1001                      }
   1002          
   1003                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   000128   7401         MOV     A,#0x1
   \   00012A   85..82       MOV     DPL,?XSP + 0
   \   00012D   85..83       MOV     DPH,?XSP + 1
   \   000130   F0           MOVX    @DPTR,A
   1004                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
   \   000131                ; Setup parameters for call to function ZMacSetReq
   \   000131   AA82         MOV     R2,DPL
   \   000133   AB83         MOV     R3,DPH
   \   000135   7952         MOV     R1,#0x52
   \   000137   12....       LCALL   ??ZMacSetReq?relay
   1005                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   \   00013A                ; Setup parameters for call to function NLME_ReJoinRequest
   \   00013A   85..82       MOV     DPL,?V0 + 0
   \   00013D   85..83       MOV     DPH,?V0 + 1
   \   000140   E0           MOVX    A,@DPTR
   \   000141   F9           MOV     R1,A
   \   000142   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000144   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000146   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000149   E9           MOV     A,R1
   \   00014A   6003         JZ      ??CrossCallReturnLabel_6
   1006                      {
   1007                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1008                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   00014C                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00014C                ; Setup parameters for call to function osal_rand
   \   00014C   12....       LCALL   ?Subroutine9 & 0xFFFF
   1009                      }
   1010                    }
   1011            
   1012                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_6:
   \   00014F   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000152   E0           MOVX    A,@DPTR
   \   000153   A2E3         MOV     C,0xE0 /* A   */.3
   \   000155   5062         JNC     ??ZDApp_ProcessOSALMsg_5
   1013                    {
   1014                      // The receiver is on, turn network layer polling off.
   1015                      NLME_SetPollRate( 0 );
   \   000157                ; Setup parameters for call to function NLME_SetPollRate
   \   000157   12....       LCALL   ?Subroutine12 & 0xFFFF
   1016                      NLME_SetQueuedPollRate( 0 );
   1017                      NLME_SetResponseRate( 0 );
   1018                    }
   1019                    else
   1020                    {
   1021                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1022                      {
   1023                        ZDApp_SavedPollRate = zgPollRate;
   1024                        NLME_SetPollRate( zgRejoinPollRate );
   1025                      }
   1026                    }
   1027                  }
   \                     ??CrossCallReturnLabel_10:
   \   00015A   805D         SJMP    ??ZDApp_ProcessOSALMsg_5
   1028                  else
   1029                  {
   1030                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   00015C   90....       MOV     DPTR,#continueJoining
   \   00015F   E0           MOVX    A,@DPTR
   \   000160   6057         JZ      ??ZDApp_ProcessOSALMsg_5
   1031                    {
   1032              #if defined ( MANAGED_SCAN )
   1033                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1034              #else
   1035                      zdoDiscCounter++;
   \   000162   90....       MOV     DPTR,#zdoDiscCounter
   \   000165   E0           MOVX    A,@DPTR
   \   000166   04           INC     A
   \   000167   F0           MOVX    @DPTR,A
   1036                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1037                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   000168                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000168                ; Setup parameters for call to function osal_rand
   \   000168   12....       LCALL   ??osal_rand?relay
   \   00016B   8A..         MOV     ?V0 + 0,R2
   \   00016D   74FF         MOV     A,#-0x1
   \   00016F   55..         ANL     A,?V0 + 0
   \   000171   F8           MOV     R0,A
   \   000172   7464         MOV     A,#0x64
   \   000174   28           ADD     A,R0
   \   000175   FA           MOV     R2,A
   \   000176   E4           CLR     A
   \   000177   3400         ADDC    A,#0x0
   \   000179   FB           MOV     R3,A
   \   00017A   803A         SJMP    ??ZDApp_ProcessOSALMsg_14
   1038              #endif
   1039                    }
   1040                  }
   1041                }
   1042                break;
   1043          
   1044              case ZDO_NWK_JOIN_IND:
   1045                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00017C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00017F   E0           MOVX    A,@DPTR
   \   000180   6401         XRL     A,#0x1
   \   000182   6005         JZ      ??ZDApp_ProcessOSALMsg_15
   \   000184   E0           MOVX    A,@DPTR
   \   000185   6402         XRL     A,#0x2
   \   000187   7030         JNZ     ??ZDApp_ProcessOSALMsg_5
   1046                {
   1047                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   000189                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   000189   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   00018C   802B         SJMP    ??ZDApp_ProcessOSALMsg_5
   1048                }
   1049                break;
   1050          
   1051              case ZDO_NWK_JOIN_REQ:
   1052                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   00018E   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000191   E0           MOVX    A,@DPTR
   \   000192   6401         XRL     A,#0x1
   \   000194   6005         JZ      ??ZDApp_ProcessOSALMsg_16
   \   000196   E0           MOVX    A,@DPTR
   \   000197   6402         XRL     A,#0x2
   \   000199   701E         JNZ     ??ZDApp_ProcessOSALMsg_5
   1053                {
   1054                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   00019B   E4           CLR     A
   \   00019C   90....       MOV     DPTR,#retryCnt
   \   00019F   F0           MOVX    @DPTR,A
   1055                  devStartMode = MODE_RESUME;
   \   0001A0   7401         MOV     A,#0x1
   \   0001A2   90....       MOV     DPTR,#devStartMode
   \   0001A5   F0           MOVX    @DPTR,A
   1056                  _tmpRejoinState = true;
   \   0001A6   90....       MOV     DPTR,#_tmpRejoinState
   \   0001A9   12....       LCALL   ?Subroutine1 & 0xFFFF
   1057                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1058                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \                     ??CrossCallReturnLabel_1:
   \   0001AC   7402         MOV     A,#0x2
   \   0001AE   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0001B1   F0           MOVX    @DPTR,A
   1059                  ZDApp_NetworkInit( 0 );
   \   0001B2                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001B2   7A00         MOV     R2,#0x0
   \   0001B4   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   0001B6   12....       LCALL   ??ZDApp_NetworkInit?relay
   1060                }
   1061                break;
   1062          
   1063              default:
   1064                if ( ZG_SECURE_ENABLED )
   1065                  ZDApp_ProcessSecMsg( msgPtr );
   1066                break;
   1067            }
   1068          
   1069          }
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   0001B9   7401         MOV     A,#0x1
   \   0001BB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001BE   7F07         MOV     R7,#0x7
   \   0001C0   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??NLME_SetPollRate?relay
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E   7A00         MOV     R2,#0x0
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   747F         MOV     A,#0x7f
   \   000007   55..         ANL     A,?V0 + 0
   \   000009   F8           MOV     R0,A
   \   00000A   7464         MOV     A,#0x64
   \   00000C   28           ADD     A,R0
   \   00000D   FA           MOV     R2,A
   \   00000E   7B00         MOV     R3,#0x0
   \   000010   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000013   22           RET
   1070          
   1071          /*********************************************************************
   1072           * @fn      ZDApp_ProcessMsgCBs()
   1073           *
   1074           * @brief   Process response messages
   1075           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1076          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1077          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine11 & 0xFFFF
   1078            switch ( inMsg->clusterID )
   \                     ??CrossCallReturnLabel_38:
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000018   0200         DW        2
   \   00001A   2100         DW        33
   \   00001C   2200         DW        34
   \   00001E   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000020   0080         DW        32768
   \   000022   0180         DW        32769
   \   000024   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000026   0000         DW        0
   \   000028   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1079            {
   1080          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1081              case NWK_addr_rsp:
   1082              case IEEE_addr_rsp:
   1083                {
   1084                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1085                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   00002A                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   00002A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00002D   8A..         MOV     ?V0 + 0,R2
   \   00002F   8B..         MOV     ?V0 + 1,R3
   \   000031   AE..         MOV     R6,?V0 + 0
   \   000033   AF..         MOV     R7,?V0 + 1
   1086                  if ( pAddrRsp )
   \   000035   EE           MOV     A,R6
   \   000036   7001         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   000038   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000039   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1087                  {
   1088                    if ( pAddrRsp->status == ZSuccess )
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   7011         JNZ     ??ZDApp_ProcessMsgCBs_4
   1089                    {
   1090                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000042                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000042   EE           MOV     A,R6
   \   000043   2403         ADD     A,#0x3
   \   000045   FC           MOV     R4,A
   \   000046   EF           MOV     A,R7
   \   000047   3400         ADDC    A,#0x0
   \   000049   FD           MOV     R5,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FA           MOV     R2,A
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   FB           MOV     R3,A
   \   000050   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1091                    }
   1092                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000053                ; Setup parameters for call to function osal_mem_free
   \   000053   EE           MOV     A,R6
   \   000054   FA           MOV     R2,A
   \   000055   EF           MOV     A,R7
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??osal_mem_free?relay
   \   00005A   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1093                  }
   1094                }
   1095                break;
   1096          #endif
   1097                
   1098          #if defined ( REFLECTOR )
   1099              case Bind_req:
   1100              case Unbind_req:
   1101                {
   1102                  ZDO_BindUnbindReq_t bindReq;
   1103                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00005C                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00005C   85..82       MOV     DPL,?XSP + 0
   \   00005F   85..83       MOV     DPH,?XSP + 1
   \   000062   AC82         MOV     R4,DPL
   \   000064   AD83         MOV     R5,DPH
   \   000066   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1104                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000069                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000069   85..82       MOV     DPL,?XSP + 0
   \   00006C   85..83       MOV     DPH,?XSP + 1
   \   00006F   AC82         MOV     R4,DPL
   \   000071   AD83         MOV     R5,DPH
   \   000073   EE           MOV     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   FB           MOV     R3,A
   \   000077   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1105                }
   1106                break;
   1107          #endif      
   1108          
   1109          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1110              case Bind_rsp:
   1111              case Unbind_rsp:
   1112                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1113                {
   1114                  ZDMatchSendState(
   1115                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1116                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1117                }
   1118                break;
   1119                
   1120              case End_Device_Bind_req:
   1121                if (ZG_DEVICE_COORDINATOR_TYPE)
   1122                {
   1123                  ZDEndDeviceBind_t bindReq;
   1124                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1125                  ZDO_MatchEndDeviceBind( &bindReq );
   1126                  
   1127                  // Freeing the cluster lists - if allocated.
   1128                  if ( bindReq.numInClusters )
   1129                    osal_mem_free( bindReq.inClusters );
   1130                  if ( bindReq.numOutClusters )
   1131                    osal_mem_free( bindReq.outClusters );
   1132                }
   1133                break;
   1134          #endif
   1135            }
   1136          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00007A                REQUIRE ?Subroutine23
   \   00007A                ; // Fall through to label ?Subroutine23

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   7415         MOV     A,#0x15
   \   000002   02....       LJMP    ??Subroutine30_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   EA           MOV     A,R2
   \   000001   FE           MOV     R6,A
   \   000002   EB           MOV     A,R3
   \   000003   FF           MOV     R7,A
   \   000004   EE           MOV     A,R6
   \   000005   240C         ADD     A,#0xc
   \   000007                REQUIRE ??Subroutine29_0
   \   000007                ; // Fall through to label ??Subroutine29_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine29_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1137          
   1138          /*********************************************************************
   1139           * @fn      ZDApp_RegisterCBs()
   1140           *
   1141           * @brief   Process response messages
   1142           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1143          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1144          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1145          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1146            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine5 & 0xFFFF
   1147          #endif
   1148          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1149            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_24:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine5 & 0xFFFF
   1150          #endif  
   1151          #if ZG_BUILD_COORDINATOR_TYPE
   1152            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1153            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1154            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1155          #endif
   1156          #if defined ( REFLECTOR )
   1157            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_25:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   1158            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_26:
   \   000015                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000015   7A22         MOV     R2,#0x22
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   1159          #endif  
   1160          }
   \                     ??CrossCallReturnLabel_27:
   \   00001C   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine24_0
   \   000002                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1161          
   1162          /*********************************************************************
   1163           * @fn      ZDApp_ProcessSecMsg()
   1164           *
   1165           * @brief   Process the incoming security message.
   1166           *
   1167           * @param   msgPtr - message to process
   1168           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1169          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1170          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1171            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessSecMsg>_0`:
   \   00000C   00           DB        0
   \   00000D   02           DB        2
   \   00000E   06           DB        6
   \   00000F   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000011   0A           DB        10
   \   000012   ....         DW        ??ZDApp_ProcessSecMsg_1
   \   000014   ....         DW        ??ZDApp_ProcessSecMsg_2
   1172            {
   1173              case ZDO_ESTABLISH_KEY_CFM:
   1174                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1175                {
   1176                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1177                }
   1178                break;
   1179          
   1180              case ZDO_ESTABLISH_KEY_IND:
   1181                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1182                {
   1183                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1184                  {
   1185                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1186                  }
   1187                }
   1188                break;
   1189          
   1190              case ZDO_TRANSPORT_KEY_IND:
   1191                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000016   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   6401         XRL     A,#0x1
   \   00001C   6005         JZ      ??ZDApp_ProcessSecMsg_3
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   6402         XRL     A,#0x2
   \   000021   7015         JNZ     ??ZDApp_ProcessSecMsg_2
   1192                {
   1193                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000023                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   000023   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   \   000026   8010         SJMP    ??ZDApp_ProcessSecMsg_2
   1194                }
   1195                break;
   1196          
   1197              case ZDO_UPDATE_DEVICE_IND:
   1198                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1199                {
   1200                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1201                }
   1202                break;
   1203          
   1204              case ZDO_REMOVE_DEVICE_IND:
   1205                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1206                {
   1207                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1208                }
   1209                break;
   1210          
   1211              case ZDO_REQUEST_KEY_IND:
   1212                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1213                {
   1214                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1215                  {
   1216                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1217                  }
   1218                }
   1219                break;
   1220          
   1221              case ZDO_SWITCH_KEY_IND:
   1222                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   000028   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   6401         XRL     A,#0x1
   \   00002E   6005         JZ      ??ZDApp_ProcessSecMsg_4
   \   000030   E0           MOVX    A,@DPTR
   \   000031   6402         XRL     A,#0x2
   \   000033   7003         JNZ     ??ZDApp_ProcessSecMsg_2
   1223                {
   1224                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000035                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000035   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1225                }
   1226                break;
   1227              
   1228              case ZDO_AUTHENTICATE_IND:
   1229                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1230                {
   1231                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1232                }
   1233                break;
   1234          
   1235              case ZDO_AUTHENTICATE_CFM:
   1236                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1237                {
   1238                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1239                }
   1240                break;
   1241          
   1242              default:
   1243                // Unsupported messages
   1244                break;
   1245            }
   1246          }
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000038   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   1247          
   1248          /*********************************************************************
   1249           * @fn      ZDApp_ProcessNetworkJoin()
   1250           *
   1251           * @brief  Save off the Network key information.
   1252           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1253          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1254          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1255            if ( (devState == DEV_NWK_JOINING) ||
   1256                ((devState == DEV_NWK_ORPHAN)  &&
   1257                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1258            {
   1259              // Result of a Join attempt by this device.
   1260              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7017         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1261              {
   1262                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine4 & 0xFFFF
   1263          
   1264          #if defined ( POWER_SAVING )
   1265                osal_pwrmgr_device( PWRMGR_BATTERY );
   1266          #endif
   1267          
   1268                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1269                {
   1270                  // wait for auth from trust center!!
   1271                  devState = DEV_END_DEVICE_UNAUTH;
   1272          
   1273                  // Start the reset timer for MAX UNAUTH time
   1274                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1275                }
   1276                else
   1277                {
   1278                  if ( ZSTACK_ROUTER_BUILD )
   1279                  {
   1280                    if ( devState == DEV_NWK_ORPHAN 
   1281                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1282                    {
   1283                      // Change NIB state to router for restore
   1284                      _NIB.nwkState = NWK_ROUTER;
   1285                    }
   1286                  }
   1287                          
   1288                  if ( devState == DEV_NWK_JOINING )
   \                     ??CrossCallReturnLabel_15:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   6403         XRL     A,#0x3
   \   000036   7003         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1289                  {
   1290                    ZDApp_AnnounceNewAddress();
   \   000038                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000038   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1291                  }
   1292                  
   1293                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   00003B   7406         MOV     A,#0x6
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   F0           MOVX    @DPTR,A
   1294                  if ( ZSTACK_ROUTER_BUILD )
   \   000041   02....       LJMP    ??CrossCallReturnLabel_7 & 0xFFFF
   1295                  {
   1296                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1297                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1298                    {
   1299                      NLME_StartRouterRequest( 0, 0, false );
   1300                    }
   1301                  }
   1302                }
   1303              }
   1304              else
   1305              {
   1306                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000044   90....       MOV     DPTR,#devStartMode
   \   000047   E0           MOVX    A,@DPTR
   \   000048   6401         XRL     A,#0x1
   \   00004A   7031         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   00004C   90....       MOV     DPTR,#retryCnt
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   04           INC     A
   \   000051   F0           MOVX    @DPTR,A
   \   000052   C3           CLR     C
   \   000053   9403         SUBB    A,#0x3
   \   000055   4026         JC      ??ZDApp_ProcessNetworkJoin_5
   1307                {
   1308                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000057   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00005A   7003         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   00005C   74FF         MOV     A,#-0x1
   \   00005E   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   00005F   600A         JZ      ??ZDApp_ProcessNetworkJoin_7
   \   000061   74FE         MOV     A,#-0x2
   \   000063   68           XRL     A,R0
   \   000064   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   000066   74FF         MOV     A,#-0x1
   \   000068   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000069   7006         JNZ     ??ZDApp_ProcessNetworkJoin_9
   1309                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   00006B   E4           CLR     A
   \   00006C   90....       MOV     DPTR,#devStartMode
   \   00006F   800B         SJMP    ??ZDApp_ProcessNetworkJoin_10
   1310                  else
   1311                  {
   1312                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   000071   7403         MOV     A,#0x3
   \   000073   90....       MOV     DPTR,#devStartMode
   \   000076   F0           MOVX    @DPTR,A
   1313                    _tmpRejoinState = true;
   \   000077   7401         MOV     A,#0x1
   \   000079   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   00007C   F0           MOVX    @DPTR,A
   1314                  }
   1315                }
   1316          
   1317                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1318                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00007D                ; Setup parameters for call to function NLME_GetShortAddr
   \   00007D   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000080   8A..         MOV     ?V0 + 0,R2
   \   000082   8B..         MOV     ?V0 + 1,R3
   \   000084   74FE         MOV     A,#-0x2
   \   000086   65..         XRL     A,?V0 + 0
   \   000088   7004         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   00008A   74FF         MOV     A,#-0x1
   \   00008C   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   00008E   700E         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   000090   90....       MOV     DPTR,#(_NIB + 20)
   \   000093   E0           MOVX    A,@DPTR
   \   000094   64FE         XRL     A,#0xfe
   \   000096   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   000098   A3           INC     DPTR
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   00009C   6026         JZ      ??ZDApp_ProcessNetworkJoin_14
   1319                {
   1320                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   00009E   85..82       MOV     DPL,?XSP + 0
   \   0000A1   85..83       MOV     DPH,?XSP + 1
   \   0000A4   74FE         MOV     A,#-0x2
   \   0000A6   F0           MOVX    @DPTR,A
   \   0000A7   A3           INC     DPTR
   \   0000A8   74FF         MOV     A,#-0x1
   \   0000AA   F0           MOVX    @DPTR,A
   1321                  // Invalidate nwk addr so end device does not use in its data reqs.
   1322                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000AB   90....       MOV     DPTR,#(_NIB + 20)
   \   0000AE   74FE         MOV     A,#-0x2
   \   0000B0   F0           MOVX    @DPTR,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   74FF         MOV     A,#-0x1
   \   0000B4   F0           MOVX    @DPTR,A
   1323                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000B5                ; Setup parameters for call to function ZMacSetReq
   \   0000B5   85..82       MOV     DPL,?XSP + 0
   \   0000B8   85..83       MOV     DPH,?XSP + 1
   \   0000BB   AA82         MOV     R2,DPL
   \   0000BD   AB83         MOV     R3,DPH
   \   0000BF   7953         MOV     R1,#0x53
   \   0000C1   12....       LCALL   ??ZMacSetReq?relay
   1324                }
   1325          
   1326                // Clear the neighbor Table and network discovery tables.
   1327                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000C4                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000C4   12....       LCALL   ??nwkNeighborInitTable?relay
   1328                NLME_NwkDiscTerm();
   \   0000C7                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000C7   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1329          
   1330                zdoDiscCounter = 1;
   \   0000CA   7401         MOV     A,#0x1
   \   0000CC   90....       MOV     DPTR,#zdoDiscCounter
   \   0000CF   F0           MOVX    @DPTR,A
   1331          
   1332          //      ZDApp_NetworkInit( (uint16)
   1333          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1334          //                          (NWK_START_DELAY * 5)) );
   1335                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1336                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000D0                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000D0                ; Setup parameters for call to function osal_rand
   \   0000D0   8067         SJMP    ??ZDApp_ProcessNetworkJoin_15
   1337              }
   1338            }
   1339            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   6404         XRL     A,#0x4
   \   0000D5   7065         JNZ     ??CrossCallReturnLabel_7
   1340            {
   1341              // results of an orphaning attempt by this device
   1342              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000D7   90....       MOV     DPTR,#nwkStatus
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   7013         JNZ     ??ZDApp_ProcessNetworkJoin_16
   1343              {
   1344                if ( ZG_SECURE_ENABLED )
   1345                {
   1346                  ZDApp_RestoreNwkKey();
   1347                }
   1348                
   1349                devState = DEV_END_DEVICE;
   \   0000DD   12....       LCALL   ?Subroutine0 & 0xFFFF
   1350                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1351                // setup Power Manager Device
   1352          #if defined ( POWER_SAVING )
   1353                osal_pwrmgr_device( PWRMGR_BATTERY );
   1354          #endif
   1355          
   1356                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_20:
   \   0000E0   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000E6   5003         JNC     ??CrossCallReturnLabel_11
   1357                {
   1358                  // The receiver is on, turn network layer polling off.
   1359                  NLME_SetPollRate( 0 );
   \   0000E8                ; Setup parameters for call to function NLME_SetPollRate
   \   0000E8   12....       LCALL   ?Subroutine12 & 0xFFFF
   1360                  NLME_SetQueuedPollRate( 0 );
   1361                  NLME_SetResponseRate( 0 );
   1362                }
   1363          
   1364                if ( ZSTACK_ROUTER_BUILD )
   1365                {
   1366                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1367                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1368                  {
   1369                    NLME_StartRouterRequest( 0, 0, false );
   1370                  }
   1371                }
   1372                
   1373                ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_11:
   \   0000EB                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   0000EB   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   0000EE   804C         SJMP    ??CrossCallReturnLabel_7
   1374              }
   1375              else
   1376              {
   1377                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000F0   90....       MOV     DPTR,#devStartMode
   \   0000F3   E0           MOVX    A,@DPTR
   \   0000F4   6401         XRL     A,#0x1
   \   0000F6   703B         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1378                {
   1379                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   0000F8   90....       MOV     DPTR,#retryCnt
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   04           INC     A
   \   0000FD   F0           MOVX    @DPTR,A
   \   0000FE   C3           CLR     C
   \   0000FF   9404         SUBB    A,#0x4
   \   000101   5028         JNC     ??ZDApp_ProcessNetworkJoin_18
   1380                  {
   1381                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000103   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000106   7003         JNZ     ??ZDApp_ProcessNetworkJoin_19
   \   000108   74FF         MOV     A,#-0x1
   \   00010A   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   00010B   600A         JZ      ??ZDApp_ProcessNetworkJoin_20
   \   00010D   74FE         MOV     A,#-0x2
   \   00010F   68           XRL     A,R0
   \   000110   7003         JNZ     ??ZDApp_ProcessNetworkJoin_21
   \   000112   74FF         MOV     A,#-0x1
   \   000114   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   000115   7007         JNZ     ??ZDApp_ProcessNetworkJoin_22
   1382                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000117   E4           CLR     A
   \   000118   90....       MOV     DPTR,#devStartMode
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00011B   F0           MOVX    @DPTR,A
   \   00011C   8015         SJMP    ??ZDApp_ProcessNetworkJoin_17
   1383                    else
   1384                    {
   1385                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00011E   7403         MOV     A,#0x3
   \   000120   90....       MOV     DPTR,#devStartMode
   \   000123   F0           MOVX    @DPTR,A
   1386                      _tmpRejoinState = true;
   \   000124   7401         MOV     A,#0x1
   \   000126   90....       MOV     DPTR,#_tmpRejoinState
   \   000129   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_23
   1387                    }
   1388                  }
   1389                  // Do a normal join to the network after certain times of rejoin retries
   1390                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   00012B   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00012E   E0           MOVX    A,@DPTR
   \   00012F   6401         XRL     A,#0x1
   \   000131   60E4         JZ      ??ZDApp_ProcessNetworkJoin_20
   1391                  {
   1392                    devStartMode = MODE_JOIN;
   1393                  }
   1394                }
   1395          
   1396                // Clear the neighbor Table and network discovery tables.
   1397                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000133                ; Setup parameters for call to function nwkNeighborInitTable
   \   000133   12....       LCALL   ??nwkNeighborInitTable?relay
   1398                NLME_NwkDiscTerm();
   \   000136                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   000136   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1399          
   1400                // setup a retry for later...
   1401                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1402                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   000139                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000139                ; Setup parameters for call to function osal_rand
   1403              }
   1404            }
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   000139   12....       LCALL   ?Subroutine9 & 0xFFFF
   1405          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1406            else
   1407            {
   1408              // Assume from address conflict
   1409              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1410              {
   1411                // Notify the network
   1412                ZDApp_AnnounceNewAddress();
   1413                
   1414                // Notify apps
   1415                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1416              }
   1417            }
   1418          #endif
   1419          }
   \                     ??CrossCallReturnLabel_7:
   \   00013C   02....       LJMP    ?Subroutine18 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   90....       MOV     DPTR,#(_NIB + 33)
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1420          
   1421          /*********************************************************************
   1422           * @fn      ZDApp_SaveNwkKey()
   1423           *
   1424           * @brief   Save off the Network key information.
   1425           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1426          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1427          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1428            nwkActiveKeyItems keyItems;
   1429          
   1430            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1431            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1432          
   1433            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1434                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1435          
   1436            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1437          }
   \   000052                REQUIRE ?Subroutine21
   \   000052                ; // Fall through to label ?Subroutine21

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine25_0
   \   000006                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1438          
   1439          /*********************************************************************
   1440           * @fn      ZDApp_ResetNwkKey()
   1441           *
   1442           * @brief   Reset the Network key information in NV.
   1443           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1444          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1445          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1446            nwkActiveKeyItems keyItems;
   1447          
   1448            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine13 & 0xFFFF
   1449            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1450                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_13:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1451          }
   \   000023   02....       LJMP    ?Subroutine23 & 0xFFFF
   1452          
   1453          /*********************************************************************
   1454           * @fn      ZDApp_RestoreNwkKey()
   1455           *
   1456           * @brief  Save off the Network key information.
   1457           *
   1458           * @return  true if restored from NV, false if not
   1459           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1460          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1461          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1462            nwkActiveKeyItems keyItems;
   1463            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1464          
   1465            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1466                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1467            {
   1468              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   90....       MOV     DPTR,#__Constant_0
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?L_EQ_X
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1469              {
   1470                // Restore the key information
   1471                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1472                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1473                ret = true;
   \   00005E   0E           INC     R6
   1474              }
   1475          
   1476              // Force a save for the first frame counter increment
   1477              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1478            }
   1479            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine21 & 0xFFFF
   1480          }
   1481          
   1482          /*********************************************************************
   1483           * @fn      ZDApp_ResetTimerStart
   1484           *
   1485           * @brief   Start the reset timer.
   1486           *
   1487           * @param   delay - delay time(ms) before reset
   1488           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1489          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1490          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1491            // Start the rest timer
   1492            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine7 & 0xFFFF
   1493          }
   \                     ??CrossCallReturnLabel_32:
   \   00000D   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine26_0
   \   000005                ; // Fall through to label ??Subroutine26_0
   1494          
   1495          /*********************************************************************
   1496           * @fn      ZDApp_ResetTimerCancel
   1497           *
   1498           * @brief   Cancel the reset timer.
   1499           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1500          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1501          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1502            // Cancel the reset timer
   1503            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1504          }
   \   000010   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   1505          
   1506          /*********************************************************************
   1507           * @fn      ZDApp_LeaveCtrlInit
   1508           *
   1509           * @brief   Initialize the leave control logic.
   1510           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1511          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1512          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1513            uint8 status;
   1514          
   1515          
   1516            // Initialize control state
   1517            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine2 & 0xFFFF
   1518          
   1519            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1520                                        sizeof(ZDApp_LeaveCtrl),
   1521                                        &ZDApp_LeaveCtrl );
   1522          
   1523            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1524            {
   1525              // Read saved control
   1526              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1527                            0,
   1528                            sizeof( uint8 ),
   1529                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1530            }
   1531          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine31_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1532          
   1533          /*********************************************************************
   1534           * @fn      ZDApp_LeaveCtrlSet
   1535           *
   1536           * @brief   Set the leave control logic.
   1537           *
   1538           * @param   ra - reassociate flag
   1539           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1540          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1541          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1542            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1543          
   1544            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1545            {
   1546              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1547            }
   1548          
   1549            // Write the leave control
   1550            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1551                           0,
   1552                           sizeof( uint8 ),
   1553                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000030   02....       LJMP    ??Subroutine30_0 & 0xFFFF
   1554          }
   1555          
   1556          /*********************************************************************
   1557           * @fn      ZDApp_LeaveCtrlBypass
   1558           *
   1559           * @brief   Check if NV restore should be skipped during a leave reset.
   1560           *
   1561           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1562           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1563          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1564          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1565            uint8 bypass;
   1566          
   1567            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1568            {
   1569              bypass = TRUE;
   1570            }
   1571            else
   1572            {
   1573              bypass = FALSE;
   1574            }
   1575          
   1576            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   80..         SJMP    ??Subroutine27_0
   1577          }
   1578          
   1579          /*********************************************************************
   1580           * @fn      ZDApp_LeaveCtrlStartup
   1581           *
   1582           * @brief   Check for startup conditions during a leave reset.
   1583           *
   1584           * @param   state      - devState_t determined by leave control logic
   1585           * @param   startDelay - startup delay
   1586           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1587          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1588          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1589            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1590          
   1591            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1592            {
   1593              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1594              {
   1595                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1596              }
   1597              else
   1598              {
   1599                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1600              }
   1601          
   1602              // Set leave control to initialized state
   1603              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine2 & 0xFFFF
   1604          
   1605              // Write initialized control
   1606              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1607                            0,
   1608                            sizeof( uint8 ),
   1609                            &ZDApp_LeaveCtrl);
   1610            }
   \                     ??CrossCallReturnLabel_3:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1611          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   1612          
   1613          /*********************************************************************
   1614           * @fn      ZDApp_LeaveReset
   1615           *
   1616           * @brief   Setup a device reset due to a leave indication/confirm.
   1617           *
   1618           * @param   ra - reassociate flag
   1619           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1620          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1621          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1622            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1623          
   1624            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1625          }
   \   00000E   80..         SJMP    ??Subroutine27_0
   1626          
   1627          /*********************************************************************
   1628           * @fn      ZDApp_LeaveUpdate
   1629           *
   1630           * @brief   Update local device data related to leaving device.
   1631           *
   1632           * @param   nwkAddr        - NWK address of leaving device
   1633           * @param   extAddr        - EXT address of leaving device
   1634           * @param   removeChildren - remove children of leaving device
   1635           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1636          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1637                                  uint8 removeChildren )
   1638          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1639            /*
   1640            AddrMgrEntry_t entry;
   1641            */
   1642            (void)nwkAddr;  // Intentionally unreferenced parameter
   1643          
   1644            // Remove if child
   1645            if ( ZSTACK_ROUTER_BUILD )
   1646            {
   1647              NLME_RemoveChild( extAddr, removeChildren );
   1648            }
   1649          }
   \   000000   02....       LJMP    ?BRET
   1650          
   1651          /*********************************************************************
   1652           * CALLBACK FUNCTIONS
   1653           */
   1654          
   1655          
   1656          /*********************************************************************
   1657           * @fn      ZDApp_SendEventMsg()
   1658           *
   1659           * @brief  Sends a Network Join message
   1660           *
   1661           * @param  cmd - command ID
   1662           * @param  len - length (in bytes) of the buf field
   1663           * @param  buf - buffer for the rest of the message.
   1664           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1665          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1666          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1667            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008                REQUIRE ?Subroutine22
   \   000008                ; // Fall through to label ?Subroutine22
   1668          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000003   80..         SJMP    ??Subroutine27_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1669          
   1670          /*********************************************************************
   1671           * @fn      ZDApp_SendMsg()
   1672           *
   1673           * @brief   Sends a OSAL message
   1674           *
   1675           * @param  taskID - Where to send the message
   1676           * @param  cmd - command ID
   1677           * @param  len - length (in bytes) of the buf field
   1678           * @param  buf - buffer for the rest of the message.
   1679           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1680          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1681          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 7,R1
   \   000007   8A..         MOV     ?V0 + 8,R2
   \   000009   8B..         MOV     ?V0 + 4,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1682            osal_event_hdr_t *msgPtr;
   1683          
   1684            // Send the address to the task
   1685            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014                ; Setup parameters for call to function osal_msg_allocate
   \   000014   AA..         MOV     R2,?V0 + 0
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_msg_allocate?relay
   \   00001B   8A..         MOV     ?V0 + 10,R2
   \   00001D   8B..         MOV     ?V0 + 11,R3
   \   00001F   AE..         MOV     R6,?V0 + 10
   \   000021   AF..         MOV     R7,?V0 + 11
   1686            if ( msgPtr )
   \   000023   EE           MOV     A,R6
   \   000024   7001         JNZ     ??ZDApp_SendMsg_0
   \   000026   EF           MOV     A,R7
   \                     ??ZDApp_SendMsg_0:
   \   000027   6036         JZ      ??ZDApp_SendMsg_1
   1687            {
   1688              if ( (len > 0) && (buf != NULL) ) osal_memcpy( msgPtr, buf, len );
   \   000029   E5..         MOV     A,?V0 + 4
   \   00002B   6022         JZ      ??ZDApp_SendMsg_2
   \   00002D   E5..         MOV     A,?V0 + 2
   \   00002F   7002         JNZ     ??ZDApp_SendMsg_3
   \   000031   E5..         MOV     A,?V0 + 3
   \                     ??ZDApp_SendMsg_3:
   \   000033   601A         JZ      ??ZDApp_SendMsg_2
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 2
   \   000038   85....       MOV     ?V0 + 5,?V0 + 3
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   AC..         MOV     R4,?V0 + 0
   \   000045   7D00         MOV     R5,#0x0
   \   000047   12....       LCALL   ??osal_memcpy?relay
   \   00004A   7403         MOV     A,#0x3
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   1689          
   1690              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E5..         MOV     A,?V0 + 8
   \   000055   F0           MOVX    @DPTR,A
   1691              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000056                ; Setup parameters for call to function osal_msg_send
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   EF           MOV     A,R7
   \   000059   FB           MOV     R3,A
   \   00005A   A9..         MOV     R1,?V0 + 7
   \   00005C   12....       LCALL   ??osal_msg_send?relay
   1692            }
   1693          }
   \                     ??ZDApp_SendMsg_1:
   \   00005F   7F0C         MOV     R7,#0xc
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
   1694          
   1695          /*********************************************************************
   1696           * Call Back Functions from NWK  - API
   1697           */
   1698          
   1699          /*********************************************************************
   1700           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1701           *
   1702           * @brief       This function returns a choice of PAN to join.
   1703           *
   1704           * @param       ResultCount - Number of routers discovered
   1705           * @param               NetworkList - Pointer to list of network descriptors
   1706           *
   1707           * @return      ZStatus_t
   1708           */
   1709          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1710          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1711                                                   networkDesc_t *NetworkList )
   1712          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 7,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   1713            networkDesc_t *pNwkDesc = NetworkList;
   1714            ZDO_NetworkDiscoveryCfm_t msg;
   1715            uint8 i = ResultCount;
   1716            uint8 stackProfile;
   1717            uint8 stackProfilePro;
   1718            uint8 selected;
   1719          
   1720          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1721            if ( zdappMgmtNwkDiscReqInProgress )
   1722            {
   1723              zdappMgmtNwkDiscReqInProgress = false;
   1724              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1725              return ( ZSuccess );
   1726            }
   1727          #endif
   1728          
   1729            // process discovery results
   1730            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1731            selected = FALSE;
   1732          
   1733            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 6,#0x0
   1734            {
   1735              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 4
   \   000018   AF..         MOV     R7,?V0 + 5
   1736              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1737              {
   1738                if ( zgConfigPANID != 0xFFFF )
   1739                {
   1740                  // PAN Id is preconfigured. check if it matches
   1741                  if ( pNwkDesc->panId != zgConfigPANID )
   1742                    continue;
   1743                }
   1744                
   1745          
   1746                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1747                {
   1748                  // If the extended Pan ID is commissioned to a non zero value
   1749                  // Only join the Pan that has match EPID
   1750                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1751                    continue;
   1752                  
   1753                }
   1754                  // check that network is allowing joining
   1755                  if ( ZSTACK_ROUTER_BUILD )
   1756                  {
   1757                    if ( stackProfilePro == FALSE )
   1758                    {
   1759                      if ( !pNwkDesc->routerCapacity )
   1760                      {
   1761                        continue;
   1762                      }
   1763                    }
   1764                    else
   1765                    {
   1766                      if ( !pNwkDesc->deviceCapacity )
   1767                      {
   1768                        continue;
   1769                      }
   1770                    }
   1771                  }
   1772                  else if ( ZSTACK_END_DEVICE_BUILD )
   1773                  {
   1774                    if ( !pNwkDesc->deviceCapacity )
   1775                    {
   1776                      continue;
   1777                    }
   1778                  }
   1779          
   1780                  // check version of zigbee protocol
   1781                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1782                    continue;
   1783          
   1784                  // check version of stack profile
   1785                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1786                  {
   1787                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1788                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   6A           XRL     A,R2
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1789                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   1790                    
   1791                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 6
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 7
   \   000058   4003         JC      $+5
   \   00005A   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00005D   90....       MOV     DPTR,#zgConfigPANID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   64FF         XRL     A,#0xff
   \   000063   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000069   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   00006B   8E82         MOV     DPL,R6
   \   00006D   8F83         MOV     DPH,R7
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F9           MOV     R1,A
   \   000074   90....       MOV     DPTR,#zgConfigPANID
   \   000077   E0           MOVX    A,@DPTR
   \   000078   68           XRL     A,R0
   \   000079   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00007E   70B3         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   000080                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000080   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000082   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000084   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000087   E9           MOV     A,R1
   \   000088   6401         XRL     A,#0x1
   \   00008A   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   00008C                ; Setup parameters for call to function sAddrExtCmp
   \   00008C   AC..         MOV     R4,?V0 + 2
   \   00008E   AD..         MOV     R5,?V0 + 3
   \   000090   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000092   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000094   12....       LCALL   ??sAddrExtCmp?relay
   \   000097   E9           MOV     A,R1
   \   000098   6099         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   00009A   8E82         MOV     DPL,R6
   \   00009C   8F83         MOV     DPH,R7
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   608C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \   0000A7   85..82       MOV     DPL,?V0 + 0
   \   0000AA   85..83       MOV     DPH,?V0 + 1
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   FA           MOV     R2,A
   \   0000AF   90....       MOV     DPTR,#(_NIB + 17)
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   6A           XRL     A,R2
   \   0000B4   6003         JZ      $+5
   \   0000B6   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000B9   8E82         MOV     DPL,R6
   \   0000BB   8F83         MOV     DPH,R7
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   FA           MOV     R2,A
   \   0000C7   90....       MOV     DPTR,#zgStackProfile
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   6A           XRL     A,R2
   \   0000CC   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   6401         XRL     A,#0x1
   \   0000D1   6003         JZ      $+5
   \   0000D3   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000D6   7402         MOV     A,#0x2
   \   0000D8   6A           XRL     A,R2
   \   0000D9   6003         JZ      $+5
   \   0000DB   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000DE   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1792                    {
   1793                      continue;
   1794                    }
   1795                  }
   1796          
   1797                // check if beacon order is the right value.. if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1798                // continue;
   1799          
   1800                // choose this pan for joining
   1801                break;
   1802              } 
   1803              if (i < ResultCount)
   1804              {
   1805               selected = TRUE;
   1806                break;
   1807              }
   1808             
   1809              // break if selected or stack profile pro wasn't found
   1810              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000E1   E5..         MOV     A,?V0 + 8
   \   0000E3   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_12
   1811              {
   1812                break;
   1813              }
   1814            }
   \   0000E5   05..         INC     ?V0 + 6
   \   0000E7   E5..         MOV     A,?V0 + 6
   \   0000E9   C3           CLR     C
   \   0000EA   9402         SUBB    A,#0x2
   \   0000EC   5003         JNC     $+5
   \   0000EE   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1815          
   1816            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000F1   E5..         MOV     A,?V0 + 7
   \   0000F3   65..         XRL     A,?V0 + 9
   \   0000F5   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1817            {
   1818              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000F7   7401         MOV     A,#0x1
   \   0000F9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FC   7401         MOV     A,#0x1
   \   0000FE   F0           MOVX    @DPTR,A
   \   0000FF   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_13
   1819            }
   1820            else
   1821            {
   1822              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000101   7401         MOV     A,#0x1
   \   000103   12....       LCALL   ?XSTACK_DISP0_8
   \   000106   E4           CLR     A
   \   000107   F0           MOVX    @DPTR,A
   1823              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   000108   8E82         MOV     DPL,R6
   \   00010A   8F83         MOV     DPH,R7
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   C0E0         PUSH    A
   \   00010F   7402         MOV     A,#0x2
   \   000111   12....       LCALL   ?XSTACK_DISP0_8
   \   000114   D0E0         POP     A
   \   000116   F0           MOVX    @DPTR,A
   1824              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   000117   8E82         MOV     DPL,R6
   \   000119   8F83         MOV     DPH,R7
   \   00011B   A3           INC     DPTR
   \   00011C   E0           MOVX    A,@DPTR
   \   00011D   C0E0         PUSH    A
   \   00011F   7403         MOV     A,#0x3
   \   000121   12....       LCALL   ?XSTACK_DISP0_8
   \   000124   D0E0         POP     A
   \   000126   F0           MOVX    @DPTR,A
   1825              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   000127   8E82         MOV     DPL,R6
   \   000129   8F83         MOV     DPH,R7
   \   00012B   A3           INC     DPTR
   \   00012C   A3           INC     DPTR
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   C0E0         PUSH    A
   \   000130   7404         MOV     A,#0x4
   \   000132   12....       LCALL   ?XSTACK_DISP0_8
   \   000135   D0E0         POP     A
   \   000137   F0           MOVX    @DPTR,A
   1826              msg.version = pNwkDesc->version;
   \   000138   85..82       MOV     DPL,?V0 + 0
   \   00013B   85..83       MOV     DPH,?V0 + 1
   \   00013E   E0           MOVX    A,@DPTR
   \   00013F   C0E0         PUSH    A
   \   000141   7405         MOV     A,#0x5
   \   000143   12....       LCALL   ?XSTACK_DISP0_8
   \   000146   D0E0         POP     A
   \   000148   F0           MOVX    @DPTR,A
   1827              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000149                ; Setup parameters for call to function sAddrExtCpy
   \   000149   AC..         MOV     R4,?V0 + 2
   \   00014B   AD..         MOV     R5,?V0 + 3
   \   00014D   7406         MOV     A,#0x6
   \   00014F   12....       LCALL   ?XSTACK_DISP0_8
   \   000152   AA82         MOV     R2,DPL
   \   000154   AB83         MOV     R3,DPH
   \   000156   12....       LCALL   ??sAddrExtCpy?relay
   1828            }
   1829            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   000159                ; Setup parameters for call to function ZDApp_SendMsg
   \   000159   85..82       MOV     DPL,?XSP + 0
   \   00015C   85..83       MOV     DPH,?XSP + 1
   \   00015F   AC82         MOV     R4,DPL
   \   000161   AD83         MOV     R5,DPH
   \   000163   7B0E         MOV     R3,#0xe
   \   000165   7A01         MOV     R2,#0x1
   \   000167   12....       LCALL   ?Subroutine6 & 0xFFFF
   1830          
   1831            return (ZSuccess);
   \                     ??CrossCallReturnLabel_22:
   \   00016A   7900         MOV     R1,#0x0
   \   00016C   740E         MOV     A,#0xe
   \   00016E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000171   7F0A         MOV     R7,#0xa
   \   000173   02....       LJMP    ?BANKED_LEAVE_XDATA
   1832          }  // ZDO_NetworkDiscoveryConfirmCB
   1833          
   1834          /*********************************************************************
   1835           * @fn          ZDO_NetworkFormationConfirmCB
   1836           *
   1837           * @brief       This function reports the results of the request to
   1838           *              initialize a coordinator in a network.
   1839           *
   1840           * @param       Status - Result of NLME_NetworkFormationRequest()
   1841           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1842          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1843          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1844            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1845          
   1846            if ( Status == ZSUCCESS )
   \   000009   7019         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   1847            {
   1848              // LED Blink shows Coordinator started
   1849              HalLedBlink (HAL_LED_1, 1, 50, 1000);
   \   00000B                ; Setup parameters for call to function HalLedBlink
   \   00000B   7CE8         MOV     R4,#-0x18
   \   00000D   7D03         MOV     R5,#0x3
   \   00000F   7B32         MOV     R3,#0x32
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7901         MOV     R1,#0x1
   \   000015   12....       LCALL   ??HalLedBlink?relay
   1850              HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );
   \   000018                ; Setup parameters for call to function HalLedSet
   \   000018   7A00         MOV     R2,#0x0
   \   00001A   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   1851              
   1852              // LED off forgets HOLD_AUTO_START
   1853              HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   1854          
   1855          #if defined ( ZBIT )
   1856              SIM_SetColor(0xd0ffd0);
   1857          #endif
   1858          
   1859              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_37:
   \   00001D   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   1860              {
   1861                // Began with HOLD_AUTO_START
   1862                devState = DEV_COORD_STARTING;
   \   00001F   7408         MOV     A,#0x8
   \   000021   F0           MOVX    @DPTR,A
   \   000022   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   1863              }
   1864            }
   1865          #if defined(BLINK_LEDS)
   1866            else
   1867              HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000024                ; Setup parameters for call to function HalLedSet
   \   000024   7A04         MOV     R2,#0x4
   \   000026   7901         MOV     R1,#0x1
   \   000028   12....       LCALL   ??HalLedSet?relay
   1868          #endif
   1869          
   1870            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A02         MOV     R2,#0x2
   \   00002D   02....       LJMP    ?Subroutine16 & 0xFFFF
   1871          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine28_0:
   \   000000   7901         MOV     R1,#0x1
   \   000002   12....       LCALL   ??HalLedSet?relay
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7902         MOV     R1,#0x2
   \   000009   12....       LCALL   ??HalLedSet?relay
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   22           RET
   1872          
   1873          /*********************************************************************
   1874           * @fn          ZDO_StartRouterConfirmCB
   1875           *
   1876           * @brief       This function reports the results of the request to
   1877           *              start functioning as a router in a network.
   1878           *
   1879           * @param       Status - Result of NLME_StartRouterRequest()
   1880           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1881          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   1882          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1883            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1884          
   1885            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   1886            {
   1887              // LED on shows Router started
   1888              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine15 & 0xFFFF
   1889              
   1890              // LED off forgets HOLD_AUTO_START
   1891              HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF);
   1892              
   1893              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_35:
   \   00000E   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   1894              {
   1895                // Began with HOLD_AUTO_START
   1896                devState = DEV_END_DEVICE;
   \   000010   7406         MOV     A,#0x6
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   1897              }
   1898            }
   1899          #if defined(BLINK_LEDS)
   1900            else
   1901              HalLedSet( HAL_LED_1, HAL_LED_MODE_FLASH ); // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7901         MOV     R1,#0x1
   \   000019   12....       LCALL   ??HalLedSet?relay
   1902          #endif
   1903          
   1904            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001C                ; Setup parameters for call to function osal_set_event
   \   00001C   7A20         MOV     R2,#0x20
   \   00001E   02....       LJMP    ?Subroutine16 & 0xFFFF
   1905          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7A01         MOV     R2,#0x1
   \   000002                REQUIRE ??Subroutine28_0
   \   000002                ; // Fall through to label ??Subroutine28_0
   1906          
   1907          /*********************************************************************
   1908           * @fn          ZDO_JoinConfirmCB
   1909           *
   1910           * @brief       This function allows the next hight layer to be notified
   1911           *              of the results of its request to join itself or another
   1912           *              device to a network.
   1913           *
   1914           * @param       Status - Result of NLME_JoinRequest()
   1915           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1916          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   1917          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1918            (void)PanId;  // remove if this parameter is used.
   1919            
   1920            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1921          
   1922            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_JoinConfirmCB_0
   1923            {
   1924              // LED on shows device joined
   1925              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine15 & 0xFFFF
   1926              
   1927              // LED off forgets HOLD_AUTO_START
   1928              HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF);
   1929              
   1930              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_36:
   \   00000E   700C         JNZ     ??ZDO_JoinConfirmCB_1
   1931              {
   1932                // Began with HOLD_AUTO_START
   1933                devState = DEV_NWK_JOINING;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_JoinConfirmCB_1
   1934              }
   1935          
   1936              if ( !ZG_SECURE_ENABLED )
   1937              {
   1938                // Notify to save info into NV
   1939                ZDApp_NVUpdate();
   1940              }
   1941            }
   1942            else
   1943            {
   1944          #if defined(BLINK_LEDS)
   1945              HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH ); // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7901         MOV     R1,#0x1
   \   000019   12....       LCALL   ??HalLedSet?relay
   1946          #endif
   1947            }
   1948          
   1949            // Notify ZDApp
   1950            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001C   7C00         MOV     R4,#0x0
   \   00001E   7D00         MOV     R5,#0x0
   \   000020   7B02         MOV     R3,#0x2
   \   000022   7A02         MOV     R2,#0x2
   \   000024   02....       LJMP    ?Subroutine22 & 0xFFFF
   1951          }
   1952          
   1953          /*********************************************************************
   1954           * @fn          ZDO_AddrChangeIndicationCB
   1955           *
   1956           * @brief       This function notifies the application that this
   1957           *              device's address has changed.  Could happen in 
   1958           *              a network with stochastic addressing (PRO).
   1959           *
   1960           * @param       newAddr - the new address
   1961           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1962          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   1963          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1964            (void)newAddr;  // remove if this parameter is used
   1965            
   1966            // Notify to save info into NV
   1967            ZDApp_NVUpdate();
   1968          
   1969            // Notify the applications   
   1970            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine4 & 0xFFFF
   1971          
   1972            // Send out a device announce
   1973            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_16:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1974          }
   \   00000A   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   1975          
   1976          /*********************************************************************
   1977           * @fn          ZDO_JoinIndicationCB
   1978           *
   1979           * @brief       This function allows the next higher layer of a
   1980           *              coordinator to be notified of a remote join request.
   1981           *
   1982           * @param       ShortAddress - 16-bit address
   1983           * @param       ExtendedAddress - IEEE (64-bit) address
   1984           * @param       CapabilityInformation - Association Capability Information
   1985           * @param       type - of joining - 
   1986           *                          NWK_ASSOC_JOIN
   1987           *                          NWK_ASSOC_REJOIN_UNSECURE
   1988           *                          NWK_ASSOC_REJOIN_SECURE
   1989           *
   1990           * @return      ZStatus_t
   1991           */
   1992          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   1993                                          uint8 CapabilityInformation, uint8 type )
   1994          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1995            (void)ShortAddress;
   1996            (void)ExtendedAddress;
   1997            (void)CapabilityInformation;
   1998            
   1999              // Notify to save info into NV
   2000              ZDApp_NVUpdate();
   2001            
   2002              // send notification to TC of new device..
   2003              if ( ZG_SECURE_ENABLED )
   2004              {
   2005                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2006                {
   2007                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2008                }
   2009              }
   2010            
   2011              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine17
   \   000000                ; // Fall through to label ?Subroutine17

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2012          }
   2013          
   2014          /*********************************************************************
   2015           * @fn          ZDO_ConcentratorIndicationCB
   2016           *
   2017           * @brief       This function allows the next higher layer of a
   2018           *              device to be notified of existence of the concentrator.
   2019           *
   2020           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2021           *
   2022           * @return      void 
   2023           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2024          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2025          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2026            // Write your code here to do something with the concentrator's
   2027            // address.
   2028            (void)nwkAddr;
   2029          }
   \   000000   02....       LJMP    ?BRET
   2030          
   2031          /*********************************************************************
   2032           * @fn          ZDO_LeaveCnf
   2033           *
   2034           * @brief       This function allows the next higher layer to be
   2035           *              notified of the results of its request for this or
   2036           *              a child device to leave the network.
   2037           *
   2038           * @param       cnf - NLME_LeaveCnf_t
   2039           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2040          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2041          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2042            // Check for this device
   2043            if ( osal_ExtAddrEqual( cnf->extAddr,
   2044                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function sAddrExtCmp
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??sAddrExtCmp?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7006         JNZ     ??CrossCallReturnLabel_8
   2045            {
   2046              // Prepare to leave with reset
   2047              ZDApp_LeaveReset( cnf->rejoin );
   \   000020                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   12....       LCALL   ?Subroutine10 & 0xFFFF
   2048            }
   2049            else if ( ZSTACK_ROUTER_BUILD )
   2050            {
   2051              // Remove device address(optionally descendents) from data
   2052              ZDApp_LeaveUpdate( cnf->dstAddr,
   2053                                 cnf->extAddr,
   2054                                 cnf->removeChildren );
   2055            }
   2056          }
   \                     ??CrossCallReturnLabel_8:
   \   000026   02....       LJMP    ?Subroutine19 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F9           MOV     R1,A
   \   000009   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00000C   22           RET
   2057          
   2058          /*********************************************************************
   2059           * @fn          ZDO_LeaveInd
   2060           *
   2061           * @brief       This function allows the next higher layer of a
   2062           *              device to be notified of a remote leave request or
   2063           *              indication.
   2064           *
   2065           * @param       ind - NLME_LeaveInd_t
   2066           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2067          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2068          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2069            uint8 leave;
   2070          
   2071          
   2072            // Parent is requesting the leave - NWK layer filters out illegal
   2073            // requests
   2074            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7008         JNZ     ??ZDO_LeaveInd_0
   2075            {
   2076              // Notify network of leave
   2077              if ( ZSTACK_ROUTER_BUILD )
   2078              {
   2079                NLME_LeaveRsp_t rsp;
   2080                rsp.rejoin         = ind->rejoin;
   2081                rsp.removeChildren = ind->removeChildren;
   2082                NLME_LeaveRsp( &rsp );
   2083              }
   2084          
   2085              // Prepare to leave with reset
   2086              ZDApp_LeaveReset( ind->rejoin );
   \                     ??ZDO_LeaveInd_1:
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   12....       LCALL   ?Subroutine10 & 0xFFFF
   2087            }
   \                     ??CrossCallReturnLabel_9:
   \   000022   802C         SJMP    ??ZDO_LeaveInd_2
   2088            else
   2089            {
   2090              leave = FALSE;
   2091          
   2092              // Check if this device needs to leave as a child or descendent
   2093              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000024                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000024   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000027   8A..         MOV     ?V0 + 0,R2
   \   000029   8B..         MOV     ?V0 + 1,R3
   \   00002B   A8..         MOV     R0,?V0 + 0
   \   00002D   A9..         MOV     R1,?V0 + 1
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   E0           MOVX    A,@DPTR
   \   000034   68           XRL     A,R0
   \   000035   7003         JNZ     ??ZDO_LeaveInd_3
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   69           XRL     A,R1
   \                     ??ZDO_LeaveInd_3:
   \   00003A   7014         JNZ     ??ZDO_LeaveInd_2
   2094              {
   2095                if ( ( ind->removeChildren == TRUE               ) ||
   2096                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2097                       NODETYPE_DEVICE                           )    )
   \   00003C   EE           MOV     A,R6
   \   00003D   240B         ADD     A,#0xb
   \   00003F   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   2098                {
   2099                  leave = TRUE;
   2100                }
   2101              }
   2102              else if ( ind->removeChildren == TRUE )
   2103              {
   2104                // Check NWK address allocation algorithm
   2105                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2106              }
   2107          
   2108              if ( leave == TRUE )
   2109              {
   2110                // Prepare to leave with reset
   2111                ZDApp_LeaveReset( ind->rejoin );
   2112              }
   2113              else
   2114              {
   2115                // Remove device address(optionally descendents) from data
   2116                ZDApp_LeaveUpdate( ind->srcAddr,
   2117                                   ind->extAddr,
   2118                                   ind->removeChildren );
   2119              }
   2120            }
   \                     ??CrossCallReturnLabel_41:
   \   000042   6401         XRL     A,#0x1
   \   000044   60D6         JZ      ??ZDO_LeaveInd_1
   \   000046   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   5407         ANL     A,#0x7
   \   00004C   6402         XRL     A,#0x2
   \   00004E   60CC         JZ      ??ZDO_LeaveInd_1
   2121          }
   \                     ??ZDO_LeaveInd_2:
   \   000050   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2122          
   2123          /*********************************************************************
   2124           * @fn          ZDO_SyncIndicationCB
   2125           *
   2126           * @brief       This function allows the next higher layer of a
   2127           *              coordinator to be notified of a loss of synchronization
   2128           *                          with the parent/child device.
   2129           *
   2130           * @param       type: 0 - child; 1 - parent
   2131           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2132          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2133          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2134            (void)shortAddr;  // Remove this line if this parameter is used.
   2135            
   2136            if ( ZSTACK_END_DEVICE_BUILD
   2137              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   2138            {
   2139              if ( type == 1 )
   \   000004   7401         MOV     A,#0x1
   \   000006   69           XRL     A,R1
   \   000007   700E         JNZ     ??CrossCallReturnLabel_23
   2140              {
   2141                // We lost contact with our parent.  Clear the neighbor Table.
   2142                nwkNeighborInitTable();
   \   000009                ; Setup parameters for call to function nwkNeighborInitTable
   \   000009   12....       LCALL   ??nwkNeighborInitTable?relay
   2143                
   2144                // Start the rejoin process.
   2145                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   00000C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000C   7C00         MOV     R4,#0x0
   \   00000E   7D00         MOV     R5,#0x0
   \   000010   7B02         MOV     R3,#0x2
   \   000012   7A03         MOV     R2,#0x3
   \   000014   12....       LCALL   ?Subroutine6 & 0xFFFF
   2146              }
   2147            }
   2148          }
   \                     ??CrossCallReturnLabel_23:
   \   000017   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2149          
   2150          /*********************************************************************
   2151           * @fn          ZDO_ManytoOneFailureIndicationCB
   2152           *
   2153           * @brief       This function allows the next higher layer of a
   2154           *              concentrator to be notified of a many-to-one route 
   2155           *              failure. 
   2156           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2157          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2158          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2159            // By default, the concentrator automatically redo many-to-one route 
   2160            // discovery to update all many-to-one routes in the network
   2161            // If you want anything processing other than the default,
   2162            // please replace the following code.
   2163            
   2164            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2165          }
   \   000007   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2166          
   2167          
   2168          /*********************************************************************
   2169           * @fn          ZDO_PollConfirmCB
   2170           *
   2171           * @brief       This function allows the next higher layer to be
   2172           *              notified of a Poll Confirm.
   2173           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2174          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2175          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2176            (void)status;  // Remove this line if this parameter is used.
   2177            return;
   \   000000   02....       LJMP    ?BRET
   2178          }
   2179          
   2180          /******************************************************************************
   2181           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2182           *
   2183           * @brief       Stub routine implemented by NHLE. NHLE should call
   2184           *              <AddrMgrWriteNV> when appropriate.
   2185           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2186          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2187          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2188          #if defined ( NV_RESTORE )  
   2189            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2190            {
   2191              // Trigger to save info into NV
   2192              ZDApp_NVUpdate();
   2193            }
   2194          #endif
   2195          }
   \   000000   02....       LJMP    ?BRET
   2196          
   2197          /*********************************************************************
   2198           * Call Back Functions from Security  - API
   2199           */
   2200          
   2201           /*********************************************************************
   2202           * @fn          ZDO_UpdateDeviceIndication
   2203           *
   2204           * @brief       This function notifies the "Trust Center" of a
   2205           *              network when a device joins or leaves the network.
   2206           *
   2207           * @param       extAddr - pointer to 64 bit address of new device
   2208           * @param       status  - 0 if a new device joined securely
   2209           *                      - 1 if a new device joined un-securely
   2210           *                      - 2 if a device left the network
   2211           *
   2212           * @return      true if newly joined device should be allowed to
   2213           *                                              remain on network
   2214           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2215          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2216          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2217            // can implement a network access policy based on the
   2218            // IEEE address of newly joining devices...
   2219            (void)extAddr;
   2220            (void)status;
   2221            
   2222            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine17 & 0xFFFF
   2223          }
   2224          
   2225          /*********************************************************************
   2226           * @fn          ZDApp_InMsgCB
   2227           *
   2228           * @brief       This function is called to pass up any message that is
   2229           *              not yet supported.  This allows for the developer to
   2230           *              support features themselves..
   2231           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2232          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2233          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL   ?Subroutine11 & 0xFFFF
   2234            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \                     ??CrossCallReturnLabel_39:
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   7480         MOV     A,#-0x80
   \   00000E   59           ANL     A,R1
   \   00000F   FB           MOV     R3,A
   \   000010   E4           CLR     A
   \   000011   7001         JNZ     ??ZDApp_InMsgCB_0
   \   000013   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   000014   7049         JNZ     ??ZDApp_InMsgCB_1
   2235            {
   2236              // Handle the response message
   2237            }
   2238            else
   2239            {
   2240              // Handle the request message by sending a generic "not supported".
   2241              // Device Announce doesn't have a response.
   2242              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000016   EE           MOV     A,R6
   \   000017   240B         ADD     A,#0xb
   \   000019   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   00001C   7041         JNZ     ??ZDApp_InMsgCB_1
   \   00001E   7413         MOV     A,#0x13
   \   000020   68           XRL     A,R0
   \   000021   7001         JNZ     ??ZDApp_InMsgCB_2
   \   000023   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_2:
   \   000024   6039         JZ      ??ZDApp_InMsgCB_1
   2243              {
   2244                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2245                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000026                ; Setup parameters for call to function ZDP_GenericRsp
   \   000026   E8           MOV     A,R0
   \   000027   F5..         MOV     ?V0 + 0,A
   \   000029   7480         MOV     A,#-0x80
   \   00002B   49           ORL     A,R1
   \   00002C   F5..         MOV     ?V0 + 1,A
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   75..00       MOV     ?V0 + 0,#0x0
   \   000036   75..00       MOV     ?V0 + 1,#0x0
   \   000039   78..         MOV     R0,#?V0 + 0
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   EE           MOV     A,R6
   \   00003F   240E         ADD     A,#0xe
   \   000041   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   2246              }
   2247            }
   \                     ??CrossCallReturnLabel_43:
   \   000044   FD           MOV     R5,A
   \   000045   7C84         MOV     R4,#-0x7c
   \   000047   EE           MOV     A,R6
   \   000048   2402         ADD     A,#0x2
   \   00004A   0A           INC     R2
   \   00004B   0A           INC     R2
   \   00004C   EF           MOV     A,R7
   \   00004D   3400         ADDC    A,#0x0
   \   00004F   FB           MOV     R3,A
   \   000050   EE           MOV     A,R6
   \   000051   240F         ADD     A,#0xf
   \   000053   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   000056   F9           MOV     R1,A
   \   000057   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00005A   7404         MOV     A,#0x4
   \   00005C   12....       LCALL   ?DEALLOC_XSTACK8
   2248          }
   \                     ??ZDApp_InMsgCB_1:
   \   00005F   02....       LJMP    ??Subroutine31_0 & 0xFFFF
   2249          
   2250          
   2251          /*********************************************************************
   2252           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2253           *
   2254           * @brief   Changes the Match Descriptor Response permission.
   2255           *
   2256           * @param   endpoint - endpoint to allow responses
   2257           * @param   action - true to allow responses, false to not
   2258           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2259          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2260          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2261            // Store the action
   2262            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2263          }
   \   000007   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2264          
   2265          /*********************************************************************
   2266           * @fn      ZDApp_NetworkInit()
   2267           *
   2268           * @brief   Used to start the network joining process
   2269           *
   2270           * @param   delay - mSec delay to wait before starting
   2271           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2272          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2273          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2274            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2275            {
   2276              // Wait awhile before starting the device
   2277              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine7 & 0xFFFF
   2278            }
   \                     ??CrossCallReturnLabel_33:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_18
   2279            else
   2280            {
   2281              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ?Subroutine20 & 0xFFFF
   2282            }
   2283          }
   \                     ??CrossCallReturnLabel_18:
   \   00001A   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2284          
   2285          /*********************************************************************
   2286           * @fn      ZDApp_NwkStateUpdateCB()
   2287           *
   2288           * @brief   This function notifies that this device's network 
   2289           *          state info has been changed.
   2290           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2291          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2292          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2293            // Notify to save info into NV
   2294            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2295            {
   2296              // Trigger to save info into NV
   2297              ZDApp_NVUpdate();
   2298            }
   2299          }
   \   000010   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2300          
   2301          /*********************************************************************
   2302           * @fn      ZDApp_NodeProfileSync()
   2303           *
   2304           * @brief   Sync node with stack profile.
   2305           *
   2306           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2307           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2308          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2309          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2310            networkDesc_t* desc;
   2311            uint16         panID;
   2312          
   2313            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2314            {
   2315              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2316          
   2317              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2318          
   2319              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2320              {
   2321                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2322                {
   2323                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2324                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2325                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2326                }
   2327              }
   2328            }
   2329          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   80..         SJMP    ??Subroutine31_0
   2330          
   2331          /*********************************************************************
   2332           * @fn      ZDApp_StartJoiningCycle()
   2333           *
   2334           * @brief   Starts the joining cycle of a device.  This will only 
   2335           *          continue an already started (or stopped) joining cycle.
   2336           *
   2337           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2338           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2339          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2340          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2341            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2342            {
   2343              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2344              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2345          
   2346              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2347            }
   2348            else
   2349              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2350          }
   2351          
   2352          /*********************************************************************
   2353           * @fn      ZDApp_StopJoiningCycle()
   2354           *
   2355           * @brief   Stops the joining or rejoining process of a device.
   2356           *
   2357           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2358           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2359          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2360          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2361            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2362            {
   2363              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2364              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2365            }
   2366            else
   2367              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2368          }
   2369          
   2370          /*********************************************************************
   2371           * @fn      ZDApp_AnnounceNewAddress()
   2372           *
   2373           * @brief   Send Device Announce and hold all transmissions for 
   2374           *          new address timeout.
   2375           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2376          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2377          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2378          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2379            // Turn off data request hold
   2380            APSME_HoldDataRequests( 0 );
   2381          #endif
   2382            
   2383            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2384                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine30_0
   2385            
   2386          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2387            // Setup the timeout
   2388            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2389          #endif  
   2390          }
   2391          
   2392          /*********************************************************************
   2393           * @fn          ZDApp_NVUpdate
   2394           *
   2395           * @brief       Set the NV Update Timer.
   2396           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2397          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2398          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2399          #if defined ( NV_RESTORE )
   2400            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2401          #endif
   2402          }
   \   000000   02....       LJMP    ?BRET
   2403          
   2404          /*********************************************************************
   2405           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2406           *
   2407           * @brief   Returns a PAN ID for the network layer to use during
   2408           *          a coordinator start and there is another network with 
   2409           *          the intended PANID.
   2410           *
   2411           * @param   panid - the intended PAN ID
   2412           *
   2413           * @return  PANID to try
   2414           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2415          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2416          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2417            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2418          }
   2419          
   2420          /*********************************************************************
   2421           * @fn          ZDO_SrcRtgIndCB
   2422           *
   2423           * @brief       This function notifies the ZDO available src route record received.
   2424           *
   2425           * @param       srcAddr - source address of the source route
   2426           * @param       relayCnt - number of devices in the relay list
   2427           * @param       relayList - relay list of the source route
   2428           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2429          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2430          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 5
   \   000004   74FB         MOV     A,#-0x5
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   2431            zdoSrcRtg_t srcRtg;
   2432            
   2433            srcRtg.srcAddr = srcAddr;
   \   000009   12....       LCALL   ?Subroutine3 & 0xFFFF
   2434            srcRtg.relayCnt = relayCnt;
   \                     ??CrossCallReturnLabel_50:
   \   00000C   7402         MOV     A,#0x2
   \   00000E   12....       LCALL   ?XSTACK_DISP0_8
   \   000011   E9           MOV     A,R1
   \   000012   F0           MOVX    @DPTR,A
   2435            srcRtg.pRelayList = pRelayList;
   \   000013   7403         MOV     A,#0x3
   \   000015   12....       LCALL   ?XSTACK_DISP0_8
   \   000018   EC           MOV     A,R4
   \   000019   F0           MOVX    @DPTR,A
   \   00001A   A3           INC     DPTR
   \   00001B   ED           MOV     A,R5
   \   00001C   F0           MOVX    @DPTR,A
   2436            
   2437            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   00001D   90....       MOV     DPTR,#zdoCBFunc
   \   000020   E0           MOVX    A,@DPTR
   \   000021   7002         JNZ     ??ZDO_SrcRtgIndCB_0
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000025   6018         JZ      ??ZDO_SrcRtgIndCB_1
   2438            {
   2439              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000027                ; Setup parameters for indirect call
   \   000027   85..82       MOV     DPL,?XSP + 0
   \   00002A   85..83       MOV     DPH,?XSP + 1
   \   00002D   AA82         MOV     R2,DPL
   \   00002F   AB83         MOV     R3,DPH
   \   000031   90....       MOV     DPTR,#zdoCBFunc
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F583         MOV     DPH,A
   \   00003A   8882         MOV     DPL,R0
   \   00003C   12....       LCALL   ?CALL_IND
   2440            }
   2441          }
   \                     ??ZDO_SrcRtgIndCB_1:
   \   00003F   7405         MOV     A,#0x5
   \   000041   12....       LCALL   ?DEALLOC_XSTACK8
   \   000044   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2442          
   2443          
   2444          /*********************************************************************
   2445           * @fn          ZDO_RegisterForZdoCB
   2446           *
   2447           * @brief       Call this function to register the higher layer (for 
   2448           *              example, the Application layer or MT layer) with ZDO 
   2449           *              callbacks to get notified of some ZDO indication like
   2450           *              existence of a concentrator or receipt of a source 
   2451           *              route record.
   2452           *
   2453           * @param       indID - ZDO Indication ID
   2454           * @param       pFn   - Callback function pointer
   2455           *
   2456           * @return      ZSuccess - successful, ZInvalidParameter if not
   2457           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2458          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2459          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2460            // Check the range of the indication ID
   2461            if ( indID < MAX_ZDO_CB_FUNC )
   \   000004   E9           MOV     A,R1
   \   000005   700A         JNZ     ??ZDO_RegisterForZdoCB_0
   2462            {
   2463              zdoCBFunc[indID] = pFn;
   \   000007   90....       MOV     DPTR,#zdoCBFunc
   \   00000A   12....       LCALL   ??Subroutine32_0 & 0xFFFF
   2464              return ZSuccess;
   \                     ??CrossCallReturnLabel_48:
   \   00000D   7900         MOV     R1,#0x0
   \   00000F   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2465            }
   2466            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000011   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000013   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2467          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2468          
   2469          /*********************************************************************
   2470          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      0
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      0
       -> NLME_GetExtAddr               4      0      0
       -> ZDAppCheckForHoldKey          4      0      0
       -> ZDO_Init                      4      0      0
       -> afRegister                    4      0      0
       -> ZDApp_InitUserDesc            4      0      0
       -> ZDOInitDevice                 4      0      0
       -> HalLedBlink                   4      0      0
       -> ZDApp_RegisterCBs             4      0      0
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     10
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  0      0      0
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     16
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     47
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     28
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               1      0     27
       -> ZDP_IncomingData              0      0     32
       -> ZDApp_ProcessMsgCBs           0      0     32
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     34
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> osal_rand                     0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> NLME_ReJoinRequest            0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> NLME_SetPollRate              0      0     32
       -> NLME_SetQueuedPollRate        0      0     32
       -> NLME_SetResponseRate          0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> ZDApp_ProcessNetworkJoin      0      0     32
       -> sAddrExtCpy                   0      0     32
       -> ZDApp_NetworkInit             0      0     32
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrTransportKeyInd       4      0      0
       -> ZDSecMgrSwitchKeyInd          4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      2      0      0
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     55
       -> osal_msg_allocate             0      0     40
       -> osal_memcpy                   0      0     46
       -> osal_msg_send                 0      0     40
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> osal_start_timerEx            0      0     20
     ZDOInitDevice                      0      0     12
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> sAddrExtCmp                   0      0     18
       -> ZDApp_LeaveReset              0      0     18
     ZDO_LeaveInd                       0      0     10
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_GetCoordShortAddr        0      0     20
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      2      0      0
       -> HalLedBlink                   4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    3      0      5
     ZDO_StartRouterConfirmCB           2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> nwkNeighborInitTable          4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      2
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    78
     ??Subroutine27_0                               7
     ZDApp_SecInit                                 10
     ZDApp_event_loop                             177
     ??Subroutine26_0                               6
     ??Subroutine31_0                               5
     ZDApp_ProcessSecEvent                         82
     ?Subroutine19                                  5
     ??Subroutine32_0                               6
     ZDOInitDevice                                141
     ?Subroutine20                                 11
     ?Subroutine4                                   5
     ?Subroutine18                                  2
     ??Subroutine30_0                               3
     ?Subroutine3                                   6
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ZDApp_NetworkStartEvt                         78
     ?Subroutine16                                  3
     ZDApp_DeviceAuthEvt                           46
     ?Subroutine0                                   8
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     64
     ?Subroutine1                                  13
     ZDApp_InitUserDesc                            93
     ?Subroutine13                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                         451
     ?Subroutine12                                 22
     ?Subroutine9                                  20
     ZDApp_ProcessMsgCBs                          122
     ?Subroutine23                                  5
     ?Subroutine11                                  7
     ??Subroutine29_0                               9
     ZDApp_RegisterCBs                             31
     ?Subroutine5                                   2
     ??Subroutine24_0                               9
     ZDApp_ProcessSecMsg                           59
     ZDApp_ProcessNetworkJoin                     319
     ?Subroutine8                                  12
     ZDApp_SaveNwkKey                              82
     ?Subroutine21                                 10
     ?Subroutine14                                  6
     ??Subroutine25_0                               8
     ZDApp_ResetNwkKey                             38
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         16
     ?Subroutine7                                   5
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine2                                  14
     ZDApp_LeaveCtrlSet                            51
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              16
     ZDApp_LeaveUpdate                              3
     ZDApp_SendEventMsg                             8
     ?Subroutine22                                  5
     ?Subroutine6                                   9
     ZDApp_SendMsg                                100
     ZDO_NetworkDiscoveryConfirmCB                374
     ZDO_NetworkFormationConfirmCB                 48
     ??Subroutine28_0                              17
     ZDO_StartRouterConfirmCB                      33
     ?Subroutine15                                  2
     ZDO_JoinConfirmCB                             39
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine17                                  5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  41
     ?Subroutine10                                 13
     ZDO_LeaveInd                                  83
     ZDO_SyncIndicationCB                          26
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 98
     ZDApp_ChangeMatchDescRespPermission
                                                   10
     ZDApp_NetworkInit                             29
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        103
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ZDO_SrcRtgIndCB                               71
     ZDO_RegisterForZdoCB                          22
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 3 915 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    43 bytes in segment XDATA_Z
 
 4 268 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    54 bytes of XDATA memory

Errors: none
Warnings: none
