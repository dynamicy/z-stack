###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                16/Aug/2013  02:06:02 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\z-stack_813\z-stack\Sensor Network              #
#                          Example\Components\stack\zdo\ZDApp.c               #
#    Command line       =  -f "D:\z-stack_813\z-stack\Sensor Network          #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.c #
#                          fg" (-DCPU32MHZ -DROOT=__near_func                 #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig. #
#                          cfg" (-DSECURE=0 -DZG_SECURE_DYNAMIC=0             #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          -f "D:\z-stack_813\z-stack\Sensor Network          #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\Tools\CC2530DB\f8wZCL.cfg #
#                          " (-DZCL_READ -DZCL_WRITE -DZCL_BASIC              #
#                          -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH    #
#                          -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING           #
#                          -DZCL_PRICING) -DZCL_MESSAGE                       #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Components\stack\zdo\ZDApp.c" -D CC2530    #
#                          -D ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D           #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D Coor_receiver -D xHAL_KEYPAD -D xPA2591 -lC     #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\Coordinator_KB_PA\List\" -lA       #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\Coordinator_KB_PA\List\"           #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\Coordinator_KB_PA\Obj\" -e         #
#                          --require_prototypes --debug --core=plain          #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\z-stack_813\z-stack\Se #
#                          nsor Network Example\Projects\zstack\Sensor        #
#                          Network Application\ZIGBEE Coordinator &           #
#                          Router\CC2530DB\" -I "D:\z-stack_813\z-stack\Senso #
#                          r Network Example\Projects\zstack\Sensor Network   #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\SOURCE\" -I                     #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\SOURCE\" -I                  #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I       #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I  #
#                          "D:\z-stack_813\z-stack\Sensor Network             #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCL #
#                          UDE\" -I "D:\z-stack_813\z-stack\Sensor Network    #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARG #
#                          ET\CC2530KB\" -I "D:\z-stack_813\z-stack\Sensor    #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU #
#                          \CCSOC\" -I "D:\z-stack_813\z-stack\Sensor         #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INC #
#                          LUDE\" -I "D:\z-stack_813\z-stack\Sensor Network   #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF #
#                          \" -I "D:\z-stack_813\z-stack\Sensor Network       #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NW #
#                          K\" -I "D:\z-stack_813\z-stack\Sensor Network      #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SE #
#                          C\" -I "D:\z-stack_813\z-stack\Sensor Network      #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SA #
#                          PI\" -I "D:\z-stack_813\z-stack\Sensor Network     #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SY #
#                          S\" -I "D:\z-stack_813\z-stack\Sensor Network      #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZC #
#                          L\" -I "D:\z-stack_813\z-stack\Sensor Network      #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZD #
#                          O\" -I "D:\z-stack_813\z-stack\Sensor Network      #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W #
#                          \" -I "D:\z-stack_813\z-stack\Sensor Network       #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\"   #
#                          -I "D:\z-stack_813\z-stack\Sensor Network          #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES #
#                          \SADDR\" -I "D:\z-stack_813\z-stack\Sensor         #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES #
#                          \SDATA\" -I "D:\z-stack_813\z-stack\Sensor         #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCL #
#                          UDE\" -I "D:\z-stack_813\z-stack\Sensor Network    #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH #
#                          _LEVEL\" -I "D:\z-stack_813\z-stack\Sensor         #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_ #
#                          LEVEL\srf04\" -I "D:\z-stack_813\z-stack\Sensor    #
#                          Network Example\Projects\zstack\Sensor Network     #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_ #
#                          LEVEL\srf04\SINGLE_CHIP\" -I "C:\Program Files     #
#                          (x86)\IAR Systems\Embedded Workbench               #
#                          5.3\8051\INC\" -I "C:\Program Files (x86)\IAR      #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  D:\z-stack_813\z-stack\Sensor Network              #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\Coordinator_KB_PA\List\ZDApp.lst   #
#    Object file        =  D:\z-stack_813\z-stack\Sensor Network              #
#                          Example\Projects\zstack\Sensor Network             #
#                          Application\ZIGBEE Coordinator &                   #
#                          Router\CC2530DB\Coordinator_KB_PA\Obj\ZDApp.r51    #
#                                                                             #
#                                                                             #
###############################################################################

D:\z-stack_813\z-stack\Sensor Network Example\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-01-04 12:16:55 -0800 (Mon, 04 Jan 2010) $
      4            Revision:       $Revision: 21428 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            Should you have any questions regarding your right to use this Software,
     12            contact Texas Instruments Incorporated at www.TI.com. 
     13          **************************************************************************************************/
     14          
     15          /*********************************************************************
     16           * INCLUDES
     17           */
     18          #include "ZComDef.h"
     19          #include "ZMac.h"
     20          #include "OSAL.h"
     21          #include "OSAL_Tasks.h"
     22          #include "OSAL_PwrMgr.h"
     23          #include "OSAL_Nv.h"
     24          #include "AF.h"
     25          #include "APSMEDE.h"
     26          #include "NLMEDE.h"
     27          #include "AddrMgr.h"
     28          #include "ZDProfile.h"
     29          #include "ZDObject.h"
     30          #include "ZDConfig.h"
     31          #include "ZDSecMgr.h"
     32          #include "ZDApp.h"
     33          #include "DebugTrace.h"
     34          #include "nwk_util.h"
     35          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     36          #include "ZGlobals.h"
     37          #include "ZDNwkMgr.h"
     38          #include "rtg.h"
     39          
     40          #include "ssp.h"
     41          
     42          /* HAL */
     43          #include "hal_led.h"
     44          #include "hal_lcd.h"
     45          #include "hal_key.h"
     46          
     47          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     48            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     49          #endif
     50          /*********************************************************************
     51           * MACROS
     52           */
     53          
     54          /*********************************************************************
     55           * CONSTANTS
     56           */
     57          #if !defined( NWK_START_DELAY )
     58            #define NWK_START_DELAY             100   // in milliseconds
     59          #endif
     60          
     61          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     62            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     63          #endif
     64          
     65          #if !defined( BEACON_REQUEST_DELAY )
     66            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     67          #endif
     68          
     69          #if !defined( BEACON_REQ_DELAY_MASK )
     70            #define BEACON_REQ_DELAY_MASK       0x007F
     71          #endif
     72          
     73          #define MAX_RESUME_RETRY            3
     74          
     75          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
     76          
     77          // Beacon Order Settings (see NLMEDE.h)
     78          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
     79          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
     80          
     81          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
     82            // The number of times the frame counter can change before
     83            // saving to NV
     84            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
     85          #endif
     86          
     87          // Leave control bits
     88          #define ZDAPP_LEAVE_CTRL_INIT 0
     89          #define ZDAPP_LEAVE_CTRL_SET  1
     90          #define ZDAPP_LEAVE_CTRL_RA   2
     91          
     92          // Standard time to update NWK NV data
     93          #define ZDAPP_UPDATE_NWK_NV_TIME 700
     94          
     95          // Address Manager Stub Implementation
     96          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
     97          
     98          // Size of the ZDO callback function table zdoCBFunc[]
     99          #define MAX_ZDO_CB_FUNC 1
    100          
    101          
    102          /*********************************************************************
    103           * GLOBAL VARIABLES
    104           */
    105          
    106          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    107            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    108          #endif
    109          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    110          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    111          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    112          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    113          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    118          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    119          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    120          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    121          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    122          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    123          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    124          
    125          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    127          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    128          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    129          
    130          /*********************************************************************
    131           * EXTERNAL VARIABLES
    132           */
    133          
    134          /*********************************************************************
    135           * EXTERNAL FUNCTIONS
    136           */
    137          
    138          /*********************************************************************
    139           * LOCAL FUNCTIONS
    140           */
    141          
    142          void ZDApp_NetworkStartEvt( void );
    143          void ZDApp_DeviceAuthEvt( void );
    144          void ZDApp_SaveNetworkStateEvt( void );
    145          
    146          uint8 ZDApp_ReadNetworkRestoreState( void );
    147          uint8 ZDApp_RestoreNetworkState( void );
    148          void ZDAppDetermineDeviceType( void );
    149          void ZDApp_InitUserDesc( void );
    150          void ZDAppCheckForHoldKey( void );
    151          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    152          void ZDApp_ProcessNetworkJoin( void );
    153          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    154          void ZDApp_SaveNwkKey( void );
    155          uint8 ZDApp_RestoreNwkKey( void );
    156            
    157          void ZDApp_SecInit( uint8 state );
    158          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    159          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    160          
    161          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    162          
    163          void ZDApp_ResetTimerStart( uint16 delay );
    164          void ZDApp_ResetTimerCancel( void );
    165          void ZDApp_LeaveCtrlInit( void );
    166          void ZDApp_LeaveCtrlSet( uint8 ra );
    167          uint8 ZDApp_LeaveCtrlBypass( void );
    168          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    169          void ZDApp_LeaveReset( uint8 ra );
    170          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    171                                  uint8 removeChildren );
    172          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    173          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    174          void ZDApp_RegisterCBs( void );
    175          
    176          /*********************************************************************
    177           * LOCAL VARIABLES
    178           */
    179          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    180          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    181          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    183          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    184          
    185          #if defined( HOLD_AUTO_START )
    186            devStates_t devState = DEV_HOLD;
    187          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    188            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    189          #endif
    190          
    191          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )
    192            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
    193            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    194                                  // to parent. Set to make the device do an Orphan scan.
    195          #else
    196            // Set the default to coodinator

   \                                 In  segment XDATA_I, align 1, keep-with-next
    197            devStartModes_t devStartMode = MODE_HARD;
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devStartMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    198          #endif
    199          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    200          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    201          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    202          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    203          {
    204            ZDO_EP,
    205            &ZDAppTaskID,
    206            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    207            (afNetworkLatencyReq_t)0            // No Network Latency req
    208          };
    209          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    210          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    211          
    212          /*********************************************************************
    213           * @fn      ZDApp_Init
    214           *
    215           * @brief   ZDApp Initialization function.
    216           *
    217           * @param   task_id - ZDApp Task ID
    218           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    219          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    220          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    221            // Save the task ID
    222            ZDAppTaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   F0           MOVX    @DPTR,A
    223          
    224            // Initialize the ZDO global device short address storage
    225            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   000009   7402         MOV     A,#0x2
   \   00000B   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000E   F0           MOVX    @DPTR,A
    226            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   00000F   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000012   74FE         MOV     A,#-0x2
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   74FF         MOV     A,#-0x1
   \   000018   F0           MOVX    @DPTR,A
    227            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    228          
    229            // Check for manual "Hold Auto Start"
    230            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    231          
    232            // Initialize ZDO items and setup the device - type of device to create.
    233            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    234          
    235            // Register the endpoint description with the AF
    236            // This task doesn't have a Simple description, but we still need
    237            // to register the endpoint.
    238            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000024   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000026   12....       LCALL   ??afRegister?relay
    239          
    240          #if defined( ZDO_USERDESC_RESPONSE )
    241            ZDApp_InitUserDesc();
   \   000029                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000029   12....       LCALL   ??ZDApp_InitUserDesc?relay
    242          #endif // ZDO_USERDESC_RESPONSE
    243          
    244            // Start the device?
    245            if ( devState != DEV_HOLD )
   \   00002C   90....       MOV     DPTR,#devState
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6009         JZ      ??ZDApp_Init_0
    246            {
    247              ZDOInitDevice( 0 );
   \   000032                ; Setup parameters for call to function ZDOInitDevice
   \   000032   7A00         MOV     R2,#0x0
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??ZDOInitDevice?relay
   \   000039   800D         SJMP    ??ZDApp_Init_1
    248            }
    249            else
    250            {
    251              // Blink LED to indicate HOLD_START
    252              HalLedBlink ( HAL_LED_2, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00003B                ; Setup parameters for call to function HalLedBlink
   \   00003B   7CF4         MOV     R4,#-0xc
   \   00003D   7D01         MOV     R5,#0x1
   \   00003F   7B32         MOV     R3,#0x32
   \   000041   7A00         MOV     R2,#0x0
   \   000043   7902         MOV     R1,#0x2
   \   000045   12....       LCALL   ??HalLedBlink?relay
    253            }
    254            
    255            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000048                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000048   12....       LCALL   ??ZDApp_RegisterCBs?relay
    256          } /* ZDApp_Init() */
   \   00004B   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    257          
    258          /*********************************************************************
    259           * @fn          ZDApp_SecInit
    260           *
    261           * @brief       ZDApp initialize security.
    262           *
    263           * @param       state - device initialization state
    264           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    265          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    266          {  
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    267            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    268            {
    269              // Set the Trust Center bit
    270              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    271            }
    272          
    273            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    274            {
    275              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    276            }
    277              
    278            // Initialize ZigBee Device Security Manager
    279            ZDSecMgrInit(state);
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    280          
    281            if ( ZG_SECURE_ENABLED )
    282            {
    283              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    284              {
    285                nwkFrameCounter = 0;
    286            
    287                if( _NIB.nwkKeyLoaded == FALSE )
    288                {
    289                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    290                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    291                  {
    292                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    293                      SSP_SwitchNwkKey( 0 );
    294                  }
    295                }
    296              }
    297            }    
    298          }
   \   000007   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    299          
    300          /*********************************************************************
    301           * @fn      ZDApp_event_loop()
    302           *
    303           * @brief   Main event loop for Zigbee device objects task. This function
    304           *          should be called at periodic intervals.
    305           *
    306           * @param   task_id - Task ID
    307           * @param   events  - Bitmap of events
    308           *
    309           * @return  none
    310           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    311          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    312          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    313            uint8 *msg_ptr;
    314          
    315            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7031         JNZ     ??ZDApp_event_loop_1
    316            {
    317              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    318              {
    319                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    320          
    321                // Release the memory
    322                osal_msg_deallocate( msg_ptr );
    323              }
    324          
    325              // Return unprocessed events
    326              return (events ^ SYS_EVENT_MSG);
    327            }
    328          
    329            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   5045         JNC     ??ZDApp_event_loop_2
    330            {
    331              // Initialize apps and start the network
    332              devState = DEV_INIT;
   \   000018   7401         MOV     A,#0x1
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   F0           MOVX    @DPTR,A
    333              
    334              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    335                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00001E                ; Setup parameters for call to function ZDO_StartDevice
   \   00001E   7C0F         MOV     R4,#0xf
   \   000020   7B0F         MOV     R3,#0xf
   \   000022   90....       MOV     DPTR,#devStartMode
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FA           MOV     R2,A
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5407         ANL     A,#0x7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??ZDO_StartDevice?relay
    336          
    337              // Return unprocessed events
    338              return (events ^ ZDO_NETWORK_INIT);
   \   000031   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000033   6E           XRL     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000036   FB           MOV     R3,A
   \   000037   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    339            }
   \                     ??ZDApp_event_loop_6:
   \   00003A                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00003A   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003D                ; Setup parameters for call to function osal_msg_deallocate
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000044                ; Setup parameters for call to function osal_msg_receive
   \   000044   90....       MOV     DPTR,#ZDAppTaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_msg_receive?relay
   \   00004C   8A..         MOV     ?V0 + 0,R2
   \   00004E   8B..         MOV     ?V0 + 1,R3
   \   000050   EA           MOV     A,R2
   \   000051   7001         JNZ     ??ZDApp_event_loop_7
   \   000053   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000054   70E4         JNZ     ??ZDApp_event_loop_6
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   00005A   6F           XRL     A,R7
   \   00005B   80D9         SJMP    ??ZDApp_event_loop_4
    340          
    341            if ( ZSTACK_ROUTER_BUILD )
    342            {
    343              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_2:
   \   00005D   5402         ANL     A,#0x2
   \   00005F   6007         JZ      ??ZDApp_event_loop_9
    344              {
    345                ZDApp_NetworkStartEvt();  //The network start event
   \   000061                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   000061   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    346            
    347                // Return unprocessed events
    348                return (events ^ ZDO_NETWORK_START);
   \   000064   7402         MOV     A,#0x2
   \   000066   80CB         SJMP    ??ZDApp_event_loop_3
    349              }
    350          
    351              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_9:
   \   000068   EE           MOV     A,R6
   \   000069   5420         ANL     A,#0x20
   \   00006B   601D         JZ      ??ZDApp_event_loop_10
    352              {
    353                if ( nwkStatus == ZSuccess )
   \   00006D   90....       MOV     DPTR,#nwkStatus
   \   000070   E0           MOVX    A,@DPTR
   \   000071   7010         JNZ     ??ZDApp_event_loop_11
    354                {
    355                  if ( devState == DEV_END_DEVICE )
   \   000073   90....       MOV     DPTR,#devState
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6406         XRL     A,#0x6
   \   000079   7003         JNZ     ??ZDApp_event_loop_12
    356                    devState = DEV_ROUTER;
   \   00007B   7407         MOV     A,#0x7
   \   00007D   F0           MOVX    @DPTR,A
    357            
    358                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_12:
   \   00007E                ; Setup parameters for call to function osal_pwrmgr_device
   \   00007E   7900         MOV     R1,#0x0
   \   000080   12....       LCALL   ??osal_pwrmgr_device?relay
    359                }
    360                else
    361                {
    362                  // remain as end device!!
    363                }
    364                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_11:
   \   000083                ; Setup parameters for call to function osal_set_event
   \   000083   12....       LCALL   ?Subroutine2 & 0xFFFF
    365            
    366                // Return unprocessed events
    367                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_16:
   \   000086   7420         MOV     A,#0x20
   \   000088   80A9         SJMP    ??ZDApp_event_loop_3
    368              }
    369            }
    370            
    371            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_10:
   \   00008A   EE           MOV     A,R6
   \   00008B   5410         ANL     A,#0x10
   \   00008D   6022         JZ      ??ZDApp_event_loop_13
    372            {
    373              ZDO_UpdateNwkStatus( devState );  // The device state
   \   00008F                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00008F   90....       MOV     DPTR,#devState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F9           MOV     R1,A
   \   000094   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    374              
    375              // At start up, do one MTO route discovery if the device is a concentrator(¶°¤¤¾¹)
    376              if ( zgConcentratorEnable == TRUE ) 
   \   000097   90....       MOV     DPTR,#zgConcentratorEnable
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   6401         XRL     A,#0x1
   \   00009D   700E         JNZ     ??CrossCallReturnLabel_39
    377              {
    378                // Start next event
    379                // chris
    380                //  osal_start_timerEx(ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
    381                //  NWK_RETRY_DELAY             1000   // in milliseconds  
    382          //          osal_start_timerEx(ZDAppTaskID, show("hello"), NWK_RETRY_DELAY );
    383          
    384            
    385                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   00009F                ; Setup parameters for call to function osal_start_timerEx
   \   00009F   7C64         MOV     R4,#0x64
   \   0000A1   7D00         MOV     R5,#0x0
   \   0000A3   7A00         MOV     R2,#0x0
   \   0000A5   7B08         MOV     R3,#0x8
   \   0000A7   90....       MOV     DPTR,#NWK_TaskID
   \   0000AA   12....       LCALL   ??Subroutine22_0 & 0xFFFF
    386              }
    387              
    388              // Return unprocessed events
    389              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_39:
   \   0000AD   7410         MOV     A,#0x10
   \   0000AF   8082         SJMP    ??ZDApp_event_loop_3
    390            }
    391          
    392            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_13:
   \   0000B1   EE           MOV     A,R6
   \   0000B2   5408         ANL     A,#0x8
   \   0000B4   6006         JZ      ??ZDApp_event_loop_14
    393            {
    394              // User defined logic
    395          
    396              // Return unprocessed events
    397              return (events ^ ZDO_COMMAND_CNF);
   \   0000B6   7408         MOV     A,#0x8
   \   0000B8   6E           XRL     A,R6
   \   0000B9   FA           MOV     R2,A
   \   0000BA   8021         SJMP    ??ZDApp_event_loop_5
    398            }
    399            
    400            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_14:
   \   0000BC   7402         MOV     A,#0x2
   \   0000BE   5F           ANL     A,R7
   \   0000BF   F9           MOV     R1,A
   \   0000C0   E4           CLR     A
   \   0000C1   7001         JNZ     ??ZDApp_event_loop_15
   \   0000C3   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_15:
   \   0000C4   6004         JZ      ??ZDApp_event_loop_16
    401            {
    402              ZDApp_SaveNetworkStateEvt();
    403          
    404              // Return unprocessed events
    405              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000C6   7402         MOV     A,#0x2
   \   0000C8   8090         SJMP    ??ZDApp_event_loop_8
    406            }
    407          
    408            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_16:
   \   0000CA   EE           MOV     A,R6
   \   0000CB   5404         ANL     A,#0x4
   \   0000CD   600A         JZ      ??ZDApp_event_loop_17
    409            {
    410              // The device has been in the UNAUTH state, so reset
    411              // Note: there will be no return from this call
    412              SystemReset();
   \   0000CF   C2AF         CLR     0xa8.7
   \   0000D1   75C9AB       MOV     0xc9,#-0x55
   \   0000D4   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_18:
   \   0000D7   80FE         SJMP    ??ZDApp_event_loop_18
    413            }
    414          
    415            if ( ZG_SECURE_ENABLED )
    416            {
    417              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    418            }
    419            else
    420            {
    421              // Discard or make more handlers
    422              return 0;
   \                     ??ZDApp_event_loop_17:
   \   0000D9   7A00         MOV     R2,#0x0
   \   0000DB   7B00         MOV     R3,#0x0
    423            }
   \                     ??ZDApp_event_loop_5:
   \   0000DD   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   \   0000E0                REQUIRE _A_IEN0
   \   0000E0                REQUIRE WDCTL
    424          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ?Subroutine16
   \   000002                ; // Fall through to label ?Subroutine16

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    425          
    426          /*********************************************************************
    427           * @fn      ZDApp_ProcessSecEvent()
    428           *
    429           * @brief   Process incoming security events.
    430           *
    431           * @param   task_id - Task ID
    432           * @param   events  - Bitmap of events
    433           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    434          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    435          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    436            (void)task_id;  // Intentionally unreferenced parameter
    437            
    438            if ( ZSTACK_ROUTER_BUILD )
    439            {
    440              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6019         JZ      ??ZDApp_ProcessSecEvent_0
    441              {
    442                // process the new device event
    443                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7009         JNZ     ??CrossCallReturnLabel_36
    444                {
    445                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   12....       LCALL   ?Subroutine6 & 0xFFFF
    446                }
    447          
    448                // Return unprocessed events
    449                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_36:
   \   00001F   7440         MOV     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000021   6E           XRL     A,R6
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \   000024   FB           MOV     R3,A
   \   000025   8045         SJMP    ??ZDApp_ProcessSecEvent_2
    450              }
    451            }
    452          
    453            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    454                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    455            {
    456              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    457              { 
    458                if ( events & ZDO_SECMGR_EVENT )
    459                {
    460                  ZDSecMgrEvent();
    461          
    462                  // Return unprocessed events
    463                  return (events ^ ZDO_SECMGR_EVENT);
    464                }
    465              }
    466            }
    467            
    468            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000027   EE           MOV     A,R6
   \   000028   5480         ANL     A,#0x80
   \   00002A   6007         JZ      ??ZDApp_ProcessSecEvent_3
    469            {
    470              ZDApp_DeviceAuthEvt();
   \   00002C                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00002C   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    471          
    472              // Return unprocessed events
    473              return (events ^ ZDO_DEVICE_AUTH);
   \   00002F   7480         MOV     A,#-0x80
   \   000031   80EE         SJMP    ??ZDApp_ProcessSecEvent_1
    474            }
    475          
    476            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000033   7404         MOV     A,#0x4
   \   000035   5F           ANL     A,R7
   \   000036   F9           MOV     R1,A
   \   000037   E4           CLR     A
   \   000038   7001         JNZ     ??ZDApp_ProcessSecEvent_4
   \   00003A   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00003B   602B         JZ      ??ZDApp_ProcessSecEvent_5
    477            {
    478              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   00003D   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F8           MOV     R0,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F9           MOV     R1,A
   \   000045   7401         MOV     A,#0x1
   \   000047   28           ADD     A,R0
   \   000048   FA           MOV     R2,A
   \   000049   E4           CLR     A
   \   00004A   39           ADDC    A,R1
   \   00004B   FB           MOV     R3,A
   \   00004C   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004F   EA           MOV     A,R2
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   EB           MOV     A,R3
   \   000053   F0           MOVX    @DPTR,A
   \   000054   C3           CLR     C
   \   000055   E8           MOV     A,R0
   \   000056   94E9         SUBB    A,#-0x17
   \   000058   E9           MOV     A,R1
   \   000059   9403         SUBB    A,#0x3
   \   00005B   4003         JC      ??ZDApp_ProcessSecEvent_6
    479                ZDApp_SaveNwkKey();
   \   00005D                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00005D   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    480          
    481              // Return unprocessed events
    482              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_6:
   \   000060   EE           MOV     A,R6
   \   000061   FA           MOV     R2,A
   \   000062   7404         MOV     A,#0x4
   \   000064   6F           XRL     A,R7
   \   000065   FB           MOV     R3,A
   \   000066   8004         SJMP    ??ZDApp_ProcessSecEvent_2
    483            }
    484            
    485            // Discard or make more handlers
    486            return 0;
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000068   7A00         MOV     R2,#0x0
   \   00006A   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   00006C                REQUIRE ?Subroutine17
   \   00006C                ; // Fall through to label ?Subroutine17
    487          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine22_0
   \   000005                ; // Fall through to label ??Subroutine22_0
    488          
    489          /*********************************************************************
    490           * Application Functions
    491           */
    492          
    493          /*********************************************************************
    494           * @fn      ZDOInitDevice
    495           *
    496           * @brief   Start the device in the network.  This function will read
    497           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    498           *   restore the network state of the device.
    499           *
    500           * @param   startDelay - timeDelay to start device (in milliseconds).
    501           *      There is a jitter added to this delay:
    502           *              ((NWK_START_DELAY + startDelay)
    503           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    504           *
    505           * NOTE:    If the application would like to force a "new" join, the
    506           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    507           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    508           *          this function. "new" join means to not restore the network
    509           *          state of the device. Use zgWriteStartupOptions() to set these
    510           *          options.
    511           *
    512           * @return   ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    513           *           restored.
    514           *           ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized. This could 
    515           *           mean that ZCD_NV_STARTUP_OPTION said to not restore, or it could mean that 
    516           *           there was no network state to restore.
    517           *           ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    518           *           with the rejoin option set to TRUE.  So, the device was notstarted in the 
    519           *           network (one time only).  The next time this function is called it will start.
    520           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    521          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    522          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    523            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    524            uint16 extendedDelay = 0;
    525          
    526            if ( devState == DEV_HOLD )
   \   000015   90....       MOV     DPTR,#devState
   \   000018   E0           MOVX    A,@DPTR
   \   000019   7005         JNZ     ??ZDOInitDevice_0
    527            {    
    528              // Initialize the RAM items table, in case an NV item has been updated.
    529              zgInitItems( FALSE );
   \   00001B                ; Setup parameters for call to function zgInitItems
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??zgInitItems?relay
    530            }
    531          
    532            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000020                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000020   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    533            //devtag.071807.todo - fix this temporary solution
    534            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000023   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000026   E0           MOVX    A,@DPTR
   \   000027   90....       MOV     DPTR,#(_NIB + 14)
   \   00002A   F0           MOVX    @DPTR,A
    535            
    536            devState = DEV_INIT;    // Remove the Hold state
   \   00002B   7401         MOV     A,#0x1
   \   00002D   90....       MOV     DPTR,#devState
   \   000030   F0           MOVX    @DPTR,A
    537          
    538            // Initialize leave control logic
    539            ZDApp_LeaveCtrlInit();
   \   000031                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000031   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    540          
    541            // Check leave control reset settings
    542            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000034                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A..         MOV     R2,#(devState & 0xff)
   \   000040   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   000042   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    543          
    544            // Leave may make the hold state come back
    545            if ( devState == DEV_HOLD )
   \   000045   90....       MOV     DPTR,#devState
   \   000048   E0           MOVX    A,@DPTR
   \   000049   700E         JNZ     ??ZDOInitDevice_1
    546            {
    547              // Set the NV startup option to force a "new" join.
    548              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   00004B                ; Setup parameters for call to function zgWriteStartupOptions
   \   00004B   7A02         MOV     R2,#0x2
   \   00004D   79FF         MOV     R1,#-0x1
   \   00004F   12....       LCALL   ??zgWriteStartupOptions?relay
    549          
    550              // Notify the applications 
    551              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   12....       LCALL   ?Subroutine2 & 0xFFFF
    552              
    553              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_17:
   \   000055   7902         MOV     R1,#0x2
   \   000057   8039         SJMP    ??ZDOInitDevice_2
    554            }
    555          
    556          #if defined ( NV_RESTORE )
    557            // Get Keypad directly to see if a reset nv is needed.
    558            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    559            // while booting to skip past NV Restore.
    560            if ( HalKeyRead() == SW_BYPASS_NV )
    561              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    562            else
    563            {
    564              // Determine if NV should be restored
    565              networkStateNV = ZDApp_ReadNetworkRestoreState();
    566            }
    567          
    568            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    569            {
    570              networkStateNV = ZDApp_RestoreNetworkState();
    571            }
    572            else
    573            {
    574              // Wipe out the network state in NV
    575              NLME_InitNV();
    576              NLME_SetDefaultNV();
    577            }
    578          #endif
    579          
    580            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    581            {
    582              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000059                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000059   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    583          
    584              // Only delay if joining network - not restoring network state
    585              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    586                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   00005C                ; Setup parameters for call to function osal_rand
   \   00005C   12....       LCALL   ??osal_rand?relay
   \   00005F   8A..         MOV     ?V0 + 0,R2
   \   000061   A8..         MOV     R0,?V0 + 0
   \   000063   85..82       MOV     DPL,?XSP + 0
   \   000066   85..83       MOV     DPH,?XSP + 1
   \   000069   747F         MOV     A,#0x7f
   \   00006B   58           ANL     A,R0
   \   00006C   F8           MOV     R0,A
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   28           ADD     A,R0
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   3400         ADDC    A,#0x0
   \   000074   F9           MOV     R1,A
   \   000075   7464         MOV     A,#0x64
   \   000077   28           ADD     A,R0
   \   000078   FE           MOV     R6,A
   \   000079   E4           CLR     A
   \   00007A   39           ADDC    A,R1
   \   00007B   FF           MOV     R7,A
    587            }
    588          
    589            // Initialize the security for type of device
    590            ZDApp_SecInit( networkStateNV );
   \   00007C                ; Setup parameters for call to function ZDSecMgrInit
   \   00007C   7901         MOV     R1,#0x1
   \   00007E   12....       LCALL   ??ZDSecMgrInit?relay
    591            
    592            // Trigger the network start
    593            ZDApp_NetworkInit( extendedDelay );
   \   000081                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000081   EE           MOV     A,R6
   \   000082   FA           MOV     R2,A
   \   000083   EF           MOV     A,R7
   \   000084   FB           MOV     R3,A
   \   000085   12....       LCALL   ??ZDApp_NetworkInit?relay
    594          
    595            // set broadcast address mask to support broadcast filtering
    596            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000088                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000088   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F9           MOV     R1,A
   \   00008D   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    597            
    598            return ( networkStateNV );
   \   000090   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   000092   02....       LJMP    ?Subroutine15 & 0xFFFF
    599          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine26_0
   \   000002                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine27_0
   \   000003                ; // Fall through to label ??Subroutine27_0
    600          
    601          /*********************************************************************
    602           * @fn      ZDApp_ReadNetworkRestoreState
    603           *
    604           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    605           *          or not to restore the network state.
    606           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    607           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    608           *
    609           *
    610           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    611           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    612           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    613           *          ZCD_NV_STARTUP_OPTION
    614           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    615          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    616          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    617            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    618          
    619            // Look for the New Network State option.
    620            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    621            {
    622              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    623            }
    624          
    625            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ?Subroutine17 & 0xFFFF
    626          }
    627          
    628          /*********************************************************************
    629           * @fn      ZDAppDetermineDeviceType()
    630           *
    631           * @brief   Determines the type of device to start. 
    632           *
    633           *          Looks at zgDeviceLogicalType and determines what type of
    634           *          device to start.  The types are:
    635           *            ZG_DEVICETYPE_COORDINATOR
    636           *            ZG_DEVICETYPE_ROUTER
    637           *            ZG_DEVICETYPE_ENDDEVICE
    638           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    639          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    640          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    641            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    642            {
    643              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    644              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    645            }
    646            else
    647            {
    648              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    649                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    650              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    651                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    652              
    653              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    654              // The device shall do rejoin the network. Otherwise, do normal join
    655              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000036   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   7003         JNZ     ??ZDAppDetermineDeviceType_5
    656              {
    657                devStartMode = MODE_JOIN;     // Assume joining
   \   00003E   E4           CLR     A
   \   00003F   8002         SJMP    ??ZDAppDetermineDeviceType_6
    658              }
    659              else
    660              {
    661                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000041   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000043   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    662              }
    663            }
    664          }
   \   000047   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    665          
    666          /*********************************************************************
    667           * @fn      ZDApp_NetworkStartEvt()
    668           *
    669           * @brief   Process the Network Start Event
    670           *
    671           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    672          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    673          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    674            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    675            {
    676              // Successfully started a ZigBee network
    677              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    678              {
    679                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    680              }
    681          
    682              osal_pwrmgr_device( PWRMGR_ALWAYS_ON ); // osal device power setting -> ALWAYS ON
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    683              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT ); // TaskID -> ZDO_STATE_CHANGE_EVT
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    684            }
    685            else
    686            {
    687              // Try again with a higher energy threshold !!
    688              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    689              {
    690                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    691                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    692              }
    693              else
    694              {
    695                // Failed to start network. Enter a dormant state (until user intervenes)
    696                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    697                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
    698              }
    699            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   02....       LJMP    ?Subroutine13 & 0xFFFF
    700          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000003                REQUIRE ??Subroutine23_0
   \   000003                ; // Fall through to label ??Subroutine23_0
    701          
    702          /*********************************************************************
    703           * @fn      ZDApp_DeviceAuthEvt()
    704           *
    705           * @brief   Process the Device Authentic Event
    706           *
    707           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    708          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    709          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    710            // received authentication from trust center
    711            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   702D         JNZ     ??ZDApp_DeviceAuthEvt_0
    712            {
    713              // Stop the reset timer so it doesn't reset
    714              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    715          
    716              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine0 & 0xFFFF
    717              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    718          
    719              // Set the Power Manager Device
    720          #if defined ( POWER_SAVING )
    721              osal_pwrmgr_device( PWRMGR_BATTERY );
    722          #endif
    723          
    724              if ( ZSTACK_ROUTER_BUILD )
    725              {
    726                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_14:
   \   000012   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    727                {
    728                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    729                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    730                }
    731              }
    732          
    733              // Notify to save info into NV
    734              ZDApp_NVUpdate();
    735          
    736              // Save off the security
    737              ZDApp_SaveNwkKey();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000020   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    738          
    739              ZDApp_AnnounceNewAddress();
   \   000023                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000023   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    740              
    741              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000026   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002C   400B         JC      ??ZDApp_DeviceAuthEvt_0
    742              {
    743                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   00002E                ; Setup parameters for call to function NLME_SetPollRate
   \   00002E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000031   E0           MOVX    A,@DPTR
   \   000032   FA           MOV     R2,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FB           MOV     R3,A
   \   000036   12....       LCALL   ??NLME_SetPollRate?relay
    744              }
    745            }
    746            else
    747            {
    748              ZDApp_NVUpdate();
    749            }
    750          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000039   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7406         MOV     A,#0x6
   \   000002   90....       MOV     DPTR,#devState
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008   02....       LJMP    ?Subroutine16 & 0xFFFF
    751          
    752          /*********************************************************************
    753           * @fn      ZDApp_SaveNetworkStateEvt()
    754           *
    755           * @brief   Process the Save the Network State Event
    756           *
    757           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    758          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    759          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    760          #if defined ( NV_RESTORE )
    761           #if defined ( NV_TURN_OFF_RADIO )
    762            // Turn off the radio's receiver during an NV update
    763            uint8 RxOnIdle;
    764            uint8 x = false;
    765            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    766            ZMacSetReq( ZMacRxOnIdle, &x );
    767           #endif
    768          
    769            // Update the Network State in NV
    770            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    771                           NWK_NV_DEVICELIST_ENABLE |
    772                           NWK_NV_BINDING_ENABLE    |
    773                           NWK_NV_ADDRMGR_ENABLE );
    774          
    775            // Reset the NV startup option to resume from NV by
    776            // clearing the "New" join option.
    777            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    778          
    779           #if defined ( NV_TURN_OFF_RADIO )
    780            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    781           #endif
    782          #endif  // NV_RESTORE
    783          }
   \   000000   02....       LJMP    ?BRET
    784          
    785          /*********************************************************************
    786           * @fn      ZDApp_RestoreNetworkState()
    787           *
    788           * @brief   This function will restore the network state of the
    789           *          device if the network state is stored in NV.
    790           *
    791           * @return
    792           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    793           *          restored.
    794           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    795           *          This could mean that zgStartupOption said to not restore, or
    796           *          it could mean that there was no network state to restore.
    797           *
    798           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    799          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    800          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    801            uint8 nvStat;
    802            nwkActiveKeyItems keyItems;
    803          
    804            // Initialize NWK NV items
    805            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    806          
    807            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   603A         JZ      ??ZDApp_RestoreNetworkState_0
    808            {
    809              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6034         JZ      ??ZDApp_RestoreNetworkState_0
    810              {
    811                // Are we a coordinator
    812                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    813                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7002         JNZ     ??ZDApp_RestoreNetworkState_1
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000028   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    814                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   54F8         ANL     A,#0xf8
   \   000030   F0           MOVX    @DPTR,A
    815                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000031   7401         MOV     A,#0x1
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   F0           MOVX    @DPTR,A
    816                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000037                ; Setup parameters for call to function sAddrExtCpy
   \   000037   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000039   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   00003B   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   00003D   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00003F   12....       LCALL   ??sAddrExtCpy?relay
    817              }
    818              else
    819                nvStat = NV_ITEM_UNINIT;
    820          
    821              if ( ZG_SECURE_ENABLED )
    822              {
    823                nwkFrameCounterChanges = 0;
    824                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    825                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    826          
    827                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    828                {
    829                  ZDApp_RestoreNwkKey();
    830                }
    831              }
    832          
    833              // The default for RxOnWhenIdle is true for Routers and false for end devices
    834              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    835              // other than default.
    836            }
    837          
    838            if ( nvStat == ZSUCCESS )
   \   000042   EE           MOV     A,R6
   \   000043   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    839              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000045   7900         MOV     R1,#0x0
   \   000047   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    840            else
    841              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000049   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_3:
   \   00004B   02....       LJMP    ?Subroutine17 & 0xFFFF
    842          }
    843          
    844          /*********************************************************************
    845           * @fn      ZDApp_InitUserDesc()
    846           *
    847           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    848           *          when needed.  If you want to initialize the User descriptor to
    849           *          something other than all zero, do it here.
    850           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    851          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    852          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    853            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    854          
    855            // Initialize the User Descriptor, the descriptor is read from NV
    856            // when needed.  If you want to initialize the User descriptor to something
    857            // other than all zero, do it here.
    858            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine10 & 0xFFFF
    859            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    860                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_12:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    861            {
    862              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    863                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    864              {
    865                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    866                {
    867                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    868                }
    869              }
    870            }
    871          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    872          
    873          /*********************************************************************
    874           * @fn      ZDAppCheckForHoldKey()
    875           *
    876           * @brief   Check for key to set the device into Hold Auto Start
    877           *
    878           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    879          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    880          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    881          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    882            // Get Keypad directly to see if a HOLD_START is needed.
    883            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    884            // while booting to avoid starting up the device.
    885            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    886            {
    887              // Change the device state to HOLD on start up
    888              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    889            }
    890          #endif // HAL_KEY
    891          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    892          
    893          /*********************************************************************
    894           * @fn      ZDApp_ProcessOSALMsg()
    895           *
    896           * @brief   Process the incoming task message.
    897           *
    898           * @param   msgPtr - message to process
    899           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    900          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    901          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    902            // Data Confirmation message fields
    903            uint8 sentEP;       // This should always be 0
    904            uint8 sentStatus;
    905            afDataConfirm_t *afDataConfirm;
    906            uint8 tmp;
    907          
    908            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   00000C   00           DB        0
   \   00000D   03           DB        3
   \   00000E   1A           DB        26
   \   00000F   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   000011   D3           DB        211
   \   000012   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   000014   FD           DB        253
   \   000015   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   000017   ....         DW        ??ZDApp_ProcessOSALMsg_3
    909            {
    910              // Incoming ZDO Message
    911              case AF_INCOMING_MSG_CMD:
    912                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000019                ; Setup parameters for call to function ZDP_IncomingData
   \   000019   12....       LCALL   ??ZDP_IncomingData?relay
   \   00001C   8018         SJMP    ??ZDApp_ProcessOSALMsg_3
    913                break;
    914                
    915              case ZDO_CB_MSG:
    916                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00001E                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00001E   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000021   8013         SJMP    ??ZDApp_ProcessOSALMsg_3
    917                break;
    918          
    919              case AF_DATA_CONFIRM_CMD:
    920                // This message is received as a confirmation of a data packet sent. The status is of ZStatus_t type 
    921                // [defined in NLMEDE.h] The message fields are defined in AF.h
    922                afDataConfirm = (afDataConfirm_t *)msgPtr;
    923                sentEP = afDataConfirm->endpoint;
    924                sentStatus = afDataConfirm->hdr.status;
    925          
    926                // Action taken when confirmation is received.
    927          #if defined ( ZIGBEE_FREQ_AGILITY )
    928                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000023   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000026   E0           MOVX    A,@DPTR
   \   000027   7002         JNZ     ??ZDApp_ProcessOSALMsg_4
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00002B   6009         JZ      ??ZDApp_ProcessOSALMsg_3
    929                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   00002D                ; Setup parameters for indirect call
   \   00002D   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000030   12....       LCALL   ?Subroutine4 & 0xFFFF
    930          #endif
    931                (void)sentEP;
    932                (void)sentStatus;
    933                break;
    934          
    935              case ZDO_NWK_DISC_CNF:
    936                if (devState != DEV_NWK_DISC)
    937                  break;
    938                
    939                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
    940                {
    941                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
    942                  {
    943                    if ( devStartMode == MODE_JOIN )
    944                    {
    945                      devState = DEV_NWK_JOINING;
    946            
    947                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
    948            
    949                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    950                                               BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, 
    951                                             ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
    952                                             ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
    953                                               ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
    954                      {
    955                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
    956                      }
    957                    }
    958                    else if ( devStartMode == MODE_REJOIN )
    959                    {
    960                      devState = DEV_NWK_REJOIN;
    961          
    962                      // Before trying to do rejoin, check if the device has a valid short address
    963                      // If not, generate a random short address for itself
    964                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
    965                      {
    966                        _NIB.nwkDevAddress = osal_rand();
    967                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
    968                      }
    969          
    970                      if ( ZG_SECURE_ENABLED )
    971                      {
    972                        ZDApp_RestoreNwkKey();
    973                      }
    974                      
    975                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
    976                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
    977                      {
    978                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
    979                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
    980                      }
    981          
    982                      tmp = true;
    983                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
    984                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
    985                      {
    986                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    987                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
    988                      }
    989                    }
    990            
    991                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
    992                    {
    993                      // The receiver is on, turn network layer polling off.
    994                      NLME_SetPollRate( 0 );
    995                      NLME_SetQueuedPollRate( 0 );
    996                      NLME_SetResponseRate( 0 );
    997                    }
    998                    else
    999                    {
   1000                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1001                      {
   1002                        ZDApp_SavedPollRate = zgPollRate;
   1003                        NLME_SetPollRate( zgRejoinPollRate );
   1004                      }
   1005                    }
   1006                  }
   1007                  else
   1008                  {
   1009                    if ( continueJoining )
   1010                    {
   1011              #if defined ( MANAGED_SCAN )
   1012                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1013              #else
   1014                      zdoDiscCounter++;
   1015                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1016                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   1017              #endif
   1018                    }
   1019                  }
   1020                }
   1021                break;
   1022          
   1023              case ZDO_NWK_JOIN_IND:
   1024                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1025                {
   1026                  ZDApp_ProcessNetworkJoin();
   1027                }
   1028                break;
   1029          
   1030              case ZDO_NWK_JOIN_REQ:
   1031                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1032                {
   1033                  retryCnt = 0;
   1034                  devStartMode = MODE_RESUME;
   1035                  _tmpRejoinState = true;
   1036                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1037                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   1038                  ZDApp_NetworkInit( 0 );
   1039                }
   1040                break;
   1041          
   1042              default:
   1043                if ( ZG_SECURE_ENABLED )
   1044                  ZDApp_ProcessSecMsg( msgPtr );
   1045                break;
   1046            }
   \                     ??CrossCallReturnLabel_2:
   \   000033   12....       LCALL   ?CALL_IND
   1047          
   1048          }
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000036   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8882         MOV     DPL,R0
   \   000008   22           RET
   1049          
   1050          /*********************************************************************
   1051           * @fn      ZDApp_ProcessMsgCBs()
   1052           * @brief   Process response messages
   1053           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1054          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1055          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 44
   \   000005   74D4         MOV     A,#-0x2c
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
   1056            switch ( inMsg->clusterID )
   \                     ??CrossCallReturnLabel_43:
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000018   0300         DW        3
   \   00001A   2100         DW        33
   \   00001C   2200         DW        34
   \   00001E   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000020   0080         DW        32768
   \   000022   0180         DW        32769
   \   000024   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000026   2180         DW        32801
   \   000028   2280         DW        32802
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_2
   \   00002C   0100         DW        1
   \   00002E   2000         DW        32
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_3
   \   000032   ....         DW        ??ZDApp_ProcessMsgCBs_4
   1057            {
   1058          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1059              case NWK_addr_rsp:
   1060              case IEEE_addr_rsp:
   1061                {
   1062                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1063                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000034                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000034   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   000037   8A..         MOV     ?V0 + 0,R2
   \   000039   8B..         MOV     ?V0 + 1,R3
   \   00003B   AE..         MOV     R6,?V0 + 0
   \   00003D   AF..         MOV     R7,?V0 + 1
   1064                  if ( pAddrRsp )
   \   00003F   EE           MOV     A,R6
   \   000040   7001         JNZ     ??ZDApp_ProcessMsgCBs_5
   \   000042   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_5:
   \   000043   7003         JNZ     $+5
   \   000045   02....       LJMP    ??ZDApp_ProcessMsgCBs_4 & 0xFFFF
   1065                  {
   1066                    if ( pAddrRsp->status == ZSuccess )
   \   000048   8E82         MOV     DPL,R6
   \   00004A   8F83         MOV     DPH,R7
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   7011         JNZ     ??ZDApp_ProcessMsgCBs_6
   1067                    {
   1068                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   00004F                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   00004F   EE           MOV     A,R6
   \   000050   2403         ADD     A,#0x3
   \   000052   FC           MOV     R4,A
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   FD           MOV     R5,A
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   FA           MOV     R2,A
   \   00005A   A3           INC     DPTR
   \   00005B   E0           MOVX    A,@DPTR
   \   00005C   FB           MOV     R3,A
   \   00005D   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1069                    }
   1070                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_6:
   \   000060                ; Setup parameters for call to function osal_mem_free
   \   000060   EE           MOV     A,R6
   \   000061   FA           MOV     R2,A
   \   000062   EF           MOV     A,R7
   \   000063   02....       LJMP    ??ZDApp_ProcessMsgCBs_7 & 0xFFFF
   1071                  }
   1072                }
   1073                break;
   1074          #endif
   1075                
   1076          #if defined ( REFLECTOR )
   1077              case Bind_req:
   1078              case Unbind_req:
   1079                {
   1080                  ZDO_BindUnbindReq_t bindReq;
   1081                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000066                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000066   7417         MOV     A,#0x17
   \   000068   12....       LCALL   ?XSTACK_DISP0_8
   \   00006B   AC82         MOV     R4,DPL
   \   00006D   AD83         MOV     R5,DPH
   \   00006F   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1082                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000072                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000072   7417         MOV     A,#0x17
   \   000074   12....       LCALL   ?XSTACK_DISP0_8
   \   000077   AC82         MOV     R4,DPL
   \   000079   AD83         MOV     R5,DPH
   \   00007B   EE           MOV     A,R6
   \   00007C   FA           MOV     R2,A
   \   00007D   EF           MOV     A,R7
   \   00007E   FB           MOV     R3,A
   \   00007F   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   \   000082   807B         SJMP    ??ZDApp_ProcessMsgCBs_4
   1083                }
   1084                break;
   1085          #endif      
   1086          
   1087          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1088              case Bind_rsp:      
   1089              case Unbind_rsp:
   1090                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000084   90....       MOV     DPTR,#matchED
   \   000087   E0           MOVX    A,@DPTR
   \   000088   7002         JNZ     ??ZDApp_ProcessMsgCBs_8
   \   00008A   A3           INC     DPTR
   \   00008B   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_8:
   \   00008C   6071         JZ      ??ZDApp_ProcessMsgCBs_4
   1091                {
   1092                  ZDMatchSendState(
   1093                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1094                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   \   00008E   7421         MOV     A,#0x21
   \   000090   65..         XRL     A,?V0 + 0
   \   000092   7004         JNZ     ??ZDApp_ProcessMsgCBs_9
   \   000094   7480         MOV     A,#-0x80
   \   000096   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessMsgCBs_9:
   \   000098   7004         JNZ     ??ZDApp_ProcessMsgCBs_10
   \   00009A   7903         MOV     R1,#0x3
   \   00009C   8002         SJMP    ??ZDApp_ProcessMsgCBs_11
   \                     ??ZDApp_ProcessMsgCBs_10:
   \   00009E   7902         MOV     R1,#0x2
   \                     ??ZDApp_ProcessMsgCBs_11:
   \   0000A0                ; Setup parameters for call to function ZDMatchSendState
   \   0000A0   EE           MOV     A,R6
   \   0000A1   240F         ADD     A,#0xf
   \   0000A3   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   1095                }
   \                     ??CrossCallReturnLabel_45:
   \   0000A6   FB           MOV     R3,A
   \   0000A7   EE           MOV     A,R6
   \   0000A8   2413         ADD     A,#0x13
   \   0000AA   F582         MOV     DPL,A
   \   0000AC   EF           MOV     A,R7
   \   0000AD   3400         ADDC    A,#0x0
   \   0000AF   F583         MOV     DPH,A
   \   0000B1   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   FA           MOV     R2,A
   \   0000B6   12....       LCALL   ??ZDMatchSendState?relay
   \   0000B9   8044         SJMP    ??ZDApp_ProcessMsgCBs_4
   1096                break;
   1097                
   1098              // Send the End device bind request  
   1099              case End_Device_Bind_req: 
   1100                if (ZG_DEVICE_COORDINATOR_TYPE)
   1101                {
   1102                  ZDEndDeviceBind_t bindReq;
   1103                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   0000BB                ; Setup parameters for call to function ZDO_ParseEndDeviceBindReq
   \   0000BB   85..82       MOV     DPL,?XSP + 0
   \   0000BE   85..83       MOV     DPH,?XSP + 1
   \   0000C1   AC82         MOV     R4,DPL
   \   0000C3   AD83         MOV     R5,DPH
   \   0000C5   12....       LCALL   ??ZDO_ParseEndDeviceBindReq?relay
   1104                  ZDO_MatchEndDeviceBind( &bindReq );  // ZDO layer match End device bind
   \   0000C8                ; Setup parameters for call to function ZDO_MatchEndDeviceBind
   \   0000C8   85..82       MOV     DPL,?XSP + 0
   \   0000CB   85..83       MOV     DPH,?XSP + 1
   \   0000CE   AA82         MOV     R2,DPL
   \   0000D0   AB83         MOV     R3,DPH
   \   0000D2   12....       LCALL   ??ZDO_MatchEndDeviceBind?relay
   1105                  
   1106                  // Freeing the cluster lists - if allocated.
   1107                  if ( bindReq.numInClusters )
   \   0000D5   7411         MOV     A,#0x11
   \   0000D7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   600D         JZ      ??ZDApp_ProcessMsgCBs_12
   1108                    osal_mem_free( bindReq.inClusters );
   \   0000DD                ; Setup parameters for call to function osal_mem_free
   \   0000DD   7412         MOV     A,#0x12
   \   0000DF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   FA           MOV     R2,A
   \   0000E4   A3           INC     DPTR
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   FB           MOV     R3,A
   \   0000E7   12....       LCALL   ??osal_mem_free?relay
   1109                  if ( bindReq.numOutClusters )
   \                     ??ZDApp_ProcessMsgCBs_12:
   \   0000EA   7414         MOV     A,#0x14
   \   0000EC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   600D         JZ      ??ZDApp_ProcessMsgCBs_4
   1110                    osal_mem_free( bindReq.outClusters );
   \   0000F2                ; Setup parameters for call to function osal_mem_free
   \   0000F2   7415         MOV     A,#0x15
   \   0000F4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   FA           MOV     R2,A
   \   0000F9   A3           INC     DPTR
   \   0000FA   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_7:
   \   0000FB   FB           MOV     R3,A
   \   0000FC   12....       LCALL   ??osal_mem_free?relay
   1111                }
   1112                break;
   1113          #endif
   1114            }
   1115          }
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   0000FF   742C         MOV     A,#0x2c
   \   000101   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   EA           MOV     A,R2
   \   000001   FE           MOV     R6,A
   \   000002   EB           MOV     A,R3
   \   000003   FF           MOV     R7,A
   \   000004   EE           MOV     A,R6
   \   000005   240C         ADD     A,#0xc
   \   000007                REQUIRE ??Subroutine25_0
   \   000007                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1116          
   1117          /*********************************************************************
   1118           * @fn      ZDApp_RegisterCBs()
   1119           *
   1120           * @brief   Process response messages
   1121           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1122          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1123          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1124          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1125            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine3 & 0xFFFF
   1126          #endif
   1127          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1128            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_25:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine3 & 0xFFFF
   1129          #endif  
   1130          #if ZG_BUILD_COORDINATOR_TYPE
   1131            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   \                     ??CrossCallReturnLabel_26:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   12....       LCALL   ?Subroutine3 & 0xFFFF
   1132            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   \                     ??CrossCallReturnLabel_27:
   \   000013                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000013   7A22         MOV     R2,#0x22
   \   000015   12....       LCALL   ?Subroutine3 & 0xFFFF
   1133            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   \                     ??CrossCallReturnLabel_28:
   \   000018                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000018   7A20         MOV     R2,#0x20
   \   00001A   7B00         MOV     R3,#0x0
   \   00001C   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   1134          #endif
   1135          #if defined ( REFLECTOR )
   1136            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_29:
   \   00001F                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001F   7A21         MOV     R2,#0x21
   \   000021   7B00         MOV     R3,#0x0
   \   000023   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   1137            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_30:
   \   000026                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000026   7A22         MOV     R2,#0x22
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   1138          #endif  
   1139          }
   \                     ??CrossCallReturnLabel_31:
   \   00002D   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine20_0
   \   000002                ; // Fall through to label ??Subroutine20_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine20_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1140          
   1141          /*********************************************************************
   1142           * @fn      ZDApp_ProcessSecMsg()
   1143           *
   1144           * @brief   Process the incoming security message.
   1145           *
   1146           * @param   msgPtr - message to process
   1147           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1148          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1149          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1150            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6407         XRL     A,#0x7
   \   00000B   7003         JNZ     ??ZDApp_ProcessSecMsg_0
   1151            {
   1152              case ZDO_ESTABLISH_KEY_CFM:
   1153                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1154                {
   1155                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1156                }
   1157                break;
   1158          
   1159              case ZDO_ESTABLISH_KEY_IND:
   1160                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1161                {
   1162                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1163                  {
   1164                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1165                  }
   1166                }
   1167                break;
   1168          
   1169              case ZDO_TRANSPORT_KEY_IND:
   1170                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1171                {
   1172                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   1173                }
   1174                break;
   1175          
   1176              case ZDO_UPDATE_DEVICE_IND:
   1177                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1178                {
   1179                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   \   00000D                ; Setup parameters for call to function ZDSecMgrUpdateDeviceInd
   \   00000D   12....       LCALL   ??ZDSecMgrUpdateDeviceInd?relay
   1180                }
   1181                break;
   1182          
   1183              case ZDO_REMOVE_DEVICE_IND:
   1184                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1185                {
   1186                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1187                }
   1188                break;
   1189          
   1190              case ZDO_REQUEST_KEY_IND:
   1191                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1192                {
   1193                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1194                  {
   1195                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1196                  }
   1197                }
   1198                break;
   1199          
   1200              case ZDO_SWITCH_KEY_IND:
   1201                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1202                {
   1203                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   1204                }
   1205                break;
   1206              
   1207              case ZDO_AUTHENTICATE_IND:
   1208                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1209                {
   1210                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1211                }
   1212                break;
   1213          
   1214              case ZDO_AUTHENTICATE_CFM:
   1215                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1216                {
   1217                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1218                }
   1219                break;
   1220          
   1221              default:
   1222                // Unsupported messages
   1223                break;
   1224            }
   1225          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1226          
   1227          /*********************************************************************
   1228           * @fn      ZDApp_ProcessNetworkJoin()
   1229           *
   1230           * @brief  Save off the Network key information.
   1231           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1232          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1233          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1234            if ( (devState == DEV_NWK_JOINING) ||
   1235                ((devState == DEV_NWK_ORPHAN)  &&
   1236                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1237            {
   1238              // Result of a Join attempt by this device.
   1239              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   703A         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1240              {
   1241                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine2 & 0xFFFF
   1242          
   1243          #if defined ( POWER_SAVING )
   1244                osal_pwrmgr_device( PWRMGR_BATTERY );
   1245          #endif
   1246          
   1247                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1248                {
   1249                  // wait for auth from trust center!!
   1250                  devState = DEV_END_DEVICE_UNAUTH;
   1251          
   1252                  // Start the reset timer for MAX UNAUTH time
   1253                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1254                }
   1255                else
   1256                {
   1257                  if ( ZSTACK_ROUTER_BUILD )
   1258                  {
   1259                    if ( devState == DEV_NWK_ORPHAN 
   1260                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_18:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   640A         XRL     A,#0xa
   \   000036   700D         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000038   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00003B   6010         JZ      ??ZDApp_ProcessNetworkJoin_5
   1261                    {
   1262                      // Change NIB state to router for restore
   1263                      _NIB.nwkState = NWK_ROUTER;
   \   00003D   7408         MOV     A,#0x8
   \   00003F   90....       MOV     DPTR,#(_NIB + 35)
   \   000042   F0           MOVX    @DPTR,A
   \   000043   8008         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1264                    }
   1265                  }
   1266                          
   1267                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1268                  {
   1269                    ZDApp_AnnounceNewAddress();
   \   00004A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00004A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1270                  }
   1271                  
   1272                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00004D   7406         MOV     A,#0x6
   \   00004F   90....       MOV     DPTR,#devState
   \   000052   F0           MOVX    @DPTR,A
   1273                  if ( ZSTACK_ROUTER_BUILD )
   1274                  {
   1275                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1276                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000053   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000056   7003         JNZ     $+5
   \   000058   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1277                    {
   1278                      NLME_StartRouterRequest( 0, 0, false );
   \   00005B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00005B   7B00         MOV     R3,#0x0
   \   00005D   7A00         MOV     R2,#0x0
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000064   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1279                    }
   1280                  }
   1281                }
   1282              }
   1283              else
   1284              {
   1285                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6401         XRL     A,#0x1
   \   00006D   7031         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00006F   90....       MOV     DPTR,#retryCnt
   \   000072   E0           MOVX    A,@DPTR
   \   000073   04           INC     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   C3           CLR     C
   \   000076   9403         SUBB    A,#0x3
   \   000078   4026         JC      ??ZDApp_ProcessNetworkJoin_7
   1286                {
   1287                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00007A   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00007D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00007F   74FF         MOV     A,#-0x1
   \   000081   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000082   600A         JZ      ??ZDApp_ProcessNetworkJoin_9
   \   000084   74FE         MOV     A,#-0x2
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   000089   74FF         MOV     A,#-0x1
   \   00008B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   00008C   7006         JNZ     ??ZDApp_ProcessNetworkJoin_11
   1288                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008E   E4           CLR     A
   \   00008F   90....       MOV     DPTR,#devStartMode
   \   000092   800B         SJMP    ??ZDApp_ProcessNetworkJoin_12
   1289                  else
   1290                  {
   1291                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   000094   7403         MOV     A,#0x3
   \   000096   90....       MOV     DPTR,#devStartMode
   \   000099   F0           MOVX    @DPTR,A
   1292                    _tmpRejoinState = true;
   \   00009A   7401         MOV     A,#0x1
   \   00009C   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   00009F   F0           MOVX    @DPTR,A
   1293                  }
   1294                }
   1295          
   1296                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1297                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   0000A0                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000A0   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   74FE         MOV     A,#-0x2
   \   0000A9   65..         XRL     A,?V0 + 0
   \   0000AB   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000AD   74FF         MOV     A,#-0x1
   \   0000AF   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000B1   700E         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000B3   90....       MOV     DPTR,#(_NIB + 20)
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FE         XRL     A,#0xfe
   \   0000B9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_15
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000BF   6026         JZ      ??ZDApp_ProcessNetworkJoin_16
   1298                {
   1299                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000C1   85..82       MOV     DPL,?XSP + 0
   \   0000C4   85..83       MOV     DPH,?XSP + 1
   \   0000C7   74FE         MOV     A,#-0x2
   \   0000C9   F0           MOVX    @DPTR,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   74FF         MOV     A,#-0x1
   \   0000CD   F0           MOVX    @DPTR,A
   1300                  // Invalidate nwk addr so end device does not use in its data reqs.
   1301                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000CE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000D1   74FE         MOV     A,#-0x2
   \   0000D3   F0           MOVX    @DPTR,A
   \   0000D4   A3           INC     DPTR
   \   0000D5   74FF         MOV     A,#-0x1
   \   0000D7   F0           MOVX    @DPTR,A
   1302                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D8                ; Setup parameters for call to function ZMacSetReq
   \   0000D8   85..82       MOV     DPL,?XSP + 0
   \   0000DB   85..83       MOV     DPH,?XSP + 1
   \   0000DE   AA82         MOV     R2,DPL
   \   0000E0   AB83         MOV     R3,DPH
   \   0000E2   7953         MOV     R1,#0x53
   \   0000E4   12....       LCALL   ??ZMacSetReq?relay
   1303                }
   1304          
   1305                // Clear the neighbor Table and network discovery tables.
   1306                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000E7                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000E7   12....       LCALL   ??nwkNeighborInitTable?relay
   1307                NLME_NwkDiscTerm();
   \   0000EA                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000EA   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1308          
   1309                zdoDiscCounter = 1;
   \   0000ED   7401         MOV     A,#0x1
   \   0000EF   90....       MOV     DPTR,#zdoDiscCounter
   \   0000F2   F0           MOVX    @DPTR,A
   1310          
   1311          //      ZDApp_NetworkInit( (uint16)
   1312          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1313          //                          (NWK_START_DELAY * 5)) );
   1314                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1315                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000F3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000F3                ; Setup parameters for call to function osal_rand
   \   0000F3   02....       LJMP    ??ZDApp_ProcessNetworkJoin_17 & 0xFFFF
   1316              }
   1317            }
   1318            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000F6   E0           MOVX    A,@DPTR
   \   0000F7   6404         XRL     A,#0x4
   \   0000F9   6003         JZ      $+5
   \   0000FB   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1319            {
   1320              // results of an orphaning attempt by this device
   1321              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000FE   90....       MOV     DPTR,#nwkStatus
   \   000101   E0           MOVX    A,@DPTR
   \   000102   7033         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1322              {
   1323                if ( ZG_SECURE_ENABLED )
   1324                {
   1325                  ZDApp_RestoreNwkKey();
   1326                }
   1327                
   1328                devState = DEV_END_DEVICE;
   \   000104   12....       LCALL   ?Subroutine0 & 0xFFFF
   1329                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1330                // setup Power Manager Device
   1331          #if defined ( POWER_SAVING )
   1332                osal_pwrmgr_device( PWRMGR_BATTERY );
   1333          #endif
   1334          
   1335                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_15:
   \   000107   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   A2E3         MOV     C,0xE0 /* A   */.3
   \   00010D   5015         JNC     ??ZDApp_ProcessNetworkJoin_19
   1336                {
   1337                  // The receiver is on, turn network layer polling off.
   1338                  NLME_SetPollRate( 0 );
   \   00010F                ; Setup parameters for call to function NLME_SetPollRate
   \   00010F   7A00         MOV     R2,#0x0
   \   000111   7B00         MOV     R3,#0x0
   \   000113   12....       LCALL   ??NLME_SetPollRate?relay
   1339                  NLME_SetQueuedPollRate( 0 );
   \   000116                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000116   7A00         MOV     R2,#0x0
   \   000118   7B00         MOV     R3,#0x0
   \   00011A   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1340                  NLME_SetResponseRate( 0 );
   \   00011D                ; Setup parameters for call to function NLME_SetResponseRate
   \   00011D   7A00         MOV     R2,#0x0
   \   00011F   7B00         MOV     R3,#0x0
   \   000121   12....       LCALL   ??NLME_SetResponseRate?relay
   1341                }
   1342          
   1343                if ( ZSTACK_ROUTER_BUILD )
   1344                {
   1345                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1346                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000124   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000127   6009         JZ      ??ZDApp_ProcessNetworkJoin_20
   1347                  {
   1348                    NLME_StartRouterRequest( 0, 0, false );
   \   000129                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000129   7B00         MOV     R3,#0x0
   \   00012B   7A00         MOV     R2,#0x0
   \   00012D   7900         MOV     R1,#0x0
   \   00012F   12....       LCALL   ??NLME_StartRouterRequest?relay
   1349                  }
   1350                }
   1351                
   1352                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000132                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000132   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000135   805C         SJMP    ??ZDApp_ProcessNetworkJoin_6
   1353              }
   1354              else
   1355              {
   1356                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000137   90....       MOV     DPTR,#devStartMode
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   6401         XRL     A,#0x1
   \   00013D   703B         JNZ     ??ZDApp_ProcessNetworkJoin_21
   1357                {
   1358                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   00013F   90....       MOV     DPTR,#retryCnt
   \   000142   E0           MOVX    A,@DPTR
   \   000143   04           INC     A
   \   000144   F0           MOVX    @DPTR,A
   \   000145   C3           CLR     C
   \   000146   9404         SUBB    A,#0x4
   \   000148   5028         JNC     ??ZDApp_ProcessNetworkJoin_22
   1359                  {
   1360                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00014A   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00014D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   00014F   74FF         MOV     A,#-0x1
   \   000151   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   000152   600A         JZ      ??ZDApp_ProcessNetworkJoin_24
   \   000154   74FE         MOV     A,#-0x2
   \   000156   68           XRL     A,R0
   \   000157   7003         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   000159   74FF         MOV     A,#-0x1
   \   00015B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   00015C   7007         JNZ     ??ZDApp_ProcessNetworkJoin_26
   1361                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00015E   E4           CLR     A
   \   00015F   90....       MOV     DPTR,#devStartMode
   \                     ??ZDApp_ProcessNetworkJoin_27:
   \   000162   F0           MOVX    @DPTR,A
   \   000163   8015         SJMP    ??ZDApp_ProcessNetworkJoin_21
   1362                    else
   1363                    {
   1364                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   000165   7403         MOV     A,#0x3
   \   000167   90....       MOV     DPTR,#devStartMode
   \   00016A   F0           MOVX    @DPTR,A
   1365                      _tmpRejoinState = true;
   \   00016B   7401         MOV     A,#0x1
   \   00016D   90....       MOV     DPTR,#_tmpRejoinState
   \   000170   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_27
   1366                    }
   1367                  }
   1368                  // Do a normal join to the network after certain times of rejoin retries
   1369                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   000172   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   000175   E0           MOVX    A,@DPTR
   \   000176   6401         XRL     A,#0x1
   \   000178   60E4         JZ      ??ZDApp_ProcessNetworkJoin_24
   1370                  {
   1371                    devStartMode = MODE_JOIN;
   1372                  }
   1373                }
   1374          
   1375                // Clear the neighbor Table and network discovery tables.
   1376                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00017A                ; Setup parameters for call to function nwkNeighborInitTable
   \   00017A   12....       LCALL   ??nwkNeighborInitTable?relay
   1377                NLME_NwkDiscTerm();
   \   00017D                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   00017D   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1378          
   1379                // setup a retry for later...
   1380                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1381                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   000180                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000180                ; Setup parameters for call to function osal_rand
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000180   12....       LCALL   ??osal_rand?relay
   \   000183   8A..         MOV     ?V0 + 0,R2
   \   000185   747F         MOV     A,#0x7f
   \   000187   55..         ANL     A,?V0 + 0
   \   000189   F8           MOV     R0,A
   \   00018A   7464         MOV     A,#0x64
   \   00018C   28           ADD     A,R0
   \   00018D   FA           MOV     R2,A
   \   00018E   7B00         MOV     R3,#0x0
   \   000190   12....       LCALL   ??ZDApp_NetworkInit?relay
   1382              }
   1383            }
   1384          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1385            else
   1386            {
   1387              // Assume from address conflict
   1388              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1389              {
   1390                // Notify the network
   1391                ZDApp_AnnounceNewAddress();
   1392                
   1393                // Notify apps
   1394                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1395              }
   1396            }
   1397          #endif
   1398          }
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   000193   02....       LJMP    ?Subroutine15 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   90....       MOV     DPTR,#(_NIB + 33)
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1399          
   1400          /*********************************************************************
   1401           * @fn      ZDApp_SaveNwkKey()
   1402           *
   1403           * @brief   Save off the Network key information.
   1404           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1405          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1406          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1407            nwkActiveKeyItems keyItems;
   1408          
   1409            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1410            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1411          
   1412            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1413                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1414          
   1415            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1416          }
   \   000052                REQUIRE ?Subroutine18
   \   000052                ; // Fall through to label ?Subroutine18

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine21_0
   \   000006                ; // Fall through to label ??Subroutine21_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine21_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1417          
   1418          /*********************************************************************
   1419           * @fn      ZDApp_ResetNwkKey()
   1420           *
   1421           * @brief   Reset the Network key information in NV.
   1422           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1423          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1424          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1425            nwkActiveKeyItems keyItems;
   1426          
   1427            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine10 & 0xFFFF
   1428            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1429                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_13:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1430          }
   \   000023   7415         MOV     A,#0x15
   \   000025   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   1431          
   1432          /*********************************************************************
   1433           * @fn      ZDApp_RestoreNwkKey()
   1434           *
   1435           * @brief  Save off the Network key information.
   1436           *
   1437           * @return  true if restored from NV, false if not
   1438           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1439          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1440          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1441            nwkActiveKeyItems keyItems;
   1442            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1443          
   1444            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1445                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1446            {
   1447              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   90....       MOV     DPTR,#__Constant_0
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?L_EQ_X
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1448              {
   1449                // Restore the key information
   1450                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1451                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1452                ret = true;
   \   00005E   0E           INC     R6
   1453              }
   1454          
   1455              // Force a save for the first frame counter increment
   1456              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1457            }
   1458            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine18 & 0xFFFF
   1459          }
   1460          
   1461          /*********************************************************************
   1462           * @fn      ZDApp_ResetTimerStart
   1463           *
   1464           * @brief   Start the reset timer.
   1465           *
   1466           * @param   delay - delay time(ms) before reset
   1467           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1468          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1469          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1470            // Start the rest timer
   1471            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine6 & 0xFFFF
   1472          }
   \                     ??CrossCallReturnLabel_37:
   \   00000D   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1473          
   1474          /*********************************************************************
   1475           * @fn      ZDApp_ResetTimerCancel
   1476           *
   1477           * @brief   Cancel the reset timer.
   1478           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1479          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1480          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1481            // Cancel the reset timer
   1482            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1483          }
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1484          
   1485          /*********************************************************************
   1486           * @fn      ZDApp_LeaveCtrlInit
   1487           *
   1488           * @brief   Initialize the leave control logic.
   1489           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1490          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1491          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1492            uint8 status;
   1493          
   1494          
   1495            // Initialize control state
   1496            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine1 & 0xFFFF
   1497          
   1498            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1499                                        sizeof(ZDApp_LeaveCtrl),
   1500                                        &ZDApp_LeaveCtrl );
   1501          
   1502            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1503            {
   1504              // Read saved control
   1505              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1506                            0,
   1507                            sizeof( uint8 ),
   1508                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1509            }
   1510          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine27_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1511          
   1512          /*********************************************************************
   1513           * @fn      ZDApp_LeaveCtrlSet
   1514           *
   1515           * @brief   Set the leave control logic.
   1516           *
   1517           * @param   ra - reassociate flag
   1518           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1519          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1520          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1521            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1522          
   1523            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1524            {
   1525              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1526            }
   1527          
   1528            // Write the leave control
   1529            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1530                           0,
   1531                           sizeof( uint8 ),
   1532                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   12....       LCALL   ??Subroutine21_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000030   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   1533          }
   1534          
   1535          /*********************************************************************
   1536           * @fn      ZDApp_LeaveCtrlBypass
   1537           *
   1538           * @brief   Check if NV restore should be skipped during a leave reset.
   1539           *
   1540           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1541           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1542          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1543          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1544            uint8 bypass;
   1545          
   1546            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1547            {
   1548              bypass = TRUE;
   1549            }
   1550            else
   1551            {
   1552              bypass = FALSE;
   1553            }
   1554          
   1555            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   80..         SJMP    ??Subroutine23_0
   1556          }
   1557          
   1558          /*********************************************************************
   1559           * @fn      ZDApp_LeaveCtrlStartup
   1560           *
   1561           * @brief   Check for startup conditions during a leave reset.
   1562           *
   1563           * @param   state      - devState_t determined by leave control logic
   1564           * @param   startDelay - startup delay
   1565           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1566          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1567          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1568            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1569          
   1570            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1571            {
   1572              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1573              {
   1574                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1575              }
   1576              else
   1577              {
   1578                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1579              }
   1580          
   1581              // Set leave control to initialized state
   1582              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine1 & 0xFFFF
   1583          
   1584              // Write initialized control
   1585              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1586                            0,
   1587                            sizeof( uint8 ),
   1588                            &ZDApp_LeaveCtrl);
   1589            }
   \                     ??CrossCallReturnLabel_1:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine21_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1590          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   1591          
   1592          /*********************************************************************
   1593           * @fn      ZDApp_LeaveReset
   1594           *
   1595           * @brief   Setup a device reset due to a leave indication/confirm.
   1596           *
   1597           * @param   ra - reassociate flag
   1598           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1599          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1600          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1601            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1602          
   1603            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1604          }
   \   00000E   80..         SJMP    ??Subroutine23_0
   1605          
   1606          /*********************************************************************
   1607           * @fn      ZDApp_LeaveUpdate
   1608           *
   1609           * @brief   Update local device data related to leaving device.
   1610           *
   1611           * @param   nwkAddr        - NWK address of leaving device
   1612           * @param   extAddr        - EXT address of leaving device
   1613           * @param   removeChildren - remove children of leaving device
   1614           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1615          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1616                                  uint8 removeChildren )
   1617          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EC           MOV     A,R4
   \   000005   FA           MOV     R2,A
   \   000006   ED           MOV     A,R5
   \   000007   FB           MOV     R3,A
   1618            /*
   1619            AddrMgrEntry_t entry;
   1620            */
   1621            (void)nwkAddr;  // Intentionally unreferenced parameter
   1622          
   1623            // Remove if child
   1624            if ( ZSTACK_ROUTER_BUILD )
   1625            {
   1626              NLME_RemoveChild( extAddr, removeChildren );
   \   000008                ; Setup parameters for call to function NLME_RemoveChild
   \   000008   12....       LCALL   ??NLME_RemoveChild?relay
   1627            }
   1628          }
   \   00000B   80..         SJMP    ??Subroutine23_0
   1629          
   1630          /*********************************************************************
   1631           * CALLBACK FUNCTIONS
   1632           */
   1633          
   1634          
   1635          /*********************************************************************
   1636           * @fn      ZDApp_SendEventMsg()
   1637           *
   1638           * @brief  Sends a Network Join message
   1639           *
   1640           * @param  cmd - command ID
   1641           * @param  len - length (in bytes) of the buf field
   1642           * @param  buf - buffer for the rest of the message.
   1643           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1644          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1645          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1646            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008                REQUIRE ?Subroutine19
   \   000008                ; // Fall through to label ?Subroutine19
   1647          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000003   80..         SJMP    ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1648          
   1649          /*********************************************************************
   1650           * @fn      ZDApp_SendMsg()
   1651           *
   1652           * @brief   Sends a OSAL message
   1653           *
   1654           * @param  taskID - Where to send the message
   1655           * @param  cmd - command ID
   1656           * @param  len - length (in bytes) of the buf field
   1657           * @param  buf - buffer for the rest of the message.
   1658           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1659          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1660          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 7,R1
   \   000007   8A..         MOV     ?V0 + 8,R2
   \   000009   8B..         MOV     ?V0 + 4,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1661            osal_event_hdr_t *msgPtr;
   1662          
   1663            // Send the address to the task
   1664            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014                ; Setup parameters for call to function osal_msg_allocate
   \   000014   AA..         MOV     R2,?V0 + 0
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_msg_allocate?relay
   \   00001B   8A..         MOV     ?V0 + 10,R2
   \   00001D   8B..         MOV     ?V0 + 11,R3
   \   00001F   AE..         MOV     R6,?V0 + 10
   \   000021   AF..         MOV     R7,?V0 + 11
   1665            if ( msgPtr )
   \   000023   EE           MOV     A,R6
   \   000024   7001         JNZ     ??ZDApp_SendMsg_0
   \   000026   EF           MOV     A,R7
   \                     ??ZDApp_SendMsg_0:
   \   000027   6036         JZ      ??ZDApp_SendMsg_1
   1666            {
   1667              if ( (len > 0) && (buf != NULL) ) osal_memcpy( msgPtr, buf, len );
   \   000029   E5..         MOV     A,?V0 + 4
   \   00002B   6022         JZ      ??ZDApp_SendMsg_2
   \   00002D   E5..         MOV     A,?V0 + 2
   \   00002F   7002         JNZ     ??ZDApp_SendMsg_3
   \   000031   E5..         MOV     A,?V0 + 3
   \                     ??ZDApp_SendMsg_3:
   \   000033   601A         JZ      ??ZDApp_SendMsg_2
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 4,?V0 + 2
   \   000038   85....       MOV     ?V0 + 5,?V0 + 3
   \   00003B   75..00       MOV     ?V0 + 6,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 4
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   AC..         MOV     R4,?V0 + 0
   \   000045   7D00         MOV     R5,#0x0
   \   000047   12....       LCALL   ??osal_memcpy?relay
   \   00004A   7403         MOV     A,#0x3
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   1668          
   1669              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E5..         MOV     A,?V0 + 8
   \   000055   F0           MOVX    @DPTR,A
   1670              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000056                ; Setup parameters for call to function osal_msg_send
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   EF           MOV     A,R7
   \   000059   FB           MOV     R3,A
   \   00005A   A9..         MOV     R1,?V0 + 7
   \   00005C   12....       LCALL   ??osal_msg_send?relay
   1671            }
   1672          }
   \                     ??ZDApp_SendMsg_1:
   \   00005F   7F0C         MOV     R7,#0xc
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
   1673          
   1674          /*********************************************************************
   1675           * Call Back Functions from NWK  - API
   1676           */
   1677          
   1678          /*********************************************************************
   1679           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1680           *
   1681           * @brief       This function returns a choice of PAN to join.
   1682           *
   1683           * @param       ResultCount - Number of routers discovered
   1684           * @param               NetworkList - Pointer to list of network descriptors
   1685           *
   1686           * @return      ZStatus_t
   1687           */
   1688          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1689          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1690                                                   networkDesc_t *NetworkList )
   1691          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 7,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   1692            networkDesc_t *pNwkDesc = NetworkList;
   1693            ZDO_NetworkDiscoveryCfm_t msg;
   1694            uint8 i = ResultCount;
   1695            uint8 stackProfile;
   1696            uint8 stackProfilePro;
   1697            uint8 selected;
   1698          
   1699          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1700            if ( zdappMgmtNwkDiscReqInProgress )
   1701            {
   1702              zdappMgmtNwkDiscReqInProgress = false;
   1703              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1704              return ( ZSuccess );
   1705            }
   1706          #endif
   1707          
   1708            // process discovery results
   1709            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1710            selected = FALSE;
   1711          
   1712            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 6,#0x0
   1713            {
   1714              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 4
   \   000018   AF..         MOV     R7,?V0 + 5
   1715              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1716              {
   1717                if ( zgConfigPANID != 0xFFFF )
   1718                {
   1719                  // PAN Id is preconfigured. check if it matches
   1720                  if ( pNwkDesc->panId != zgConfigPANID )
   1721                    continue;
   1722                }
   1723                
   1724          
   1725                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1726                {
   1727                  // If the extended Pan ID is commissioned to a non zero value
   1728                  // Only join the Pan that has match EPID
   1729                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1730                    continue;
   1731                  
   1732                }
   1733                  // check that network is allowing joining
   1734                  if ( ZSTACK_ROUTER_BUILD )
   1735                  {
   1736                    if ( stackProfilePro == FALSE )
   1737                    {
   1738                      if ( !pNwkDesc->routerCapacity )
   1739                      {
   1740                        continue;
   1741                      }
   1742                    }
   1743                    else
   1744                    {
   1745                      if ( !pNwkDesc->deviceCapacity )
   1746                      {
   1747                        continue;
   1748                      }
   1749                    }
   1750                  }
   1751                  else if ( ZSTACK_END_DEVICE_BUILD )
   1752                  {
   1753                    if ( !pNwkDesc->deviceCapacity )
   1754                    {
   1755                      continue;
   1756                    }
   1757                  }
   1758          
   1759                  // check version of zigbee protocol
   1760                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1761                    continue;
   1762          
   1763                  // check version of stack profile
   1764                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1765                  {
   1766                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1767                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   6A           XRL     A,R2
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1768                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   1769                    
   1770                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 6
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 7
   \   000058   4003         JC      $+5
   \   00005A   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00005D   90....       MOV     DPTR,#zgConfigPANID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   64FF         XRL     A,#0xff
   \   000063   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000069   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   00006B   8E82         MOV     DPL,R6
   \   00006D   8F83         MOV     DPH,R7
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F8           MOV     R0,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F9           MOV     R1,A
   \   000074   90....       MOV     DPTR,#zgConfigPANID
   \   000077   E0           MOVX    A,@DPTR
   \   000078   68           XRL     A,R0
   \   000079   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00007E   70B3         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   000080                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000080   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000082   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000084   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000087   E9           MOV     A,R1
   \   000088   6401         XRL     A,#0x1
   \   00008A   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   00008C                ; Setup parameters for call to function sAddrExtCmp
   \   00008C   AC..         MOV     R4,?V0 + 2
   \   00008E   AD..         MOV     R5,?V0 + 3
   \   000090   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000092   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000094   12....       LCALL   ??sAddrExtCmp?relay
   \   000097   E9           MOV     A,R1
   \   000098   6099         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   00009A   E5..         MOV     A,?V0 + 8
   \   00009C   8E82         MOV     DPL,R6
   \   00009E   8F83         MOV     DPH,R7
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   7005         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   7006         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_13
   \   0000AA   8087         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000AC   A3           INC     DPTR
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   6083         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000B0   85..82       MOV     DPL,?V0 + 0
   \   0000B3   85..83       MOV     DPH,?V0 + 1
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   FA           MOV     R2,A
   \   0000B8   90....       MOV     DPTR,#(_NIB + 17)
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   6A           XRL     A,R2
   \   0000BD   6003         JZ      $+5
   \   0000BF   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000C2   8E82         MOV     DPL,R6
   \   0000C4   8F83         MOV     DPH,R7
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   A3           INC     DPTR
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   FA           MOV     R2,A
   \   0000D0   90....       MOV     DPTR,#zgStackProfile
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   6A           XRL     A,R2
   \   0000D5   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   6401         XRL     A,#0x1
   \   0000DA   6003         JZ      $+5
   \   0000DC   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000DF   7402         MOV     A,#0x2
   \   0000E1   6A           XRL     A,R2
   \   0000E2   6003         JZ      $+5
   \   0000E4   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000E7   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1771                    {
   1772                      continue;
   1773                    }
   1774                  }
   1775          
   1776                // check if beacon order is the right value.. if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1777                // continue;
   1778          
   1779                // choose this pan for joining
   1780                break;
   1781              } 
   1782              if (i < ResultCount)
   1783              {
   1784               selected = TRUE;
   1785                break;
   1786              }
   1787             
   1788              // break if selected or stack profile pro wasn't found
   1789              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000EA   E5..         MOV     A,?V0 + 8
   \   0000EC   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_14
   1790              {
   1791                break;
   1792              }
   1793            }
   \   0000EE   05..         INC     ?V0 + 6
   \   0000F0   E5..         MOV     A,?V0 + 6
   \   0000F2   C3           CLR     C
   \   0000F3   9402         SUBB    A,#0x2
   \   0000F5   5003         JNC     $+5
   \   0000F7   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1794          
   1795            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   0000FA   E5..         MOV     A,?V0 + 7
   \   0000FC   65..         XRL     A,?V0 + 9
   \   0000FE   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1796            {
   1797              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   000100   7401         MOV     A,#0x1
   \   000102   12....       LCALL   ?XSTACK_DISP0_8
   \   000105   7401         MOV     A,#0x1
   \   000107   F0           MOVX    @DPTR,A
   \   000108   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_15
   1798            }
   1799            else
   1800            {
   1801              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   00010A   7401         MOV     A,#0x1
   \   00010C   12....       LCALL   ?XSTACK_DISP0_8
   \   00010F   E4           CLR     A
   \   000110   F0           MOVX    @DPTR,A
   1802              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   000111   8E82         MOV     DPL,R6
   \   000113   8F83         MOV     DPH,R7
   \   000115   E0           MOVX    A,@DPTR
   \   000116   C0E0         PUSH    A
   \   000118   7402         MOV     A,#0x2
   \   00011A   12....       LCALL   ?XSTACK_DISP0_8
   \   00011D   D0E0         POP     A
   \   00011F   F0           MOVX    @DPTR,A
   1803              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   000120   8E82         MOV     DPL,R6
   \   000122   8F83         MOV     DPH,R7
   \   000124   A3           INC     DPTR
   \   000125   E0           MOVX    A,@DPTR
   \   000126   C0E0         PUSH    A
   \   000128   7403         MOV     A,#0x3
   \   00012A   12....       LCALL   ?XSTACK_DISP0_8
   \   00012D   D0E0         POP     A
   \   00012F   F0           MOVX    @DPTR,A
   1804              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   000130   8E82         MOV     DPL,R6
   \   000132   8F83         MOV     DPH,R7
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   E0           MOVX    A,@DPTR
   \   000137   C0E0         PUSH    A
   \   000139   7404         MOV     A,#0x4
   \   00013B   12....       LCALL   ?XSTACK_DISP0_8
   \   00013E   D0E0         POP     A
   \   000140   F0           MOVX    @DPTR,A
   1805              msg.version = pNwkDesc->version;
   \   000141   85..82       MOV     DPL,?V0 + 0
   \   000144   85..83       MOV     DPH,?V0 + 1
   \   000147   E0           MOVX    A,@DPTR
   \   000148   C0E0         PUSH    A
   \   00014A   7405         MOV     A,#0x5
   \   00014C   12....       LCALL   ?XSTACK_DISP0_8
   \   00014F   D0E0         POP     A
   \   000151   F0           MOVX    @DPTR,A
   1806              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000152                ; Setup parameters for call to function sAddrExtCpy
   \   000152   AC..         MOV     R4,?V0 + 2
   \   000154   AD..         MOV     R5,?V0 + 3
   \   000156   7406         MOV     A,#0x6
   \   000158   12....       LCALL   ?XSTACK_DISP0_8
   \   00015B   AA82         MOV     R2,DPL
   \   00015D   AB83         MOV     R3,DPH
   \   00015F   12....       LCALL   ??sAddrExtCpy?relay
   1807            }
   1808            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000162                ; Setup parameters for call to function ZDApp_SendMsg
   \   000162   85..82       MOV     DPL,?XSP + 0
   \   000165   85..83       MOV     DPH,?XSP + 1
   \   000168   AC82         MOV     R4,DPL
   \   00016A   AD83         MOV     R5,DPH
   \   00016C   7B0E         MOV     R3,#0xe
   \   00016E   7A01         MOV     R2,#0x1
   \   000170   12....       LCALL   ?Subroutine7 & 0xFFFF
   1809          
   1810            return (ZSuccess);
   \                     ??CrossCallReturnLabel_23:
   \   000173   7900         MOV     R1,#0x0
   \   000175   740E         MOV     A,#0xe
   \   000177   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017A   7F0A         MOV     R7,#0xa
   \   00017C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1811          }  // ZDO_NetworkDiscoveryConfirmCB
   1812          
   1813          /*********************************************************************
   1814           * @fn          ZDO_NetworkFormationConfirmCB
   1815           *
   1816           * @brief       This function reports the results of the request to
   1817           *              initialize a coordinator in a network.
   1818           *
   1819           * @param       Status - Result of NLME_NetworkFormationRequest()
   1820           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1821          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1822          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1823            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1824          
   1825            if ( Status == ZSUCCESS )
   \   000009   7019         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   1826            {
   1827              // LED Blink shows Coordinator started
   1828              HalLedBlink (HAL_LED_1, 1, 50, 1000);
   \   00000B                ; Setup parameters for call to function HalLedBlink
   \   00000B   7CE8         MOV     R4,#-0x18
   \   00000D   7D03         MOV     R5,#0x3
   \   00000F   7B32         MOV     R3,#0x32
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7901         MOV     R1,#0x1
   \   000015   12....       LCALL   ??HalLedBlink?relay
   1829              HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );
   \   000018                ; Setup parameters for call to function HalLedSet
   \   000018   7A00         MOV     R2,#0x0
   \   00001A   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   1830              
   1831              // LED off forgets HOLD_AUTO_START
   1832              HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   1833          
   1834          #if defined ( ZBIT )
   1835              SIM_SetColor(0xd0ffd0);
   1836          #endif
   1837          
   1838              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_42:
   \   00001D   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   1839              {
   1840                // Began with HOLD_AUTO_START
   1841                devState = DEV_COORD_STARTING;
   \   00001F   7408         MOV     A,#0x8
   \   000021   F0           MOVX    @DPTR,A
   \   000022   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   1842              }
   1843            }
   1844          #if defined(BLINK_LEDS)
   1845            else
   1846              HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000024                ; Setup parameters for call to function HalLedSet
   \   000024   7A04         MOV     R2,#0x4
   \   000026   7901         MOV     R1,#0x1
   \   000028   12....       LCALL   ??HalLedSet?relay
   1847          #endif
   1848          
   1849            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A02         MOV     R2,#0x2
   \   00002D   02....       LJMP    ?Subroutine13 & 0xFFFF
   1850          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   7901         MOV     R1,#0x1
   \   000002   12....       LCALL   ??HalLedSet?relay
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005                ; Setup parameters for call to function HalLedSet
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7902         MOV     R1,#0x2
   \   000009   12....       LCALL   ??HalLedSet?relay
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   22           RET
   1851          
   1852          /*********************************************************************
   1853           * @fn          ZDO_StartRouterConfirmCB
   1854           *
   1855           * @brief       This function reports the results of the request to
   1856           *              start functioning as a router in a network.
   1857           *
   1858           * @param       Status - Result of NLME_StartRouterRequest()
   1859           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1860          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   1861          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1862            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1863          
   1864            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   1865            {
   1866              // LED on shows Router started
   1867              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine12 & 0xFFFF
   1868              
   1869              // LED off forgets HOLD_AUTO_START
   1870              HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF);
   1871              
   1872              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_40:
   \   00000E   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   1873              {
   1874                // Began with HOLD_AUTO_START
   1875                devState = DEV_END_DEVICE;
   \   000010   7406         MOV     A,#0x6
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   1876              }
   1877            }
   1878          #if defined(BLINK_LEDS)
   1879            else
   1880              HalLedSet( HAL_LED_1, HAL_LED_MODE_FLASH ); // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7901         MOV     R1,#0x1
   \   000019   12....       LCALL   ??HalLedSet?relay
   1881          #endif
   1882          
   1883            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001C                ; Setup parameters for call to function osal_set_event
   \   00001C   7A20         MOV     R2,#0x20
   \   00001E   02....       LJMP    ?Subroutine13 & 0xFFFF
   1884          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   7A01         MOV     R2,#0x1
   \   000002                REQUIRE ??Subroutine24_0
   \   000002                ; // Fall through to label ??Subroutine24_0
   1885          
   1886          /*********************************************************************
   1887           * @fn          ZDO_JoinConfirmCB
   1888           *
   1889           * @brief       This function allows the next hight layer to be notified
   1890           *              of the results of its request to join itself or another
   1891           *              device to a network.
   1892           *
   1893           * @param       Status - Result of NLME_JoinRequest()
   1894           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1895          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   1896          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1897            (void)PanId;  // remove if this parameter is used.
   1898            
   1899            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1900          
   1901            if ( Status == ZSUCCESS )
   \   000009   700A         JNZ     ??ZDO_JoinConfirmCB_0
   1902            {
   1903              // LED on shows device joined
   1904              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   12....       LCALL   ?Subroutine12 & 0xFFFF
   1905              
   1906              // LED off forgets HOLD_AUTO_START
   1907              HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF);
   1908              
   1909              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_41:
   \   00000E   700C         JNZ     ??ZDO_JoinConfirmCB_1
   1910              {
   1911                // Began with HOLD_AUTO_START
   1912                devState = DEV_NWK_JOINING;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   \   000013   8007         SJMP    ??ZDO_JoinConfirmCB_1
   1913              }
   1914          
   1915              if ( !ZG_SECURE_ENABLED )
   1916              {
   1917                // Notify to save info into NV
   1918                ZDApp_NVUpdate();
   1919              }
   1920            }
   1921            else
   1922            {
   1923          #if defined(BLINK_LEDS)
   1924              HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH ); // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000015                ; Setup parameters for call to function HalLedSet
   \   000015   7A04         MOV     R2,#0x4
   \   000017   7901         MOV     R1,#0x1
   \   000019   12....       LCALL   ??HalLedSet?relay
   1925          #endif
   1926            }
   1927          
   1928            // Notify ZDApp
   1929            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001C                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001C   7C00         MOV     R4,#0x0
   \   00001E   7D00         MOV     R5,#0x0
   \   000020   7B02         MOV     R3,#0x2
   \   000022   7A02         MOV     R2,#0x2
   \   000024   02....       LJMP    ?Subroutine19 & 0xFFFF
   1930          }
   1931          
   1932          /*********************************************************************
   1933           * @fn          ZDO_AddrChangeIndicationCB
   1934           *
   1935           * @brief       This function notifies the application that this
   1936           *              device's address has changed.  Could happen in 
   1937           *              a network with stochastic addressing (PRO).
   1938           *
   1939           * @param       newAddr - the new address
   1940           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1941          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   1942          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1943            (void)newAddr;  // remove if this parameter is used
   1944            
   1945            // Notify to save info into NV
   1946            ZDApp_NVUpdate();
   1947          
   1948            // Notify the applications   
   1949            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine2 & 0xFFFF
   1950          
   1951            // Send out a device announce
   1952            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_19:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1953          }
   \   00000A   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1954          
   1955          /*********************************************************************
   1956           * @fn          ZDO_JoinIndicationCB
   1957           *
   1958           * @brief       This function allows the next higher layer of a
   1959           *              coordinator to be notified of a remote join request.
   1960           *
   1961           * @param       ShortAddress - 16-bit address
   1962           * @param       ExtendedAddress - IEEE (64-bit) address
   1963           * @param       CapabilityInformation - Association Capability Information
   1964           * @param       type - of joining - 
   1965           *                          NWK_ASSOC_JOIN
   1966           *                          NWK_ASSOC_REJOIN_UNSECURE
   1967           *                          NWK_ASSOC_REJOIN_SECURE
   1968           *
   1969           * @return      ZStatus_t
   1970           */
   1971          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   1972                                          uint8 CapabilityInformation, uint8 type )
   1973          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1974            (void)ShortAddress;
   1975            (void)ExtendedAddress;
   1976            (void)CapabilityInformation;
   1977            
   1978              // Notify to save info into NV
   1979              ZDApp_NVUpdate();
   1980            
   1981              // send notification to TC of new device..
   1982              if ( ZG_SECURE_ENABLED )
   1983              {
   1984                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   1985                {
   1986                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   1987                }
   1988              }
   1989            
   1990              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine14
   \   000000                ; // Fall through to label ?Subroutine14

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   1991          }
   1992          
   1993          /*********************************************************************
   1994           * @fn          ZDO_ConcentratorIndicationCB
   1995           *
   1996           * @brief       This function allows the next higher layer of a
   1997           *              device to be notified of existence of the concentrator.
   1998           *
   1999           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2000           *
   2001           * @return      void 
   2002           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2003          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2004          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2005            // Write your code here to do something with the concentrator's
   2006            // address.
   2007            (void)nwkAddr;
   2008          }
   \   000000   02....       LJMP    ?BRET
   2009          
   2010          /*********************************************************************
   2011           * @fn          ZDO_LeaveCnf
   2012           *
   2013           * @brief       This function allows the next higher layer to be
   2014           *              notified of the results of its request for this or
   2015           *              a child device to leave the network.
   2016           *
   2017           * @param       cnf - NLME_LeaveCnf_t
   2018           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2019          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2020          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2021            // Check for this device
   2022            if ( osal_ExtAddrEqual( cnf->extAddr,
   2023                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   700C         JNZ     ??ZDO_LeaveCnf_0
   2024            {
   2025              // Prepare to leave with reset
   2026              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   2027            }
   \                     ??CrossCallReturnLabel_47:
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000030   8017         SJMP    ??ZDO_LeaveCnf_1
   2028            else if ( ZSTACK_ROUTER_BUILD )
   2029            {
   2030              // Remove device address(optionally descendents) from data
   2031              ZDApp_LeaveUpdate( cnf->dstAddr,
   2032                                 cnf->extAddr,
   2033                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000032                ; Setup parameters for call to function NLME_RemoveChild
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   AA..         MOV     R2,?V0 + 0
   \   000044   AB..         MOV     R3,?V0 + 1
   \   000046   12....       LCALL   ??NLME_RemoveChild?relay
   2034            }
   2035          }
   \                     ??ZDO_LeaveCnf_1:
   \   000049   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2036          
   2037          /*********************************************************************
   2038           * @fn          ZDO_LeaveInd
   2039           *
   2040           * @brief       This function allows the next higher layer of a
   2041           *              device to be notified of a remote leave request or
   2042           *              indication.
   2043           *
   2044           * @param       ind - NLME_LeaveInd_t
   2045           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2046          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2047          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2048            uint8 leave;
   2049          
   2050          
   2051            // Parent is requesting the leave - NWK layer filters out illegal
   2052            // requests
   2053            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F8           MOV     R0,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F9           MOV     R1,A
   \   000016   88..         MOV     ?V0 + 0,R0
   \   000018   89..         MOV     ?V0 + 1,R1
   \   00001A   EE           MOV     A,R6
   \   00001B   240B         ADD     A,#0xb
   \   00001D   18           DEC     R0
   \   00001E   EF           MOV     A,R7
   \   00001F   3400         ADDC    A,#0x0
   \   000021   F9           MOV     R1,A
   \   000022   88..         MOV     ?V0 + 2,R0
   \   000024   89..         MOV     ?V0 + 3,R1
   \   000026   8E82         MOV     DPL,R6
   \   000028   8F83         MOV     DPH,R7
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   6401         XRL     A,#0x1
   \   000037   7031         JNZ     ??ZDO_LeaveInd_0
   2054            {
   2055              // Notify network of leave
   2056              if ( ZSTACK_ROUTER_BUILD )
   2057              {
   2058                NLME_LeaveRsp_t rsp;
   2059                rsp.rejoin         = ind->rejoin;
   \   000039   85..82       MOV     DPL,?V0 + 0
   \   00003C   85..83       MOV     DPH,?V0 + 1
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   C0E0         PUSH    A
   \   000042   7401         MOV     A,#0x1
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   D0E0         POP     A
   \   000049   F0           MOVX    @DPTR,A
   2060                rsp.removeChildren = ind->removeChildren;
   \   00004A   8882         MOV     DPL,R0
   \   00004C   8983         MOV     DPH,R1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   85..82       MOV     DPL,?XSP + 0
   \   000052   85..83       MOV     DPH,?XSP + 1
   \   000055   F0           MOVX    @DPTR,A
   2061                NLME_LeaveRsp( &rsp );
   \   000056                ; Setup parameters for call to function NLME_LeaveRsp
   \   000056   AA82         MOV     R2,DPL
   \   000058   AB83         MOV     R3,DPH
   \   00005A   12....       LCALL   ??NLME_LeaveRsp?relay
   2062              }
   2063          
   2064              // Prepare to leave with reset
   2065              ZDApp_LeaveReset( ind->rejoin );
   \   00005D                ; Setup parameters for call to function ZDApp_LeaveReset
   \                     ??ZDO_LeaveInd_1:
   \   00005D   85..82       MOV     DPL,?V0 + 0
   \   000060   85..83       MOV     DPH,?V0 + 1
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F9           MOV     R1,A
   \   000065   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000068   802D         SJMP    ??ZDO_LeaveInd_2
   2066            }
   2067            else
   2068            {
   2069              leave = FALSE;
   2070          
   2071              // Check if this device needs to leave as a child or descendent
   2072              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   00006A                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   00006A   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00006D   85..82       MOV     DPL,?V0 + 2
   \   000070   85..83       MOV     DPH,?V0 + 3
   \   000073   E0           MOVX    A,@DPTR
   \   000074   F9           MOV     R1,A
   \   000075   8E82         MOV     DPL,R6
   \   000077   8F83         MOV     DPH,R7
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   6A           XRL     A,R2
   \   00007B   7003         JNZ     ??ZDO_LeaveInd_3
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   000080   700A         JNZ     ??ZDO_LeaveInd_4
   2073              {
   2074                if ( ( ind->removeChildren == TRUE               ) ||
   2075                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2076                       NODETYPE_DEVICE                           )    )
   \   000082   7401         MOV     A,#0x1
   \   000084   69           XRL     A,R1
   \   000085   60D6         JZ      ??ZDO_LeaveInd_1
   \   000087   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   00008A   60D1         JZ      ??ZDO_LeaveInd_1
   2077                {
   2078                  leave = TRUE;
   2079                }
   2080              }
   2081              else if ( ind->removeChildren == TRUE )
   2082              {
   2083                // Check NWK address allocation algorithm
   2084                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2085              }
   2086          
   2087              if ( leave == TRUE )
   2088              {
   2089                // Prepare to leave with reset
   2090                ZDApp_LeaveReset( ind->rejoin );
   \   00008C                ; Setup parameters for call to function ZDApp_LeaveReset
   2091              }
   2092              else
   2093              {
   2094                // Remove device address(optionally descendents) from data
   2095                ZDApp_LeaveUpdate( ind->srcAddr,
   2096                                   ind->extAddr,
   2097                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   00008C                ; Setup parameters for call to function NLME_RemoveChild
   \   00008C   EE           MOV     A,R6
   \   00008D   2402         ADD     A,#0x2
   \   00008F   FA           MOV     R2,A
   \   000090   EF           MOV     A,R7
   \   000091   3400         ADDC    A,#0x0
   \   000093   FB           MOV     R3,A
   \   000094   12....       LCALL   ??NLME_RemoveChild?relay
   2098              }
   2099            }
   2100          }
   \                     ??ZDO_LeaveInd_2:
   \   000097   7402         MOV     A,#0x2
   \   000099   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009C   7F06         MOV     R7,#0x6
   \   00009E   02....       LJMP    ?BANKED_LEAVE_XDATA
   2101          
   2102          /*********************************************************************
   2103           * @fn          ZDO_SyncIndicationCB
   2104           *
   2105           * @brief       This function allows the next higher layer of a
   2106           *              coordinator to be notified of a loss of synchronization
   2107           *                          with the parent/child device.
   2108           *
   2109           * @param       type: 0 - child; 1 - parent
   2110           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2111          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2112          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2113            (void)shortAddr;  // Remove this line if this parameter is used.
   2114            
   2115            if ( ZSTACK_END_DEVICE_BUILD
   2116              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000004   90....       MOV     DPTR,#(_NIB + 14)
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000A   4013         JC      ??CrossCallReturnLabel_24
   2117            {
   2118              if ( type == 1 )
   \   00000C   7401         MOV     A,#0x1
   \   00000E   69           XRL     A,R1
   \   00000F   700E         JNZ     ??CrossCallReturnLabel_24
   2119              {
   2120                // We lost contact with our parent.  Clear the neighbor Table.
   2121                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2122                
   2123                // Start the rejoin process.
   2124                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   12....       LCALL   ?Subroutine7 & 0xFFFF
   2125              }
   2126            }
   2127          }
   \                     ??CrossCallReturnLabel_24:
   \   00001F   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2128          
   2129          /*********************************************************************
   2130           * @fn          ZDO_ManytoOneFailureIndicationCB
   2131           *
   2132           * @brief       This function allows the next higher layer of a
   2133           *              concentrator to be notified of a many-to-one route 
   2134           *              failure. 
   2135           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2136          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2137          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2138            // By default, the concentrator automatically redo many-to-one route 
   2139            // discovery to update all many-to-one routes in the network
   2140            // If you want anything processing other than the default,
   2141            // please replace the following code.
   2142            
   2143            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2144          }
   \   000007   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2145          
   2146          
   2147          /*********************************************************************
   2148           * @fn          ZDO_PollConfirmCB
   2149           *
   2150           * @brief       This function allows the next higher layer to be
   2151           *              notified of a Poll Confirm.
   2152           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2153          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2154          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2155            (void)status;  // Remove this line if this parameter is used.
   2156            return;
   \   000000   02....       LJMP    ?BRET
   2157          }
   2158          
   2159          /******************************************************************************
   2160           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2161           *
   2162           * @brief       Stub routine implemented by NHLE. NHLE should call
   2163           *              <AddrMgrWriteNV> when appropriate.
   2164           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2165          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2166          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2167          #if defined ( NV_RESTORE )  
   2168            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2169            {
   2170              // Trigger to save info into NV
   2171              ZDApp_NVUpdate();
   2172            }
   2173          #endif
   2174          }
   \   000000   02....       LJMP    ?BRET
   2175          
   2176          /*********************************************************************
   2177           * Call Back Functions from Security  - API
   2178           */
   2179          
   2180           /*********************************************************************
   2181           * @fn          ZDO_UpdateDeviceIndication
   2182           *
   2183           * @brief       This function notifies the "Trust Center" of a
   2184           *              network when a device joins or leaves the network.
   2185           *
   2186           * @param       extAddr - pointer to 64 bit address of new device
   2187           * @param       status  - 0 if a new device joined securely
   2188           *                      - 1 if a new device joined un-securely
   2189           *                      - 2 if a device left the network
   2190           *
   2191           * @return      true if newly joined device should be allowed to
   2192           *                                              remain on network
   2193           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2194          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2195          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2196            // can implement a network access policy based on the
   2197            // IEEE address of newly joining devices...
   2198            (void)extAddr;
   2199            (void)status;
   2200            
   2201            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine14 & 0xFFFF
   2202          }
   2203          
   2204          /*********************************************************************
   2205           * @fn          ZDApp_InMsgCB
   2206           *
   2207           * @brief       This function is called to pass up any message that is
   2208           *              not yet supported.  This allows for the developer to
   2209           *              support features themselves..
   2210           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2211          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2212          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL   ?Subroutine9 & 0xFFFF
   2213            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \                     ??CrossCallReturnLabel_44:
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   7480         MOV     A,#-0x80
   \   00000E   59           ANL     A,R1
   \   00000F   FB           MOV     R3,A
   \   000010   E4           CLR     A
   \   000011   7001         JNZ     ??ZDApp_InMsgCB_0
   \   000013   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   000014   7049         JNZ     ??ZDApp_InMsgCB_1
   2214            {
   2215              // Handle the response message
   2216            }
   2217            else
   2218            {
   2219              // Handle the request message by sending a generic "not supported".
   2220              // Device Announce doesn't have a response.
   2221              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000016   EE           MOV     A,R6
   \   000017   240B         ADD     A,#0xb
   \   000019   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   00001C   7041         JNZ     ??ZDApp_InMsgCB_1
   \   00001E   7413         MOV     A,#0x13
   \   000020   68           XRL     A,R0
   \   000021   7001         JNZ     ??ZDApp_InMsgCB_2
   \   000023   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_2:
   \   000024   6039         JZ      ??ZDApp_InMsgCB_1
   2222              {
   2223                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2224                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000026                ; Setup parameters for call to function ZDP_GenericRsp
   \   000026   E8           MOV     A,R0
   \   000027   F5..         MOV     ?V0 + 0,A
   \   000029   7480         MOV     A,#-0x80
   \   00002B   49           ORL     A,R1
   \   00002C   F5..         MOV     ?V0 + 1,A
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   75..00       MOV     ?V0 + 0,#0x0
   \   000036   75..00       MOV     ?V0 + 1,#0x0
   \   000039   78..         MOV     R0,#?V0 + 0
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   EE           MOV     A,R6
   \   00003F   240E         ADD     A,#0xe
   \   000041   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   2225              }
   2226            }
   \                     ??CrossCallReturnLabel_49:
   \   000044   FD           MOV     R5,A
   \   000045   7C84         MOV     R4,#-0x7c
   \   000047   EE           MOV     A,R6
   \   000048   2402         ADD     A,#0x2
   \   00004A   0A           INC     R2
   \   00004B   0A           INC     R2
   \   00004C   EF           MOV     A,R7
   \   00004D   3400         ADDC    A,#0x0
   \   00004F   FB           MOV     R3,A
   \   000050   EE           MOV     A,R6
   \   000051   240F         ADD     A,#0xf
   \   000053   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000056   F9           MOV     R1,A
   \   000057   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00005A   7404         MOV     A,#0x4
   \   00005C   12....       LCALL   ?DEALLOC_XSTACK8
   2227          }
   \                     ??ZDApp_InMsgCB_1:
   \   00005F   02....       LJMP    ??Subroutine27_0 & 0xFFFF
   2228          
   2229          
   2230          /*********************************************************************
   2231           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2232           *
   2233           * @brief   Changes the Match Descriptor Response permission.
   2234           *
   2235           * @param   endpoint - endpoint to allow responses
   2236           * @param   action - true to allow responses, false to not
   2237           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2238          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2239          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2240            // Store the action
   2241            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2242          }
   \   000007   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2243          
   2244          /*********************************************************************
   2245           * @fn      ZDApp_NetworkInit()
   2246           *
   2247           * @brief   Used to start the network joining process
   2248           *
   2249           * @param   delay - mSec delay to wait before starting
   2250           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2251          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2252          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2253            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2254            {
   2255              // Wait awhile before starting the device
   2256              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine6 & 0xFFFF
   2257            }
   \                     ??CrossCallReturnLabel_38:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_21
   2258            else
   2259            {
   2260              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ?Subroutine16 & 0xFFFF
   2261            }
   2262          }
   \                     ??CrossCallReturnLabel_21:
   \   00001A   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2263          
   2264          /*********************************************************************
   2265           * @fn      ZDApp_NwkStateUpdateCB()
   2266           *
   2267           * @brief   This function notifies that this device's network 
   2268           *          state info has been changed.
   2269           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2270          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2271          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2272            // Notify to save info into NV
   2273            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2274            {
   2275              // Trigger to save info into NV
   2276              ZDApp_NVUpdate();
   2277            }
   2278          }
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2279          
   2280          /*********************************************************************
   2281           * @fn      ZDApp_NodeProfileSync()
   2282           *
   2283           * @brief   Sync node with stack profile.
   2284           *
   2285           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2286           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2287          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2288          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2289            networkDesc_t* desc;
   2290            uint16         panID;
   2291          
   2292            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2293            {
   2294              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2295          
   2296              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2297          
   2298              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2299              {
   2300                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2301                {
   2302                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2303                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2304                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2305                }
   2306              }
   2307            }
   2308          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   80..         SJMP    ??Subroutine27_0
   2309          
   2310          /*********************************************************************
   2311           * @fn      ZDApp_StartJoiningCycle()
   2312           *
   2313           * @brief   Starts the joining cycle of a device.  This will only 
   2314           *          continue an already started (or stopped) joining cycle.
   2315           *
   2316           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2317           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2318          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2319          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2320            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2321            {
   2322              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2323              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2324          
   2325              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2326            }
   2327            else
   2328              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2329          }
   2330          
   2331          /*********************************************************************
   2332           * @fn      ZDApp_StopJoiningCycle()
   2333           *
   2334           * @brief   Stops the joining or rejoining process of a device.
   2335           *
   2336           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2337           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2338          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2339          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2340            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2341            {
   2342              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2343              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2344            }
   2345            else
   2346              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2347          }
   2348          
   2349          /*********************************************************************
   2350           * @fn      ZDApp_AnnounceNewAddress()
   2351           *
   2352           * @brief   Send Device Announce and hold all transmissions for 
   2353           *          new address timeout.
   2354           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2355          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2356          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2357          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2358            // Turn off data request hold
   2359            APSME_HoldDataRequests( 0 );
   2360          #endif
   2361            
   2362            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2363                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine26_0
   2364            
   2365          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2366            // Setup the timeout
   2367            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2368          #endif  
   2369          }
   2370          
   2371          /*********************************************************************
   2372           * @fn          ZDApp_NVUpdate
   2373           *
   2374           * @brief       Set the NV Update Timer.
   2375           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2376          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2377          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2378          #if defined ( NV_RESTORE )
   2379            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2380          #endif
   2381          }
   \   000000   02....       LJMP    ?BRET
   2382          
   2383          /*********************************************************************
   2384           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2385           *
   2386           * @brief   Returns a PAN ID for the network layer to use during
   2387           *          a coordinator start and there is another network with 
   2388           *          the intended PANID.
   2389           *
   2390           * @param   panid - the intended PAN ID
   2391           *
   2392           * @return  PANID to try
   2393           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2394          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2395          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2396            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2397          }
   2398          
   2399          /*********************************************************************
   2400           * @fn          ZDO_SrcRtgIndCB
   2401           *
   2402           * @brief       This function notifies the ZDO available src route record received.
   2403           *
   2404           * @param       srcAddr - source address of the source route
   2405           * @param       relayCnt - number of devices in the relay list
   2406           * @param       relayList - relay list of the source route
   2407           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2408          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2409          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 5
   \   000004   74FB         MOV     A,#-0x5
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   2410            zdoSrcRtg_t srcRtg;
   2411            
   2412            srcRtg.srcAddr = srcAddr;
   \   000009   85..82       MOV     DPL,?XSP + 0
   \   00000C   85..83       MOV     DPH,?XSP + 1
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   2413            srcRtg.relayCnt = relayCnt;
   \   000014   7402         MOV     A,#0x2
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E9           MOV     A,R1
   \   00001A   F0           MOVX    @DPTR,A
   2414            srcRtg.pRelayList = pRelayList;
   \   00001B   7403         MOV     A,#0x3
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   EC           MOV     A,R4
   \   000021   F0           MOVX    @DPTR,A
   \   000022   A3           INC     DPTR
   \   000023   ED           MOV     A,R5
   \   000024   F0           MOVX    @DPTR,A
   2415            
   2416            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   000025   90....       MOV     DPTR,#zdoCBFunc
   \   000028   E0           MOVX    A,@DPTR
   \   000029   7002         JNZ     ??ZDO_SrcRtgIndCB_0
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \                     ??ZDO_SrcRtgIndCB_0:
   \   00002D   6013         JZ      ??ZDO_SrcRtgIndCB_1
   2417            {
   2418              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   00002F                ; Setup parameters for indirect call
   \   00002F   85..82       MOV     DPL,?XSP + 0
   \   000032   85..83       MOV     DPH,?XSP + 1
   \   000035   AA82         MOV     R2,DPL
   \   000037   AB83         MOV     R3,DPH
   \   000039   90....       MOV     DPTR,#zdoCBFunc
   \   00003C   12....       LCALL   ?Subroutine4 & 0xFFFF
   2419            }
   \                     ??CrossCallReturnLabel_4:
   \   00003F   12....       LCALL   ?CALL_IND
   2420          }
   \                     ??ZDO_SrcRtgIndCB_1:
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?DEALLOC_XSTACK8
   \   000047   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2421          
   2422          
   2423          /*********************************************************************
   2424           * @fn          ZDO_RegisterForZdoCB
   2425           *
   2426           * @brief       Call this function to register the higher layer (for 
   2427           *              example, the Application layer or MT layer) with ZDO 
   2428           *              callbacks to get notified of some ZDO indication like
   2429           *              existence of a concentrator or receipt of a source 
   2430           *              route record.
   2431           *
   2432           * @param       indID - ZDO Indication ID
   2433           * @param       pFn   - Callback function pointer
   2434           *
   2435           * @return      ZSuccess - successful, ZInvalidParameter if not
   2436           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2437          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2438          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2439            // Check the range of the indication ID
   2440            if ( indID < MAX_ZDO_CB_FUNC )
   \   000004   E9           MOV     A,R1
   \   000005   700C         JNZ     ??ZDO_RegisterForZdoCB_0
   2441            {
   2442              zdoCBFunc[indID] = pFn;
   \   000007   90....       MOV     DPTR,#zdoCBFunc
   \   00000A   EA           MOV     A,R2
   \   00000B   F0           MOVX    @DPTR,A
   \   00000C   A3           INC     DPTR
   \   00000D   EB           MOV     A,R3
   \   00000E   F0           MOVX    @DPTR,A
   2443              return ZSuccess;
   \   00000F   7900         MOV     R1,#0x0
   \   000011   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2444            }
   2445            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000013   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000015   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2446          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devStartMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2447          
   2448          /*********************************************************************
   2449          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      0
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      0
       -> NLME_GetExtAddr               4      0      0
       -> ZDAppCheckForHoldKey          4      0      0
       -> ZDO_Init                      4      0      0
       -> afRegister                    4      0      0
       -> ZDApp_InitUserDesc            4      0      0
       -> ZDOInitDevice                 4      0      0
       -> HalLedBlink                   4      0      0
       -> ZDApp_RegisterCBs             4      0      0
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     16
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  2      0      0
       -> NLME_RemoveChild              4      0      0
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     12
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     10
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     54
       -> ZDO_ParseAddrRsp              0      0    108
       -> ZDO_UpdateAddrManager         0      0    108
       -> osal_mem_free                 0      0    108
       -> ZDO_ParseBindUnbindReq        0      0    108
       -> ZDO_ProcessBindUnbindReq      0      0    108
       -> ZDMatchSendState              0      0    108
       -> ZDO_ParseEndDeviceBindReq     0      0    108
       -> ZDO_MatchEndDeviceBind        0      0    108
       -> osal_mem_free                 0      0    108
       -> osal_mem_free                 0      0    108
     ZDApp_ProcessNetworkJoin           0      0     12
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               2      0     10
       -> ZDP_IncomingData              4      0      0
       -> ZDApp_ProcessMsgCBs           4      0      0
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrUpdateDeviceInd       4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      2      0      0
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     55
       -> osal_msg_allocate             0      0     40
       -> osal_memcpy                   0      0     46
       -> osal_msg_send                 0      0     40
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> osal_start_timerEx            0      0     20
     ZDOInitDevice                      0      0     12
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_LeaveInd                       1      0     16
       -> NLME_LeaveRsp                 0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_GetCoordShortAddr        0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_RemoveChild              0      0     32
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      2      0      0
       -> HalLedBlink                   4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    3      0      5
     ZDO_StartRouterConfirmCB           2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> nwkNeighborInitTable          4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      2
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    78
     ??Subroutine23_0                               7
     ZDApp_SecInit                                 10
     ZDApp_event_loop                             224
     ?Subroutine2                                   2
     ?Subroutine16                                 11
     ??Subroutine22_0                               6
     ??Subroutine27_0                               5
     ZDApp_ProcessSecEvent                        108
     ?Subroutine17                                  5
     ?Subroutine6                                   5
     ZDOInitDevice                                149
     ?Subroutine15                                  2
     ??Subroutine26_0                               3
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ZDApp_NetworkStartEvt                         78
     ?Subroutine13                                  3
     ZDApp_DeviceAuthEvt                           60
     ?Subroutine5                                   9
     ?Subroutine0                                  11
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     78
     ZDApp_InitUserDesc                            93
     ?Subroutine10                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                          57
     ?Subroutine4                                   9
     ZDApp_ProcessMsgCBs                          260
     ?Subroutine9                                   7
     ??Subroutine25_0                               9
     ZDApp_RegisterCBs                             48
     ?Subroutine3                                   2
     ??Subroutine20_0                               9
     ZDApp_ProcessSecMsg                           19
     ZDApp_ProcessNetworkJoin                     406
     ?Subroutine8                                  12
     ZDApp_SaveNwkKey                              82
     ?Subroutine18                                 10
     ?Subroutine11                                  6
     ??Subroutine21_0                               8
     ZDApp_ResetNwkKey                             40
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         16
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine1                                  14
     ZDApp_LeaveCtrlSet                            51
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              16
     ZDApp_LeaveUpdate                             13
     ZDApp_SendEventMsg                             8
     ?Subroutine19                                  5
     ?Subroutine7                                   9
     ZDApp_SendMsg                                100
     ZDO_NetworkDiscoveryConfirmCB                383
     ZDO_NetworkFormationConfirmCB                 48
     ??Subroutine24_0                              17
     ZDO_StartRouterConfirmCB                      33
     ?Subroutine12                                  2
     ZDO_JoinConfirmCB                             39
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine14                                  5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  76
     ZDO_LeaveInd                                 161
     ZDO_SyncIndicationCB                          34
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 98
     ZDApp_ChangeMatchDescRespPermission
                                                   10
     ZDApp_NetworkInit                             29
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        103
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ZDO_SrcRtgIndCB                               74
     ZDO_RegisterForZdoCB                          24
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for devStartMode>                1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 3 912 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    12 bytes in segment XDATA_I
    12 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    42 bytes in segment XDATA_Z
 
 4 266 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    54 bytes of XDATA memory

Errors: none
Warnings: none
