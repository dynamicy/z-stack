///////////////////////////////////////////////////////////////////////////////
//                                                                            /
// IAR C/C++ Compiler V7.51A/W32 for 8051               07/Jun/2010  09:43:25 /
// Copyright 2004-2009 IAR Systems AB.                                        /
//                                                                            /
//    Core               =  plain                                             /
//    Code model         =  banked                                            /
//    Data model         =  large                                             /
//    Calling convention =  xdata reentrant                                   /
//    Constant location  =  data_rom                                          /
//    Dptr setup         =  1,16                                              /
//    Source file        =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 /
//                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Components\mt\MT /
//                          _ZDO.c                                            /
//    Command line       =  -f "D:\µ{¦¡¶}µo\TI Zigbee                         /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg"      /
//                          (-DCPU32MHZ -DROOT=__near_func -DBLINK_LEDS) -f   /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\Tools\CC25 /
//                          30DB\f8wConfig.cfg" (-DSECURE=0                   /
//                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                 /
//                          -DDEFAULT_CHANLIST=0x00000800                     /
//                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                      /
//                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_M /
//                          ASK=0x007F -DBEACON_REQUEST_DELAY=100             /
//                          -DBEACON_REQ_DELAY_MASK=0x00FF                    /
//                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_P /
//                          OLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7           /
//                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3   /
//                          -DNWK_MAX_DATA_RETRIES=2                          /
//                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9        /
//                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40          /
//                          -DNWK_MAX_BINDING_ENTRIES=4                       /
//                          -DMAX_BINDING_CLUSTER_IDS=4                       /
//                          "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07, 0x09,     /
//                          0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08,   /
//                          0x0A, 0x0C, 0x0D}" -DMAC_MAX_FRAME_SIZE=116       /
//                          "-DCONST=const __code" -DGENERIC=__generic        /
//                          -DRFD_RCVC_ALWAYS_ON=TRUE -DPOLL_RATE=1000        /
//                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)  /
//                          -DREJOIN_POLL_RATE=440 "D:\µ{¦¡¶}µo\TI Zigbee     /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Components\mt\MT_ZDO.c" -D             /
//                          NWK_AUTO_POLL -D HAL_UART=TRUE -D                 /
//                          SERIAL_APP_PORT=0 -D LCD_SUPPORTED -D             /
//                          xPOWER_SAVING -lC "D:\µ{¦¡¶}µo\TI Zigbee          /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\EndDeviceEB\List\" -lA "D:\µ{¦¡¶}µo\TI     /
//                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-C /
//                          C2530-2.3.0-1.4.0\Projects\zstack\Utilities\Seria /
//                          lApp\CC2530DB\EndDeviceEB\List\" --diag_suppress  /
//                          Pe001,Pa010 -o "D:\µ{¦¡¶}µo\TI Zigbee             /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\EndDeviceEB\Obj\" -e --require_prototypes  /
//                          --debug --core=plain --dptr=16,1                  /
//                          --data_model=large --code_model=banked            /
//                          --calling_convention=xdata_reentrant              /
//                          --place_constants=data_rom --nr_virtual_regs 16   /
//                          -I "D:\µ{¦¡¶}µo\TI Zigbee                         /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\" -I "D:\µ{¦¡¶}µo\TI Zigbee                /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\SOURCE\" -I "D:\µ{¦¡¶}µo\TI Zigbee      /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\ZMAIN\TI2530DB\" -I               /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMP /
//                          ONENTS\MT\" -I "D:\µ{¦¡¶}µo\TI Zigbee             /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\"    /
//                          -I "D:\µ{¦¡¶}µo\TI Zigbee                         /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC253 /
//                          0EB\" -I "D:\µ{¦¡¶}µo\TI Zigbee                   /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\" /
//                           -I "D:\µ{¦¡¶}µo\TI Zigbee                        /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\"   /
//                          -I "D:\µ{¦¡¶}µo\TI Zigbee                         /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\" -I    /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMP /
//                          ONENTS\STACK\NWK\" -I "D:\µ{¦¡¶}µo\TI Zigbee      /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" -I   /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMP /
//                          ONENTS\STACK\SAPI\" -I "D:\µ{¦¡¶}µo\TI Zigbee     /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" -I   /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMP /
//                          ONENTS\STACK\ZDO\" -I "D:\µ{¦¡¶}µo\TI Zigbee      /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\" -I    /
//                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3. /
//                          0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack /
//                          \Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMP /
//                          ONENTS\ZMAC\" -I "D:\µ{¦¡¶}µo\TI Zigbee           /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\" /
//                           -I "D:\µ{¦¡¶}µo\TI Zigbee                        /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\" /
//                           -I "D:\µ{¦¡¶}µo\TI Zigbee                        /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\"    /
//                          -I "D:\µ{¦¡¶}µo\TI Zigbee                         /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" /
//                           -I "D:\µ{¦¡¶}µo\TI Zigbee                        /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\sr /
//                          f04\" -I "D:\µ{¦¡¶}µo\TI Zigbee                   /
//                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2 /
//                          .3.0-1.4.0\Projects\zstack\Utilities\SerialApp\CC /
//                          2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\sr /
//                          f04\SINGLE_CHIP\" -I "C:\IAR Systems\Embedded     /
//                          Workbench 5.3\8051\INC\" -I "C:\IAR               /
//                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"    /
//                          -Ohz                                              /
//    List file          =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 /
//                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\ /
//                          Utilities\SerialApp\CC2530DB\EndDeviceEB\List\MT_ /
//                          ZDO.s51                                           /
//                                                                            /
//                                                                            /
///////////////////////////////////////////////////////////////////////////////

        NAME MT_ZDO

        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "banked"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)


        END
// D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Components\mt\MT_ZDO.c
//    1 /**************************************************************************************************
//    2   Filename:       MT_ZDO.c
//    3   Revised:        $Date: 2009-12-29 11:40:43 -0800 (Tue, 29 Dec 2009) $
//    4   Revision:       $Revision: 21414 $
//    5 
//    6   Description:    MonitorTest functions for the ZDO layer.
//    7 
//    8 
//    9   Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
//   10 
//   11   IMPORTANT: Your use of this Software is limited to those specific rights
//   12   granted under the terms of a software license agreement between the user
//   13   who downloaded the software, his/her employer (which must be your employer)
//   14   and Texas Instruments Incorporated (the "License").  You may not use this
//   15   Software unless you agree to abide by the terms of the License. The License
//   16   limits your use, and you acknowledge, that the Software may not be modified,
//   17   copied or distributed unless embedded on a Texas Instruments microcontroller
//   18   or used solely and exclusively in conjunction with a Texas Instruments radio
//   19   frequency transceiver, which is integrated into your product.  Other than for
//   20   the foregoing purpose, you may not use, reproduce, copy, prepare derivative
//   21   works of, modify, distribute, perform, display or sell this Software and/or
//   22   its documentation for any purpose.
//   23 
//   24   YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
//   25   PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
//   26   INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
//   27   NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
//   28   TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
//   29   NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
//   30   LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
//   31   INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
//   32   OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
//   33   OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
//   34   (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
//   35 
//   36   Should you have any questions regarding your right to use this Software,
//   37   contact Texas Instruments Incorporated at www.TI.com.
//   38 **************************************************************************************************/
//   39 
//   40 #ifdef MT_ZDO_FUNC
//   41 
//   42 /**************************************************************************************************
//   43  * INCLUDES
//   44  **************************************************************************************************/
//   45 #include "ZComDef.h"
//   46 #include "OSAL.h"
//   47 #include "MT.h"
//   48 #include "MT_ZDO.h"
//   49 #include "APSMEDE.h"
//   50 #include "ZDConfig.h"
//   51 #include "ZDProfile.h"
//   52 #include "ZDObject.h"
//   53 #include "ZDApp.h"
//   54 
//   55 #if !defined( WIN32 )
//   56   #include "OnBoard.h"
//   57 #endif
//   58 
//   59 #if defined(ZDO_LINK_KEY_MANAGEMENT)
//   60   #include "ZDSecMgr.h"
//   61 #endif
//   62 
//   63 #include "nwk_util.h"
//   64 #include "hal_lcd.h"
//   65 
//   66 /**************************************************************************************************
//   67  * CONSTANTS
//   68  **************************************************************************************************/
//   69 #define MT_ZDO_END_DEVICE_ANNCE_IND_LEN   0x0D
//   70 #define MT_ZDO_ADDR_RSP_LEN               0x0D
//   71 #define MT_ZDO_BIND_UNBIND_RSP_LEN        0x03
//   72 
//   73 #define MTZDO_RESPONSE_BUFFER_LEN   100
//   74 
//   75 #define MTZDO_MAX_MATCH_CLUSTERS    16
//   76 #define MTZDO_MAX_ED_BIND_CLUSTERS  15
//   77 
//   78 // Conversion from ZDO Cluster Id to the RPC AREQ Id is direct as follows:
//   79 #define MT_ZDO_CID_TO_AREQ_ID(CId)  ((uint8)(CId) | 0x80)
//   80 
//   81 /**************************************************************************************************
//   82  * GLOBAL VARIABLES
//   83  **************************************************************************************************/
//   84 uint32 _zdoCallbackSub;
//   85 
//   86 /**************************************************************************************************
//   87  * LOCAL VARIABLES
//   88  **************************************************************************************************/
//   89 
//   90 /**************************************************************************************************
//   91  * LOCAL FUNCTIONS
//   92  **************************************************************************************************/
//   93 #if defined (MT_ZDO_FUNC)
//   94 void MT_ZdoNWKAddressRequest(uint8 *pBuf);
//   95 void MT_ZdoIEEEAddrRequest(uint8 *pBuf);
//   96 void MT_ZdoNodeDescRequest(uint8 *pBuf);
//   97 void MT_ZdoPowerDescRequest(uint8 *pBuf);
//   98 void MT_ZdoSimpleDescRequest(uint8 *pBuf);
//   99 void MT_ZdoActiveEpRequest(uint8 *pBuf);
//  100 void MT_ZdoMatchDescRequest(uint8 *pBuf);
//  101 void MT_ZdoComplexDescRequest(uint8 *pBuf);
//  102 void MT_ZdoUserDescRequest(uint8 *pBuf);
//  103 void MT_ZdoEndDevAnnce(uint8 *pBuf);
//  104 void MT_ZdoUserDescSet(uint8 *pBuf);
//  105 void MT_ZdoServiceDiscRequest(uint8 *pBuf);
//  106 void MT_ZdoEndDevBindRequest(uint8 *pBuf);
//  107 void MT_ZdoBindRequest(uint8 *pBuf);
//  108 void MT_ZdoUnbindRequest(uint8 *pBuf);
//  109 void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf);
//  110 void MT_ZdoSetLinkKey(uint8 *pBuf);
//  111 void MT_ZdoRemoveLinkKey(uint8 *pBuf);
//  112 void MT_ZdoGetLinkKey(uint8 *pBuf);
//  113 #if defined (MT_ZDO_MGMT)
//  114 void MT_ZdoMgmtLqiRequest(uint8 *pBuf);
//  115 void MT_ZdoMgmtRtgRequest(uint8 *pBuf);
//  116 void MT_ZdoMgmtBindRequest(uint8 *pBuf);
//  117 void MT_ZdoMgmtLeaveRequest(uint8 *pBuf);
//  118 void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf);
//  119 void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf);
//  120 void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf);
//  121 #endif /* MT_ZDO_MGMT */
//  122 void MT_ZdoStartupFromApp(uint8 *pBuf);
//  123 void MT_ZdoRegisterForZDOMsg(uint8 *pBuf);
//  124 void MT_ZdoRemoveRegisteredCB(uint8 *pBuf);
//  125 #endif /* MT_ZDO_FUNC */
//  126 
//  127 #if defined (MT_ZDO_CB_FUNC)
//  128 uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg );
//  129 void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID );
//  130 void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr );
//  131 void MT_ZdoBindUnbindRspCB( uint16 clusterID, uint16 srcAddr, uint8 status );
//  132 void* MT_ZdoSrcRtgCB( void *pStr );
//  133 #endif /* MT_ZDO_CB_FUNC */
//  134 
//  135 #if defined (MT_ZDO_FUNC)
//  136 /***************************************************************************************************
//  137  * @fn      MT_ZdoInit
//  138  *
//  139  * @brief   MT ZDO initialization
//  140  *
//  141  * @param   none
//  142  *
//  143  * @return  none
//  144  ***************************************************************************************************/
//  145 void MT_ZdoInit(void)
//  146 {
//  147 #ifdef MT_ZDO_CB_FUNC
//  148   /* Register with ZDO for indication callbacks */
//  149   ZDO_RegisterForZdoCB(ZDO_SRC_RTG_IND_CBID, &MT_ZdoSrcRtgCB);
//  150 #endif
//  151 }
//  152 
//  153 /***************************************************************************************************
//  154  * @fn      MT_ZdoCommandProcessing
//  155  *
//  156  * @brief
//  157  *
//  158  *   Process all the ZDO commands that are issued by test tool
//  159  *
//  160  * @param   pBuf - pointer to the msg buffer
//  161  *
//  162  *          | LEN  | CMD0  | CMD1  |  DATA  |
//  163  *          |  1   |   1   |   1   |  0-255 |
//  164  *
//  165  * @return  status
//  166  ***************************************************************************************************/
//  167 uint8 MT_ZdoCommandProcessing(uint8* pBuf)
//  168 {
//  169   uint8 status = MT_RPC_SUCCESS;
//  170 
//  171   switch (pBuf[MT_RPC_POS_CMD1])
//  172   {
//  173 #if defined ( ZDO_NWKADDR_REQUEST )
//  174     case MT_ZDO_NWK_ADDR_REQ:
//  175       MT_ZdoNWKAddressRequest(pBuf);
//  176       break;
//  177 #endif
//  178 
//  179 #if defined ( ZDO_IEEEADDR_REQUEST )
//  180     case MT_ZDO_IEEE_ADDR_REQ:
//  181       MT_ZdoIEEEAddrRequest(pBuf);
//  182       break;
//  183 #endif
//  184 
//  185 #if defined ( ZDO_NODEDESC_REQUEST )
//  186     case MT_ZDO_NODE_DESC_REQ:
//  187       MT_ZdoNodeDescRequest(pBuf);
//  188       break;
//  189 #endif
//  190 
//  191 #if defined ( ZDO_POWERDESC_REQUEST )
//  192     case MT_ZDO_POWER_DESC_REQ:
//  193       MT_ZdoPowerDescRequest(pBuf);
//  194       break;
//  195 #endif
//  196 
//  197 #if defined ( ZDO_SIMPLEDESC_REQUEST )
//  198     case MT_ZDO_SIMPLE_DESC_REQ:
//  199       MT_ZdoSimpleDescRequest(pBuf);
//  200       break;
//  201 #endif
//  202 
//  203 #if defined ( ZDO_ACTIVEEP_REQUEST )
//  204     case MT_ZDO_ACTIVE_EP_REQ:
//  205       MT_ZdoActiveEpRequest(pBuf);
//  206       break;
//  207 #endif
//  208 
//  209 #if defined ( ZDO_MATCH_REQUEST )
//  210     case MT_ZDO_MATCH_DESC_REQ:
//  211       MT_ZdoMatchDescRequest(pBuf);
//  212       break;
//  213 #endif
//  214 
//  215 #if defined ( ZDO_COMPLEXDESC_REQUEST )
//  216     case MT_ZDO_COMPLEX_DESC_REQ:
//  217       MT_ZdoComplexDescRequest(pBuf);
//  218       break;
//  219 #endif
//  220 
//  221 #if defined ( ZDO_USERDESC_REQUEST )
//  222     case MT_ZDO_USER_DESC_REQ:
//  223       MT_ZdoUserDescRequest(pBuf);
//  224       break;
//  225 #endif
//  226 
//  227 #if defined ( ZDO_ENDDEVICE_ANNCE )
//  228     case MT_ZDO_END_DEV_ANNCE:
//  229       MT_ZdoEndDevAnnce(pBuf);
//  230       break;
//  231 #endif      
//  232 
//  233 #if defined ( ZDO_USERDESCSET_REQUEST )
//  234     case MT_ZDO_USER_DESC_SET:
//  235       MT_ZdoUserDescSet(pBuf);
//  236       break;
//  237 #endif
//  238 
//  239 #if defined ( ZDO_SERVERDISC_REQUEST )
//  240     case MT_ZDO_SERVICE_DISC_REQ:
//  241       MT_ZdoServiceDiscRequest(pBuf);
//  242       break;
//  243 #endif
//  244 
//  245 #if defined ( ZDO_ENDDEVICEBIND_REQUEST )
//  246     case MT_ZDO_END_DEV_BIND_REQ:
//  247       MT_ZdoEndDevBindRequest(pBuf);
//  248       break;
//  249 #endif
//  250 
//  251 #if defined ( ZDO_BIND_UNBIND_REQUEST )
//  252     case MT_ZDO_BIND_REQ:
//  253       MT_ZdoBindRequest(pBuf);
//  254       break;
//  255 #endif
//  256 
//  257 #if defined ( ZDO_BIND_UNBIND_REQUEST )
//  258     case MT_ZDO_UNBIND_REQ:
//  259       MT_ZdoUnbindRequest(pBuf);
//  260       break;
//  261 #endif
//  262       
//  263 #if defined ( ZDO_LINK_KEY_MANAGEMENT )
//  264     case MT_ZDO_SET_LINK_KEY:
//  265       MT_ZdoSetLinkKey(pBuf);
//  266       break;
//  267 
//  268     case MT_ZDO_REMOVE_LINK_KEY:
//  269       MT_ZdoRemoveLinkKey(pBuf);
//  270       break;
//  271 
//  272     case MT_ZDO_GET_LINK_KEY:
//  273       MT_ZdoGetLinkKey(pBuf);
//  274       break;
//  275 #endif      
//  276 
//  277 #if defined ( ZDO_MGMT_NWKDISC_REQUEST )
//  278     case MT_ZDO_MGMT_NWKDISC_REQ:
//  279       MT_ZdoMgmtNwkDiscRequest(pBuf);
//  280       break;
//  281 #endif
//  282 
//  283 #if defined ( ZDO_MGMT_LQI_REQUEST )
//  284     case MT_ZDO_MGMT_LQI_REQ:
//  285       MT_ZdoMgmtLqiRequest(pBuf);
//  286       break;
//  287 #endif
//  288 
//  289 #if defined ( ZDO_MGMT_RTG_REQUEST )
//  290     case MT_ZDO_MGMT_RTG_REQ:
//  291       MT_ZdoMgmtRtgRequest(pBuf);
//  292       break;
//  293 #endif
//  294 
//  295 #if defined ( ZDO_MGMT_BIND_REQUEST )
//  296     case MT_ZDO_MGMT_BIND_REQ:
//  297       MT_ZdoMgmtBindRequest(pBuf);
//  298       break;
//  299 #endif
//  300 
//  301 #if defined ( ZDO_MGMT_LEAVE_REQUEST )
//  302     case MT_ZDO_MGMT_LEAVE_REQ:
//  303       MT_ZdoMgmtLeaveRequest(pBuf);
//  304       break;
//  305 #endif
//  306 
//  307 #if defined ( ZDO_MGMT_JOINDIRECT_REQUEST )
//  308     case MT_ZDO_MGMT_DIRECT_JOIN_REQ:
//  309       MT_ZdoMgmtDirectJoinRequest(pBuf);
//  310       break;
//  311 #endif
//  312 
//  313 #if defined ( ZDO_MGMT_PERMIT_JOIN_REQUEST )
//  314     case MT_ZDO_MGMT_PERMIT_JOIN_REQ:
//  315       MT_ZdoMgmtPermitJoinRequest(pBuf);
//  316       break;
//  317 #endif
//  318 
//  319 #if defined ( ZDO_MGMT_NWKUPDATE_REQUEST )
//  320     case MT_ZDO_MGMT_NWK_UPDATE_REQ:
//  321       MT_ZdoMgmtNwkUpdateRequest(pBuf);
//  322       break;
//  323 #endif 
//  324 
//  325 #if defined ( ZDO_NETWORKSTART_REQUEST )
//  326     case MT_ZDO_STARTUP_FROM_APP:
//  327       MT_ZdoStartupFromApp(pBuf);
//  328       break;
//  329 #endif
//  330 
//  331     case MT_ZDO_MSG_CB_REGISTER:
//  332       MT_ZdoRegisterForZDOMsg(pBuf);
//  333       break;
//  334 
//  335     case MT_ZDO_MSG_CB_REMOVE:
//  336       MT_ZdoRemoveRegisteredCB(pBuf);
//  337       break;
//  338 
//  339     default:
//  340       status = MT_RPC_ERR_COMMAND_ID;
//  341       break;
//  342   }
//  343 
//  344   return status;
//  345 }
//  346 
//  347 /***************************************************************************************************
//  348  * @fn      MT_ZdoNwkAddrReq
//  349  *
//  350  * @brief   Handle a nwk address request.
//  351  *
//  352  * @param   pData  - MT message data
//  353  *
//  354  * @return  void
//  355  ***************************************************************************************************/
//  356 void MT_ZdoNWKAddressRequest(uint8 *pBuf)
//  357 {
//  358   uint8 cmdId;
//  359   uint8 retValue;
//  360   uint8 reqType;
//  361   uint8 startIndex;
//  362   uint8 *pExtAddr;
//  363 
//  364   /* parse header */
//  365   cmdId = pBuf[MT_RPC_POS_CMD1];
//  366   pBuf += MT_RPC_FRAME_HDR_SZ;
//  367 
//  368   /* parse parameters */
//  369   pExtAddr = pBuf;
//  370   pBuf += Z_EXTADDR_LEN;
//  371 
//  372   /* Request type */
//  373   reqType = *pBuf++;
//  374 
//  375   /* Start index */
//  376   startIndex = *pBuf;
//  377 
//  378   retValue = (uint8)ZDP_NwkAddrReq(pExtAddr, reqType, startIndex, 0);
//  379 
//  380   /* Build and send back the response */
//  381   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  382 }
//  383 
//  384 /***************************************************************************************************
//  385  * @fn      MT_ZdoIEEEAddrRequest
//  386  *
//  387  * @brief   Handle a IEEE address request.
//  388  *
//  389  * @param   pData  - MT message data
//  390  *
//  391  * @return  void
//  392  ***************************************************************************************************/
//  393 void MT_ZdoIEEEAddrRequest (uint8 *pBuf)
//  394 {
//  395   uint8 cmdId;
//  396   uint8 retValue;
//  397   uint16 shortAddr;
//  398   uint8 reqType;
//  399   uint8 startIndex;
//  400 
//  401   /* parse header */
//  402   cmdId = pBuf[MT_RPC_POS_CMD1];
//  403   pBuf += MT_RPC_FRAME_HDR_SZ;
//  404 
//  405   /* Dev address */
//  406   shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
//  407   pBuf += 2;
//  408 
//  409   /* request type */
//  410   reqType = *pBuf++;
//  411 
//  412   /* start index */
//  413   startIndex = *pBuf;
//  414 
//  415   retValue = (uint8)ZDP_IEEEAddrReq(shortAddr, reqType, startIndex, 0);
//  416   
//  417   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  418 }
//  419 
//  420 /***************************************************************************************************
//  421  * @fn      MT_ZdoNodeDescRequest
//  422  *
//  423  * @brief   Handle a Node Descriptor request.
//  424  *
//  425  * @param   pData  - MT message data
//  426  *
//  427  * @return  void
//  428  ***************************************************************************************************/
//  429 void MT_ZdoNodeDescRequest (uint8 *pBuf)
//  430 {
//  431   uint8 cmdId;
//  432   uint8 retValue;
//  433   zAddrType_t destAddr;
//  434   uint16 shortAddr;
//  435 
//  436   /* parse header */
//  437   cmdId = pBuf[MT_RPC_POS_CMD1];
//  438   pBuf += MT_RPC_FRAME_HDR_SZ;
//  439 
//  440   /* Destination address */
//  441   destAddr.addrMode = Addr16Bit;
//  442   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  443   pBuf += 2;
//  444 
//  445   /* Network address of interest */
//  446   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  447   pBuf += 2;
//  448 
//  449   retValue = (uint8)ZDP_NodeDescReq( &destAddr, shortAddr, 0);
//  450 
//  451   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  452 }
//  453 
//  454 /***************************************************************************************************
//  455  * @fn      MT_ZdoPowerDescRequest
//  456  *
//  457  * @brief   Handle a Power Descriptor request.
//  458  *
//  459  * @param   pData  - MT message data
//  460  *
//  461  * @return  void
//  462  ***************************************************************************************************/
//  463 void MT_ZdoPowerDescRequest(uint8 *pBuf)
//  464 {
//  465   uint8 cmdId;
//  466   uint8 retValue;
//  467   zAddrType_t destAddr;
//  468   uint16 shortAddr;
//  469 
//  470   /* parse header */
//  471   cmdId = pBuf[MT_RPC_POS_CMD1];
//  472   pBuf += MT_RPC_FRAME_HDR_SZ;
//  473 
//  474   /* Dev address */
//  475   destAddr.addrMode = Addr16Bit;
//  476   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  477   pBuf += 2;
//  478 
//  479   /* Network address of interest */
//  480   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  481   pBuf += 2;
//  482 
//  483   retValue = (uint8)ZDP_PowerDescReq( &destAddr, shortAddr, 0);
//  484 
//  485   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  486 }
//  487 
//  488 /***************************************************************************************************
//  489  * @fn      MT_ZdoSimpleDescRequest
//  490  *
//  491  * @brief   Handle a Simple Descriptor request.
//  492  *
//  493  * @param   pBuf  - MT message data
//  494  *
//  495  * @return  void
//  496  ***************************************************************************************************/
//  497 void MT_ZdoSimpleDescRequest(uint8 *pBuf)
//  498 {
//  499   uint8 cmdId;
//  500   uint8 retValue;
//  501   uint8 epInt;
//  502   zAddrType_t destAddr;
//  503   uint16 shortAddr;
//  504 
//  505   /* parse header */
//  506   cmdId = pBuf[MT_RPC_POS_CMD1];
//  507   pBuf += MT_RPC_FRAME_HDR_SZ;
//  508 
//  509   /* Dev address */
//  510   destAddr.addrMode = Addr16Bit;
//  511   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  512   pBuf += 2;
//  513 
//  514   /* Network address of interest */
//  515   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  516   pBuf += 2;
//  517 
//  518   /* endpoint/interface */
//  519   epInt = *pBuf++;
//  520 
//  521   retValue = (uint8)ZDP_SimpleDescReq( &destAddr, shortAddr, epInt, 0);
//  522 
//  523   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  524 }
//  525 
//  526 /***************************************************************************************************
//  527  * @fn      MT_ZdoActiveEpRequest
//  528  *
//  529  * @brief   Handle a Active EP request.
//  530  *
//  531  * @param   pBuf  - MT message data
//  532  *
//  533  * @return  void
//  534  ***************************************************************************************************/
//  535 void MT_ZdoActiveEpRequest(uint8 *pBuf)
//  536 {
//  537   uint8 cmdId;
//  538   uint8 retValue;
//  539   zAddrType_t destAddr;
//  540   uint16 shortAddr;
//  541 
//  542   /* parse header */
//  543   cmdId = pBuf[MT_RPC_POS_CMD1];
//  544   pBuf += MT_RPC_FRAME_HDR_SZ;
//  545 
//  546   /* Dev address */
//  547   destAddr.addrMode = Addr16Bit;
//  548   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  549   pBuf += 2;
//  550 
//  551   /* Network address of interest */
//  552   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  553   pBuf += 2;
//  554 
//  555   retValue = (uint8)ZDP_ActiveEPReq( &destAddr, shortAddr, 0);
//  556 
//  557   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  558 }
//  559 
//  560 /***************************************************************************************************
//  561  * @fn      MT_ZdoMatchDescRequest
//  562  *
//  563  * @brief   Handle a Match Descriptor request.
//  564  *
//  565  * @param   pBuf  - MT message data
//  566  *
//  567  * @return  void
//  568  ***************************************************************************************************/
//  569 void MT_ZdoMatchDescRequest(uint8 *pBuf)
//  570 {
//  571   uint8 cmdId;
//  572   uint8 retValue = 0;
//  573   uint8 i, numInClusters, numOutClusters;
//  574   uint16 profileId;
//  575   zAddrType_t destAddr;
//  576   uint16 shortAddr;
//  577   uint16 inClusters[MTZDO_MAX_MATCH_CLUSTERS], outClusters[MTZDO_MAX_MATCH_CLUSTERS];
//  578 
//  579   /* parse header */
//  580   cmdId = pBuf[MT_RPC_POS_CMD1];
//  581   pBuf += MT_RPC_FRAME_HDR_SZ;
//  582 
//  583   /* Dev address */
//  584   destAddr.addrMode = Addr16Bit;
//  585   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  586   pBuf += 2;
//  587 
//  588   /* Network address of interest */
//  589   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  590   pBuf += 2;
//  591 
//  592   /* Profile ID */
//  593   profileId = BUILD_UINT16( pBuf[0], pBuf[1] );
//  594   pBuf += 2;
//  595 
//  596   /* NumInClusters */
//  597   numInClusters = *pBuf++;
//  598   if ( numInClusters <= MTZDO_MAX_MATCH_CLUSTERS )
//  599   {
//  600     /* IN clusters */
//  601     for ( i = 0; i < numInClusters; i++ )
//  602     {
//  603       inClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
//  604       pBuf += 2;
//  605     }
//  606   }
//  607   else
//  608   {
//  609     retValue = ZDP_INVALID_REQTYPE;
//  610   }
//  611 
//  612   /* NumOutClusters */
//  613   numOutClusters = *pBuf++;
//  614   if ( numOutClusters <= MTZDO_MAX_MATCH_CLUSTERS )
//  615   {
//  616     /* OUT Clusters */
//  617     for ( i = 0; i < numOutClusters; i++ )
//  618     {
//  619       outClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
//  620       pBuf += 2;
//  621     }
//  622   }
//  623   else
//  624   {
//  625     retValue = ZDP_INVALID_REQTYPE;
//  626   }
//  627 
//  628   if ( retValue == 0 )
//  629   {
//  630     retValue = (uint8)ZDP_MatchDescReq( &destAddr, shortAddr, profileId, numInClusters,
//  631                                        inClusters, numOutClusters, outClusters, 0);
//  632   }
//  633 
//  634   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  635 }
//  636 
//  637 /***************************************************************************************************
//  638  * @fn      MT_ZdoComplexDescRequest
//  639  *
//  640  * @brief   Handle a Complex Descriptor request.
//  641  *
//  642  * @param   pBuf  - MT message data
//  643  *
//  644  * @return  void
//  645  ***************************************************************************************************/
//  646 void MT_ZdoComplexDescRequest(uint8 *pBuf)
//  647 {
//  648   uint8 cmdId;
//  649   uint8 retValue;
//  650   zAddrType_t destAddr;
//  651   uint16 shortAddr;
//  652 
//  653   /* parse header */
//  654   cmdId = pBuf[MT_RPC_POS_CMD1];
//  655   pBuf += MT_RPC_FRAME_HDR_SZ;
//  656 
//  657   /* Dev address */
//  658   destAddr.addrMode = Addr16Bit;
//  659   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  660   pBuf += 2;
//  661 
//  662   /* Network address of interest */
//  663   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  664   pBuf += 2;
//  665 
//  666   retValue = (uint8)ZDP_ComplexDescReq( &destAddr, shortAddr, 0);
//  667 
//  668   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  669 }
//  670 
//  671 /***************************************************************************************************
//  672  * @fn      MT_ZdoUserDescRequest
//  673  *
//  674  * @brief   Handle a User Descriptor request.
//  675  *
//  676  * @param   pBuf  - MT message data
//  677  *
//  678  * @return  void
//  679  ***************************************************************************************************/
//  680 void MT_ZdoUserDescRequest(uint8 *pBuf)
//  681 {
//  682   uint8 cmdId;
//  683   uint8 retValue;
//  684   zAddrType_t destAddr;
//  685   uint16 shortAddr;
//  686 
//  687   /* parse header */
//  688   cmdId = pBuf[MT_RPC_POS_CMD1];
//  689   pBuf += MT_RPC_FRAME_HDR_SZ;
//  690 
//  691   /* Dev address */
//  692   destAddr.addrMode = Addr16Bit;
//  693   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
//  694   pBuf += 2;
//  695 
//  696   /* Network address of interest */
//  697   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
//  698   pBuf += 2;
//  699 
//  700   retValue = (uint8)ZDP_UserDescReq( &destAddr, shortAddr, 0);
//  701 
//  702   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  703 }
//  704 
//  705 /***************************************************************************************************
//  706  * @fn      MT_ZdoEndDevAnnce
//  707  *
//  708  * @brief   Handle a End Device Announce Descriptor request.
//  709  *
//  710  * @param   pBuf  - MT message data
//  711  *
//  712  * @return  void
//  713  ***************************************************************************************************/
//  714 void MT_ZdoEndDevAnnce(uint8 *pBuf)
//  715 {
//  716   uint8 cmdId;
//  717   uint8 retValue;
//  718   uint16 shortAddr;
//  719   uint8 *pIEEEAddr;
//  720 
//  721   /* parse header */
//  722   cmdId = pBuf[MT_RPC_POS_CMD1];
//  723   pBuf += MT_RPC_FRAME_HDR_SZ;
//  724 
//  725   /* network address */
//  726   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  727   pBuf += 2;
//  728 
//  729   /* extended address */
//  730   pIEEEAddr = pBuf;
//  731   pBuf += Z_EXTADDR_LEN;
//  732 
//  733   retValue = (uint8)ZDP_DeviceAnnce( shortAddr, pIEEEAddr, *pBuf, 0);
//  734 
//  735   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  736 }
//  737 
//  738 /***************************************************************************************************
//  739  * @fn      MT_ZdoUserDescSet
//  740  *
//  741  * @brief   Handle a User Descriptor Set.
//  742  *
//  743  * @param   pBuf  - MT message data
//  744  *
//  745  * @return  void
//  746  ***************************************************************************************************/
//  747 void MT_ZdoUserDescSet(uint8 *pBuf)
//  748 {
//  749   uint8 cmdId;
//  750   uint8 retValue;
//  751   zAddrType_t destAddr;
//  752   uint16 shortAddr;
//  753   UserDescriptorFormat_t userDesc;
//  754 
//  755   /* parse header */
//  756   cmdId = pBuf[MT_RPC_POS_CMD1];
//  757   pBuf += MT_RPC_FRAME_HDR_SZ;
//  758 
//  759   /* Dev address */
//  760   destAddr.addrMode = Addr16Bit;
//  761   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  762   pBuf += 2;
//  763 
//  764   /* Network address of interest */
//  765   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  766   pBuf += 2;
//  767 
//  768   /* User descriptor */
//  769   userDesc.len = *pBuf++;
//  770   osal_memcpy( userDesc.desc, pBuf, userDesc.len );
//  771   pBuf += 16;
//  772 
//  773   retValue = (uint8)ZDP_UserDescSet( &destAddr, shortAddr, &userDesc, 0);
//  774 
//  775   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  776 }
//  777 
//  778 /***************************************************************************************************
//  779  * @fn      MT_ZdoServiceDiscRequest
//  780  *
//  781  * @brief   Handle a Server Discovery request.
//  782  *
//  783  * @param   pBuf  - MT message data
//  784  *
//  785  * @return  void
//  786  ***************************************************************************************************/
//  787 void MT_ZdoServiceDiscRequest(uint8 *pBuf)
//  788 {
//  789   uint8 cmdId;
//  790   uint8 retValue;
//  791   uint16 serviceMask;
//  792 
//  793   /* parse header */
//  794   cmdId = pBuf[MT_RPC_POS_CMD1];
//  795   pBuf += MT_RPC_FRAME_HDR_SZ;
//  796 
//  797   /* Service Mask */
//  798   serviceMask = BUILD_UINT16( pBuf[0], pBuf[1]);
//  799   pBuf += 2;
//  800 
//  801   retValue = (uint8)ZDP_ServerDiscReq( serviceMask, 0);
//  802 
//  803   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  804 }
//  805 
//  806 /***************************************************************************************************
//  807  * @fn      MT_ZdoEndDevBindRequest
//  808  *
//  809  * @brief   Handle a End Device Bind request.
//  810  *
//  811  * @param   pBuf  - MT message data
//  812  *
//  813  * @return  void
//  814  ***************************************************************************************************/
//  815 void MT_ZdoEndDevBindRequest(uint8 *pBuf)
//  816 {
//  817   uint8 cmdId;
//  818   uint8 retValue = 0;
//  819   uint8 i, epInt, numInClusters, numOutClusters;
//  820   zAddrType_t destAddr;
//  821   uint16 shortAddr;
//  822   uint16 profileID, inClusters[MTZDO_MAX_ED_BIND_CLUSTERS], outClusters[MTZDO_MAX_ED_BIND_CLUSTERS];
//  823 
//  824   /* parse header */
//  825   cmdId = pBuf[MT_RPC_POS_CMD1];
//  826   pBuf += MT_RPC_FRAME_HDR_SZ;
//  827 
//  828   /* Dev address */
//  829   destAddr.addrMode = Addr16Bit;
//  830   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  831   pBuf += 2;
//  832 
//  833   /* Local coordinator of the binding */
//  834   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  835   pBuf += 2;
//  836   
//  837   /* For now, skip past the extended address */
//  838   pBuf += Z_EXTADDR_LEN;
//  839 
//  840   /* Endpoint */
//  841   epInt = *pBuf++;
//  842 
//  843   /* Profile ID */
//  844   profileID = BUILD_UINT16( pBuf[0], pBuf[1] );
//  845   pBuf += 2;
//  846 
//  847   /* NumInClusters */
//  848   numInClusters = *pBuf++;
//  849   if ( numInClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
//  850   {
//  851     for ( i = 0; i < numInClusters; i++ )
//  852     {
//  853       inClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
//  854       pBuf += 2;
//  855     }
//  856   }
//  857   else
//  858     retValue = ZDP_INVALID_REQTYPE;
//  859 
//  860   /* NumOutClusters */
//  861   numOutClusters = *pBuf++;
//  862   if ( numOutClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
//  863   {
//  864     for ( i = 0; i < numOutClusters; i++ )
//  865     {
//  866       outClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
//  867       pBuf += 2;
//  868     }
//  869   }
//  870   else
//  871     retValue = ZDP_INVALID_REQTYPE;
//  872   
//  873   if ( retValue == 0 )
//  874   {
//  875     retValue = (uint8)ZDP_EndDeviceBindReq( &destAddr, shortAddr, epInt, profileID,
//  876                                           numInClusters, inClusters, numOutClusters, outClusters, 0);
//  877   }
//  878 
//  879   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  880 }
//  881 
//  882 /***************************************************************************************************
//  883  * @fn      MT_ZdoBindRequest
//  884  *
//  885  * @brief   Handle a Bind request.
//  886  *
//  887  * @param   pBuf  - MT message data
//  888  *
//  889  * @return  void
//  890  ***************************************************************************************************/
//  891 void MT_ZdoBindRequest(uint8 *pBuf)
//  892 {
//  893   uint8 cmdId;
//  894   uint8 retValue;
//  895   zAddrType_t destAddr, devAddr;
//  896   uint8 *pSrcAddr, *ptr;
//  897   uint8 srcEPInt, dstEPInt;
//  898   uint16 clusterID;
//  899 
//  900   /* parse header */
//  901   cmdId = pBuf[MT_RPC_POS_CMD1];
//  902   pBuf += MT_RPC_FRAME_HDR_SZ;
//  903 
//  904   /* Dev address */
//  905   destAddr.addrMode = Addr16Bit;
//  906   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  907   pBuf += 2;
//  908 
//  909   /* SrcAddress */
//  910   pSrcAddr = pBuf;
//  911   pBuf += Z_EXTADDR_LEN;
//  912 
//  913   /* SrcEPInt */
//  914   srcEPInt = *pBuf++;
//  915 
//  916   /* ClusterID */
//  917   clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
//  918   pBuf += 2;
//  919 
//  920   /* Destination Address mode */
//  921   devAddr.addrMode = *pBuf++;
//  922 
//  923   /* Destination Address */
//  924   if ( devAddr.addrMode == Addr64Bit )
//  925   {
//  926     ptr = pBuf;
//  927     osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
//  928   }
//  929   else
//  930   {
//  931     devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  932   }
//  933   /* The short address occupies LSB two bytes */
//  934   pBuf += Z_EXTADDR_LEN;
//  935 
//  936   /* DstEPInt */
//  937   dstEPInt = *pBuf;
//  938 
//  939   retValue = (uint8)ZDP_BindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
//  940 
//  941   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
//  942 }
//  943 
//  944 /***************************************************************************************************
//  945  * @fn      MT_ZdoUnbindRequest
//  946  *
//  947  * @brief   Handle a Unbind request.
//  948  *
//  949  * @param   pBuf  - MT message data
//  950  *
//  951  * @return  void
//  952  ***************************************************************************************************/
//  953 void MT_ZdoUnbindRequest(uint8 *pBuf)
//  954 {
//  955   uint8 cmdId;
//  956   uint8 retValue;
//  957   zAddrType_t destAddr, devAddr;
//  958   uint8 *pSrcAddr, *ptr;
//  959   uint8 srcEPInt, dstEPInt;
//  960   uint16 clusterID;
//  961 
//  962   /* parse header */
//  963   cmdId = pBuf[MT_RPC_POS_CMD1];
//  964   pBuf += MT_RPC_FRAME_HDR_SZ;
//  965 
//  966   /* dev address */
//  967   destAddr.addrMode = Addr16Bit;
//  968   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  969   pBuf += 2;
//  970 
//  971   /* SrcAddress */
//  972   pSrcAddr = pBuf;
//  973   pBuf += Z_EXTADDR_LEN;
//  974 
//  975   /* SrcEPInt */
//  976   srcEPInt = *pBuf++;
//  977 
//  978   /* ClusterID */
//  979   clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
//  980   pBuf += 2;
//  981 
//  982   /* Destination Address mode */
//  983   devAddr.addrMode = *pBuf++;
//  984 
//  985   /* Destination Address */
//  986   if ( devAddr.addrMode == Addr64Bit )
//  987   {
//  988     ptr = pBuf;
//  989     osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
//  990   }
//  991   else
//  992   {
//  993     devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
//  994   }
//  995   /* The short address occupies LSB two bytes */
//  996   pBuf += Z_EXTADDR_LEN;
//  997 
//  998   /* dstEPInt */
//  999   dstEPInt = *pBuf;
// 1000 
// 1001   retValue = (uint8)ZDP_UnbindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
// 1002 
// 1003   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1004 }
// 1005 
// 1006 /***************************************************************************************************
// 1007  * @fn      MT_ZdoSetLinkKey
// 1008  *
// 1009  * @brief   Set an application or trust center link key.
// 1010  *
// 1011  * @param   pBuf  - MT message data
// 1012  *
// 1013  * @return  void
// 1014  ***************************************************************************************************/
// 1015 void MT_ZdoSetLinkKey(uint8 *pBuf)
// 1016 {
// 1017   uint8 cmdId;
// 1018   uint8 retValue;
// 1019   uint8 *pExtAddr;
// 1020   uint8 *pKey;
// 1021   uint16 shortAddr;
// 1022   
// 1023   /* parse header */
// 1024   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1025   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1026 
// 1027   /* ShortAddr */
// 1028   shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1029   pBuf += 2;
// 1030   
// 1031   /* Extended Addr */
// 1032   pExtAddr = pBuf;
// 1033   pBuf += Z_EXTADDR_LEN;
// 1034   
// 1035   /* Key data */
// 1036   pKey = pBuf;
// 1037 
// 1038   retValue = (uint8)ZDSecMgrAddLinkKey( shortAddr, pExtAddr, pKey);
// 1039 
// 1040   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1041 }
// 1042 
// 1043 /***************************************************************************************************
// 1044  * @fn      MT_ZdoRemoveLinkKey
// 1045  *
// 1046  * @brief   Remove an application or trust center link key.
// 1047  *
// 1048  * @param   pBuf  - MT message data
// 1049  *
// 1050  * @return  void
// 1051  ***************************************************************************************************/
// 1052 void MT_ZdoRemoveLinkKey(uint8 *pBuf)
// 1053 {
// 1054   uint8 cmdId;
// 1055   uint8 retValue;
// 1056   uint8 *pExtAddr;
// 1057     
// 1058   /* parse header */
// 1059   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1060   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1061   
// 1062   /* ShortAddr */
// 1063   pExtAddr = pBuf;
// 1064 
// 1065   retValue = ZDSecMgrDeviceRemoveByExtAddr( pExtAddr );
// 1066 
// 1067   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1068 }
// 1069 
// 1070 /***************************************************************************************************
// 1071  * @fn      MT_ZdoGetLinkKey
// 1072  *
// 1073  * @brief   Get the application or trust center link key.
// 1074  *
// 1075  * @param   pBuf  - MT message data
// 1076  *
// 1077  * @return  void
// 1078  ***************************************************************************************************/
// 1079 void MT_ZdoGetLinkKey(uint8 *pBuf)
// 1080 {
// 1081   uint8 cmdId;
// 1082   uint8 retValue;
// 1083   uint8 *pExtAddr;
// 1084   uint8 *retBuf;
// 1085   uint8 len;
// 1086   APSME_LinkKeyData_t *pLinkKey;
// 1087     
// 1088   /* parse header */
// 1089   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1090   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1091   
// 1092   /* Extended Address */
// 1093   pExtAddr = pBuf;
// 1094 
// 1095   /* Fetch the key data */
// 1096   retValue = APSME_LinkKeyDataGet( pExtAddr, &pLinkKey );
// 1097   
// 1098   /* Construct the response message */
// 1099   len = 1 + Z_EXTADDR_LEN + SEC_KEY_LEN; // status + extAddr + key
// 1100   if ( ( retBuf = osal_mem_alloc( len ) ) == NULL )
// 1101   {
// 1102     retValue = ZMemError;
// 1103   }
// 1104   else
// 1105   {  
// 1106     if( retValue == ZSuccess )
// 1107     {
// 1108       /* Extended Address */
// 1109       osal_memcpy( &(retBuf[1]), pExtAddr, Z_EXTADDR_LEN );
// 1110       
// 1111       /* Key data */
// 1112       osal_memcpy( &(retBuf[1 + Z_EXTADDR_LEN]), pLinkKey->key, SEC_KEY_LEN );      
// 1113     }
// 1114   }
// 1115     
// 1116   if( retValue != ZSuccess )
// 1117   {
// 1118     /* Failed case - set the rest fields to all FF */
// 1119     osal_memset( &(retBuf[1]), 0xFF, Z_EXTADDR_LEN + SEC_KEY_LEN );   
// 1120   }    
// 1121   
// 1122   retBuf[0] = retValue;  /* Status */
// 1123   
// 1124   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, len, retBuf);
// 1125   
// 1126   return;
// 1127 }
// 1128 
// 1129 #if defined (MT_ZDO_MGMT)
// 1130 /***************************************************************************************************
// 1131  * @fn      MT_ZdoMgmtNwkDiscRequest
// 1132  *
// 1133  * @brief   Handle a Mgmt Nwk Discovery request.
// 1134  *
// 1135  * @param   pBuf  - MT message data
// 1136  *
// 1137  * @return  void
// 1138  ***************************************************************************************************/
// 1139 void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf)
// 1140 {
// 1141   uint8 cmdId;
// 1142   uint8 retValue;
// 1143   zAddrType_t destAddr;
// 1144   uint32 scanChannels;
// 1145   uint8 scanDuration, startIndex;
// 1146 
// 1147   /* parse header */
// 1148   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1149   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1150 
// 1151   /* Dev address */
// 1152   destAddr.addrMode = Addr16Bit;
// 1153   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1154   pBuf += 2;
// 1155 
// 1156   /* Scan Channels */
// 1157   scanChannels = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3] );
// 1158   pBuf += 4;
// 1159 
// 1160   /* Scan Duration */
// 1161   scanDuration = *pBuf++;
// 1162 
// 1163   /* Start Index */
// 1164   startIndex = *pBuf;
// 1165 
// 1166   retValue = (uint8)ZDP_MgmtNwkDiscReq( &destAddr, scanChannels, scanDuration, startIndex, 0);
// 1167 
// 1168   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1169 }
// 1170 
// 1171 /***************************************************************************************************
// 1172  * @fn      MT_ZdoMgmtLqiRequest
// 1173  *
// 1174  * @brief   Handle a Mgmt Lqi request.
// 1175  *
// 1176  * @param   pBuf  - MT message data
// 1177  *
// 1178  * @return  void
// 1179  ***************************************************************************************************/
// 1180 void MT_ZdoMgmtLqiRequest(uint8 *pBuf)
// 1181 {
// 1182   uint8 cmdId;
// 1183   uint8 retValue;
// 1184   zAddrType_t destAddr;
// 1185   uint8 startIndex;
// 1186 
// 1187   /* parse header */
// 1188   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1189   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1190 
// 1191   /* Dev address */
// 1192   destAddr.addrMode = Addr16Bit;
// 1193   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1194   pBuf += 2;
// 1195 
// 1196   /* Start Index */
// 1197   startIndex = *pBuf;
// 1198 
// 1199   retValue = (uint8)ZDP_MgmtLqiReq( &destAddr, startIndex, 0);
// 1200 
// 1201   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1202 }
// 1203 
// 1204 /***************************************************************************************************
// 1205  * @fn      MT_ZdoMgmtRtgRequest
// 1206  *
// 1207  * @brief   Handle a Mgmt Rtg request.
// 1208  *
// 1209  * @param   pBuf  - MT message data
// 1210  *
// 1211  * @return  void
// 1212  ***************************************************************************************************/
// 1213 void MT_ZdoMgmtRtgRequest(uint8 *pBuf)
// 1214 {
// 1215   uint8 cmdId;
// 1216   uint8 retValue;
// 1217   zAddrType_t destAddr;
// 1218   uint8 startIndex;
// 1219 
// 1220   /* parse header */
// 1221   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1222   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1223 
// 1224   /* Dev Address */
// 1225   destAddr.addrMode = Addr16Bit;
// 1226   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
// 1227   pBuf += 2;
// 1228 
// 1229   /* Start Index */
// 1230   startIndex = *pBuf;
// 1231 
// 1232   retValue = (byte)ZDP_MgmtRtgReq( &destAddr, startIndex, 0);
// 1233 
// 1234   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1235 }
// 1236 
// 1237 /***************************************************************************************************
// 1238  * @fn      MT_ZdoMgmtBindRequest
// 1239  *
// 1240  * @brief   Handle a Mgmt Bind request.
// 1241  *
// 1242  * @param   pBuf  - MT message data
// 1243  *
// 1244  * @return  void
// 1245  ***************************************************************************************************/
// 1246 void MT_ZdoMgmtBindRequest(uint8 *pBuf)
// 1247 {
// 1248   uint8 cmdId;
// 1249   uint8 retValue;
// 1250   zAddrType_t destAddr;
// 1251   uint8 startIndex;
// 1252 
// 1253   /* parse header */
// 1254   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1255   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1256 
// 1257   /* Dev Address */
// 1258   destAddr.addrMode = Addr16Bit;
// 1259   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1260   pBuf += 2;
// 1261 
// 1262   /* Start Index */
// 1263   startIndex = *pBuf;
// 1264 
// 1265   retValue = (uint8)ZDP_MgmtBindReq( &destAddr, startIndex, 0);
// 1266 
// 1267   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1268 }
// 1269 
// 1270 /***************************************************************************************************
// 1271  * @fn      MT_ZdoMgmtLeaveRequest
// 1272  *
// 1273  * @brief   Handle a Mgmt Leave request.
// 1274  *
// 1275  * @param   pBuf  - MT message data
// 1276  *
// 1277  * @return  void
// 1278  ***************************************************************************************************/
// 1279 void MT_ZdoMgmtLeaveRequest(uint8 *pBuf)
// 1280 {
// 1281   uint8 cmdId;
// 1282   uint8 retValue;
// 1283   zAddrType_t destAddr;
// 1284   uint8 *pIEEEAddr;
// 1285   uint8 removeChildren, rejoin;
// 1286 
// 1287   /* parse header */
// 1288   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1289   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1290 
// 1291   /* Destination Address */
// 1292   destAddr.addrMode = Addr16Bit;
// 1293   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1294   pBuf += 2;
// 1295 
// 1296   /* IEEE address */
// 1297   pIEEEAddr = pBuf;
// 1298   pBuf += Z_EXTADDR_LEN;
// 1299 
// 1300   /* Remove Children */
// 1301   removeChildren = *pBuf++;
// 1302 
// 1303   /* Rejoin */
// 1304   rejoin = *pBuf;
// 1305 
// 1306   retValue = (byte)ZDP_MgmtLeaveReq( &destAddr, pIEEEAddr, removeChildren, rejoin, 0);
// 1307 
// 1308   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1309 }
// 1310 
// 1311 
// 1312 /***************************************************************************************************
// 1313  * @fn      MT_ZdoMgmtDirectJoinRequest
// 1314  *
// 1315  * @brief   Handle a Mgmt Direct Join request.
// 1316  *
// 1317  * @param   pBuf  - MT message data
// 1318  *
// 1319  * @return  void
// 1320  ***************************************************************************************************/
// 1321 void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf)
// 1322 {
// 1323   uint8 cmdId;
// 1324   uint8 retValue;
// 1325   zAddrType_t destAddr;
// 1326   uint8 *deviceAddr;
// 1327   uint8 capInfo;
// 1328 
// 1329   /* parse header */
// 1330   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1331   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1332 
// 1333   /* Destination Address */
// 1334   destAddr.addrMode = Addr16Bit;
// 1335   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1336   pBuf += 2;
// 1337 
// 1338   /* Device Address */
// 1339   deviceAddr = pBuf;
// 1340   pBuf += Z_EXTADDR_LEN;
// 1341 
// 1342   /* Capability information */
// 1343   capInfo = *pBuf;
// 1344 
// 1345   retValue = (uint8)ZDP_MgmtDirectJoinReq( &destAddr, deviceAddr, capInfo, 0);
// 1346 
// 1347   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1348 }
// 1349 
// 1350 /***************************************************************************************************
// 1351  * @fn      MT_ZdoMgmtPermitJoinRequest
// 1352  *
// 1353  * @brief   Handle a Mgmt Permit Join request.
// 1354  *
// 1355  * @param   pBuf  - MT message data
// 1356  *
// 1357  * @return  void
// 1358  ***************************************************************************************************/
// 1359 void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf)
// 1360 {
// 1361   uint8 cmdId;
// 1362   uint8 retValue;
// 1363   zAddrType_t destAddr;
// 1364   uint8 duration, tcSignificance;
// 1365 
// 1366   /* parse header */
// 1367   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1368   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1369 
// 1370   /* Destination Address */
// 1371   destAddr.addrMode = Addr16Bit;
// 1372   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1373   pBuf += 2;
// 1374 
// 1375   /* Duration */
// 1376   duration = *pBuf++;
// 1377 
// 1378   /* Trust center significance */
// 1379   tcSignificance = *pBuf;
// 1380 
// 1381   retValue = (byte)ZDP_MgmtPermitJoinReq( &destAddr, duration, tcSignificance, 0);
// 1382 
// 1383   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1384 }
// 1385 
// 1386 /***************************************************************************************************
// 1387  * @fn      MT_ZdoMgmtNwkUpdateRequest
// 1388  *
// 1389  * @brief   Handle a Mgmt Nwk Update request.
// 1390  *
// 1391  * @param   pBuf  - MT message data
// 1392  *
// 1393  * @return  void
// 1394  ***************************************************************************************************/
// 1395 void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf)
// 1396 {
// 1397   uint8 cmdId;
// 1398   uint8 retValue;
// 1399   zAddrType_t destAddr;
// 1400   uint32 channelMask;
// 1401   uint8 scanDuration, scanCount;
// 1402   uint16 nwkManagerAddr;
// 1403 
// 1404     /* parse header */
// 1405   cmdId = pBuf[MT_RPC_POS_CMD1];
// 1406   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1407 
// 1408   /* Destination address */
// 1409   destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1410   pBuf += 2;
// 1411 
// 1412   /* Destination address mode */
// 1413   destAddr.addrMode = *pBuf++;
// 1414 
// 1415   channelMask = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3]);
// 1416   pBuf += 4;
// 1417 
// 1418   /* Scan duration */
// 1419   scanDuration = *pBuf++;
// 1420 
// 1421   /* Scan count */
// 1422   scanCount = *pBuf++;
// 1423 
// 1424   /* NWK manager address */
// 1425   nwkManagerAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
// 1426 
// 1427   /* Send the Management Network Update request */
// 1428   retValue = (uint8)ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
// 1429                                           scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
// 1430 
// 1431   /*
// 1432     Since we don't recevied our own broadcast messages, we should
// 1433     send a unicast copy of the message to ourself.
// 1434   */
// 1435   if ( destAddr.addrMode == AddrBroadcast )
// 1436   {
// 1437     destAddr.addrMode = Addr16Bit;
// 1438     destAddr.addr.shortAddr = _NIB.nwkDevAddress;
// 1439     retValue = (uint8) ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
// 1440                                              scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
// 1441   }
// 1442 
// 1443   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
// 1444 }
// 1445 #endif /* MT_ZDO_MGMT */
// 1446 
// 1447 /***************************************************************************************************
// 1448  * @fn      MT_ZdoStartupFromApp
// 1449  *
// 1450  * @brief   Handle a Startup from App request.
// 1451  *
// 1452  * @param   pBuf  - MT message data
// 1453  *
// 1454  * @return  void
// 1455  ***************************************************************************************************/
// 1456 void MT_ZdoStartupFromApp(uint8 *pBuf)
// 1457 {
// 1458   uint8 cmd0, cmd1, retValue;
// 1459 
// 1460   /* parse header */
// 1461   cmd0 = pBuf[MT_RPC_POS_CMD0];
// 1462   cmd1 = pBuf[MT_RPC_POS_CMD1];
// 1463   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1464 
// 1465   retValue = ZDOInitDevice(100);
// 1466 
// 1467   if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
// 1468   {
// 1469     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1,1, &retValue);
// 1470   }
// 1471 }
// 1472 
// 1473 /*************************************************************************************************
// 1474  * @fn      MT_ZdoRegisterForZDOMsg(pBuf);
// 1475  *
// 1476  * @brief   MT proxy for ZDO_RegisterForZDOMsg.
// 1477  *
// 1478  * @param   pBuf  - MT message data
// 1479  *
// 1480  * @return  void
// 1481  *************************************************************************************************/
// 1482 void MT_ZdoRegisterForZDOMsg(uint8 *pBuf)
// 1483 {
// 1484   uint8 cmd0, cmd1, tmp;
// 1485   uint16 cId;
// 1486 
// 1487   /* parse header */
// 1488   cmd0 = pBuf[MT_RPC_POS_CMD0];
// 1489   cmd1 = pBuf[MT_RPC_POS_CMD1];
// 1490   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1491 
// 1492   cId = BUILD_UINT16(pBuf[0], pBuf[1]);
// 1493   tmp = ZDO_RegisterForZDOMsg(MT_TaskID, cId);
// 1494 
// 1495   if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
// 1496   {
// 1497     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1, 1, &tmp);
// 1498   }
// 1499 }
// 1500 
// 1501 /*************************************************************************************************
// 1502  * @fn      MT_ZdoRemoveRegisteredCB(pBuf);
// 1503  *
// 1504  * @brief   MT proxy for ZDO_RemoveRegisteredCB.
// 1505  *
// 1506  * @param   pBuf  - MT message data
// 1507  *
// 1508  * @return  void
// 1509  *************************************************************************************************/
// 1510 void MT_ZdoRemoveRegisteredCB(uint8 *pBuf)
// 1511 {
// 1512   uint8 cmd0, cmd1, tmp;
// 1513   uint16 cId;
// 1514 
// 1515   /* parse header */
// 1516   cmd0 = pBuf[MT_RPC_POS_CMD0];
// 1517   cmd1 = pBuf[MT_RPC_POS_CMD1];
// 1518   pBuf += MT_RPC_FRAME_HDR_SZ;
// 1519 
// 1520   cId = BUILD_UINT16(pBuf[0], pBuf[1]);
// 1521   tmp = ZDO_RemoveRegisteredCB(MT_TaskID, cId);
// 1522 
// 1523   if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
// 1524   {
// 1525     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1, 1, &tmp);
// 1526   }
// 1527 }
// 1528 
// 1529 #endif /* MT_ZDO_FUNC */
// 1530 
// 1531 
// 1532 /***************************************************************************************************
// 1533  * Callback handling function
// 1534  ***************************************************************************************************/
// 1535 
// 1536 #if defined (MT_ZDO_CB_FUNC)
// 1537 
// 1538 /***************************************************************************************************
// 1539  * @fn      MT_ZdoStateChangeCB
// 1540  *
// 1541  * @brief   Handle state change OSAL message from ZDO.
// 1542  *
// 1543  * @param   pMsg  - Message data
// 1544  *
// 1545  * @return  void
// 1546  */
// 1547 void MT_ZdoStateChangeCB(osal_event_hdr_t *pMsg)
// 1548 {
// 1549   MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
// 1550                                        MT_ZDO_STATE_CHANGE_IND, 1, &pMsg->status);
// 1551 }
// 1552 
// 1553 /***************************************************************************************************
// 1554  * @fn     MT_ZdoDirectCB()
// 1555  *
// 1556  * @brief  ZDO direct callback.  Build an MT message directly from the
// 1557  *         over-the-air ZDO message.
// 1558  *
// 1559  * @param  pData - Incoming AF frame.
// 1560  *
// 1561  * @return  none
// 1562  ***************************************************************************************************/
// 1563 void MT_ZdoDirectCB( afIncomingMSGPacket_t *pData,  zdoIncomingMsg_t *inMsg )
// 1564 {
// 1565   uint8 len, *pBuf;
// 1566   
// 1567   // Is the message an exception or not a response?
// 1568   if ( MT_ZdoHandleExceptions( pData, inMsg ) || ( (pData->clusterId & ZDO_RESPONSE_BIT) == 0 ) )
// 1569   {
// 1570     return;  // Handled somewhere else or not needed.
// 1571   }
// 1572 
// 1573   /* ZDO data starts after one-byte sequence number and the msg buffer length includes
// 1574    * two bytes for srcAddr.
// 1575    */
// 1576   len = pData->cmd.DataLength - 1 + sizeof(uint16);
// 1577 
// 1578   if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
// 1579   {
// 1580     uint8 id = MT_ZDO_CID_TO_AREQ_ID(pData->clusterId);
// 1581 
// 1582     pBuf[0] = LO_UINT16(pData->srcAddr.addr.shortAddr);
// 1583     pBuf[1] = HI_UINT16(pData->srcAddr.addr.shortAddr);
// 1584 
// 1585     /* copy ZDO data, skipping one-byte sequence number */
// 1586     osal_memcpy(pBuf+2, (pData->cmd.Data + 1), pData->cmd.DataLength-1);
// 1587 
// 1588     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), id, len, pBuf);
// 1589     osal_mem_free(pBuf);
// 1590   }
// 1591 }
// 1592 
// 1593 /***************************************************************************************************
// 1594  * @fn     MT_ZdoHandleExceptions()
// 1595  *
// 1596  * @brief  Handles all messages that are an expection to the generic MT ZDO Response.
// 1597  *
// 1598  * @param  pData - Incoming AF frame.
// 1599  *
// 1600  * @return  TRUE if handled by this function, FALSE if not
// 1601  ***************************************************************************************************/
// 1602 uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg )
// 1603 {
// 1604   uint8 ret = TRUE;
// 1605   ZDO_NwkIEEEAddrResp_t *nwkRsp = NULL;
// 1606   ZDO_DeviceAnnce_t devAnnce;
// 1607   uint8 doDefault = FALSE;
// 1608   
// 1609   switch ( inMsg->clusterID )
// 1610   {
// 1611     case NWK_addr_rsp:
// 1612     case IEEE_addr_rsp:
// 1613       nwkRsp = ZDO_ParseAddrRsp( inMsg );
// 1614       MT_ZdoAddrRspCB( nwkRsp, inMsg->clusterID );
// 1615       if ( nwkRsp )
// 1616         osal_mem_free( nwkRsp );
// 1617       break;
// 1618       
// 1619     case Device_annce:
// 1620       ZDO_ParseDeviceAnnce( inMsg, &devAnnce );
// 1621       MT_ZdoEndDevAnnceCB( &devAnnce, inMsg->srcAddr.addr.shortAddr );
// 1622       break;
// 1623       
// 1624     case Simple_Desc_rsp:
// 1625       if ( pData->cmd.DataLength > 5 )
// 1626         ret = FALSE;
// 1627       else
// 1628         doDefault = TRUE;        
// 1629       break;  
// 1630       
// 1631     default:
// 1632       ret = FALSE;
// 1633       break;
// 1634   }
// 1635   
// 1636   if ( doDefault )
// 1637   {
// 1638     ret = FALSE;
// 1639     pData->clusterId = MtZdoDef_rsp;
// 1640     pData->cmd.DataLength = 2;
// 1641   }
// 1642 
// 1643   return ( ret );
// 1644 }
// 1645 
// 1646 /***************************************************************************************************
// 1647  * @fn      MT_ZdoAddrRspCB
// 1648  *
// 1649  * @brief   Handle IEEE or nwk address response OSAL message from ZDO.
// 1650  *
// 1651  * @param   pMsg  - Message data
// 1652  *
// 1653  * @return  void
// 1654  */
// 1655 void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID )
// 1656 {
// 1657   uint8   listLen, len, *pBuf;
// 1658 
// 1659   /* both ZDO_NwkAddrResp_t and ZDO_IEEEAddrResp_t must be the same */
// 1660 
// 1661   /* get length, sanity check length */
// 1662   listLen = pMsg->numAssocDevs;
// 1663   
// 1664   /* calculate msg length */
// 1665   len = MT_ZDO_ADDR_RSP_LEN + (listLen * sizeof(uint16));
// 1666 
// 1667   /* get buffer */
// 1668   if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
// 1669   {
// 1670     uint8 id = MT_ZDO_CID_TO_AREQ_ID(clusterID);
// 1671     uint8 *pTmp = pBuf;
// 1672 
// 1673     *pTmp++ = pMsg->status;
// 1674 
// 1675     osal_cpyExtAddr(pTmp, pMsg->extAddr);
// 1676     pTmp += Z_EXTADDR_LEN;
// 1677 
// 1678     *pTmp++ = LO_UINT16(pMsg->nwkAddr);
// 1679     *pTmp++ = HI_UINT16(pMsg->nwkAddr);
// 1680 
// 1681     *pTmp++ = pMsg->startIndex;
// 1682     *pTmp++ = listLen;
// 1683 
// 1684     MT_Word2Buf(pTmp, pMsg->devList, listLen);
// 1685 
// 1686     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), id, len, pBuf);
// 1687     osal_mem_free(pBuf);
// 1688   }
// 1689 }
// 1690 
// 1691 /***************************************************************************************************
// 1692  * @fn      MT_ZdoEndDevAnnceCB
// 1693  *
// 1694  * @brief   Handle end device announce OSAL message from ZDO.
// 1695  *
// 1696  * @param   pMsg  - Message data
// 1697  *
// 1698  * @return  void
// 1699  */
// 1700 void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr )
// 1701 {
// 1702   uint8 *pBuf;
// 1703 
// 1704   if (NULL != (pBuf = (uint8 *)osal_mem_alloc(MT_ZDO_END_DEVICE_ANNCE_IND_LEN)))
// 1705   {
// 1706     uint8 *pTmp = pBuf;
// 1707 
// 1708     *pTmp++ = LO_UINT16(srcAddr);
// 1709     *pTmp++ = HI_UINT16(srcAddr);
// 1710 
// 1711     *pTmp++ = LO_UINT16(pMsg->nwkAddr);
// 1712     *pTmp++ = HI_UINT16(pMsg->nwkAddr);
// 1713 
// 1714     osal_cpyExtAddr(pTmp, pMsg->extAddr);
// 1715     pTmp += Z_EXTADDR_LEN;
// 1716 
// 1717     *pTmp = pMsg->capabilities;
// 1718 
// 1719     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), 
// 1720                                          MT_ZDO_END_DEVICE_ANNCE_IND, 
// 1721                                          MT_ZDO_END_DEVICE_ANNCE_IND_LEN, pBuf);
// 1722     osal_mem_free(pBuf);
// 1723   }
// 1724 }
// 1725 
// 1726 /***************************************************************************************************
// 1727  * @fn      MT_ZdoSrcRtgCB
// 1728  *
// 1729  * @brief   Handle Src Route from ZDO.
// 1730  *
// 1731  * @param   pStr  - pointer to the data structure for the src route
// 1732  *
// 1733  * @return  void* 
// 1734  */
// 1735 void* MT_ZdoSrcRtgCB( void *pStr )
// 1736 {
// 1737   uint8 len, *pBuf;
// 1738   zdoSrcRtg_t *pSrcRtg = pStr;
// 1739   
// 1740   // srcAddr (2) + relayCnt (1) + relayList( relaycnt * 2 )
// 1741   len = 2 + 1 + pSrcRtg->relayCnt * sizeof(uint16);
// 1742 
// 1743   if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
// 1744   {
// 1745     uint8 idx, *pTmp = pBuf;
// 1746     uint16 *pRelay;
// 1747 
// 1748     // Packet payload
// 1749     *pTmp++ = LO_UINT16(pSrcRtg->srcAddr);
// 1750     *pTmp++ = HI_UINT16(pSrcRtg->srcAddr);
// 1751     *pTmp++ = pSrcRtg->relayCnt;
// 1752     
// 1753     // Relay List
// 1754     if( ( pRelay = pSrcRtg->pRelayList ) != NULL )
// 1755     {
// 1756       for( idx = 0; idx < pSrcRtg->relayCnt; idx ++ )
// 1757       {
// 1758         *pTmp++ = LO_UINT16(*pRelay);
// 1759         *pTmp++ = HI_UINT16(*pRelay);
// 1760         pRelay++;
// 1761       }
// 1762     }
// 1763     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
// 1764                                          MT_ZDO_SRC_RTG_IND, len, pBuf);
// 1765     osal_mem_free(pBuf);
// 1766   }
// 1767   
// 1768   return NULL;
// 1769 }
// 1770 #endif // MT_ZDO_CB_FUNC
// 1771 
// 1772 /***************************************************************************************************
// 1773  * @fn      MT_ZdoSendMsgCB
// 1774  *
// 1775  * @brief   Proxy the ZDO_SendMsgCBs one message at a time.
// 1776  *
// 1777  * @param   pMsg  - Message data
// 1778  *
// 1779  * @return  void
// 1780  */
// 1781 void MT_ZdoSendMsgCB(zdoIncomingMsg_t *pMsg)
// 1782 {
// 1783   uint8 len = pMsg->asduLen + 9;
// 1784   uint8 *pBuf = (uint8 *)osal_mem_alloc(len);
// 1785 
// 1786   if (pBuf != NULL)
// 1787   {
// 1788     uint8 *pTmp = pBuf;
// 1789 
// 1790     // Assuming exclusive use of network short addresses.
// 1791     *pTmp++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
// 1792     *pTmp++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
// 1793     *pTmp++ = pMsg->wasBroadcast;
// 1794     *pTmp++ = LO_UINT16(pMsg->clusterID);
// 1795     *pTmp++ = HI_UINT16(pMsg->clusterID);
// 1796     *pTmp++ = pMsg->SecurityUse;
// 1797     *pTmp++ = pMsg->TransSeq;
// 1798     // Skipping asduLen since it can be deduced from the RPC packet length.
// 1799     *pTmp++ = LO_UINT16(pMsg->macDestAddr);
// 1800     *pTmp++ = HI_UINT16(pMsg->macDestAddr);
// 1801     (void)osal_memcpy(pTmp, pMsg->asdu, pMsg->asduLen);
// 1802 
// 1803     MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
// 1804                                          MT_ZDO_MSG_CB_INCOMING, len, pBuf);
// 1805   }
// 1806 }
// 1807 
// 1808 #endif   /*ZDO Command Processing in MT*/
// 1809 /***************************************************************************************************
// 1810 ***************************************************************************************************/
// 
// 
// 0 bytes of memory
//
//Errors: none
//Warnings: none
