###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                08/Jun/2010  11:32:55 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\ZStack-CC2530-2.3.0-1.4.0\Components\zmac\f8 #
#                          w\zmac.c                                           #
#    Command line       =  -f "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\Tools\CC2530DB\f8wRouter.cfg"          #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE -DRTR_NWK         #
#                          -DBLINK_LEDS) -f "D:\µ{¦¡¶}µo\TI Zigbee            #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"          #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Components\zmac\f #
#                          8w\zmac.c" -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC   #
#                          -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC          #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\RouterKB\List\" -lA      #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\RouterKB\List\"          #
#                          --diag_suppress Pe001,Pa010 -o "D:\µ{¦¡¶}µo\TI     #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\RouterKB\Obj\" -e --require_prototypes   #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\µ{¦¡¶}µo\TI Zigbee                          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\" -I "D:\µ{¦¡¶}µo\TI Zigbee                     #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\SOURCE\" -I "D:\µ{¦¡¶}µo\TI Zigbee           #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\ZMAIN\TI2530DB\" -I "D:\µ{¦¡¶}µo\TI    #
#                          Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC #
#                          2530-2.3.0-1.4.0\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I        #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\HAL\INCLUDE\" -I "D:\µ{¦¡¶}µo\TI Zigbee          #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\" #
#                           -I "D:\µ{¦¡¶}µo\TI Zigbee                         #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\" -I   #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\OSAL\INCLUDE\" -I "D:\µ{¦¡¶}µo\TI Zigbee         #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\STACK\AF\" -I         #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\STACK\NWK\" -I "D:\µ{¦¡¶}µo\TI Zigbee            #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" -I        #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\STACK\SAPI\" -I "D:\µ{¦¡¶}µo\TI Zigbee           #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" -I        #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\STACK\ZDO\" -I "D:\µ{¦¡¶}µo\TI Zigbee            #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\" -I         #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\ZMAC\" -I "D:\µ{¦¡¶}µo\TI Zigbee                 #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\" -I   #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\SERVICES\SDATA\" -I "D:\µ{¦¡¶}µo\TI Zigbee       #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\" -I      #
#                          "D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0 #
#                          -1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\COMPONENT #
#                          S\MAC\HIGH_LEVEL\" -I "D:\µ{¦¡¶}µo\TI Zigbee       #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\" #
#                           -I "D:\µ{¦¡¶}µo\TI Zigbee                         #
#                          Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2. #
#                          3.0-1.4.0\Projects\zstack\Samples\SampleApp\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\S #
#                          INGLE_CHIP\" -I "C:\IAR Systems\Embedded           #
#                          Workbench 5.3\8051\INC\" -I "C:\IAR                #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Sa #
#                          mples\SampleApp\CC2530DB\RouterKB\List\zmac.lst    #
#    Object file        =  D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0- #
#                          1.4.0\ZStack-CC2530-2.3.0-1.4.0\Projects\zstack\Sa #
#                          mples\SampleApp\CC2530DB\RouterKB\Obj\zmac.r51     #
#                                                                             #
#                                                                             #
###############################################################################

D:\µ{¦¡¶}µo\TI Zigbee Z-Stack\ZStack-CC2530-2.3.0-1.4.0\ZStack-CC2530-2.3.0-1.4.0\Components\zmac\f8w\zmac.c
      1          /**************************************************************************************************
      2            Filename:       zmac.c
      3            Revised:        $Date: 2010-01-08 14:36:19 -0800 (Fri, 08 Jan 2010) $
      4            Revision:       $Revision: 21466 $
      5          
      6          
      7            Description:    This file contains the ZStack MAC Porting Layer
      8          
      9          
     10            Copyright 2005-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /********************************************************************************************************
     42           *                                               INCLUDES
     43           ********************************************************************************************************/
     44          
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "ZMAC.h"
     48          #include "mac_main.h"
     49          #include "ssp.h"
     50          #include "hal_lcd.h"
     51          
     52          #if !defined NONWK
     53            #include "ZGlobals.h"
     54          #endif
     55          
     56          /********************************************************************************************************
     57           *                                                 MACROS
     58           ********************************************************************************************************/
     59          
     60          /********************************************************************************************************
     61           *                                               CONSTANTS
     62           ********************************************************************************************************/
     63          
     64          /********************************************************************************************************
     65           *                                               GLOBALS
     66           ********************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     67          uint32 _ScanChannels;
   \                     _ScanChannels:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
     68          
     69          extern uint8 aExtendedAddress[];
     70          
     71          /**************************************************************************************************
     72           * @fn          MAC_SetRandomSeedCB
     73           *
     74           * @brief       MAC function: Set the function pointer for the random seed callback.
     75           *
     76           * input parameters
     77           *
     78           * @param       pCBFcn - function pointer of the random seed callback
     79           *
     80           * output parameters
     81           *
     82           * None.
     83           *
     84           * @return      none
     85           **************************************************************************************************
     86           */
     87          extern void MAC_SetRandomSeedCB(macRNGFcn_t pCBFcn);
     88          /********************************************************************************************************
     89           *                                               LOCALS
     90           ********************************************************************************************************/
     91          
     92          /* Pointer to scan result buffer */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     93          void *ZMac_ScanBuf = NULL;
   \                     ZMac_ScanBuf:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     94          
     95          /********************************************************************************************************
     96           * LOCAL FUNCTION PROTOTYPES
     97           ********************************************************************************************************/
     98          
     99          /********************************************************************************************************
    100           *                                                TYPEDEFS
    101           ********************************************************************************************************/
    102          
    103          
    104          /********************************************************************************************************
    105           *                                                FUNCTIONS
    106           ********************************************************************************************************/
    107          
    108          /********************************************************************************************************
    109           * @fn      ZMacInit
    110           *
    111           * @brief   Initialize MAC.
    112           *
    113           * @param   none.
    114           *
    115           * @return  status.
    116           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    117          uint8 ZMacInit( void )
   \                     ZMacInit:
    118          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    119            uint8 stat;
    120          
    121          #if defined( ZCL_KEY_ESTABLISH )
    122            /* Set the callback function for 16 byte random seed */
    123            MAC_SetRandomSeedCB( SSP_StoreRandomSeedNV);
    124          #endif
    125            
    126            MAC_Init();
   \   000005                ; Setup parameters for call to function MAC_Init
   \   000005   12....       LCALL   ??MAC_Init?relay
    127            MAC_InitDevice();
   \   000008                ; Setup parameters for call to function MAC_InitDevice
   \   000008   12....       LCALL   ??MAC_InitDevice?relay
    128          
    129          #if !defined NONWK
    130            if ( ZG_BUILD_RTR_TYPE )
    131            {
    132              MAC_InitCoord();
   \   00000B                ; Setup parameters for call to function MAC_InitCoord
   \   00000B   12....       LCALL   ??MAC_InitCoord?relay
    133            }
    134          #endif
    135          
    136            // If OK, initialize the MAC
    137            stat = ZMacReset( TRUE );
   \   00000E                ; Setup parameters for call to function ZMacReset
   \   00000E   7901         MOV     R1,#0x1
   \   000010   12....       LCALL   ??ZMacReset?relay
   \   000013   E9           MOV     A,R1
   \   000014   FE           MOV     R6,A
    138          
    139            // Turn off interrupts
    140            osal_int_disable( INTS_ALL );
   \   000015                ; Setup parameters for call to function osal_int_disable
   \   000015   79FF         MOV     R1,#-0x1
   \   000017   12....       LCALL   ??osal_int_disable?relay
    141          
    142            return ( stat );
   \   00001A   EE           MOV     A,R6
   \   00001B   F9           MOV     R1,A
   \   00001C   80..         SJMP    ??Subroutine9_0
    143          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    144          
    145          /********************************************************************************************************
    146           * @fn      ZMacReset
    147           *
    148           * @brief   Reset the MAC.
    149           *
    150           * @param   Default to PIB defaults.
    151           *
    152           * @return  status.
    153           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7401         MOV     A,#0x1
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005                REQUIRE ??Subroutine9_0
   \   000005                ; // Fall through to label ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    154          uint8 ZMacReset( bool SetDefaultPIB )
   \                     ZMacReset:
    155          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    156            byte stat;
    157            byte value;
    158          
    159            stat = MAC_MlmeResetReq( SetDefaultPIB );
   \   00000A                ; Setup parameters for call to function MAC_MlmeResetReq
   \   00000A   12....       LCALL   ??MAC_MlmeResetReq?relay
   \   00000D   E9           MOV     A,R1
   \   00000E   FE           MOV     R6,A
    160          
    161            // Don't send PAN ID conflict
    162            value = FALSE;
   \   00000F   E4           CLR     A
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    163            MAC_MlmeSetReq( MAC_ASSOCIATED_PAN_COORD, &value );
   \   000017                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000017   AA82         MOV     R2,DPL
   \   000019   AB83         MOV     R3,DPH
   \   00001B   7956         MOV     R1,#0x56
   \   00001D   12....       LCALL   ??MAC_MlmeSetReq?relay
    164            MAC_MlmeSetReq( MAC_EXTENDED_ADDRESS, &aExtendedAddress );
   \   000020                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000020   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000022   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000024   79E2         MOV     R1,#-0x1e
   \   000026   12....       LCALL   ??MAC_MlmeSetReq?relay
    165          
    166            if (ZMac_ScanBuf)
   \   000029   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   7002         JNZ     ??ZMacReset_0
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \                     ??ZMacReset_0:
   \   000031   6012         JZ      ??ZMacReset_1
    167            {
    168              osal_mem_free(ZMac_ScanBuf);
   \   000033                ; Setup parameters for call to function osal_mem_free
   \   000033   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FA           MOV     R2,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FB           MOV     R3,A
   \   00003B   12....       LCALL   ??osal_mem_free?relay
    169              ZMac_ScanBuf = NULL;
   \   00003E   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
   \   000043   A3           INC     DPTR
   \   000044   F0           MOVX    @DPTR,A
    170            }
    171          
    172            return ( stat );
   \                     ??ZMacReset_1:
   \   000045   EE           MOV     A,R6
   \   000046   F9           MOV     R1,A
   \   000047   80..         SJMP    ?Subroutine6
    173          }
    174          
    175          
    176          /********************************************************************************************************
    177           * @fn      ZMacGetReq
    178           *
    179           * @brief   Read a MAC PIB attribute.
    180           *
    181           * @param   attr - PIB attribute to get
    182           * @param   value - pointer to the buffer to store the attribute
    183           *
    184           * @return  status
    185           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    186          uint8 ZMacGetReq( uint8 attr, uint8 *value )
   \                     ZMacGetReq:
    187          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    188            if ( attr == ZMacExtAddr )
   \   000004   74E2         MOV     A,#-0x1e
   \   000006   69           XRL     A,R1
   \   000007   700B         JNZ     ??ZMacGetReq_0
    189            {
    190              osal_cpyExtAddr( value, &aExtendedAddress );
   \   000009                ; Setup parameters for call to function sAddrExtCpy
   \   000009   7C..         MOV     R4,#(aExtendedAddress & 0xff)
   \   00000B   7D..         MOV     R5,#((aExtendedAddress >> 8) & 0xff)
   \   00000D   12....       LCALL   ??sAddrExtCpy?relay
    191              return ZMacSuccess;
   \   000010   7900         MOV     R1,#0x0
   \   000012   8003         SJMP    ??ZMacGetReq_1
    192            }
    193          
    194            return (ZMacStatus_t) MAC_MlmeGetReq( attr, value );
   \                     ??ZMacGetReq_0:
   \   000014                ; Setup parameters for call to function MAC_MlmeGetReq
   \   000014   12....       LCALL   ??MAC_MlmeGetReq?relay
   \                     ??ZMacGetReq_1:
   \   000017   02....       LJMP    ??Subroutine11_0 & 0xFFFF
    195          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine11_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    196          
    197          
    198          /********************************************************************************************************
    199           * @fn      ZMacSetReq
    200           *
    201           * @brief   Write a MAC PIB attribute.
    202           *
    203           * @param   attr - PIB attribute to Set
    204           * @param   value - pointer to the data
    205           *
    206           * @return  status
    207           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    208          uint8 ZMacSetReq( uint8 attr, byte *value )
   \                     ZMacSetReq:
    209          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    210            if ( attr == ZMacExtAddr )
   \   00000B   74E2         MOV     A,#-0x1e
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   700B         JNZ     ??ZMacSetReq_0
    211            {
    212              osal_cpyExtAddr( aExtendedAddress, value );
   \   000011                ; Setup parameters for call to function sAddrExtCpy
   \   000011   EE           MOV     A,R6
   \   000012   FC           MOV     R4,A
   \   000013   EF           MOV     A,R7
   \   000014   FD           MOV     R5,A
   \   000015   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000017   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000019   12....       LCALL   ??sAddrExtCpy?relay
    213            }
    214          
    215            return (ZMacStatus_t) MAC_MlmeSetReq( attr, value );
   \                     ??ZMacSetReq_0:
   \   00001C                ; Setup parameters for call to function MAC_MlmeSetReq
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   A9..         MOV     R1,?V0 + 0
   \   000022   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   000025   02....       LJMP    ??Subroutine9_0 & 0xFFFF
    216          }
    217          
    218          /********************************************************************************************************
    219           * @fn      ZMacAssociateReq
    220           *
    221           * @brief   Request an association with a coordinator.
    222           *
    223           * @param   structure with info need to associate.
    224           *
    225           * @return  status
    226           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    227          uint8 ZMacAssociateReq( ZMacAssociateReq_t *pData )
   \                     ZMacAssociateReq:
    228          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    229            /* Right now, set security to zero */
    230            pData->Sec.SecurityLevel = false;
   \   000004   EA           MOV     A,R2
   \   000005   2416         ADD     A,#0x16
   \   000007   12....       LCALL   ?Subroutine2 & 0xFFFF
    231          
    232            MAC_MlmeAssociateReq ( (macMlmeAssociateReq_t *)pData);
   \                     ??CrossCallReturnLabel_9:
   \   00000A                ; Setup parameters for call to function MAC_MlmeAssociateReq
   \   00000A   12....       LCALL   ??MAC_MlmeAssociateReq?relay
    233            return ( ZMacSuccess );
   \   00000D   02....       LJMP    ?Subroutine7 & 0xFFFF
    234          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003                REQUIRE ??Subroutine10_0
   \   000003                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7900         MOV     R1,#0x0
   \   000002                REQUIRE ??Subroutine11_0
   \   000002                ; // Fall through to label ??Subroutine11_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine12_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   22           RET
    235          
    236          /********************************************************************************************************
    237           * @fn      ZMacAssociateRsp
    238           *
    239           * @brief   Request to send an association response message.
    240           *
    241           * @param   structure with associate response and info needed to send it.
    242           *
    243           * @return  MAC_SUCCESS or MAC error code
    244           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    245          uint8 ZMacAssociateRsp( ZMacAssociateRsp_t *pData )
   \                     ZMacAssociateRsp:
    246          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    247            /* Right now, set security to zero */
    248            pData->Sec.SecurityLevel = false;
   \   000004   12....       LCALL   ?Subroutine0 & 0xFFFF
    249          
    250            return ( MAC_MlmeAssociateRsp( (macMlmeAssociateRsp_t *) pData ) );
   \                     ??CrossCallReturnLabel_0:
   \   000007                ; Setup parameters for call to function MAC_MlmeAssociateRsp
   \   000007   12....       LCALL   ??MAC_MlmeAssociateRsp?relay
   \   00000A   02....       LJMP    ??Subroutine11_0 & 0xFFFF
    251          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   EA           MOV     A,R2
   \   000001   2413         ADD     A,#0x13
   \   000003   F582         MOV     DPL,A
   \   000005   EB           MOV     A,R3
   \   000006   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000009   22           RET
    252          
    253          /********************************************************************************************************
    254           * @fn      ZMacDisassociateReq
    255           *
    256           * @brief   Request to send a disassociate request message.
    257           *
    258           * @param   structure with info need send it.
    259           *
    260           * @return  status
    261           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    262          uint8 ZMacDisassociateReq( ZMacDisassociateReq_t *pData )
   \                     ZMacDisassociateReq:
    263          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    264            /* Right now, set security to zero */
    265            pData->Sec.SecurityLevel = false;
   \   000004   EA           MOV     A,R2
   \   000005   2415         ADD     A,#0x15
   \   000007   12....       LCALL   ?Subroutine2 & 0xFFFF
    266          
    267            MAC_MlmeDisassociateReq( (macMlmeDisassociateReq_t *)pData);
   \                     ??CrossCallReturnLabel_10:
   \   00000A                ; Setup parameters for call to function MAC_MlmeDisassociateReq
   \   00000A   12....       LCALL   ??MAC_MlmeDisassociateReq?relay
    268            return ( ZMacSuccess );
   \   00000D   02....       LJMP    ?Subroutine7 & 0xFFFF
    269          }
    270          
    271          /********************************************************************************************************
    272           * @fn      ZMacOrphanRsp
    273           *
    274           * @brief   Allows next higher layer to respond to an orphan indication message.
    275           *
    276           * @param   structure with info need send it.
    277           *
    278           * @return  status
    279           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    280          uint8 ZMacOrphanRsp( ZMacOrphanRsp_t *pData )
   \                     ZMacOrphanRsp:
    281          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    282            /* Right now, set security to zero */
    283            pData->Sec.SecurityLevel = false;
   \   000004   12....       LCALL   ?Subroutine0 & 0xFFFF
    284          
    285            MAC_MlmeOrphanRsp( (macMlmeOrphanRsp_t *)pData);
   \                     ??CrossCallReturnLabel_1:
   \   000007                ; Setup parameters for call to function MAC_MlmeOrphanRsp
   \   000007   12....       LCALL   ??MAC_MlmeOrphanRsp?relay
    286            return ( ZMacSuccess );
   \   00000A   02....       LJMP    ?Subroutine7 & 0xFFFF
    287          }
    288          
    289          /********************************************************************************************************
    290           * @fn      ZMacScanReq
    291           *
    292           * @brief   This function is called to perform a network scan.
    293           *
    294           * @param   param - structure with info need send it.
    295           *
    296           * @return  status
    297           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    298          uint8 ZMacScanReq( ZMacScanReq_t *pData )
   \                     ZMacScanReq:
    299          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    300            _ScanChannels = pData->ScanChannels;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   78..         MOV     R0,#?V0 + 0
   \   00000F   12....       LCALL   ?L_MOV_X
   \   000012   90....       MOV     DPTR,#_ScanChannels
   \   000015   78..         MOV     R0,#?V0 + 0
   \   000017   12....       LCALL   ?L_MOV_TO_X
    301          
    302            /* scan in progress */
    303            if (ZMac_ScanBuf != NULL)
   \   00001A   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   7002         JNZ     ??ZMacScanReq_0
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \                     ??ZMacScanReq_0:
   \   000022   6005         JZ      ??ZMacScanReq_1
    304            {
    305              return MAC_SCAN_IN_PROGRESS;
   \   000024   79FC         MOV     R1,#-0x4
   \   000026   02....       LJMP    ??ZMacScanReq_2 & 0xFFFF
    306            }
    307          
    308            if (pData->ScanType != ZMAC_ORPHAN_SCAN)
   \                     ??ZMacScanReq_1:
   \   000029   8E82         MOV     DPL,R6
   \   00002B   8F83         MOV     DPH,R7
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \   000032   FA           MOV     R2,A
   \   000033   7403         MOV     A,#0x3
   \   000035   6A           XRL     A,R2
   \   000036   7003         JNZ     $+5
   \   000038   02....       LJMP    ??ZMacScanReq_3 & 0xFFFF
    309            {
    310              /* Allocate memory depends on the scan type */
    311              if (pData->ScanType == ZMAC_ED_SCAN)
   \   00003B   EE           MOV     A,R6
   \   00003C   2413         ADD     A,#0x13
   \   00003E   F5..         MOV     ?V0 + 0,A
   \   000040   EF           MOV     A,R7
   \   000041   3400         ADDC    A,#0x0
   \   000043   F5..         MOV     ?V0 + 1,A
   \   000045   EA           MOV     A,R2
   \   000046   7043         JNZ     ??ZMacScanReq_4
    312              {
    313                if ((ZMac_ScanBuf = osal_mem_alloc(ZMAC_ED_SCAN_MAXCHANNELS)) == NULL)
   \   000048                ; Setup parameters for call to function osal_mem_alloc
   \   000048   7A1B         MOV     R2,#0x1b
   \   00004A   7B00         MOV     R3,#0x0
   \   00004C   12....       LCALL   ??osal_mem_alloc?relay
   \   00004F   8A..         MOV     ?V0 + 2,R2
   \   000051   8B..         MOV     ?V0 + 3,R3
   \   000053   A8..         MOV     R0,?V0 + 2
   \   000055   A9..         MOV     R1,?V0 + 3
   \   000057   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00005A   E8           MOV     A,R0
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   E9           MOV     A,R1
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   E8           MOV     A,R0
   \   000060   7001         JNZ     ??ZMacScanReq_5
   \   000062   E9           MOV     A,R1
   \                     ??ZMacScanReq_5:
   \   000063   7004         JNZ     ??ZMacScanReq_6
    314                {
    315                  return MAC_NO_RESOURCES;
   \                     ??ZMacScanReq_7:
   \   000065   791A         MOV     R1,#0x1a
   \   000067   807F         SJMP    ??ZMacScanReq_2
    316                }
    317                osal_memset(ZMac_ScanBuf, 0, ZMAC_ED_SCAN_MAXCHANNELS);
   \                     ??ZMacScanReq_6:
   \   000069                ; Setup parameters for call to function osal_memset
   \   000069   7C1B         MOV     R4,#0x1b
   \   00006B   7D00         MOV     R5,#0x0
   \   00006D   7900         MOV     R1,#0x0
   \   00006F   12....       LCALL   ??osal_memset?relay
    318                pData->Result.pEnergyDetect = ((uint8*)ZMac_ScanBuf) + MAC_CHAN_11;
   \   000072   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000075   E0           MOVX    A,@DPTR
   \   000076   240B         ADD     A,#0xb
   \   000078   F8           MOV     R0,A
   \   000079   A3           INC     DPTR
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   3400         ADDC    A,#0x0
   \   00007D   F9           MOV     R1,A
   \   00007E   85..82       MOV     DPL,?V0 + 0
   \   000081   85..83       MOV     DPH,?V0 + 1
   \   000084   E8           MOV     A,R0
   \   000085   F0           MOVX    @DPTR,A
   \   000086   A3           INC     DPTR
   \   000087   E9           MOV     A,R1
   \   000088   F0           MOVX    @DPTR,A
   \   000089   8040         SJMP    ??ZMacScanReq_3
    319              }
    320              else if (pData->MaxResults > 0)
   \                     ??ZMacScanReq_4:
   \   00008B   8E82         MOV     DPL,R6
   \   00008D   8F83         MOV     DPH,R7
   \   00008F   A3           INC     DPTR
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   A3           INC     DPTR
   \   000093   A3           INC     DPTR
   \   000094   A3           INC     DPTR
   \   000095   A3           INC     DPTR
   \   000096   E0           MOVX    A,@DPTR
   \   000097   6032         JZ      ??ZMacScanReq_3
    321              {
    322                if ((ZMac_ScanBuf = pData->Result.pPanDescriptor =
    323                     osal_mem_alloc( sizeof( ZMacPanDesc_t ) * pData->MaxResults )) == NULL)
   \   000099                ; Setup parameters for call to function osal_mem_alloc
   \   000099   75F021       MOV     B,#0x21
   \   00009C   A4           MUL     AB
   \   00009D   FA           MOV     R2,A
   \   00009E   ABF0         MOV     R3,B
   \   0000A0   12....       LCALL   ??osal_mem_alloc?relay
   \   0000A3   85..82       MOV     DPL,?V0 + 0
   \   0000A6   85..83       MOV     DPH,?V0 + 1
   \   0000A9   EA           MOV     A,R2
   \   0000AA   F0           MOVX    @DPTR,A
   \   0000AB   A3           INC     DPTR
   \   0000AC   EB           MOV     A,R3
   \   0000AD   F0           MOVX    @DPTR,A
   \   0000AE   85..82       MOV     DPL,?V0 + 0
   \   0000B1   85..83       MOV     DPH,?V0 + 1
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F9           MOV     R1,A
   \   0000B9   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0000BC   E8           MOV     A,R0
   \   0000BD   F0           MOVX    @DPTR,A
   \   0000BE   A3           INC     DPTR
   \   0000BF   E9           MOV     A,R1
   \   0000C0   F0           MOVX    @DPTR,A
   \   0000C1   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   7002         JNZ     ??ZMacScanReq_8
   \   0000C7   A3           INC     DPTR
   \   0000C8   E0           MOVX    A,@DPTR
   \                     ??ZMacScanReq_8:
   \   0000C9   609A         JZ      ??ZMacScanReq_7
    324                {
    325                  return MAC_NO_RESOURCES;
    326                }
    327              }
    328            }
    329          
    330            /* Right now, set security to zero */
    331            pData->Sec.SecurityLevel = false;
   \                     ??ZMacScanReq_3:
   \   0000CB   EE           MOV     A,R6
   \   0000CC   2410         ADD     A,#0x10
   \   0000CE   F582         MOV     DPL,A
   \   0000D0   EF           MOV     A,R7
   \   0000D1   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    332          
    333            /* Channel Page */
    334            pData->ChannelPage = 0x00;
   \                     ??CrossCallReturnLabel_7:
   \   0000D4   8E82         MOV     DPL,R6
   \   0000D6   8F83         MOV     DPH,R7
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   A3           INC     DPTR
   \   0000DD   A3           INC     DPTR
   \   0000DE   F0           MOVX    @DPTR,A
    335          
    336            MAC_MlmeScanReq ((macMlmeScanReq_t *)pData);
   \   0000DF                ; Setup parameters for call to function MAC_MlmeScanReq
   \   0000DF   EE           MOV     A,R6
   \   0000E0   FA           MOV     R2,A
   \   0000E1   EF           MOV     A,R7
   \   0000E2   FB           MOV     R3,A
   \   0000E3   12....       LCALL   ??MAC_MlmeScanReq?relay
    337          
    338            return ZMacSuccess;
   \   0000E6   7900         MOV     R1,#0x0
   \                     ??ZMacScanReq_2:
   \   0000E8                REQUIRE ?Subroutine8
   \   0000E8                ; // Fall through to label ?Subroutine8
    339          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    340          
    341          
    342          /********************************************************************************************************
    343           * @fn      ZMacStartReq
    344           *
    345           * @brief   This function is called to tell the MAC to transmit beacons
    346           *          and become a coordinator.
    347           *
    348           * @param   structure with info need send it.
    349           *
    350           * @return  status
    351           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    352          uint8 ZMacStartReq( ZMacStartReq_t *pData )
   \                     ZMacStartReq:
    353          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    354            uint8 stat;
    355          
    356            // Probably want to keep the receiver on
    357            stat = true;
   \   00000E   7401         MOV     A,#0x1
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    358            MAC_MlmeSetReq( MAC_RX_ON_WHEN_IDLE, &stat );
   \   000017                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000017   AA82         MOV     R2,DPL
   \   000019   AB83         MOV     R3,DPH
   \   00001B   7952         MOV     R1,#0x52
   \   00001D   12....       LCALL   ??MAC_MlmeSetReq?relay
    359          
    360            /* Right now, set security to zero */
    361            pData->RealignSec.SecurityLevel = false;
   \   000020   EE           MOV     A,R6
   \   000021   2415         ADD     A,#0x15
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    362            pData->BeaconSec.SecurityLevel = false;
   \                     ??CrossCallReturnLabel_8:
   \   000029   EE           MOV     A,R6
   \   00002A   2420         ADD     A,#0x20
   \   00002C   12....       LCALL   ?Subroutine1 & 0xFFFF
    363          
    364          
    365            MAC_MlmeStartReq((macMlmeStartReq_t *) pData);
   \                     ??CrossCallReturnLabel_3:
   \   00002F   12....       LCALL   ??MAC_MlmeStartReq?relay
    366          
    367            // MAC does not issue mlmeStartConfirm(), so we have to
    368            // mlmeStartConfirm( stat );  This needs to be addressed some how
    369          
    370            return ZMacSuccess;
   \   000032   7900         MOV     R1,#0x0
   \   000034   02....       LJMP    ?Subroutine6 & 0xFFFF
    371          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000006                ; Setup parameters for call to function MAC_MlmeStartReq
   \   000006                ; Setup parameters for call to function MAC_McpsDataReq
   \   000006   EE           MOV     A,R6
   \   000007   FA           MOV     R2,A
   \   000008   EF           MOV     A,R7
   \   000009   FB           MOV     R3,A
   \   00000A   22           RET
    372          
    373          /********************************************************************************************************
    374           * @fn      ZMacSyncReq
    375           *
    376           * @brief   This function is called to request a sync to the current
    377           *          networks beacons.
    378           *
    379           * @param   LogicalChannel -
    380           * @param   TrackBeacon - true/false
    381           *
    382           * @return  status
    383           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    384          uint8 ZMacSyncReq( ZMacSyncReq_t *pData )
   \                     ZMacSyncReq:
    385          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    386            MAC_MlmeSyncReq( (macMlmeSyncReq_t *)pData);
   \   000004                ; Setup parameters for call to function MAC_MlmeSyncReq
   \   000004   12....       LCALL   ??MAC_MlmeSyncReq?relay
    387            return ZMacSuccess;
   \   000007   02....       LJMP    ?Subroutine7 & 0xFFFF
    388          }
    389          
    390          /********************************************************************************************************
    391           * @fn      ZMacPollReq
    392           *
    393           * @brief   This function is called to request MAC data request poll.
    394           *
    395           * @param   coordAddr -
    396           * @param   coordPanId -
    397           * @param   SecurityEnable - true or false.
    398           *
    399           * @return  status
    400           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    401          uint8 ZMacPollReq( ZMacPollReq_t *pData )
   \                     ZMacPollReq:
    402          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    403            /* Right now, set security to zero */
    404            pData->Sec.SecurityLevel = false;
   \   000004   12....       LCALL   ?Subroutine0 & 0xFFFF
    405          
    406            MAC_MlmePollReq ((macMlmePollReq_t *)pData);
   \                     ??CrossCallReturnLabel_2:
   \   000007                ; Setup parameters for call to function MAC_MlmePollReq
   \   000007   12....       LCALL   ??MAC_MlmePollReq?relay
    407            return ( ZMacSuccess );
   \   00000A   02....       LJMP    ?Subroutine7 & 0xFFFF
    408          }
    409          
    410          /********************************************************************************************************
    411           * @fn      ZMacDataReqSec
    412           *
    413           * @brief   Send a MAC Data Frame packet, calls the passed in function to apply non-MAC security
    414           *          on the MAC data field after the MAC buffer allocation.
    415           *
    416           * @param   pData - structure containing data and where to send it.
    417           * @param   secCB - callback function to apply security, NULL indicates no security
    418           *
    419           * @return  status
    420           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    421          uint8 ZMacDataReqSec( ZMacDataReq_t *pData, applySecCB_t secCB )
   \                     ZMacDataReqSec:
    422          {
   \   000000   74EA         MOV     A,#-0x16
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 22
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   8C..         MOV     ?V0 + 12,R4
   \   00000B   8D..         MOV     ?V0 + 13,R5
    423            macMcpsDataReq_t *pBuf;
    424          
    425            /* Allocate memory */
    426            pBuf = MAC_McpsDataAlloc( pData->msduLength, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE );
   \   00000D   EA           MOV     A,R2
   \   00000E   241B         ADD     A,#0x1b
   \   000010   F5..         MOV     ?V0 + 2,A
   \   000012   EB           MOV     A,R3
   \   000013   3400         ADDC    A,#0x0
   \   000015   F5..         MOV     ?V0 + 3,A
   \   000017                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   85..82       MOV     DPL,?V0 + 2
   \   00001E   F583         MOV     DPH,A
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F9           MOV     R1,A
   \   000022   12....       LCALL   ??MAC_McpsDataAlloc?relay
   \   000025   8A..         MOV     ?V0 + 4,R2
   \   000027   8B..         MOV     ?V0 + 5,R3
   \   000029   AE..         MOV     R6,?V0 + 4
   \   00002B   AF..         MOV     R7,?V0 + 5
    427          
    428            if ( pBuf )
   \   00002D   EE           MOV     A,R6
   \   00002E   7001         JNZ     ??ZMacDataReqSec_0
   \   000030   EF           MOV     A,R7
   \                     ??ZMacDataReqSec_0:
   \   000031   7003         JNZ     $+5
   \   000033   02....       LJMP    ??ZMacDataReqSec_1 & 0xFFFF
    429            {
    430              /* Copy the addresses */
    431              osal_memcpy( &pBuf->mac, pData, sizeof (macDataReq_t) );
   \   000036                ; Setup parameters for call to function osal_memcpy
   \   000036   85....       MOV     ?V0 + 4,?V0 + 0
   \   000039   85....       MOV     ?V0 + 5,?V0 + 1
   \   00003C   75..00       MOV     ?V0 + 6,#0x0
   \   00003F   78..         MOV     R0,#?V0 + 4
   \   000041   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000044   7C10         MOV     R4,#0x10
   \   000046   7D00         MOV     R5,#0x0
   \   000048   EE           MOV     A,R6
   \   000049   2422         ADD     A,#0x22
   \   00004B   FA           MOV     R2,A
   \   00004C   EF           MOV     A,R7
   \   00004D   3400         ADDC    A,#0x0
   \   00004F   FB           MOV     R3,A
   \   000050   12....       LCALL   ??osal_memcpy?relay
   \   000053   7403         MOV     A,#0x3
   \   000055   12....       LCALL   ?DEALLOC_XSTACK8
    432          
    433              /* Copy data */
    434              pBuf->msdu.len = pData->msduLength;
   \   000058   EE           MOV     A,R6
   \   000059   2404         ADD     A,#0x4
   \   00005B   F5..         MOV     ?V0 + 6,A
   \   00005D   EF           MOV     A,R7
   \   00005E   3400         ADDC    A,#0x0
   \   000060   F5..         MOV     ?V0 + 7,A
   \   000062   85..82       MOV     DPL,?V0 + 2
   \   000065   85..83       MOV     DPH,?V0 + 3
   \   000068   E0           MOVX    A,@DPTR
   \   000069   85..82       MOV     DPL,?V0 + 6
   \   00006C   85..83       MOV     DPH,?V0 + 7
   \   00006F   F0           MOVX    @DPTR,A
    435              osal_memcpy( pBuf->msdu.p, pData->msdu, pData->msduLength );
   \   000070   EE           MOV     A,R6
   \   000071   2402         ADD     A,#0x2
   \   000073   F5..         MOV     ?V0 + 4,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F5..         MOV     ?V0 + 5,A
   \   00007A                ; Setup parameters for call to function osal_memcpy
   \   00007A   E5..         MOV     A,?V0 + 0
   \   00007C   241C         ADD     A,#0x1c
   \   00007E   F582         MOV     DPL,A
   \   000080   E5..         MOV     A,?V0 + 1
   \   000082   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F5..         MOV     ?V0 + 8,A
   \   000088   A3           INC     DPTR
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   F5..         MOV     ?V0 + 9,A
   \   00008C   75..00       MOV     ?V0 + 10,#0x0
   \   00008F   78..         MOV     R0,#?V0 + 8
   \   000091   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000094   85..82       MOV     DPL,?V0 + 2
   \   000097   85..83       MOV     DPH,?V0 + 3
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   FC           MOV     R4,A
   \   00009C   7D00         MOV     R5,#0x0
   \   00009E   85..82       MOV     DPL,?V0 + 4
   \   0000A1   85..83       MOV     DPH,?V0 + 5
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   FA           MOV     R2,A
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   FB           MOV     R3,A
   \   0000A9   12....       LCALL   ??osal_memcpy?relay
   \   0000AC   7403         MOV     A,#0x3
   \   0000AE   12....       LCALL   ?DEALLOC_XSTACK8
    436              
    437              /* Encrypt in place */
    438              if ( secCB && pBuf->msdu.len && pBuf->msdu.p )
   \   0000B1   E5..         MOV     A,?V0 + 12
   \   0000B3   7002         JNZ     ??ZMacDataReqSec_2
   \   0000B5   E5..         MOV     A,?V0 + 13
   \                     ??ZMacDataReqSec_2:
   \   0000B7   6030         JZ      ??ZMacDataReqSec_3
   \   0000B9   85..82       MOV     DPL,?V0 + 6
   \   0000BC   85..83       MOV     DPH,?V0 + 7
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   F9           MOV     R1,A
   \   0000C1   6026         JZ      ??ZMacDataReqSec_3
   \   0000C3   85..82       MOV     DPL,?V0 + 4
   \   0000C6   85..83       MOV     DPH,?V0 + 5
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   FA           MOV     R2,A
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   FB           MOV     R3,A
   \   0000CE   EA           MOV     A,R2
   \   0000CF   7001         JNZ     ??ZMacDataReqSec_4
   \   0000D1   EB           MOV     A,R3
   \                     ??ZMacDataReqSec_4:
   \   0000D2   6015         JZ      ??ZMacDataReqSec_3
    439              {
    440                if ( secCB( pBuf->msdu.len, pBuf->msdu.p ) != ZSuccess )
   \   0000D4                ; Setup parameters for indirect call
   \   0000D4   85..82       MOV     DPL,?V0 + 12
   \   0000D7   85..83       MOV     DPH,?V0 + 13
   \   0000DA   12....       LCALL   ?CALL_IND
   \   0000DD   E9           MOV     A,R1
   \   0000DE   6009         JZ      ??ZMacDataReqSec_3
    441                {
    442                  // Deallocate the buffer.  MAC_McpsDataAlloc() calls osal_msg_allocate() and
    443                  // returns the same pointer.
    444                  osal_msg_deallocate( (uint8 *)pBuf );
   \   0000E0                ; Setup parameters for call to function osal_msg_deallocate
   \   0000E0   EE           MOV     A,R6
   \   0000E1   FA           MOV     R2,A
   \   0000E2   EF           MOV     A,R7
   \   0000E3   FB           MOV     R3,A
   \   0000E4   12....       LCALL   ??osal_msg_deallocate?relay
    445                  
    446                  return ( MAC_NO_RESOURCES );
   \   0000E7   800D         SJMP    ??ZMacDataReqSec_1
    447                }
    448              }
    449          
    450              /* Right now, set MAC security to off */
    451              pBuf->sec.securityLevel = false;
   \                     ??ZMacDataReqSec_3:
   \   0000E9   EE           MOV     A,R6
   \   0000EA   241F         ADD     A,#0x1f
   \   0000EC   12....       LCALL   ?Subroutine1 & 0xFFFF
    452          
    453              /* Call Mac Data Request */
    454              MAC_McpsDataReq( pBuf );
   \                     ??CrossCallReturnLabel_4:
   \   0000EF   12....       LCALL   ??MAC_McpsDataReq?relay
    455          
    456              return ( ZMacSuccess );
   \   0000F2   7900         MOV     R1,#0x0
   \   0000F4   8002         SJMP    ??ZMacDataReqSec_5
    457            }
    458          
    459            return ( MAC_NO_RESOURCES );
   \                     ??ZMacDataReqSec_1:
   \   0000F6   791A         MOV     R1,#0x1a
   \                     ??ZMacDataReqSec_5:
   \   0000F8   7F0E         MOV     R7,#0xe
   \   0000FA   02....       LJMP    ?BANKED_LEAVE_XDATA
    460          }
    461          
    462          /********************************************************************************************************
    463           * @fn      ZMacDataReq
    464           *
    465           * @brief   Send a MAC Data Frame packet.
    466           *
    467           * @param   structure containing data and where to send it.
    468           *
    469           * @return  status
    470           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    471          uint8 ZMacDataReq( ZMacDataReq_t *pData )
   \                     ZMacDataReq:
    472          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    473            return ZMacDataReqSec( pData, NULL );
   \   000004                ; Setup parameters for call to function ZMacDataReqSec
   \   000004   7C00         MOV     R4,#0x0
   \   000006   7D00         MOV     R5,#0x0
   \   000008   12....       LCALL   ??ZMacDataReqSec?relay
   \   00000B   80..         SJMP    ??Subroutine11_0
    474          }
    475          
    476          /********************************************************************************************************
    477           * @fn      ZMacPurgeReq
    478           *
    479           * @brief   Purge a MAC Data Frame packet.
    480           *
    481           * @param   MSDU data handle.
    482           *
    483           * @return  status
    484           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    485          uint8 ZMacPurgeReq( byte Handle )
   \                     ZMacPurgeReq:
    486          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    487            MAC_McpsPurgeReq( Handle );
   \   000004                ; Setup parameters for call to function MAC_McpsPurgeReq
   \   000004   12....       LCALL   ??MAC_McpsPurgeReq?relay
    488            return ZMacSuccess;
   \   000007   80..         SJMP    ?Subroutine7
    489          }
    490          
    491          /********************************************************************************************************
    492           * @fn      ZMacSrcMatchEnable
    493           *
    494           * @brief   This function is call to enable AUTOPEND and source address matching.
    495           *
    496           * @param   addressType - address type that the application uses
    497           *                        SADDR_MODE_SHORT or SADDR_MODE_EXT.
    498           *          numEntries  - number of source address table entries to be used
    499           *
    500           * @return  status
    501           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    502          ZMacStatus_t ZMacSrcMatchEnable (uint8 addrType, uint8 numEntries)
   \                     ZMacSrcMatchEnable:
    503          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    504            return (MAC_SrcMatchEnable(addrType, numEntries));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchEnable
   \   000004   12....       LCALL   ??MAC_SrcMatchEnable?relay
   \   000007   80..         SJMP    ??Subroutine11_0
    505          }
    506          
    507          /********************************************************************************************************
    508           * @fn      ZMacSrcMatchAddEntry
    509           *
    510           * @brief   This function is called to add a short or extended address to source address table.
    511           *
    512           * @param   addr - a pointer to sAddr_t which contains addrMode
    513           *                     and a union of a short 16-bit MAC address or an extended
    514           *                     64-bit MAC address to be added to the source address table.
    515           *          panID - the device PAN ID. It is only used when the addr is
    516           *                      using short address
    517           *
    518           * @return  status
    519           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    520          ZMacStatus_t ZMacSrcMatchAddEntry (zAddrType_t *addr, uint16 panID)
   \                     ZMacSrcMatchAddEntry:
    521          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    522            return (MAC_SrcMatchAddEntry ((sAddr_t*)addr, panID));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchAddEntry
   \   000004   12....       LCALL   ??MAC_SrcMatchAddEntry?relay
   \   000007   80..         SJMP    ??Subroutine11_0
    523          }
    524          
    525          /********************************************************************************************************
    526           * @fn      ZMacSrcMatchDeleteEntry
    527           *
    528           * @brief   This function is called to delete a short or extended address from source address table.
    529           *
    530           * @param   addr - a pointer to sAddr_t which contains addrMode
    531           *                     and a union of a short 16-bit MAC address or an extended
    532           *                     64-bit MAC address to be added to the source address table.
    533           *          panID - the device PAN ID. It is only used when the addr is
    534           *                      using short address
    535           *
    536           * @return  status
    537           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    538          ZMacStatus_t ZMacSrcMatchDeleteEntry (zAddrType_t *addr, uint16 panID)
   \                     ZMacSrcMatchDeleteEntry:
    539          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    540            return (MAC_SrcMatchDeleteEntry ((sAddr_t*)addr, panID));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchDeleteEntry
   \   000004   12....       LCALL   ??MAC_SrcMatchDeleteEntry?relay
   \   000007   80..         SJMP    ??Subroutine11_0
    541          }
    542          
    543          /********************************************************************************************************
    544           * @fn       ZMacSrcMatchAckAllPending
    545           *
    546           * @brief    Enabled/disable acknowledging all packets with pending bit set
    547           *           It is normally enabled when adding new entries to
    548           *           the source address table fails due to the table is full, or
    549           *           disabled when more entries are deleted and the table has
    550           *           empty slots.
    551           *
    552           * @param    option - true (acknowledging all packets with pending field set)
    553           *                    false (acknowledging all packets with pending field cleared)
    554           *
    555           * @return   status
    556           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    557          ZMacStatus_t ZMacSrcMatchAckAllPending (uint8 option)
   \                     ZMacSrcMatchAckAllPending:
    558          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    559            MAC_SrcMatchAckAllPending (option);
   \   000004                ; Setup parameters for call to function MAC_SrcMatchAckAllPending
   \   000004   12....       LCALL   ??MAC_SrcMatchAckAllPending?relay
    560          
    561            return ZMacSuccess;
   \   000007   80..         SJMP    ?Subroutine7
    562          }
    563          
    564          /********************************************************************************************************
    565           * @fn       ZMacSrcMatchCheckAllPending
    566           *
    567           * @brief    This function is called to check if acknowledging all packets with pending bit set is enabled.
    568           *
    569           * @param    none
    570           *
    571           * @return   status
    572           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    573          ZMacStatus_t ZMacSrcMatchCheckAllPending (void)
   \                     ZMacSrcMatchCheckAllPending:
    574          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    575            return (MAC_SrcMatchCheckAllPending ());
   \   000004                ; Setup parameters for call to function MAC_SrcMatchCheckAllPending
   \   000004   12....       LCALL   ??MAC_SrcMatchCheckAllPending?relay
   \   000007   80..         SJMP    ??Subroutine11_0
    576          }
    577          
    578          /********************************************************************************************************
    579           * @fn      - ZMACPwrOnReq
    580           *
    581           * @brief   - This function requests the MAC to power on the radio hardware
    582           *            and wake up.  When the power on procedure is complete the MAC
    583           *            will send a MAC_PWR_ON_CNF to the application.
    584           *
    585           * @input   - None.
    586           *
    587           * @output  - None.
    588           *
    589           * @return  - None.
    590           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    591          void ZMacPwrOnReq ( void )
   \                     ZMacPwrOnReq:
    592          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    593            MAC_PwrOnReq();
   \   000004                ; Setup parameters for call to function MAC_PwrOnReq
   \   000004   12....       LCALL   ??MAC_PwrOnReq?relay
    594          }
   \   000007   80..         SJMP    ??Subroutine11_0
    595          
    596          /********************************************************************************************************
    597           * @fn          MAC_PwrMode
    598           *
    599           * @brief       This function returns the current power mode of the MAC.
    600           *
    601           * input parameters
    602           *
    603           * None.
    604           *
    605           * output parameters
    606           *
    607           * None.
    608           *
    609           * @return      The current power mode of the MAC.
    610           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    611          uint8 ZMac_PwrMode(void)
   \                     ZMac_PwrMode:
    612          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    613            return (MAC_PwrMode());
   \   000004                ; Setup parameters for call to function MAC_PwrMode
   \   000004   12....       LCALL   ??MAC_PwrMode?relay
   \   000007   80..         SJMP    ??Subroutine11_0
    614          }
    615          
    616          /********************************************************************************************************
    617           * @fn      ZMacSetTransmitPower
    618           *
    619           * @brief   Set the transmitter power according to the level setting param.
    620           *
    621           * @param   Valid power level setting as defined in ZMAC.h.
    622           *
    623           * @return  ZMacSuccess if PHY_TRANSMIT_POWER found or ZMacUnsupportedAttribute.
    624           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    625          uint8 ZMacSetTransmitPower( ZMacTransmitPower_t level )
   \                     ZMacSetTransmitPower:
    626          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 1
   \   000004   74FF         MOV     A,#-0x1
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
    627            return MAC_MlmeSetReq( ZMacPhyTransmitPower, &level );
   \   000011                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000011   AA82         MOV     R2,DPL
   \   000013   AB83         MOV     R3,DPH
   \   000015   79E0         MOV     R1,#-0x20
   \   000017   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   00001A   7401         MOV     A,#0x1
   \   00001C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001F   80..         SJMP    ??Subroutine11_0
    628          }
    629          
    630          /********************************************************************************************************
    631           * @fn      ZMacSendNoData
    632           *
    633           * @brief   This function sends an empty msg
    634           *
    635           * @param   DstAddr   - destination short address
    636           *          DstPANId  - destination pan id
    637           *
    638           * @return  None
    639           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    640          void ZMacSendNoData ( uint16 DstAddr, uint16 DstPANId )
   \                     ZMacSendNoData:
    641          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    642            macMcpsDataReq_t *pBuf;
    643          
    644            /* Allocate memory */
    645            pBuf = MAC_McpsDataAlloc(0, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE);
   \   00000D                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   00000D   7B00         MOV     R3,#0x0
   \   00000F   7A00         MOV     R2,#0x0
   \   000011   7900         MOV     R1,#0x0
   \   000013   12....       LCALL   ??MAC_McpsDataAlloc?relay
    646          
    647            if (pBuf)
   \   000016   EA           MOV     A,R2
   \   000017   7001         JNZ     ??ZMacSendNoData_0
   \   000019   EB           MOV     A,R3
   \                     ??ZMacSendNoData_0:
   \   00001A   603A         JZ      ??ZMacSendNoData_1
    648            {
    649              /* Fill in src information */
    650              pBuf->mac.srcAddrMode              = SADDR_MODE_SHORT;
   \   00001C   EA           MOV     A,R2
   \   00001D   242D         ADD     A,#0x2d
   \   00001F   12....       LCALL   ?Subroutine3 & 0xFFFF
    651          
    652              /* Fill in dst information */
    653              pBuf->mac.dstAddr.addr.shortAddr   = DstAddr;
   \                     ??CrossCallReturnLabel_5:
   \   000022   2422         ADD     A,#0x22
   \   000024   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000027   E5..         MOV     A,?V0 + 0
   \   000029   F0           MOVX    @DPTR,A
   \   00002A   A3           INC     DPTR
   \   00002B   E5..         MOV     A,?V0 + 1
   \   00002D   F0           MOVX    @DPTR,A
    654              pBuf->mac.dstAddr.addrMode         = SADDR_MODE_SHORT;
   \   00002E   EA           MOV     A,R2
   \   00002F   242A         ADD     A,#0x2a
   \   000031   12....       LCALL   ?Subroutine3 & 0xFFFF
    655              pBuf->mac.dstPanId                 = DstPANId;
   \                     ??CrossCallReturnLabel_6:
   \   000034   242B         ADD     A,#0x2b
   \   000036   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   000039   EE           MOV     A,R6
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   A3           INC     DPTR
   \   00003C   EF           MOV     A,R7
   \   00003D   F0           MOVX    @DPTR,A
    656              
    657              /* Misc information */
    658              pBuf->mac.msduHandle               = 0;
   \   00003E   EA           MOV     A,R2
   \   00003F   242E         ADD     A,#0x2e
   \   000041   12....       LCALL   ?Subroutine2 & 0xFFFF
    659              pBuf->mac.txOptions                = ZMAC_TXOPTION_ACK | ZMAC_TXOPTION_NO_RETRANS | ZMAC_TXOPTION_NO_CNF;
   \                     ??CrossCallReturnLabel_11:
   \   000044   EA           MOV     A,R2
   \   000045   242F         ADD     A,#0x2f
   \   000047   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   00004A   7431         MOV     A,#0x31
   \   00004C   F0           MOVX    @DPTR,A
    660          
    661              /* Right now, set security to zero */
    662              pBuf->sec.securityLevel = false;
   \   00004D   EA           MOV     A,R2
   \   00004E   241F         ADD     A,#0x1f
   \   000050   12....       LCALL   ?Subroutine2 & 0xFFFF
    663          
    664              /* Call Mac Data Request */
    665              MAC_McpsDataReq(pBuf);
   \                     ??CrossCallReturnLabel_12:
   \   000053                ; Setup parameters for call to function MAC_McpsDataReq
   \   000053   12....       LCALL   ??MAC_McpsDataReq?relay
    666            }
    667          
    668          }
   \                     ??ZMacSendNoData_1:
   \   000056   02....       LJMP    ?Subroutine8 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003                REQUIRE ??Subroutine12_0
   \   000003                ; // Fall through to label ??Subroutine12_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000003   7402         MOV     A,#0x2
   \   000005   F0           MOVX    @DPTR,A
   \   000006   EA           MOV     A,R2
   \   000007   22           RET
    669          
    670          /********************************************************************************************************
    671           * @fn      ZMacStateIdle
    672           *
    673           * @brief   This function returns true if the MAC state is idle.
    674           *
    675           * @param   none
    676           *
    677           * @return  TRUE if the MAC state is idle, FALSE otherwise.
    678           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    679          uint8 ZMacStateIdle( void )
   \                     ZMacStateIdle:
    680          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    681            return macStateIdle();
   \   000004                ; Setup parameters for call to function macStateIdle
   \   000004   12....       LCALL   ??macStateIdle?relay
   \   000007   02....       LJMP    ??Subroutine11_0 & 0xFFFF
    682          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacGetReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacGetReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSetReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSetReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacAssociateReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacAssociateReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacAssociateRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacAssociateRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacDisassociateReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacDisassociateReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacOrphanRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacOrphanRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacScanReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacScanReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacStartReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacStartReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSyncReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSyncReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPollReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPollReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacDataReqSec?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacDataReqSec

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacDataReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacDataReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPurgeReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPurgeReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchEnable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchEnable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchAddEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchAddEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchDeleteEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchDeleteEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchAckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchAckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchCheckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchCheckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPwrOnReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPwrOnReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMac_PwrMode?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMac_PwrMode

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSetTransmitPower?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSetTransmitPower

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSendNoData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSendNoData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacStateIdle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacStateIdle

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     ZMacAssociateReq                   3      0      0
       -> MAC_MlmeAssociateReq          4      0      0
     ZMacAssociateRsp                   3      0      0
       -> MAC_MlmeAssociateRsp          4      0      0
     ZMacDataReq                        2      0      0
       -> ZMacDataReqSec                4      0      0
     ZMacDataReqSec                     1      0     25
       -> MAC_McpsDataAlloc             0      0     44
       -> osal_memcpy                   0      0     50
       -> osal_memcpy                   0      0     50
       -> osal_msg_deallocate           0      0     44
       -> MAC_McpsDataReq               0      0     44
     ZMacDisassociateReq                3      0      0
       -> MAC_MlmeDisassociateReq       4      0      0
     ZMacGetReq                         2      0      0
       -> sAddrExtCpy                   4      0      0
       -> MAC_MlmeGetReq                4      0      0
     ZMacInit                           0      0      9
       -> MAC_Init                      0      0     18
       -> MAC_InitDevice                0      0     18
       -> MAC_InitCoord                 0      0     18
       -> ZMacReset                     0      0     18
       -> osal_int_disable              0      0     18
     ZMacOrphanRsp                      3      0      0
       -> MAC_MlmeOrphanRsp             4      0      0
     ZMacPollReq                        3      0      0
       -> MAC_MlmePollReq               4      0      0
     ZMacPurgeReq                       2      0      0
       -> MAC_McpsPurgeReq              4      0      0
     ZMacPwrOnReq                       2      0      0
       -> MAC_PwrOnReq                  4      0      0
     ZMacReset                          1      0     19
       -> MAC_MlmeResetReq              0      0     20
       -> MAC_MlmeSetReq                0      0     20
       -> MAC_MlmeSetReq                0      0     20
       -> osal_mem_free                 0      0     20
     ZMacScanReq                        1      0     12
       -> osal_mem_alloc                0      0     24
       -> osal_memset                   0      0     24
       -> osal_mem_alloc                0      0     24
       -> MAC_MlmeScanReq               0      0     24
     ZMacSendNoData                     1      0     12
       -> MAC_McpsDataAlloc             0      0     24
       -> MAC_McpsDataReq               0      0     24
     ZMacSetReq                         0      0      9
       -> sAddrExtCpy                   0      0     18
       -> MAC_MlmeSetReq                0      0     18
     ZMacSetTransmitPower               3      0      1
       -> MAC_MlmeSetReq                4      0      2
     ZMacSrcMatchAckAllPending          2      0      0
       -> MAC_SrcMatchAckAllPending     4      0      0
     ZMacSrcMatchAddEntry               2      0      0
       -> MAC_SrcMatchAddEntry          4      0      0
     ZMacSrcMatchCheckAllPending        2      0      0
       -> MAC_SrcMatchCheckAllPending
                                        4      0      0
     ZMacSrcMatchDeleteEntry            2      0      0
       -> MAC_SrcMatchDeleteEntry       4      0      0
     ZMacSrcMatchEnable                 2      0      0
       -> MAC_SrcMatchEnable            4      0      0
     ZMacStartReq                       1      0     10
       -> MAC_MlmeSetReq                0      0     20
       -> MAC_MlmeStartReq              0      0     20
     ZMacStateIdle                      2      0      0
       -> macStateIdle                  4      0      0
     ZMacSyncReq                        2      0      0
       -> MAC_MlmeSyncReq               4      0      0
     ZMac_PwrMode                       2      0      0
       -> MAC_PwrMode                   4      0      0


   Segment part sizes:

     Function/Label                      Bytes
     --------------                      -----
     _ScanChannels                          4
     ZMac_ScanBuf                           2
     ZMacInit                              30
     ??Subroutine9_0                        5
     ?Subroutine6                           5
     ZMacReset                             73
     ZMacGetReq                            26
     ??Subroutine11_0                       7
     ZMacSetReq                            40
     ZMacAssociateReq                      16
     ?Subroutine2                           3
     ??Subroutine10_0                       4
     ?Subroutine4                           6
     ?Subroutine7                           2
     ??Subroutine12_0                       5
     ZMacAssociateRsp                      13
     ?Subroutine0                          10
     ZMacDisassociateReq                   16
     ZMacOrphanRsp                         13
     ZMacScanReq                          232
     ?Subroutine8                           5
     ZMacStartReq                          55
     ?Subroutine1                          11
     ZMacSyncReq                           10
     ZMacPollReq                           13
     ZMacDataReqSec                       253
     ZMacDataReq                           13
     ZMacPurgeReq                           9
     ZMacSrcMatchEnable                     9
     ZMacSrcMatchAddEntry                   9
     ZMacSrcMatchDeleteEntry                9
     ZMacSrcMatchAckAllPending              9
     ZMacSrcMatchCheckAllPending            9
     ZMacPwrOnReq                           9
     ZMac_PwrMode                           9
     ZMacSetTransmitPower                  33
     ZMacSendNoData                        89
     ?Subroutine5                           3
     ?Subroutine3                           8
     ZMacStateIdle                         10
     ??ZMacInit?relay                       6
     ??ZMacReset?relay                      6
     ??ZMacGetReq?relay                     6
     ??ZMacSetReq?relay                     6
     ??ZMacAssociateReq?relay               6
     ??ZMacAssociateRsp?relay               6
     ??ZMacDisassociateReq?relay            6
     ??ZMacOrphanRsp?relay                  6
     ??ZMacScanReq?relay                    6
     ??ZMacStartReq?relay                   6
     ??ZMacSyncReq?relay                    6
     ??ZMacPollReq?relay                    6
     ??ZMacDataReqSec?relay                 6
     ??ZMacDataReq?relay                    6
     ??ZMacPurgeReq?relay                   6
     ??ZMacSrcMatchEnable?relay             6
     ??ZMacSrcMatchAddEntry?relay           6
     ??ZMacSrcMatchDeleteEntry?relay        6
     ??ZMacSrcMatchAckAllPending?relay      6
     ??ZMacSrcMatchCheckAllPending?relay    6
     ??ZMacPwrOnReq?relay                   6
     ??ZMac_PwrMode?relay                   6
     ??ZMacSetTransmitPower?relay           6
     ??ZMacSendNoData?relay                 6
     ??ZMacStateIdle?relay                  6

 
 1 081 bytes in segment BANKED_CODE
   150 bytes in segment BANK_RELAYS
     6 bytes in segment XDATA_Z
 
 1 231 bytes of CODE  memory
     6 bytes of XDATA memory

Errors: none
Warnings: none
